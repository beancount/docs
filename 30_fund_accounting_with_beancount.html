<!DOCTYPE html>

<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="https://beancount.github.io/docs/30_fund_accounting_with_beancount.html" rel="canonical"/>
<link href="img/favicon.ico" rel="shortcut icon"/>
<title>Fund Accounting with Beancount - Beancount Documentation</title>
<link href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" rel="stylesheet">
<link href="css/theme.css" rel="stylesheet">
<link href="css/theme_extra.css" rel="stylesheet"/>
<link href="css/custom.css" rel="stylesheet"/>
<script>
    // Current page data
    var mkdocs_page_name = "Fund Accounting with Beancount";
    var mkdocs_page_input_path = "30_fund_accounting_with_beancount.md";
    var mkdocs_page_url = "/docs/30_fund_accounting_with_beancount.html";
  </script>
<script defer="" src="js/jquery-2.1.1.min.js"></script>
<script defer="" src="js/modernizr-2.8.3.min.js"></script>
</link></link></head>
<body class="wy-body-for-nav" role="document">
<div class="wy-grid-for-nav">
<nav class="wy-nav-side stickynav" data-toggle="wy-nav-shift">
<div class="wy-side-scroll">
<div class="wy-side-nav-search">
<a class="icon icon-home" href="."> Beancount Documentation</a>
<div role="search">
<form action="./search.html" class="wy-form" id="rtd-search-form" method="get">
<input name="q" placeholder="Search docs" title="Type search term here" type="text"/>
</form>
</div>
</div>
<div aria-label="main navigation" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation">
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">Index</a>
</li>
</ul>
<p class="caption"><span class="caption-text">Outline</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="#">Documentation for Users</a>
<ul>
<li class="toctree-l2"><a class="reference internal" href="01_command_line_accounting_in_context.html">Command Line Accounting in Context</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="02_the_double_entry_counting_method.html">The Double Entry Counting Method</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="03_installing_beancount.html">Installing Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="04_running_beancount_and_generating_reports.html">Running Beancount and Generating Reports</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="05_getting_started_with_beancount.html">Getting Started with Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="06_beancount_language_syntax.html">Beancount Language Syntax</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="07_beancount_options_reference.html">Beancount Options Reference</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="08_precision_tolerances.html">Precision Tolerances</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="09_beancount_query_language.html">Beancount Query Language</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="10_beancount_cheat_sheet.html">Beancount Cheat Sheet</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="11_how_inventories_work.html">How Inventories Work</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="12_exporting_your_portfolio.html">Exporting Your Portfolio</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="13_tutorial_example.html">Tutorial &amp; Example</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="14_beancount_history_and_credits.html">Beancount History and Credits</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="15_a_comparison_of_beancount_and_ledger_hledger.html">A Comparison of Beancount and Ledger Hledger</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="16_fetching_prices_in_beancount.html">Fetching Prices in Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="17_importing_external_data.html">Importing External Data</a>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#">Cookbooks &amp; Examples</a>
<ul>
<li class="toctree-l2"><a class="reference internal" href="18_command_line_accounting_cookbook.html">Command Line Accounting Cookbook</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="19_trading_with_beancount.html">Trading with Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="20_stock_vesting_in_beancount.html">Stock Vesting in Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="21_sharing_expenses_with_beancount.html">Sharing Expenses with Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="22_how_we_share_expenses.html">How We Share Expenses</a>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#">Documentation for Developers</a>
<ul>
<li class="toctree-l2"><a class="reference internal" href="23_beancount_scripting_plugins.html">Beancount Scripting Plugins</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="24_beancount_design_doc.html">Beancount Design Doc</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="25_ledgerhub_design_doc.html">Ledgerhub Design Doc</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="26_external_contributions.html">External Contributions</a>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal current" href="#">Enhancement Proposals &amp; Discussions</a>
<ul class="current">
<li class="toctree-l2"><a class="reference internal" href="27_a_proposal_for_an_improvement_on_inventory_booking.html">A Proposal for an Improvement on Inventory Booking</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="28_settlement_dates_in_beancount.html">Settlement Dates in Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="29_balance_assertions_in_beancount.html">Balance Assertions in Beancount</a>
</li>
<li class="toctree-l2 current"><a class="reference internal current" href="30_fund_accounting_with_beancount.html">Fund Accounting with Beancount</a>
<ul class="current">
<li class="toctree-l3"><a class="reference internal" href="#motivation">Motivation</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#what-is-fund-accounting">What is Fund Accounting?</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#joint-account-management">Joint Account Management</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#handling-multiple-funds">Handling Multiple Funds</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#ideas-for-implementation">Ideas for Implementation</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#examples">Examples</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#without-funds">Without Funds</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#using-funds">Using Funds</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#transfer-accounts-proposal">Transfer Accounts Proposal</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#account-aliases">Account Aliases</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="31_rounding_precision_in_beancount.html">Rounding Precision in Beancount</a>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api_reference/index.html">beancount</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="api_reference/beancount.core.html">beancount.core</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="api_reference/beancount.ingest.html">beancount.ingest</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="api_reference/beancount.loader.html">beancount.loader</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="api_reference/beancount.ops.html">beancount.ops</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="api_reference/beancount.parser.html">beancount.parser</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="api_reference/beancount.plugins.html">beancount.plugins</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="api_reference/beancount.prices.html">beancount.prices</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="api_reference/beancount.query.html">beancount.query</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="api_reference/beancount.reports.html">beancount.reports</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="api_reference/beancount.scripts.html">beancount.scripts</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="api_reference/beancount.tools.html">beancount.tools</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="api_reference/beancount.utils.html">beancount.utils</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="api_reference/beancount.web.html">beancount.web</a>
</li>
</ul>
</div>
</div>
</nav>
<section class="wy-nav-content-wrap" data-toggle="wy-nav-shift">
<nav aria-label="top navigation" class="wy-nav-top" role="navigation">
<i class="fa fa-bars" data-toggle="wy-nav-top"></i>
<a href=".">Beancount Documentation</a>
</nav>
<div class="wy-nav-content">
<div class="rst-content">
<div aria-label="breadcrumbs navigation" role="navigation">
<ul class="wy-breadcrumbs">
<li><a href=".">Docs</a> »</li>
<li>Enhancement Proposals &amp; Discussions »</li>
<li>Outline »</li>
<li>Fund Accounting with Beancount</li>
<li class="wy-breadcrumbs-aside">
<a class="icon icon-github" href="https://github.com/beancount/docs/edit/master/docs/30_fund_accounting_with_beancount.md"> Edit on GitHub</a>
</li>
</ul>
<hr/>
</div>
<div role="main">
<div class="section">
<h1 id="fund-accounting-with-beancount">Fund Accounting with Beancount<a id="title"></a><a class="headerlink" href="#fund-accounting-with-beancount" title="Permanent link"></a></h1>
<p><a href="http://plus.google.com/+MartinBlais"><span class="underline">Martin Blais</span></a>, Carl Hauser, August 2014</p>
<p><a href="http://furius.ca/beancount/doc/proposal-funds"><span class="underline">http://furius.ca/beancount/doc/proposal-funds</span></a></p>
<p><em>A discussion about how to carry out fund accounting within Beancount, various approaches, solutions and possible extensions.</em></p>
<h2 id="motivation">Motivation<a id="motivation"></a><a class="headerlink" href="#motivation" title="Permanent link"></a></h2>
<p>Multiple users are attempting to solve the problem of fund accounting using command-line accounting systems, partially because this type of accounting occurs in the context of non-profit organizations that have small budgets and would prefer to use free software, and partially because the flexibility and customization required appear to be a good fit for command-line bookkeeping systems.</p>
<h2 id="what-is-fund-accounting">What is Fund Accounting?<a id="what-is-fund-accounting"></a><a class="headerlink" href="#what-is-fund-accounting" title="Permanent link"></a></h2>
<p>For example, see <a href="https://groups.google.com/d/msg/ledger-cli/N8Slh2t45K0/nu1ZACCueQYJ"><span class="underline">this thread</span></a>:</p>
<blockquote>
<p><em>“Another religious duty I compute is effectively tithing (we call it Huqúqu'lláh, and it's computed differently, but that's another story). In order to compute the tithe owed, I accrue 19% of every deposit to a virtual account, and then subtract from that account 19% of every needful expenditure.</em></p>
<p><em>The total remaining at the end of the year is what I owe in tithe. This tithing account is not a real account, as it exists in no financial institution; but it is real enough as a personal duty. By using virtual account, I can track this "side-band" Liability, and then pay it off from an assets account when the time comes. If I report with --real I will simply see how much I've paid to this Liability; and if I report without --real I see how much Huqúqu'lláh is presently owed.”</em></p>
<p><em>— John Wiegley</em></p>
</blockquote>
<p>Here’s another description, as a comment from another user:</p>
<blockquote>
<p><em>[...] basically the idea that you split your financial life into separate pots called "funds". Each fund has its own chart of accounts (to a certain extent) and each fund obeys Assets+Liabilities+Equities == 0. This is often needed in non-profits where money given for specific purposes has to be accounted separately. The one area of non-separation is that actual asset accounts (e.g. bank accounts) and actual liability accounts (credit cards) may hold or owe money on behalf of multiple funds, so you can't use entirely separate ledger files. At our church we use a program called PowerChurchPlus for this and it works really well. My wife is now treasurer for a community music organization and facing the same problem but on such a small scale that the cost of a commercial program isn't warranted.</em></p>
<p><em>I've seen what was posted in the ledger-cli list about non-profit accounting using C++ ledger and it just looks like it requires way too much discipline to use the tags correctly and consistently. The fund idea is much easier to explain and use (and the balance account invariant naturally enforced). So I was looking at the Beancount code to see whether I could adapt it to support fund accounting. I think the answer is "yes and relatively easily so". Furthermore, I think this idea has uses even for individuals: a couple of scenarios present themselves. First, I live in a community property state. My wife and I are each likely to inherit property which will be ours individually, but we also have the community property. These can each be treated as a separate fund and we will be able to report on them separately but also together for understanding our overall financial situation. Similarly, it potentially makes sense to account for retirement money with a separate fund for each person.</em></p>
<p><em>— Carl Hauser</em></p>
</blockquote>
<p>From the PowerChurchPlus 11.5 Manual (PowerChurch, Inc. 2013):</p>
<blockquote>
<p><em>“In accounting, the term fund has a very specific meaning. An Accounting Fund is a self-balancing Chart of Accounts. [...] In accounting we need to think of a fund as a division, or sub-group of your church. Each Accounting Fund has its own assets, liabilities, equity, income, transfer and expense accounts.</em></p>
<p><em>So when would you use an additional fund? If you have an area of your church that needs to produce its own reporting, you would need to use an additional fund. For example, if your church operates a preschool or play school, you might want to set up an additional fund to keep their finances separate from the church's. Depending on your needs, you might want to setup a separate fund for the men's or women's group. You might even setup a new fund to keep track of all fixed assets separately from the daily operating accounts.”</em></p>
</blockquote>
<p>This is an interesting and apparently common problem. We will describe use cases in the rest of this section.</p>
<h3 id="joint-account-management">Joint Account Management<a id="joint-account-management"></a><a class="headerlink" href="#joint-account-management" title="Permanent link"></a></h3>
<p>I have personally used this “fund accounting” idea to manage a joint account that I had with my ex-wife, where we would both hold individual accounts—we were both working professionals— and chip in to the joint account as needed. This section describes how I did this<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup>.</p>
<p>The accounting for the joint account was held in a separate file. Two sub-accounts were created to hold each of our “portions”:</p>
<pre><code>2010-01-01 open Assets:BofA:Joint         
2010-01-01 open Assets:BofA:Joint:Martin  
2010-01-01 open Assets:BofA:Joint:Judie
</code></pre>
<p>Transfers to the joint account were directly booked into one of the two sub-account:</p>
<pre><code>2012-09-07 * "Online Xfer Transfer from CK 345"
  Assets:BofA:Joint:Judie          1000.00 USD
  Income:Contributions:Judie
</code></pre>
<p>When we would incur expenses, we would reduce the asset account with two legs, one for each subaccount. We often booked them 2:1 to account for difference in income, or I just booked many of the transactions to myself (the fact that it was precisely accounted for does not imply that we weren’t being generous to each other in that way):</p>
<pre><code>2013-04-27 * "Urban Vets for Grumpy"
  Expenses:Medical:Cat           100.00 USD
  Assets:BofA:Joint:Martin          -50 USD
  Assets:BofA:Joint:Judie           -50 USD

2013-05-30 * "Takahachi"  "Dinner"
  Expenses:Food:Restaurant        65.80 USD
  Assets:BofA:Joint:Judie        -25.00 USD
  Assets:BofA:Joint:Martin
</code></pre>
<p>It was convenient to elide one of the two amounts, as we weren’t being very precise about this.</p>
<h3 id="handling-multiple-funds">Handling Multiple Funds<a id="handling-multiple-funds"></a><a class="headerlink" href="#handling-multiple-funds" title="Permanent link"></a></h3>
<p><em>(Contributed from Carl Hauser)</em></p>
<p>Here’s the model used in the PowerChurchPlus system that is mentioned above (replacing the account numbers it uses with Beancount-style names). “Fund” names are <em>prefixed</em> to the account names.</p>
<pre><code>Operations:Assets:Bank:...
Endowment:Assets:Bank:...
Operations:Liabilities:CreditCard:...
Endowment:Liabilities:CreditCard:...
Operations:Income:Pledges:2014
Operations:Expenses:Salaries:...
Operations:Expenses:BuildingImprovement:...
Endowment:Income:Investments:...
Endowment:Expenses:BuildingImprovement:...
…
</code></pre>
<p>It is required that any transaction be balanced in every fund that it uses. For example, our Endowment fund often helps pay for things that are beyond the reach of current donations income.</p>
<pre><code>2014-07-25 * "Bill’s Audio" "Sound system upgrade"
   Endowment:Assets:Bank1:Checking        800.00 USD
   Operations:Assets:Bank1:Checking       200.00 USD
   Endowment:Expenses:BuildingImprovement:Sound -800.00 USD
   Operations:Expenses:BuildingImprovement:Sound -200.00 USD
</code></pre>
<p>This represents a single check to Bill’s Audio paid from assets of both the Endowment and Operations funds that are kept in the single external assets account <code>Assets:Bank1:Checking.</code></p>
<p><strong>Note 1:</strong> An empty fund name could be allowed and the following “:” omitted, and in fact could be the default for people who don’t want to use these features. (i.e., nothing changes if you don’t use these features.) The Fund with the empty string for its name is, of course, distinct from all other Funds.</p>
<p><strong>Note 2:</strong> <code>balance</code> and <code>pad</code> directives are not very useful with accounts that participate in more than one Fund. Their use would require knowing the allocation of the account between the different funds and account statements from external holders (banks, e.g.) will not have this information. It might be useful to allow something like</p>
<pre><code>2014-07-31 balance *:Assets:Bank1:Checking     579.39 USD
</code></pre>
<p>as a check that things were right, but automatically correcting it with <code>pad</code> entries seems impossible.</p>
<p>A balance sheet report can be run on any Fund <em>or any combination of Funds</em> and it will balance. You can keep track of what is owned for each different purpose easily. Transfers between funds are booked as expenses and decreases in the assets of one fund and income and increases in assets of the other. The income and expense accounts used for transfers may be generic (<code>Operations:Income:Transfer</code>) or you can use accounts set up for a particular kind of income or expense (<code>Endowment:Expense:BuildingImprovement:Sound</code>) would be fine as one leg of a transfer transaction.</p>
<p>The account name syntax here is just one way it might work and relies on Beancount’s use of five specifically-named top-level accounts. Anything to the left of the first of those could be treated as a fund name, or a different separator could be used between the fund part and the account name part. Similarly, I’ve only shown single-level fund names but they might be hierarchical as well. I’m not sure of the value of that, but observe that if transactions balance at the leaf-level funds they will also balance for funds higher in the hierarchy and there might be some mileage there.</p>
<p>For John W.’s <em>Huqúqu'lláh</em> example one might set up a Fund whose liabilities were “moral obligations” rather than legal ones (that seems to be the objection to simply tracking the tithes in an ordinary liability account). As income comes in (say, direct deposited in a real bank checking account), book 19% of it to the “moral obligation” fund’s checking account with a matching liability. When needful expenses are made, take back 19% from the “moral obligation” fund’s checking account and reduce the liability. No virtual postings or transactions -- everything must balance. This would work well if for example we were to have a <code>HisRetirement</code> fund and a <code>HerRetirement</code> fund -- useful to have separate for estate planning purposes -- but more commonly we want to know about our combined retirement which could be defined to be a <em>virtual</em> fund <code>OurRetirement</code> equal to the sum of <code>HisRetirement</code> and <code>HerRetirement</code>. Note that this only matters when creating reports: there is no need to do anything except normal, double-entry booking with balanced transactions in each <em>real</em> fund. When I say the “sum” of two funds I mean a combination of taking the union of the contained account names, after stripping off the fund names, then summing the balances of the common accounts and keeping the balances of the others.</p>
<p><em>(Balance Sheet)</em> For reporting, one wants the capability for balance by fund and balance summed over a set of funds. I also use a report that shows a subset of funds, one per column, with corresponding account names lined up horizontally and a column at the right that is the “sum”. When all funds are included in this latter report you get a complete picture of what you own and owe and what is set aside for different purposes, or restricted in different ways. Here’s a small sample of a balance sheet for a subset of the church Funds. The terminology is a little different: what Beancount calls Equity is here Net Assets. And because using large numbers of Funds in PowerChurchPlus is not so easy, the NetAssets are actually categorized for different purposes -- this is where I think the ideas we’re exploring here can really shine: if Funds are really easy to create and combine for reporting then some of the mechanisms that PCP has for divvying up assets within a fund become unnecessary. <img alt="samplebalsheet.jpg" src="30_fund_accounting_with_beancount/media/8c56573ed54aa0aff877dee48727a6f485015884.jpg" style="width:6.5in;height:3.76389in"/></p>
<p><em>(Income Statement)</em> For the Income and Expense report, usually I only care about expenses in one Fund at a time, but adding two funds together makes perfect sense if that’s what you need to do.</p>
<p>For me, this approach to fund accounting is appealing because it relies on and preserves the fundamental principles of double-entry bookkeeping: when transactions sum to 0 the balance sheet equation is always true. Out of this we automatically get the ability to combine <em>any set of funds</em> (we don’t have to do anything special when entering transactions or organizing the deep structure of the accounts) and have it make at least arithmetical sense, and we don’t rely on any “magic” associated with renaming or tagging. I don’t see how this can be so easily or neatly achieved by pushing the idea of the “funds” down into the account hierarchy: funds belong <em>above</em> the five root accounts (Assets, Liabilities, Equity, Income and Expenses), not below them.</p>
<h2 id="ideas-for-implementation">Ideas for Implementation<a id="ideas-for-implementation"></a><a class="headerlink" href="#ideas-for-implementation" title="Permanent link"></a></h2>
<p><strong><em>Some random ideas for now. This needs a bit more work.</em></strong></p>
<ul>
<li>
<p>If multiple redundant postings are required, the generation of these can be <strong>automated using a <a href="23_beancount_scripting_plugins.html"><span class="underline">plugin</span></a></strong>. For instance, if a technique similar to <a href="http://furius.ca/beancount/doc/mirror"><span class="underline">mirror accounting</span></a> is used in order to “send the same dollars to multiple accounts”, at least the user should not have to do this manually, which would be both tedious and prone to errors.</p>
</li>
<li>
<p>A procedure to <strong>rename accounts</strong> upon parsing could be used, in order to merge multiple files into one. (Allowing the user to install such a mapping is an idea I’ve had for a while but never implemented, though it could be implemented by a plugin filter.)</p>
</li>
<li>
<p>We can rely on the fact that the transactions of <strong>subaccounts may be joined and summed in a parent account</strong> (despite the fact that reporting is lagging behind in that matter at the moment. It will be implemented eventually).</p>
</li>
<li>
<p>Building off the earlier remark about doing something similar to the tag stack for Funds. What if the current tag architecture were extended to allow tags to have a value, <code>#fund=Operations,</code> or <code>#fund=Endowment</code>. Call them value-tags. You would also need to allow postings to have tags. Semantics of value-tags would be that they could only occur once for any posting, that a tag explicitly on a posting overrides the value-tag inherited from the transaction, and that an explicit tag on a transaction overrides a value from the tag-stack, and that only the last value-tag (with a particular key) in the tag-stack is applied to a transaction. This makes Funds a little less first-class than the earlier proposal to stick them in front of account names, but gets around the minor parsing difficulty previously mentioned. It suggests that opening of accounts within funds is not necessary where the previous syntax suggests that it is. The strict balancing rule for each fund in a transaction can still be implemented as a plugin. And reporting for a fund (or sum of funds) looks like:</p>
<ul>
<li>
<p>select transactions with any posting matching the desired fund (or funds)</p>
</li>
<li>
<p>collect (and sum if necessary in the obvious way) postings associated with the fund (or funds) being reported on (A)</p>
</li>
<li>
<p>collect (and sum in the obvious way) postings from the selected transactions not associated with the desired fund (B)</p>
</li>
<li>
<p>Format a report with (A) as the information for the desired fund or funds and (B) as OTHER. OTHER is needed to make sure that the report balances, but could be omitted by choice.</p>
</li>
</ul>
</li>
</ul>
<!-- -->
<pre><code>From an implementation perspective this seems more orthogonal to the current status quo, requiring even less change to existing code. It adds a new feature -- value tags and that can then be used by plugins and new reports to do what we want for fund accounting.
</code></pre>
<h2 id="examples">Examples<a id="examples"></a><a class="headerlink" href="#examples" title="Permanent link"></a></h2>
<p><em>(Carl)</em> Here is an example of how I might try to handle things associated with my paycheck, which involves deferred compensation (403(b) -- extremely similar to a 401(k)) and a Flexible Spending Account (somewhat similar to an HSA which has been discussed previously on the ledger-cli group).</p>
<h3 id="without-funds">Without Funds<a id="without-funds"></a><a class="headerlink" href="#without-funds" title="Permanent link"></a></h3>
<p>(Carl) First, without Funds (this passes a bean-check):</p>
<p>This is how I might set up my pay stub with health insurance, an FSA and 403b contributions in the absence of Funds. One problem is that it distributes Gross Income directly into the 403b and FSA accounts even though it recognizes that the health insurance contribution is a reduction in salary which the 403b and FSA ought to be as well. So tracking contributions to both of those is made more difficult as well as tracking taxable income.</p>
<p>By thinking hard we could fix this -- we would come up with Income and Expense type accounts to represent the contributions, but they would end up looking kind of silly (in my opinion) because they are entirely internal to the accounts system.</p>
<p>See the next example for how it would look using Funds. If you stick out your tongue, rub your tummy and stand on your head you will see that the Funds-based solution is equivalent to what we would have come up with in the paragraph above in terms of the complexity of its transactions -- just as many lines are required. The advantage is primarily a mental one -- it is much easier to see what to do to be both consistent and useful.</p>
<pre><code>option “title” “Paystub - no funds”

2014-07-15 open Assets:Bank:Checking
2014-07-15 open Assets:CreditUnion:Saving
2014-07-15 open Assets:FedIncTaxDeposits
2014-07-15 open Assets:Deferred:R-403b
2014-07-15 open Expenses:OASI
2014-07-15 open Expenses:Medicare
2014-07-15 open Expenses:MedicalAid
2014-07-15 open Expenses:SalReduction:HealthInsurance
2014-07-15 open Income:Gross:Emp1
2014-07-15 open Income:EmplContrib:Emp1:Retirement
2014-01-01 open Assets:FSA

; This way of setting up an FSA looks pretty good. It recognizes the
; rule that the designated amount for the year is immediately available
; (in the Asset account), and that we are obliged to make contributions
; to fund it over the course of the year (the Liability account).
2014-01-01 open Liabilities:FSA
2014-01-01 ! "Set up FSA for 2014"
  Assets:FSA                                                    2000 USD
  Liabilities:FSA                                               -2000 USD

2014-07-15 ! "Emp1 Paystub"
  Income:Gross:Emp1                                             -6000 USD
  Assets:Bank:Checking                                          3000 USD
  Assets:CreditUnion:Saving                                     1000 USD
  Assets:FedIncTaxDeposits                                      750 USD
  Expenses:OASI                                                 375 USD
  Expenses:Medicare                                             100 USD
  Expenses:MedicalAid                                           10 USD
  Assets:Deferred:R-403b                                        600 USD
  Liabilities:FSA                                               75 USD
  Expenses:SalReduction:HealthInsurance                         90 USD
  Income:EmplContrib:Emp1:Retirement                            -600 USD
  Assets:Deferred:R-403b

2014-01-01 open Expenses:Medical
2014-07-20 ! "Direct expense from FSA"
  Expenses:Medical                                              25 USD
  Assets:FSA

2014-07-20 ! "Medical expense from checking"
  Expenses:Medical                                              25 USD
  Assets:Bank:Checking

2014-07-20 ! "Medical expense reimbursed from FSA"
  Assets:Bank:Checking                                          25 USD
  Assets:FSA
</code></pre>
<h3 id="using-funds">Using Funds<a id="using-funds"></a><a class="headerlink" href="#using-funds" title="Permanent link"></a></h3>
<p>(Carl) And now using Funds (uses proposed features and hence can’t be checked by bean-check):</p>
<p>This is how I might set up my pay stub with health insurance, an FSA and 403b contributions using Funds. I can straightforwardly arrange things so that contributions to the FSA and 403b are recognized as salary reductions for income tax purposes. And I can easily see how much I have contributed to the 403b and how much my employer has contributed.</p>
<p>See the previous example for how it would look without using Funds and which is not as accurate.</p>
<p>What this does NOT do is track taxes ultimately owed on the 403b money. I think that is a matter of one's decision about whether to do cash-basis or accrual-basis accounting. If cash basis those taxes are not a current liability and cannot be reported as such. If accrual basis, they are a current liability and need to be recorded as such when the income is booked.</p>
<p>For cash-basis books, we'd want the ability to report the state of affairs as if taxes were owed, but that is a matter for reporting rather than booking. We need to make sure we have enough identifiable information to automate creating those reports. I believe that taking a Fund-based accounting perspective easily does this.</p>
<p>A problem not solved: what if your basis is different for Federal and State purposes, or even for Federal and multiple different states. Yikes!</p>
<p>I've used the convention that the Fund name precedes the root account name. Note that with appropriate standing on one's head along with pivoting rules you can put the Fund name anywhere. Putting it first emphasizes that it identifies a set of accounts that must balance, and it makes it easy for the txn processor to guarantee this property. Accounts without a fund name in front belong to the Fund whose name is the empty string.</p>
<pre><code>option "title" "Paystub - no Funds"

2014-07-15 open Assets:Bank:Checking
2014-07-15 open Assets:CreditUnion:Saving
2014-07-15 open Assets:FedIncTaxDeposits
2014-07-15 open Expenses:OASI
2014-07-15 open Expenses:Medicare
2014-07-15 open Expenses:MedicalAid
2014-07-15 open Expenses:SalReduction:HealthInsurance
2014-07-15 open Expenses:SalReduction:FSA
2014-07-15 open Expenses:SalReduction:R-403b
2014-07-15 open Income:Gross:Emp1
2014-07-15 open Income:EmplContrib:Emp1:Retirement
2014-01-01 open FSA:Assets                      ; FSA fund accounts
2014-01-01 open FSA:Income:Contributions
2014-01-01 open FSA:Expenses:Medical
2014-01-01 open FSA:Expenses:ReimburseMedical
2014-01-01 open FSA:Liabilities
2014-07-15 open Retirement403b:Assets:CREF      ; Retirement fund accounts
2014-07-15 open Retirement403b:Income:EmployeeContrib
2014-07-15 open Retirement403b:Income:EmployerContrib
2014-07-15 open Retirement403b:Income:EarningsGainsAndLosses

; This implements the same idea as above for the FSA, of balancing
; Assets and Liabilities at the opening, but now does it using a 
; separate Fund.
2014-01-01 ! "Set up FSA for 2014"
  FSA:Assets                                                    2000 USD
  FSA:Liabilities                                               -2000 USD

2014-07-15 ! "Emp1 Paystub"
  Income:Gross:Emp1                                             -6000 USD
  Assets:Bank:Checking                                          3000 USD
  Assets:CreditUnion:Saving                                     1000 USD
  Assets:FedIncTaxDeposits                                      750 USD
  Expenses:OASI                                                 375 USD
  Expenses:Medicare                                             100 USD
  Expenses:MedicalAid                                           10 USD
  Expenses:SalReduction:R-403b                                  600 USD
  Retirement403b:Income:EmployeeContrib                         -600 USD
  Retirement403b:Assets:CREF                                    600 USD
  Expenses:SalReduction:FSA                                     75 USD
  FSA:Income:Contributions                                      -75 USD
  FSA:Liabilities                                                
  Expenses:SalReduction:HealthInsurance                          
  Retirement403b:Income:EmployerContrib                         -600 USD
  Retirement403b:Assets:CREF

2014-01-01 open Expenses:Medical
2014-07-20 ! "Direct expense from FSA"
  FSA:Expenses:Medical                                          25 USD
  FSA:Assets

2014-07-20 ! "Medical expense from checking"
  Expenses:Medical                                              25 USD
  Assets:Bank:Checking

2014-07-20 ! "Medical expense reimbursed from FSA"
  Assets:Bank:Checking                                          25 USD
  Income:ReimburseMedical
  FSA:Assets                                                   -25 USD
  FSA:Expenses:ReimburseMedical
</code></pre>
<h2 id="transfer-accounts-proposal">Transfer Accounts Proposal<a id="transfer-accounts-proposal"></a><a class="headerlink" href="#transfer-accounts-proposal" title="Permanent link"></a></h2>
<p>One problem that I’ve experienced using the Fund approach is that it’s a bit too easy to make mistakes when transferring money between funds, such as in the very last transaction above. Formalizing the idea of Transfer accounts can help with this. The most common mistake is to end up with something that moves assets in both accounts in the same direction -- both up or both down as in this mistaken version of the transaction in question:</p>
<pre><code>2014-07-20 ! "Medical expense reimbursed from FSA - with mistake"
 Assets:Bank:Checking                            25 USD
 Income:ReimburseMedical
 FSA:Assets                                      25 USD
 FSA:Expenses:ReimburseMedical
</code></pre>
<p>This balances but isn’t what we intended. Suppose we add the idea of Transfer accounts. They live at the same place in the hierarchy as Income and Expenses and like those are non-balance-sheet accounts. But they really come into play only for transactions that involve multiple funds. There is an additional rule for transactions containing Transfer accounts: the sum of the transfers must also be zero (additional in the sense that the rule about transactions balancing within each fund is still there). So to use this we set things up a little differently:</p>
<pre><code>2014-07-15 open FSA:Transfer:Incoming:Contribution
2014-07-15 open FSA:Transfer:Outgoing:ReimburseMedical
2014-07-15 open Transfer:Outgoing:FSAContribution
2014-07-15 open Transfer:Incoming:ReimburseMedical
</code></pre>
<p>The incorrect transaction is now flagged because sum of the transfers is <code>-50 USD</code>, not zero.</p>
<pre><code>2014-07-20 ! "Medical expense reimbursed from FSA - with mistake"
  Assets:Bank:Checking                                    25 USD
  Transfer:Incoming:ReimburseMedical
  FSA:Assets                                              25 USD
  FSA:Transfer:Outgoing:ReimburseMedical
</code></pre>
<p>The paycheck transaction using transfer accounts for the FSA and the retirement account amounts might look like this (after appropriate <code>open</code>s of course):</p>
<pre><code>2014-07-15 ! "Emp1 Paystub - using transfer accounts"
  Income:Gross:Emp1                                      -6000 USD
  Assets:Bank:Checking                                    3000 USD
  Assets:CreditUnion:Saving                               1000 USD
  Assets:FedIncTaxDeposits                                 750 USD
  Expenses:OASI                                            375 USD
  Expenses:Medicare                                        100 USD
  Expenses:MedicalAid                                       10 USD
  Transfer:Outgoing:SalReduction          600 USD
  Retirement403b:Transfer:Incoming:EmployeeContrib
  Retirement403b:Assets:CREF                               600 USD
  Transfer:Outgoing:SalReduction                        75 USD
  FSA:Transfer:Incoming:Contributions
  FSA:Liabilities                                                   
  Expenses:SalReduction:HealthInsurance                              
  Retirement403b:Income:EmployerContrib                   -600 USD
  Retirement403b:Assets:CREF
</code></pre>
<p>Some might think that this is too complicated. Without changing the Transfer accounts idea or rule, you can simplify booking to just a single account per fund, <code>Fund:Transfer</code>, losing some ability for precision in reporting but without losing the ability to check correctness of transfer transactions.</p>
<h2 id="account-aliases">Account Aliases<a id="account-aliases"></a><a class="headerlink" href="#account-aliases" title="Permanent link"></a></h2>
<p>Simon Michael mentions that this is related to HLedger <a href="http://hledger.org/how-to-use-account-aliases"><span class="underline">account aliases</span></a>:</p>
<blockquote>
<p>“I think this is related to the situation where you want to view entities' finances both separately and merged. Account aliases can be another way to approximate this, as in<a href="http://hledger.org/how-to-use-account-aliases"><span class="underline">http://hledger.org/how-to-use-account-aliases</span></a>.”</p>
</blockquote>
<div class="footnote">
<hr/>
<ol>
<li id="fn:1">
<p>If you find yourself culturally challenged by our modern lifestyle, perhaps you can imagine the case of roommates, although I don’t like the reductionist view this association brings to my mind. <a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
</div>
</div>
<footer>
<div aria-label="footer navigation" class="rst-footer-buttons" role="navigation">
<a class="btn btn-neutral float-right" href="31_rounding_precision_in_beancount.html" title="Rounding Precision in Beancount">Next <span class="icon icon-circle-arrow-right"></span></a>
<a class="btn btn-neutral" href="29_balance_assertions_in_beancount.html" title="Balance Assertions in Beancount"><span class="icon icon-circle-arrow-left"></span> Previous</a>
</div>
<hr/>
<div role="contentinfo">
<!-- Copyright etc -->
</div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
</div>
</div>
</section>
</div>
<div aria-label="versions" class="rst-versions" role="note">
<span class="rst-current-version" data-toggle="rst-current-version">
<a class="fa fa-github" href="https://github.com/beancount/docs/" style="float: left; color: #fcfcfc"> GitHub</a>
<span><a href="29_balance_assertions_in_beancount.html" style="color: #fcfcfc;">« Previous</a></span>
<span style="margin-left: 15px"><a href="31_rounding_precision_in_beancount.html" style="color: #fcfcfc">Next »</a></span>
</span>
</div>
<script>var base_url = '.';</script>
<script defer="" src="js/theme.js"></script>
<script defer="" src="js/extra.js"></script>
<script defer="" src="search/main.js"></script>
<script defer="">
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>
</body>
</html>
