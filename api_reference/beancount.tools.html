<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="canonical" href="https://beancount.github.io/docs/api_reference/beancount.tools.html">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>beancount.tools - Beancount Documentation</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link href="../assets/_mkdocstrings.css" rel="stylesheet" />
  <link href="../css/custom.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "beancount.tools";
    var mkdocs_page_input_path = "api_reference/beancount.tools.md";
    var mkdocs_page_url = "/docs/api_reference/beancount.tools.html";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="icon icon-home"> Beancount Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../index.html">Index</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Outline</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="#">Documentation for Users</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../command_line_accounting_in_context.html">Command Line Accounting in Context</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../the_double_entry_counting_method.html">The Double Entry Counting Method</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../installing_beancount.html">Installing Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../running_beancount_and_generating_reports.html">Running Beancount and Generating Reports</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../getting_started_with_beancount.html">Getting Started with Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_language_syntax.html">Beancount Language Syntax</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_options_reference.html">Beancount Options Reference</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../precision_tolerances.html">Precision Tolerances</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_query_language.html">Beancount Query Language</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_cheat_sheet.html">Beancount Cheat Sheet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../how_inventories_work.html">How Inventories Work</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../exporting_your_portfolio.html">Exporting Your Portfolio</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../tutorial_example.html">Tutorial & Example</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_history_and_credits.html">Beancount History and Credits</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../a_comparison_of_beancount_and_ledger_hledger.html">A Comparison of Beancount and Ledger Hledger</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../fetching_prices_in_beancount.html">Fetching Prices in Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../importing_external_data.html">Importing External Data</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Cookbooks & Examples</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../command_line_accounting_cookbook.html">Command Line Accounting Cookbook</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../trading_with_beancount.html">Trading with Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../stock_vesting_in_beancount.html">Stock Vesting in Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../sharing_expenses_with_beancount.html">Sharing Expenses with Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../how_we_share_expenses.html">How We Share Expenses</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../health_care_expenses.html">Health Care Expenses</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../calculating_portolio_returns.html">Calculating Portfolio Returns</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../tracking_medical_claims.html">Tracking Out-of-Network Medical Claims in Beancount</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Documentation for Developers</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_scripting_plugins.html">Beancount Scripting Plugins</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_design_doc.html">Beancount Design Doc</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ledgerhub_design_doc.html">Ledgerhub Design Doc</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../external_contributions.html">External Contributions</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Enhancement Proposals & Discussions</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../a_proposal_for_an_improvement_on_inventory_booking.html">A Proposal for an Improvement on Inventory Booking</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../settlement_dates_in_beancount.html">Settlement Dates in Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../balance_assertions_in_beancount.html">Balance Assertions in Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../fund_accounting_with_beancount.html">Fund Accounting with Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../rounding_precision_in_beancount.html">Rounding Precision in Beancount</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Beancount 3</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_v3.html">Goals & Design</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../installing_beancount_v3.html">Installing Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_v3_dependencies.html">Dependencies</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beangulp.html">Beangulp</a>
                </li>
    </ul>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">API reference</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="index.html">beancount</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.core.html">beancount.core</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.loader.html">beancount.loader</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.ops.html">beancount.ops</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.parser.html">beancount.parser</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.plugins.html">beancount.plugins</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.scripts.html">beancount.scripts</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="beancount.tools.html">beancount.tools</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#beancount.tools">beancount.tools</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.tools.treeify">treeify</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.tools.treeify.Node">Node</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.tools.treeify.Node.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.tools.treeify.create_tree">create_tree()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.tools.treeify.dump_tree">dump_tree()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.tools.treeify.enum_tree_by_input_line_num">enum_tree_by_input_line_num()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.tools.treeify.find_column">find_column()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.tools.treeify.render_tree">render_tree()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.tools.treeify_test">treeify_test</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.tools.treeify_test.TestTreeifyBase">TestTreeifyBase</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.tools.treeify_test.TestTreeifyBase.treeify">treeify()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.tools.treeify_test.TestTreeifyBase.treeify_equal">treeify_equal()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.tools.treeify_test.treeify">treeify()</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.utils.html">beancount.utils</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Beancount Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
    
      
        
          <li>API reference &raquo;</li>
        
      
    
    <li>beancount.tools</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h1 id="beancounttools">beancount.tools<a class="headerlink" href="#beancounttools" title="Permanent link"></a></h1>


  <div class="doc doc-object doc-module">

<a id="beancount.tools"></a>
    <div class="doc doc-contents first">

      <p>Standalone tools that aren't linked to Beancount but that are useful with it.</p>
<p>The beancount.scripts package contains the implementation of scripts which
invoke the Beancount library code. This beancount.tools package implements other
tools which aren't directly invoking Beancount library code and which could be
theoretically copied and used independently. However, these are to be
distributed with Beancount and in order to maintain all the source code together
they are put in this package and invokes from stubs under beancount/bin/, just
like the other scripts.</p>



  <div class="doc doc-children">












  <div class="doc doc-object doc-module">



<h2 id="beancount.tools.treeify" class="doc doc-heading">
        <code>beancount.tools.treeify</code>



<a href="#beancount.tools.treeify" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Identify a column of text that contains hierarchical id and treeify that column.</p>
<p>This script will inspect a text file and attempt to find a vertically
left-aligned column of text that contains identifiers with multiple components,
such as "Assets:US:Bank:Checking", and replace those by a tree-like structure rendered
in ASCII, inserting new empty lines where necessary to create the tree.</p>
<p>Note: If your paths have spaces in them, this will not work. Space is used as a
delimiter to detect the end of a column. You can customize the delimiter with an
option.</p>



  <div class="doc doc-children">




















  <div class="doc doc-object doc-class">



<h3 id="beancount.tools.treeify.Node" class="doc doc-heading">
        <code>
beancount.tools.treeify.Node            (<span title="list">list</span>)
        </code>



<a href="#beancount.tools.treeify.Node" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A node with a name attribute, a list of line numbers and a list of children
(from its parent class).</p>




  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h4 id="beancount.tools.treeify.Node.__repr__" class="doc doc-heading">
<code class="highlight language-python">beancount.tools.treeify.Node.__repr__(self)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.tools.treeify.Node.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return str(self).</p>

        <details class="quote">
          <summary>Source code in <code>beancount/tools/treeify.py</code></summary>
          <pre class="highlight"><code class="language-python">def __str__(self):
    return '&lt;Node {} {}&gt;'.format(self.name, [node.name for node in self])
</code></pre>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>





  <div class="doc doc-object doc-function">



<h3 id="beancount.tools.treeify.create_tree" class="doc doc-heading">
<code class="highlight language-python">beancount.tools.treeify.create_tree(column_matches, regexp_split)</code>


<a href="#beancount.tools.treeify.create_tree" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Build up a tree from a list of matches.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>column_matches</strong> – A list of (line-number, name) pairs.</p></li>
            <li><p><strong>regexp_split</strong> – A regular expression string, to use for splitting the names
of components.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>An instance of Node, the root node of the created tree.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/tools/treeify.py</code></summary>
          <pre class="highlight"><code class="language-python">def create_tree(column_matches, regexp_split):
    """Build up a tree from a list of matches.

    Args:
      column_matches: A list of (line-number, name) pairs.
      regexp_split: A regular expression string, to use for splitting the names
        of components.
    Returns:
      An instance of Node, the root node of the created tree.
    """
    root = Node('')
    for no, name in column_matches:
        parts = re.split(regexp_split, name)
        node = root
        for part in parts:
            last_node = node[-1] if node else None
            if last_node is None or last_node.name != part:
                last_node = Node(part)
                node.append(last_node)
            node = last_node
        node.nos.append(no)
    return root
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.tools.treeify.dump_tree" class="doc doc-heading">
<code class="highlight language-python">beancount.tools.treeify.dump_tree(node, file=&lt;_io.StringIO object at 0x72972ba25a80&gt;, prefix='')</code>


<a href="#beancount.tools.treeify.dump_tree" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Render a tree as a tree.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>node</strong> – An instance of Node.</p></li>
            <li><p><strong>file</strong> – A file object to write to.</p></li>
            <li><p><strong>prefix</strong> – A prefix string for each of the lines of the children.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/tools/treeify.py</code></summary>
          <pre class="highlight"><code class="language-python">def dump_tree(node, file=sys.stdout, prefix=''):
    """Render a tree as a tree.

    Args:
      node: An instance of Node.
      file: A file object to write to.
      prefix: A prefix string for each of the lines of the children.
    """
    file.write(prefix)
    file.write(node.name)
    file.write('\n')
    for child in node:
        dump_tree(child, file, prefix + '... ')
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.tools.treeify.enum_tree_by_input_line_num" class="doc doc-heading">
<code class="highlight language-python">beancount.tools.treeify.enum_tree_by_input_line_num(tree_lines)</code>


<a href="#beancount.tools.treeify.enum_tree_by_input_line_num" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Accumulate the lines of a tree until a line number is found.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>tree_lines</strong> – A list of lines as returned by render_tree.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  Pairs of (line number, list of (line, node)).</p>

        <details class="quote">
          <summary>Source code in <code>beancount/tools/treeify.py</code></summary>
          <pre class="highlight"><code class="language-python">def enum_tree_by_input_line_num(tree_lines):
    """Accumulate the lines of a tree until a line number is found.

    Args:
      tree_lines: A list of lines as returned by render_tree.
    Yields:
      Pairs of (line number, list of (line, node)).
    """
    pending = []
    for first_line, cont_line, node in tree_lines:
        if not node.nos:
            pending.append((first_line, node))
        else:
            line = first_line
            for no in node.nos:
                pending.append((line, node))
                line = cont_line
                yield (no, pending)
                pending = []
    if pending:
        yield (None, pending)
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.tools.treeify.find_column" class="doc doc-heading">
<code class="highlight language-python">beancount.tools.treeify.find_column(lines, pattern, delimiter)</code>


<a href="#beancount.tools.treeify.find_column" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Find a valid column with hierarchical data in the text lines.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>lines</strong> – A list of strings, the contents of the input.</p></li>
            <li><p><strong>pattern</strong> – A regular expression for the hierarchical entries.</p></li>
            <li><p><strong>delimiter</strong> – A regular expression that dictates how we detect the
end of a column. Normally this is a single space. If the patterns
contain spaces, you will need to increase this.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>A tuple of
  matches</code> – A list of (line-number, name) tuples where 'name' is the
    hierarchical string to treeify and line-number is an integer, the
    line number where this applies.
  left: An integer, the leftmost column.
  right: An integer, the rightmost column.
Note that not all line numbers may be present, so you may need to
skip some. However, they are in guaranteed in sorted order.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/tools/treeify.py</code></summary>
          <pre class="highlight"><code class="language-python">def find_column(lines, pattern, delimiter):
    """Find a valid column with hierarchical data in the text lines.

    Args:
      lines: A list of strings, the contents of the input.
      pattern: A regular expression for the hierarchical entries.
      delimiter: A regular expression that dictates how we detect the
        end of a column. Normally this is a single space. If the patterns
        contain spaces, you will need to increase this.
    Returns:
      A tuple of
        matches: A list of (line-number, name) tuples where 'name' is the
          hierarchical string to treeify and line-number is an integer, the
          line number where this applies.
        left: An integer, the leftmost column.
        right: An integer, the rightmost column.
      Note that not all line numbers may be present, so you may need to
      skip some. However, they are in guaranteed in sorted order.
    """
    # A mapping of the line beginning position to its match object.
    beginnings = collections.defaultdict(list)
    pattern_and_whitespace = "({})(?P&lt;ws&gt;{}.|$)".format(pattern, delimiter)
    for no, line in enumerate(lines):
        for match in re.finditer(pattern_and_whitespace, line):
            beginnings[match.start()].append((no, line, match))

    # For each potential column found, verify that it is valid. A valid column
    # will have the maximum of its content text not overlap with any of the
    # following text. We assume that a column will have been formatted to full
    # width and that no text following the line overlap with the column, even in
    # its trailing whitespace.
    #
    # In other words, the following example is a violation because "10,990.74"
    # overlaps with the end of "Insurance" and so this would not be recognized
    # as a valid column:
    #
    # Expenses:Food:Restaurant     10,990.74 USD
    # Expenses:Health:Dental:Insurance   208.80 USD
    #
    for leftmost_column, column_matches in sorted(beginnings.items()):

        # Compute the location of the rightmost column of text.
        rightmost_column = max(match.end(1) for _, _, match in column_matches)

        # Compute the leftmost location of the content following the column text
        # and past its whitespace.
        following_column = min(match.end() if match.group('ws') else 10000
                               for _, _, match in column_matches)

        if rightmost_column &lt; following_column:
            # We process only the very first match.
            return_matches = [(no, match.group(1).rstrip())
                              for no, _, match in column_matches]
            return return_matches, leftmost_column, rightmost_column
</code></pre>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.tools.treeify.render_tree" class="doc doc-heading">
<code class="highlight language-python">beancount.tools.treeify.render_tree(root)</code>


<a href="#beancount.tools.treeify.render_tree" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Render a tree of nodes.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>A list of tuples of (first_line, continuation_line, node) where
  first_line</code> – A string, the first line to render, which includes the
    account name.
  continuation_line: A string, further line to render if necessary.
  node: The Node instance which corresponds to this line.
and an integer, the width of the new columns.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/tools/treeify.py</code></summary>
          <pre class="highlight"><code class="language-python">def render_tree(root):
    """Render a tree of nodes.

    Returns:
      A list of tuples of (first_line, continuation_line, node) where
        first_line: A string, the first line to render, which includes the
          account name.
        continuation_line: A string, further line to render if necessary.
        node: The Node instance which corresponds to this line.
      and an integer, the width of the new columns.
    """
    # Compute all the lines ahead of time in order to calculate the width.
    lines = []

    # Start with the root node. We push the constant prefix before this node,
    # the account name, and the RealAccount instance. We will maintain a stack
    # of children nodes to render.
    stack = [('', root.name, root, True)]
    while stack:
        prefix, name, node, is_last = stack.pop(-1)

        if node is root:
            # For the root node, we don't want to render any prefix.
            first = cont = ''
        else:
            # Compute the string that precedes the name directly and the one below
            # that for the continuation lines.
            #  |
            #  @@@ Bank1    &lt;----------------
            #  @@@ |
            #  |   |-- Checking
            if is_last:
                first = prefix + PREFIX_LEAF_1
                cont = prefix + PREFIX_LEAF_C
            else:
                first = prefix + PREFIX_CHILD_1
                cont = prefix + PREFIX_CHILD_C

        # Compute the name to render for continuation lines.
        #  |
        #  |-- Bank1
        #  |   @@@       &lt;----------------
        #  |   |-- Checking
        if len(node) &gt; 0:
            cont_name = PREFIX_CHILD_C
        else:
            cont_name = PREFIX_LEAF_C

        # Add a line for this account.
        if not (node is root and not name):
            lines.append((first + name,
                          cont + cont_name,
                          node))

        # Push the children onto the stack, being careful with ordering and
        # marking the last node as such.
        if node:
            child_items = reversed(node)
            child_iter = iter(child_items)
            child_node = next(child_iter)
            stack.append((cont, child_node.name, child_node, True))
            for child_node in child_iter:
                stack.append((cont, child_node.name, child_node, False))

    if not lines:
        return lines

    # Compute the maximum width of the lines and convert all of them to the same
    # maximal width. This makes it easy on the client.
    max_width = max(len(first_line) for first_line, _, __ in lines)
    line_format = '{{:{width}}}'.format(width=max_width)
    return [(line_format.format(first_line),
             line_format.format(cont_line),
             node)
            for (first_line, cont_line, node) in lines], max_width
</code></pre>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.tools.treeify_test" class="doc doc-heading">
        <code>beancount.tools.treeify_test</code>



<a href="#beancount.tools.treeify_test" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Unit tests for treeify tool.</p>



  <div class="doc doc-children">












  <div class="doc doc-object doc-class">



<h3 id="beancount.tools.treeify_test.TestTreeifyBase" class="doc doc-heading">
        <code>
beancount.tools.treeify_test.TestTreeifyBase            (<span title="unittest.case.TestCase">TestCase</span>)
        </code>



<a href="#beancount.tools.treeify_test.TestTreeifyBase" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">





  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h4 id="beancount.tools.treeify_test.TestTreeifyBase.treeify" class="doc doc-heading">
<code class="highlight language-python">beancount.tools.treeify_test.TestTreeifyBase.treeify(self, string, expect_errors=False, options=None)</code>


<a href="#beancount.tools.treeify_test.TestTreeifyBase.treeify" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Run treeify on the given string and assert no errors.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>string</strong> – A string, the input contents to run on.</p></li>
            <li><p><strong>expect_errors</strong> – A boolean, true if we should expect there to be errors.</p></li>
            <li><p><strong>options</strong> – An optional list of options for the subprogram.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>The converted output string. This fails the test if there were any
errors.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/tools/treeify_test.py</code></summary>
          <pre class="highlight"><code class="language-python">def treeify(self, string, expect_errors=False, options=None):
    """Run treeify on the given string and assert no errors.

    Args:
      string: A string, the input contents to run on.
      expect_errors: A boolean, true if we should expect there to be errors.
      options: An optional list of options for the subprogram.
    Returns:
      The converted output string. This fails the test if there were any
      errors.
    """
    returncode, output, errors = treeify(string, options)
    actual_errors = returncode != 0 or bool(errors)
    if actual_errors != expect_errors:
        if expect_errors:
            self.fail("Missing expected errors")
        else:
            self.fail("Unexpected errors: {}".format(errors))
    return output
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.tools.treeify_test.TestTreeifyBase.treeify_equal" class="doc doc-heading">
<code class="highlight language-python">beancount.tools.treeify_test.TestTreeifyBase.treeify_equal(self, string, expected, expect_errors=False, options=None)</code>


<a href="#beancount.tools.treeify_test.TestTreeifyBase.treeify_equal" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Assert an expected treeification result.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>string</strong> – An expected input contents string to treeify.</p></li>
            <li><p><strong>expected</strong> – A string, the expected treeified output.</p></li>
            <li><p><strong>expect_errors</strong> – A boolean, true if we should expect there to be errors.</p></li>
            <li><p><strong>options</strong> – An optional list of options for the subprogram.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>The actual output string. This fails the test if there the expected
output differed from the actual.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/tools/treeify_test.py</code></summary>
          <pre class="highlight"><code class="language-python">def treeify_equal(self, string, expected, expect_errors=False, options=None):
    """Assert an expected treeification result.

    Args:
      string: An expected input contents string to treeify.
      expected: A string, the expected treeified output.
      expect_errors: A boolean, true if we should expect there to be errors.
      options: An optional list of options for the subprogram.
    Returns:
      The actual output string. This fails the test if there the expected
      output differed from the actual.
    """
    input_ = textwrap.dedent(string)
    output = self.treeify(input_, expect_errors, options)
    expected = textwrap.dedent(expected)
    if DEBUG:
        print('-(input)----------------------------------')
        print(input_)
        print('-(output)---------------------------------')
        print(output)
        print('-(expected)-------------------------------')
        print(expected)
        print('------------------------------------------')
    self.assertEqual(expected, output)
    return output
</code></pre>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.tools.treeify_test.treeify" class="doc doc-heading">
<code class="highlight language-python">beancount.tools.treeify_test.treeify(string, options=None)</code>


<a href="#beancount.tools.treeify_test.treeify" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Run treeify on the string.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>string</strong> – The input string to feed treeify.</p></li>
            <li><p><strong>options</strong> – An optional list of options for the subprogram.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>The treeified string.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/tools/treeify_test.py</code></summary>
          <pre class="highlight"><code class="language-python">def treeify(string, options=None):
    """Run treeify on the string.

    Args:
      string: The input string to feed treeify.
      options: An optional list of options for the subprogram.
    Returns:
      The treeified string.
    """
    pipe = subprocess.Popen([PROGRAM] + (options or []),
                            shell=False,
                            stdin=subprocess.PIPE,
                            stdout=subprocess.PIPE,
                            stderr=subprocess.PIPE)
    output, errors = pipe.communicate(string.encode('utf-8'))
    return (pipe.returncode,
            output.decode('utf-8') if output else '',
            errors.decode('utf-8') if errors else '')
</code></pre>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>




  </div>

    </div>

  </div>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="beancount.utils.html" class="btn btn-neutral float-right" title="beancount.utils">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="beancount.scripts.html" class="btn btn-neutral" title="beancount.scripts"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="beancount.scripts.html" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="beancount.utils.html" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
