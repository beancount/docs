<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="canonical" href="https://beancount.github.io/docs/api_reference/beancount.utils.html">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>beancount.utils - Beancount Documentation</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link href="../assets/_mkdocstrings.css" rel="stylesheet" />
  <link href="../css/custom.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "beancount.utils";
    var mkdocs_page_input_path = "api_reference/beancount.utils.md";
    var mkdocs_page_url = "/docs/api_reference/beancount.utils.html";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="icon icon-home"> Beancount Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../index.html">Index</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Outline</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="#">Documentation for Users</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../command_line_accounting_in_context.html">Command Line Accounting in Context</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../the_double_entry_counting_method.html">The Double Entry Counting Method</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../installing_beancount.html">Installing Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../running_beancount_and_generating_reports.html">Running Beancount and Generating Reports</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../getting_started_with_beancount.html">Getting Started with Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_language_syntax.html">Beancount Language Syntax</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_options_reference.html">Beancount Options Reference</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../precision_tolerances.html">Precision Tolerances</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_query_language.html">Beancount Query Language</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_cheat_sheet.html">Beancount Cheat Sheet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../how_inventories_work.html">How Inventories Work</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../exporting_your_portfolio.html">Exporting Your Portfolio</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../tutorial_example.html">Tutorial & Example</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_history_and_credits.html">Beancount History and Credits</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../a_comparison_of_beancount_and_ledger_hledger.html">A Comparison of Beancount and Ledger Hledger</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../fetching_prices_in_beancount.html">Fetching Prices in Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../importing_external_data.html">Importing External Data</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Cookbooks & Examples</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../command_line_accounting_cookbook.html">Command Line Accounting Cookbook</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../trading_with_beancount.html">Trading with Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../stock_vesting_in_beancount.html">Stock Vesting in Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../sharing_expenses_with_beancount.html">Sharing Expenses with Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../how_we_share_expenses.html">How We Share Expenses</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../health_care_expenses.html">Health Care Expenses</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../calculating_portolio_returns.html">Calculating Portfolio Returns</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../tracking_medical_claims.html">Tracking Out-of-Network Medical Claims in Beancount</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Documentation for Developers</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_scripting_plugins.html">Beancount Scripting Plugins</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_design_doc.html">Beancount Design Doc</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ledgerhub_design_doc.html">Ledgerhub Design Doc</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../external_contributions.html">External Contributions</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Enhancement Proposals & Discussions</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../a_proposal_for_an_improvement_on_inventory_booking.html">A Proposal for an Improvement on Inventory Booking</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../settlement_dates_in_beancount.html">Settlement Dates in Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../balance_assertions_in_beancount.html">Balance Assertions in Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../fund_accounting_with_beancount.html">Fund Accounting with Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../rounding_precision_in_beancount.html">Rounding Precision in Beancount</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Beancount 3</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_v3.html">Goals & Design</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../installing_beancount_v3.html">Installing Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_v3_dependencies.html">Dependencies</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beangulp.html">Beangulp</a>
                </li>
    </ul>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">API reference</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="index.html">beancount</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.core.html">beancount.core</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.loader.html">beancount.loader</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.ops.html">beancount.ops</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.parser.html">beancount.parser</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.plugins.html">beancount.plugins</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.scripts.html">beancount.scripts</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.tools.html">beancount.tools</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="beancount.utils.html">beancount.utils</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#beancount.utils">beancount.utils</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.utils.bisect_key">bisect_key</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.bisect_key.bisect_left_with_key">bisect_left_with_key()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.bisect_key.bisect_right_with_key">bisect_right_with_key()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.utils.date_utils">date_utils</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.date_utils.intimezone">intimezone()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.date_utils.iter_dates">iter_dates()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.date_utils.next_month">next_month()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.date_utils.render_ofx_date">render_ofx_date()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.utils.defdict">defdict</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.defdict.DefaultDictWithKey">DefaultDictWithKey</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.defdict.ImmutableDictWithDefault">ImmutableDictWithDefault</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.defdict.ImmutableDictWithDefault.__setitem__">__setitem__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.defdict.ImmutableDictWithDefault.get">get()</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.utils.encryption">encryption</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.encryption.is_encrypted_file">is_encrypted_file()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.encryption.is_gpg_installed">is_gpg_installed()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.encryption.read_encrypted_file">read_encrypted_file()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.utils.file_utils">file_utils</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.file_utils.chdir">chdir()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.file_utils.find_files">find_files()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.file_utils.guess_file_format">guess_file_format()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.file_utils.path_greedy_split">path_greedy_split()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.file_utils.touch_file">touch_file()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.utils.import_utils">import_utils</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.import_utils.import_symbol">import_symbol()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.utils.invariants">invariants</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.invariants.instrument_invariants">instrument_invariants()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.invariants.invariant_check">invariant_check()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.invariants.uninstrument_invariants">uninstrument_invariants()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.utils.memo">memo</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.memo.memoize_recent_fileobj">memoize_recent_fileobj()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.memo.now">now()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.utils.misc_utils">misc_utils</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.LineFileProxy">LineFileProxy</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.misc_utils.LineFileProxy.__init__">__init__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.misc_utils.LineFileProxy.close">close()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.misc_utils.LineFileProxy.flush">flush()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.misc_utils.LineFileProxy.write">write()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.TypeComparable">TypeComparable</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.box">box()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.cmptuple">cmptuple()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.compute_unique_clean_ids">compute_unique_clean_ids()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.deprecated">deprecated()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.dictmap">dictmap()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.escape_string">escape_string()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.filter_type">filter_type()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.first_paragraph">first_paragraph()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.get_screen_height">get_screen_height()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.get_screen_width">get_screen_width()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.get_tuple_values">get_tuple_values()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.groupby">groupby()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.idify">idify()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.import_curses">import_curses()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.is_sorted">is_sorted()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.log_time">log_time()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.longest">longest()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.map_namedtuple_attributes">map_namedtuple_attributes()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.replace_namedtuple_values">replace_namedtuple_values()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.skipiter">skipiter()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.sorted_uniquify">sorted_uniquify()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.staticvar">staticvar()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.swallow">swallow()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.uniquify">uniquify()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.utils.pager">pager</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.pager.ConditionalPager">ConditionalPager</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.pager.ConditionalPager.__enter__">__enter__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.pager.ConditionalPager.__exit__">__exit__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.pager.ConditionalPager.__init__">__init__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.pager.ConditionalPager.flush_accumulated">flush_accumulated()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.pager.ConditionalPager.write">write()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.pager.create_pager">create_pager()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.pager.flush_only">flush_only()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.utils.snoop">snoop</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.snoop.Snoop">Snoop</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.snoop.Snoop.__call__">__call__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.snoop.Snoop.__getattr__">__getattr__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.snoop.Snoop.__init__">__init__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.snoop.snoopify">snoopify()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.utils.table">table</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.table.Table">Table</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.table.Table.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.table.Table.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.table.Table.__replace__">__replace__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.table.Table.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.table.attribute_to_title">attribute_to_title()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.table.compute_table_widths">compute_table_widths()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.table.create_table">create_table()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.table.render_table">render_table()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.table.table_to_csv">table_to_csv()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.table.table_to_html">table_to_html()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.table.table_to_text">table_to_text()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.utils.test_utils">test_utils</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.ClickTestCase">ClickTestCase</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.RCall">RCall</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.test_utils.RCall.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.test_utils.RCall.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.test_utils.RCall.__replace__">__replace__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.test_utils.RCall.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.TestCase">TestCase</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.test_utils.TestCase.assertLines">assertLines()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.test_utils.TestCase.assertOutput">assertOutput()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.TmpFilesTestBase">TmpFilesTestBase</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.test_utils.TmpFilesTestBase.create_file_hierarchy">create_file_hierarchy()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.test_utils.TmpFilesTestBase.setUp">setUp()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.test_utils.TmpFilesTestBase.tearDown">tearDown()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.capture">capture()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.create_temporary_files">create_temporary_files()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.docfile">docfile()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.docfile_extra">docfile_extra()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.environ">environ()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.find_python_lib">find_python_lib()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.find_repository_root">find_repository_root()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.make_failing_importer">make_failing_importer()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.nottest">nottest()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.patch">patch()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.record">record()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.search_words">search_words()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.skipIfRaises">skipIfRaises()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.subprocess_env">subprocess_env()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.tempdir">tempdir()</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Beancount Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
    
      
        
          <li>API reference &raquo;</li>
        
      
    
    <li>beancount.utils</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h1 id="beancountutils">beancount.utils<a class="headerlink" href="#beancountutils" title="Permanent link"></a></h1>


  <div class="doc doc-object doc-module">

<a id="beancount.utils"></a>
    <div class="doc doc-contents first">

      <p>Generic utility packages and functions.</p>



  <div class="doc doc-children">












  <div class="doc doc-object doc-module">



<h2 id="beancount.utils.bisect_key" class="doc doc-heading">
        <code>beancount.utils.bisect_key</code>



<a href="#beancount.utils.bisect_key" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>A version of bisect that accepts a custom key function, like the sorting ones do.</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.bisect_key.bisect_left_with_key" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.bisect_key.bisect_left_with_key(sequence, value, key=None)</code>


<a href="#beancount.utils.bisect_key.bisect_left_with_key" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Find the last element before the given value in a sorted list.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>sequence</strong> – A sorted sequence of elements.</p></li>
            <li><p><strong>value</strong> – The value to search for.</p></li>
            <li><p><strong>key</strong> – An optional function used to extract the value from the elements of
sequence.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>Return the index. May return None.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/bisect_key.py</code></summary>
          <pre class="highlight"><code class="language-python">def bisect_left_with_key(sequence, value, key=None):
    """Find the last element before the given value in a sorted list.

    Args:
      sequence: A sorted sequence of elements.
      value: The value to search for.
      key: An optional function used to extract the value from the elements of
        sequence.
    Returns:
      Return the index. May return None.
    """
    if key is None:
        key = lambda x: x  # Identity.

    lo = 0
    hi = len(sequence)

    while lo &lt; hi:
        mid = (lo + hi) // 2
        if key(sequence[mid]) &lt; value:
            lo = mid + 1
        else:
            hi = mid
    return lo
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.bisect_key.bisect_right_with_key" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.bisect_key.bisect_right_with_key(a, x, key, lo=0, hi=None)</code>


<a href="#beancount.utils.bisect_key.bisect_right_with_key" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Like bisect.bisect_right, but with a key lookup parameter.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> – The list to search in.</p></li>
            <li><p><strong>x</strong> – The element to search for.</p></li>
            <li><p><strong>key</strong> – A function, to extract the value from the list.</p></li>
            <li><p><strong>lo</strong> – The smallest index to search.</p></li>
            <li><p><strong>hi</strong> – The largest index to search.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>As in bisect.bisect_right, an element from list 'a'.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/bisect_key.py</code></summary>
          <pre class="highlight"><code class="language-python">def bisect_right_with_key(a, x, key, lo=0, hi=None):
    """Like bisect.bisect_right, but with a key lookup parameter.

    Args:
      a: The list to search in.
      x: The element to search for.
      key: A function, to extract the value from the list.
      lo: The smallest index to search.
      hi: The largest index to search.
    Returns:
      As in bisect.bisect_right, an element from list 'a'.
    """
    # pylint: disable=invalid-name
    if lo &lt; 0:
        raise ValueError('lo must be non-negative')
    if hi is None:
        hi = len(a)
    while lo &lt; hi:
        mid = (lo+hi)//2
        if x &lt; key(a[mid]):
            hi = mid
        else:
            lo = mid+1
    return lo
</code></pre>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.utils.date_utils" class="doc doc-heading">
        <code>beancount.utils.date_utils</code>



<a href="#beancount.utils.date_utils" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Parse the date from various formats.</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.date_utils.intimezone" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.date_utils.intimezone(tz_value)</code>


<a href="#beancount.utils.date_utils.intimezone" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Temporarily reset the value of TZ.</p>
<p>This is used for testing.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>tz_value</strong> (<code>str</code>) – The value of TZ to set for the duration of this context.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A contextmanager in the given timezone locale.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/date_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">@contextlib.contextmanager
def intimezone(tz_value: str):
    """Temporarily reset the value of TZ.

    This is used for testing.

    Args:
      tz_value: The value of TZ to set for the duration of this context.
    Returns:
      A contextmanager in the given timezone locale.
    """
    tz_old = os.environ.get('TZ', None)
    os.environ['TZ'] = tz_value
    time.tzset()
    try:
        yield
    finally:
        if tz_old is None:
            del os.environ['TZ']
        else:
            os.environ['TZ'] = tz_old
        time.tzset()
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.date_utils.iter_dates" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.date_utils.iter_dates(start_date, end_date)</code>


<a href="#beancount.utils.date_utils.iter_dates" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Yield all the dates between 'start_date' and 'end_date'.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>start_date</strong> – An instance of datetime.date.</p></li>
            <li><p><strong>end_date</strong> – An instance of datetime.date.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  Instances of datetime.date.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/date_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def iter_dates(start_date, end_date):
    """Yield all the dates between 'start_date' and 'end_date'.

    Args:
      start_date: An instance of datetime.date.
      end_date: An instance of datetime.date.
    Yields:
      Instances of datetime.date.
    """
    oneday = datetime.timedelta(days=1)
    date = start_date
    while date &lt; end_date:
        yield date
        date += oneday
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.date_utils.next_month" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.date_utils.next_month(date)</code>


<a href="#beancount.utils.date_utils.next_month" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Compute the date at the beginning of the following month from the given date.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>date</strong> – A datetime.date instance.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A datetime.date instance, the first day of the month following 'date'.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/date_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def next_month(date):
    """Compute the date at the beginning of the following month from the given date.

    Args:
      date: A datetime.date instance.
    Returns:
      A datetime.date instance, the first day of the month following 'date'.
    """
    # Compute the date at the beginning of the following month.
    year = date.year
    month = date.month + 1
    if date.month == 12:
        year += 1
        month = 1
    return datetime.date(year, month, 1)
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.date_utils.render_ofx_date" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.date_utils.render_ofx_date(dtime)</code>


<a href="#beancount.utils.date_utils.render_ofx_date" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Render a datetime to the OFX format.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>dtime</strong> – A datetime.datetime instance.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A string, rendered to milliseconds.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/date_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def render_ofx_date(dtime):
    """Render a datetime to the OFX format.

    Args:
      dtime: A datetime.datetime instance.
    Returns:
      A string, rendered to milliseconds.
    """
    return '{}.{:03d}'.format(dtime.strftime('%Y%m%d%H%M%S'),
                              int(dtime.microsecond / 1000))
</code></pre>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.utils.defdict" class="doc doc-heading">
        <code>beancount.utils.defdict</code>



<a href="#beancount.utils.defdict" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>An instance of collections.defaultdict whose factory accepts a key.</p>
<p>Note: This really ought to be an enhancement to Python itself. I should bother
adding this in eventually.</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-class">



<h3 id="beancount.utils.defdict.DefaultDictWithKey" class="doc doc-heading">
        <code>
beancount.utils.defdict.DefaultDictWithKey            (<span title="collections.defaultdict">defaultdict</span>)
        </code>



<a href="#beancount.utils.defdict.DefaultDictWithKey" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A version of defaultdict whose factory accepts the key as an argument.
Note: collections.defaultdict would be improved by supporting this directly,
this is a common occurrence.</p>




  <div class="doc doc-children">












  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="beancount.utils.defdict.ImmutableDictWithDefault" class="doc doc-heading">
        <code>
beancount.utils.defdict.ImmutableDictWithDefault            (<span title="dict">dict</span>)
        </code>



<a href="#beancount.utils.defdict.ImmutableDictWithDefault" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>An immutable dict which returns a default value for missing keys.</p>
<p>This differs from a defaultdict in that it does not insert a missing default
value when one is materialized (from a missing fetch), and furthermore, the
set method is make unavailable to prevent mutation beyond construction.</p>




  <div class="doc doc-children">













  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.defdict.ImmutableDictWithDefault.__setitem__" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.defdict.ImmutableDictWithDefault.__setitem__(self, key, value)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.utils.defdict.ImmutableDictWithDefault.__setitem__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Disallow mutating the dict in the usual way.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/defdict.py</code></summary>
          <pre class="highlight"><code class="language-python">def __setitem__(self, key, value):
    """Disallow mutating the dict in the usual way."""
    raise NotImplementedError
</code></pre>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.defdict.ImmutableDictWithDefault.get" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.defdict.ImmutableDictWithDefault.get(self, key, _=None)</code>


<a href="#beancount.utils.defdict.ImmutableDictWithDefault.get" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return the value for key if key is in the dictionary, else default.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/defdict.py</code></summary>
          <pre class="highlight"><code class="language-python">def get(self, key, _=None):
    return self.__getitem__(key)  # pylint: disable=unnecessary-dunder-call
</code></pre>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.utils.encryption" class="doc doc-heading">
        <code>beancount.utils.encryption</code>



<a href="#beancount.utils.encryption" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Support for encrypted tests.</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.encryption.is_encrypted_file" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.encryption.is_encrypted_file(filename)</code>


<a href="#beancount.utils.encryption.is_encrypted_file" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Return true if the given filename contains an encrypted file.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>filename</strong> – A path string.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A boolean, true if the file contains an encrypted file.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/encryption.py</code></summary>
          <pre class="highlight"><code class="language-python">def is_encrypted_file(filename):
    """Return true if the given filename contains an encrypted file.

    Args:
      filename: A path string.
    Returns:
      A boolean, true if the file contains an encrypted file.
    """
    _, ext = path.splitext(filename)
    if ext == '.gpg':
        return True
    if ext == '.asc':
        with open(filename) as encfile:
            head = encfile.read(1024)
            if re.search('--BEGIN PGP MESSAGE--', head):
                return True
    return False
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.encryption.is_gpg_installed" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.encryption.is_gpg_installed()</code>


<a href="#beancount.utils.encryption.is_gpg_installed" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Return true if GPG 1.4.x or 2.x are installed, which is what we use and support.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/encryption.py</code></summary>
          <pre class="highlight"><code class="language-python">def is_gpg_installed():
    """Return true if GPG 1.4.x or 2.x are installed, which is what we use and support."""
    try:
        pipe = subprocess.Popen(['gpg', '--version'], shell=0,
                                stdout=subprocess.PIPE, stderr=subprocess.PIPE)
        out, err = pipe.communicate()
        version_text = out.decode('utf8')
        return pipe.returncode == 0 and re.match(r'gpg \(GnuPG\) (1\.4|2)\.', version_text)
    except OSError:
        return False
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.encryption.read_encrypted_file" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.encryption.read_encrypted_file(filename)</code>


<a href="#beancount.utils.encryption.read_encrypted_file" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Decrypt and read an encrypted file without temporary storage.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>filename</strong> – A string, the path to the encrypted file.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A string, the contents of the file.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>OSError</code> – If we could not properly decrypt the file.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/encryption.py</code></summary>
          <pre class="highlight"><code class="language-python">def read_encrypted_file(filename):
    """Decrypt and read an encrypted file without temporary storage.

    Args:
      filename: A string, the path to the encrypted file.
    Returns:
      A string, the contents of the file.
    Raises:
      OSError: If we could not properly decrypt the file.
    """
    command = ['gpg', '--batch', '--decrypt', path.realpath(filename)]
    pipe = subprocess.Popen(command,
                            shell=False,
                            stdout=subprocess.PIPE,
                            stderr=subprocess.PIPE)
    contents, errors = pipe.communicate()
    if pipe.returncode != 0:
        raise OSError("Could not decrypt file ({}): {}".format(pipe.returncode,
                                                               errors.decode('utf8')))
    return contents.decode('utf-8')
</code></pre>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.utils.file_utils" class="doc doc-heading">
        <code>beancount.utils.file_utils</code>



<a href="#beancount.utils.file_utils" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>File utilities.</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.file_utils.chdir" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.file_utils.chdir(directory)</code>


<a href="#beancount.utils.file_utils.chdir" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Temporarily chdir to the given directory.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>directory</strong> – The directory to switch do.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A context manager which restores the cwd after running.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/file_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">@contextlib.contextmanager
def chdir(directory):
    """Temporarily chdir to the given directory.

    Args:
      directory: The directory to switch do.
    Returns:
      A context manager which restores the cwd after running.
    """
    cwd = os.getcwd()
    os.chdir(directory)
    try:
        yield cwd
    finally:
        os.chdir(cwd)
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.file_utils.find_files" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.file_utils.find_files(fords, ignore_dirs=('.hg', '.svn', '.git'), ignore_files=('.DS_Store',))</code>


<a href="#beancount.utils.file_utils.find_files" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Enumerate the files under the given directories, stably.</p>
<p>Invalid file or directory names will be logged to the error log.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>fords</strong> – A list of strings, file or directory names.</p></li>
            <li><p><strong>ignore_dirs</strong> – A list of strings, filenames or directories to be ignored.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  Strings, full filenames from the given roots.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/file_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def find_files(fords,
               ignore_dirs=('.hg', '.svn', '.git'),
               ignore_files=('.DS_Store',)):
    """Enumerate the files under the given directories, stably.

    Invalid file or directory names will be logged to the error log.

    Args:
      fords: A list of strings, file or directory names.
      ignore_dirs: A list of strings, filenames or directories to be ignored.
    Yields:
      Strings, full filenames from the given roots.
    """
    if isinstance(fords, str):
        fords = [fords]
    assert isinstance(fords, (list, tuple))
    for ford in fords:
        if path.isdir(ford):
            for root, dirs, filenames in os.walk(ford):
                dirs[:] = sorted(dirname for dirname in dirs if dirname not in ignore_dirs)
                for filename in sorted(filenames):
                    if filename in ignore_files:
                        continue
                    yield path.join(root, filename)
        elif path.isfile(ford) or path.islink(ford):
            yield ford
        elif not path.exists(ford):
            logging.error("File or directory '{}' does not exist.".format(ford))
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.file_utils.guess_file_format" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.file_utils.guess_file_format(filename, default=None)</code>


<a href="#beancount.utils.file_utils.guess_file_format" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Guess the file format from the filename.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>filename</strong> – A string, the name of the file. This can be None.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A string, the extension of the format, without a leading period.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/file_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def guess_file_format(filename, default=None):
    """Guess the file format from the filename.

    Args:
      filename: A string, the name of the file. This can be None.
    Returns:
      A string, the extension of the format, without a leading period.
    """
    if filename:
        if filename.endswith('.txt') or filename.endswith('.text'):
            format = 'text'
        elif filename.endswith('.csv'):
            format = 'csv'
        elif filename.endswith('.html') or filename.endswith('.xhtml'):
            format = 'html'
        else:
            format = default
    else:
        format = default
    return format
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.file_utils.path_greedy_split" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.file_utils.path_greedy_split(filename)</code>


<a href="#beancount.utils.file_utils.path_greedy_split" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Split a path, returning the longest possible extension.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>filename</strong> – A string, the filename to split.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A pair of basename, extension (which includes the leading period).</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/file_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def path_greedy_split(filename):
    """Split a path, returning the longest possible extension.

    Args:
      filename: A string, the filename to split.
    Returns:
      A pair of basename, extension (which includes the leading period).
    """
    basename = path.basename(filename)
    index = basename.find('.')
    if index == -1:
        extension = None
    else:
        extension = basename[index:]
        basename = basename[:index]
    return (path.join(path.dirname(filename), basename), extension)
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.file_utils.touch_file" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.file_utils.touch_file(filename, *otherfiles)</code>


<a href="#beancount.utils.file_utils.touch_file" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Touch a file and wait until its timestamp has been changed.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>filename</strong> – A string path, the name of the file to touch.</p></li>
            <li><p><strong>otherfiles</strong> – A list of other files to ensure the timestamp is beyond of.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/file_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def touch_file(filename, *otherfiles):
    """Touch a file and wait until its timestamp has been changed.

    Args:
      filename: A string path, the name of the file to touch.
      otherfiles: A list of other files to ensure the timestamp is beyond of.
    """
    # Note: You could set os.stat_float_times() but then the main function would
    # have to set that up as well. It doesn't help so much, however, since
    # filesystems tend to have low resolutions, e.g. one second.
    orig_mtime_ns = max(os.stat(minfile).st_mtime_ns
                        for minfile in (filename,) + otherfiles)
    delay_secs = 0.05
    while True:
        with open(filename, 'a'):
            os.utime(filename)
        time.sleep(delay_secs)
        new_stat = os.stat(filename)
        if new_stat.st_mtime_ns &gt; orig_mtime_ns:
            break
</code></pre>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.utils.import_utils" class="doc doc-heading">
        <code>beancount.utils.import_utils</code>



<a href="#beancount.utils.import_utils" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Utilities for importing symbols programmatically.</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.import_utils.import_symbol" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.import_utils.import_symbol(dotted_name)</code>


<a href="#beancount.utils.import_utils.import_symbol" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Import a symbol in an arbitrary module.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>dotted_name</strong> – A dotted path to a symbol.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>The object referenced by the given name.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>ImportError</code> – If the module not not be imported.</p></li>
            <li><p><code>AttributeError</code> – If the symbol could not be found in the module.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/import_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def import_symbol(dotted_name):
    """Import a symbol in an arbitrary module.

    Args:
      dotted_name: A dotted path to a symbol.
    Returns:
      The object referenced by the given name.
    Raises:
      ImportError: If the module not not be imported.
      AttributeError: If the symbol could not be found in the module.
    """
    comps = dotted_name.split('.')
    module_name = '.'.join(comps[:-1])
    symbol_name = comps[-1]
    module = importlib.import_module(module_name)
    return getattr(module, symbol_name)
</code></pre>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.utils.invariants" class="doc doc-heading">
        <code>beancount.utils.invariants</code>



<a href="#beancount.utils.invariants" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Functions to register auxiliary functions on a class' methods to check for invariants.</p>
<p>This is intended to be used in a test, whereby your test will setup a class to
automatically run invariant verification functions before and after each
function call, to ensure some extra sanity checks that wouldn't be used in
non-tests.</p>
<p>Example: Instrument the Inventory class with the check_inventory_invariants()
function.</p>
<p>def setUp(module):
      instrument_invariants(Inventory,
                            check_inventory_invariants,
                            check_inventory_invariants)</p>
<p>def tearDown(module):
      uninstrument_invariants(Inventory)</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.invariants.instrument_invariants" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.invariants.instrument_invariants(klass, prefun, postfun)</code>


<a href="#beancount.utils.invariants.instrument_invariants" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Instrument the class 'klass' with pre/post invariant
checker functions.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>klass</strong> – A class object, whose methods to be instrumented.</p></li>
            <li><p><strong>prefun</strong> – A function that checks invariants pre-call.</p></li>
            <li><p><strong>postfun</strong> – A function that checks invariants pre-call.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/invariants.py</code></summary>
          <pre class="highlight"><code class="language-python">def instrument_invariants(klass, prefun, postfun):
    """Instrument the class 'klass' with pre/post invariant
    checker functions.

    Args:
      klass: A class object, whose methods to be instrumented.
      prefun: A function that checks invariants pre-call.
      postfun: A function that checks invariants pre-call.
    """
    instrumented = {}
    for attrname, object_ in klass.__dict__.items():
        if attrname.startswith('_'):
            continue
        if not isinstance(object_, types.FunctionType):
            continue
        instrumented[attrname] = object_
        setattr(klass, attrname,
                invariant_check(object_, prefun, postfun))
    klass.__instrumented = instrumented
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.invariants.invariant_check" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.invariants.invariant_check(method, prefun, postfun)</code>


<a href="#beancount.utils.invariants.invariant_check" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Decorate a method with the pre/post invariant checkers.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>method</strong> – An unbound method to instrument.</p></li>
            <li><p><strong>prefun</strong> – A function that checks invariants pre-call.</p></li>
            <li><p><strong>postfun</strong> – A function that checks invariants post-call.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>An unbound method, decorated.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/invariants.py</code></summary>
          <pre class="highlight"><code class="language-python">def invariant_check(method, prefun, postfun):
    """Decorate a method with the pre/post invariant checkers.

    Args:
      method: An unbound method to instrument.
      prefun: A function that checks invariants pre-call.
      postfun: A function that checks invariants post-call.
    Returns:
      An unbound method, decorated.
    """
    reentrant = []
    def new_method(self, *args, **kw):
        reentrant.append(None)
        if len(reentrant) == 1:
            prefun(self)
        result = method(self, *args, **kw)
        if len(reentrant) == 1:
            postfun(self)
        reentrant.pop()
        return result
    return new_method
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.invariants.uninstrument_invariants" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.invariants.uninstrument_invariants(klass)</code>


<a href="#beancount.utils.invariants.uninstrument_invariants" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Undo the instrumentation for invariants.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>klass</strong> – A class object, whose methods to be uninstrumented.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/invariants.py</code></summary>
          <pre class="highlight"><code class="language-python">def uninstrument_invariants(klass):
    """Undo the instrumentation for invariants.

    Args:
      klass: A class object, whose methods to be uninstrumented.
    """
    instrumented = getattr(klass, '__instrumented', None)
    if instrumented:
        for attrname, object_ in instrumented.items():
            setattr(klass, attrname, object_)
    del klass.__instrumented
</code></pre>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.utils.memo" class="doc doc-heading">
        <code>beancount.utils.memo</code>



<a href="#beancount.utils.memo" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Memoization utilities.</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.memo.memoize_recent_fileobj" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.memo.memoize_recent_fileobj(function, cache_filename, expiration=None)</code>


<a href="#beancount.utils.memo.memoize_recent_fileobj" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Memoize recent calls to the given function which returns a file object.</p>
<p>The results of the cache expire after some time.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>function</strong> – A callable object.</p></li>
            <li><p><strong>cache_filename</strong> – A string, the path to the database file to cache to.</p></li>
            <li><p><strong>expiration</strong> – The time during which the results will be kept valid. Use
'None' to never expire the cache (this is the default).</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A memoized version of the function.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/memo.py</code></summary>
          <pre class="highlight"><code class="language-python">def memoize_recent_fileobj(function, cache_filename, expiration=None):
    """Memoize recent calls to the given function which returns a file object.

    The results of the cache expire after some time.

    Args:
      function: A callable object.
      cache_filename: A string, the path to the database file to cache to.
      expiration: The time during which the results will be kept valid. Use
        'None' to never expire the cache (this is the default).
    Returns:
      A memoized version of the function.
    """
    urlcache = shelve.open(cache_filename, 'c')
    urlcache.lock = threading.Lock()  # Note: 'shelve' is not thread-safe.
    @functools.wraps(function)
    def memoized(*args, **kw):
        # Encode the arguments, including a date string in order to invalidate
        # results over some time.
        md5 = hashlib.md5()
        md5.update(str(args).encode('utf-8'))
        md5.update(str(sorted(kw.items())).encode('utf-8'))

        hash_ = md5.hexdigest()
        time_now = now()
        try:
            with urlcache.lock:
                time_orig, contents = urlcache[hash_]
            if expiration is not None and (time_now - time_orig) &gt; expiration:
                raise KeyError
        except KeyError:
            fileobj = function(*args, **kw)
            if fileobj:
                contents = fileobj.read()
                with urlcache.lock:
                    urlcache[hash_] = (time_now, contents)
            else:
                contents = None

        return io.BytesIO(contents) if contents else None
    return memoized
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.memo.now" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.memo.now()</code>


<a href="#beancount.utils.memo.now" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Indirection on datetime.datetime.now() for testing.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/memo.py</code></summary>
          <pre class="highlight"><code class="language-python">def now():
    "Indirection on datetime.datetime.now() for testing."
    return datetime.datetime.now()
</code></pre>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.utils.misc_utils" class="doc doc-heading">
        <code>beancount.utils.misc_utils</code>



<a href="#beancount.utils.misc_utils" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Generic utility packages and functions.</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-class">



<h3 id="beancount.utils.misc_utils.LineFileProxy" class="doc doc-heading">
        <code>
beancount.utils.misc_utils.LineFileProxy        </code>



<a href="#beancount.utils.misc_utils.LineFileProxy" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A file object that will delegate writing full lines to another logging function.
This may be used for writing data to a logging level without having to worry about
lines.</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.misc_utils.LineFileProxy.__init__" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.misc_utils.LineFileProxy.__init__(self, line_writer, prefix=None, write_newlines=False)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.utils.misc_utils.LineFileProxy.__init__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Construct a new line delegator file object proxy.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>line_writer</strong> – A callable function, used to write to the delegated output.</p></li>
            <li><p><strong>prefix</strong> – An optional string, the prefix to insert before every line.</p></li>
            <li><p><strong>write_newlines</strong> – A boolean, true if we should output the newline characters.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def __init__(self, line_writer, prefix=None, write_newlines=False):
    """Construct a new line delegator file object proxy.

    Args:
      line_writer: A callable function, used to write to the delegated output.
      prefix: An optional string, the prefix to insert before every line.
      write_newlines: A boolean, true if we should output the newline characters.
    """
    self.line_writer = line_writer
    self.prefix = prefix
    self.write_newlines = write_newlines
    self.data = []
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.misc_utils.LineFileProxy.close" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.misc_utils.LineFileProxy.close(self)</code>


<a href="#beancount.utils.misc_utils.LineFileProxy.close" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Close the line delegator.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def close(self):
    """Close the line delegator."""
    self.flush()
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.misc_utils.LineFileProxy.flush" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.misc_utils.LineFileProxy.flush(self)</code>


<a href="#beancount.utils.misc_utils.LineFileProxy.flush" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Flush the data to the line writer.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def flush(self):
    """Flush the data to the line writer."""
    data = ''.join(self.data)
    if data:
        lines = data.splitlines()
        self.data = [lines.pop(-1)] if data[-1] != '\n' else []
        for line in lines:
            if self.prefix:
                line = self.prefix + line
            if self.write_newlines:
                line += '\n'
            self.line_writer(line)
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.misc_utils.LineFileProxy.write" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.misc_utils.LineFileProxy.write(self, data)</code>


<a href="#beancount.utils.misc_utils.LineFileProxy.write" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Write some string data to the output.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>data</strong> – A string, with or without newlines.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def write(self, data):
    """Write some string data to the output.

    Args:
      data: A string, with or without newlines.
    """
    if '\n' in data:
        self.data.append(data)
        self.flush()
    else:
        self.data.append(data)
</code></pre>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="beancount.utils.misc_utils.TypeComparable" class="doc doc-heading">
        <code>
beancount.utils.misc_utils.TypeComparable        </code>



<a href="#beancount.utils.misc_utils.TypeComparable" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A base class whose equality comparison includes comparing the
type of the instance itself.</p>




  <div class="doc doc-children">












  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.box" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.misc_utils.box(name=None, file=None)</code>


<a href="#beancount.utils.misc_utils.box" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A context manager that prints out a box around a block.
This is useful for printing out stuff from tests in a way that is readable.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>name</strong> – A string, the name of the box to use.</p></li>
            <li><p><strong>file</strong> – The file object to print to.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  None.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">@contextlib.contextmanager
def box(name=None, file=None):
    """A context manager that prints out a box around a block.
    This is useful for printing out stuff from tests in a way that is readable.

    Args:
      name: A string, the name of the box to use.
      file: The file object to print to.
    Yields:
      None.
    """
    file = file or sys.stdout
    file.write('\n')
    if name:
        header = ',--------({})--------\n'.format(name)
        footer = '`{}\n'.format('-' * (len(header)-2))
    else:
        header = ',----------------\n'
        footer = '`----------------\n'

    file.write(header)
    yield
    file.write(footer)
    file.flush()
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.cmptuple" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.misc_utils.cmptuple(name, attributes)</code>


<a href="#beancount.utils.misc_utils.cmptuple" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Manufacture a comparable namedtuple class, similar to collections.namedtuple.</p>
<p>A comparable named tuple is a tuple which compares to False if contents are
equal but the data types are different. We define this to supplement
collections.namedtuple because by default a namedtuple disregards the type
and we want to make precise comparisons for tests.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>name</strong> – The given name of the class.</p></li>
            <li><p><strong>attributes</strong> – A string or tuple of strings, with the names of the
attributes.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A new namedtuple-derived type that compares False with other
tuples with same contents.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def cmptuple(name, attributes):
    """Manufacture a comparable namedtuple class, similar to collections.namedtuple.

    A comparable named tuple is a tuple which compares to False if contents are
    equal but the data types are different. We define this to supplement
    collections.namedtuple because by default a namedtuple disregards the type
    and we want to make precise comparisons for tests.

    Args:
      name: The given name of the class.
      attributes: A string or tuple of strings, with the names of the
        attributes.
    Returns:
      A new namedtuple-derived type that compares False with other
      tuples with same contents.
    """
    base = collections.namedtuple('_{}'.format(name), attributes)
    return type(name, (TypeComparable, base,), {})
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.compute_unique_clean_ids" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.misc_utils.compute_unique_clean_ids(strings)</code>


<a href="#beancount.utils.misc_utils.compute_unique_clean_ids" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Given a sequence of strings, reduce them to corresponding ids without any
funny characters and insure that the list of ids is unique. Yields pairs
of (id, string) for the result.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>strings</strong> – A list of strings.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of (id, string) pairs.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def compute_unique_clean_ids(strings):
    """Given a sequence of strings, reduce them to corresponding ids without any
    funny characters and insure that the list of ids is unique. Yields pairs
    of (id, string) for the result.

    Args:
      strings: A list of strings.
    Returns:
      A list of (id, string) pairs.
    """
    string_set = set(strings)

    # Try multiple methods until we get one that has no collisions.
    for regexp, replacement in [(r'[^A-Za-z0-9.-]', '_'),
                                (r'[^A-Za-z0-9_]', ''),]:
        seen = set()
        idmap = {}
        mre = re.compile(regexp)
        for string in string_set:
            id_ = mre.sub(replacement, string)
            if id_ in seen:
                break  # Collision.
            seen.add(id_)
            idmap[id_] = string
        else:
            break
    else:
        return None # Could not find a unique mapping.

    return idmap
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.deprecated" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.misc_utils.deprecated(message)</code>


<a href="#beancount.utils.misc_utils.deprecated" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A decorator generator to mark functions as deprecated and log a warning.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def deprecated(message):
    """A decorator generator to mark functions as deprecated and log a warning."""
    def decorator(func):
        @functools.wraps(func)
        def new_func(*args, **kwargs):
            warnings.warn("Call to deprecated function {}: {}".format(func.__name__,
                                                                      message),
                          category=DeprecationWarning,
                          stacklevel=2)
            return func(*args, **kwargs)
        return new_func
    return decorator
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.dictmap" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.misc_utils.dictmap(mdict, keyfun=None, valfun=None)</code>


<a href="#beancount.utils.misc_utils.dictmap" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Map a dictionary's value.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>mdict</strong> – A dict.</p></li>
            <li><p><strong>key</strong> – A callable to apply to the keys.</p></li>
            <li><p><strong>value</strong> – A callable to apply to the values.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def dictmap(mdict, keyfun=None, valfun=None):
    """Map a dictionary's value.

    Args:
      mdict: A dict.
      key: A callable to apply to the keys.
      value: A callable to apply to the values.
    """
    if keyfun is None:
        keyfun = lambda x: x
    if valfun is None:
        valfun = lambda x: x
    return {keyfun(key): valfun(val) for key, val in mdict.items()}
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.escape_string" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.misc_utils.escape_string(string)</code>


<a href="#beancount.utils.misc_utils.escape_string" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Escape quotes and backslashes in payee and narration.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>string</strong> – Any string.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Returns.
  The input string, with offending characters replaced.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def escape_string(string):
    """Escape quotes and backslashes in payee and narration.

    Args:
      string: Any string.
    Returns.
      The input string, with offending characters replaced.
    """
    return string.replace('\\', r'\\')\
                 .replace('"', r'\"')
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.filter_type" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.misc_utils.filter_type(elist, types)</code>


<a href="#beancount.utils.misc_utils.filter_type" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Filter the given list to yield only instances of the given types.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>elist</strong> – A sequence of elements.</p></li>
            <li><p><strong>types</strong> – A sequence of types to include in the output list.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  Each element, if it is an instance of 'types'.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def filter_type(elist, types):
    """Filter the given list to yield only instances of the given types.

    Args:
      elist: A sequence of elements.
      types: A sequence of types to include in the output list.
    Yields:
      Each element, if it is an instance of 'types'.
    """
    for element in elist:
        if not isinstance(element, types):
            continue
        yield element
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.first_paragraph" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.misc_utils.first_paragraph(docstring)</code>


<a href="#beancount.utils.misc_utils.first_paragraph" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Return the first sentence of a docstring.
The sentence has to be delimited by an empty line.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>docstring</strong> – A doc string.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A string with just the first sentence on a single line.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def first_paragraph(docstring):
    """Return the first sentence of a docstring.
    The sentence has to be delimited by an empty line.

    Args:
      docstring: A doc string.
    Returns:
      A string with just the first sentence on a single line.
    """
    lines = []
    for line in docstring.strip().splitlines():
        if not line:
            break
        lines.append(line.rstrip())
    return ' '.join(lines)
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.get_screen_height" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.misc_utils.get_screen_height()</code>


<a href="#beancount.utils.misc_utils.get_screen_height" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Return the height of the terminal that runs this program.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>An integer, the number of characters the screen is high.
Return 0 if the terminal cannot be initialized.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def get_screen_height():
    """Return the height of the terminal that runs this program.

    Returns:
      An integer, the number of characters the screen is high.
      Return 0 if the terminal cannot be initialized.
    """
    return _get_screen_value('lines', 0)
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.get_screen_width" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.misc_utils.get_screen_width()</code>


<a href="#beancount.utils.misc_utils.get_screen_width" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Return the width of the terminal that runs this program.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>An integer, the number of characters the screen is wide.
Return 0 if the terminal cannot be initialized.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def get_screen_width():
    """Return the width of the terminal that runs this program.

    Returns:
      An integer, the number of characters the screen is wide.
      Return 0 if the terminal cannot be initialized.
    """
    return _get_screen_value('cols', 0)
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.get_tuple_values" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.misc_utils.get_tuple_values(ntuple, predicate, memo=None)</code>


<a href="#beancount.utils.misc_utils.get_tuple_values" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Return all members referred to by this namedtuple instance that satisfy the
given predicate. This function also works recursively on its members which
are lists or tuples, and so it can be used for Transaction instances.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>ntuple</strong> – A tuple or namedtuple.</p></li>
            <li><p><strong>predicate</strong> – A predicate function that returns true if an attribute is to be
output.</p></li>
            <li><p><strong>memo</strong> – An optional memoizing dictionary. If a tuple has already been seen, the
recursion will be avoided.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  Attributes of the tuple and its sub-elements if the predicate is true.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def get_tuple_values(ntuple, predicate, memo=None):
    """Return all members referred to by this namedtuple instance that satisfy the
    given predicate. This function also works recursively on its members which
    are lists or tuples, and so it can be used for Transaction instances.

    Args:
      ntuple: A tuple or namedtuple.
      predicate: A predicate function that returns true if an attribute is to be
        output.
      memo: An optional memoizing dictionary. If a tuple has already been seen, the
        recursion will be avoided.
    Yields:
      Attributes of the tuple and its sub-elements if the predicate is true.
    """
    if memo is None:
        memo = set()
    id_ntuple = id(ntuple)
    if id_ntuple in memo:
        return
    memo.add(id_ntuple)

    if predicate(ntuple):
        yield
    for attribute in ntuple:
        if predicate(attribute):
            yield attribute
        if isinstance(attribute, (list, tuple)):
            for value in get_tuple_values(attribute, predicate, memo):
                yield value
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.groupby" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.misc_utils.groupby(keyfun, elements)</code>


<a href="#beancount.utils.misc_utils.groupby" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Group the elements as a dict of lists, where the key is computed using the
function 'keyfun'.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>keyfun</strong> – A callable, used to obtain the group key from each element.</p></li>
            <li><p><strong>elements</strong> – An iterable of the elements to group.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A dict of key to list of sequences.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def groupby(keyfun, elements):
    """Group the elements as a dict of lists, where the key is computed using the
    function 'keyfun'.

    Args:
      keyfun: A callable, used to obtain the group key from each element.
      elements: An iterable of the elements to group.
    Returns:
      A dict of key to list of sequences.
    """
    # Note: We could allow a custom aggregation function. Another option is
    # provide another method to reduce the list values of a dict, but that can
    # be accomplished using a dict comprehension.
    grouped = defaultdict(list)
    for element in elements:
        grouped[keyfun(element)].append(element)
    return grouped
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.idify" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.misc_utils.idify(string)</code>


<a href="#beancount.utils.misc_utils.idify" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Replace characters objectionable for a filename with underscores.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>string</strong> – Any string.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>The input string, with offending characters replaced.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def idify(string):
    """Replace characters objectionable for a filename with underscores.

    Args:
      string: Any string.
    Returns:
      The input string, with offending characters replaced.
    """
    for sfrom, sto in [(r'[ \(\)]+', '_'),
                       (r'_*\._*', '.')]:
        string = re.sub(sfrom, sto, string)
    string = string.strip('_')
    return string
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.import_curses" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.misc_utils.import_curses()</code>


<a href="#beancount.utils.misc_utils.import_curses" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Try to import the 'curses' module.
(This is used here in order to override for tests.)</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>The curses module, if it was possible to import it.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>ImportError</code> – If the module could not be imported.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def import_curses():
    """Try to import the 'curses' module.
    (This is used here in order to override for tests.)

    Returns:
      The curses module, if it was possible to import it.
    Raises:
      ImportError: If the module could not be imported.
    """
    # Note: There's a recipe for getting terminal size on Windows here, without
    # curses, I should probably implement that at some point:
    # https://stackoverflow.com/questions/263890/how-do-i-find-the-width-height-of-a-terminal-window
    # Also, consider just using 'blessings' instead, which provides this across
    # multiple platforms.
    # pylint: disable=import-outside-toplevel
    import curses
    return curses
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.is_sorted" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.misc_utils.is_sorted(iterable, key=&lt;function &lt;lambda&gt; at 0x77fedd22e480&gt;, cmp=&lt;function &lt;lambda&gt; at 0x77fedd22e520&gt;)</code>


<a href="#beancount.utils.misc_utils.is_sorted" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Return true if the sequence is sorted.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>iterable</strong> – An iterable sequence.</p></li>
            <li><p><strong>key</strong> – A function to extract the quantity by which to sort.</p></li>
            <li><p><strong>cmp</strong> – A function that compares two elements of a sequence.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A boolean, true if the sequence is sorted.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def is_sorted(iterable, key=lambda x: x, cmp=lambda x, y: x &lt;= y):
    """Return true if the sequence is sorted.

    Args:
      iterable: An iterable sequence.
      key: A function to extract the quantity by which to sort.
      cmp: A function that compares two elements of a sequence.
    Returns:
      A boolean, true if the sequence is sorted.
    """
    iterator = map(key, iterable)
    prev = next(iterator)
    for element in iterator:
        if not cmp(prev, element):
            return False
        prev = element
    return True
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.log_time" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.misc_utils.log_time(operation_name, log_timings, indent=0)</code>


<a href="#beancount.utils.misc_utils.log_time" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A context manager that times the block and logs it to info level.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>operation_name</strong> – A string, a label for the name of the operation.</p></li>
            <li><p><strong>log_timings</strong> – A function to write log messages to. If left to None,
no timings are written (this becomes a no-op).</p></li>
            <li><p><strong>indent</strong> – An integer, the indentation level for the format of the timing
line. This is useful if you're logging timing to a hierarchy of
operations.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  The start time of the operation.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">@contextlib.contextmanager
def log_time(operation_name, log_timings, indent=0):
    """A context manager that times the block and logs it to info level.

    Args:
      operation_name: A string, a label for the name of the operation.
      log_timings: A function to write log messages to. If left to None,
        no timings are written (this becomes a no-op).
      indent: An integer, the indentation level for the format of the timing
        line. This is useful if you're logging timing to a hierarchy of
        operations.
    Yields:
      The start time of the operation.
    """
    time1 = time()
    yield time1
    time2 = time()
    if log_timings:
        log_timings("Operation: {:48} Time: {}{:6.0f} ms".format(
            "'{}'".format(operation_name), '      '*indent, (time2 - time1) * 1000))
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.longest" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.misc_utils.longest(seq)</code>


<a href="#beancount.utils.misc_utils.longest" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Return the longest of the given subsequences.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>seq</strong> – An iterable sequence of lists.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>The longest list from the sequence.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def longest(seq):
    """Return the longest of the given subsequences.

    Args:
      seq: An iterable sequence of lists.
    Returns:
      The longest list from the sequence.
    """
    longest, length = None, -1
    for element in seq:
        len_element = len(element)
        if len_element &gt; length:
            longest, length = element, len_element
    return longest
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.map_namedtuple_attributes" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.misc_utils.map_namedtuple_attributes(attributes, mapper, object_)</code>


<a href="#beancount.utils.misc_utils.map_namedtuple_attributes" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Map the value of the named attributes of object by mapper.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>attributes</strong> – A sequence of string, the attribute names to map.</p></li>
            <li><p><strong>mapper</strong> – A callable that accepts the value of a field and returns
the new value.</p></li>
            <li><p><strong>object_</strong> – Some namedtuple object with attributes on it.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A new instance of the same namedtuple with the named fields mapped by
mapper.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def map_namedtuple_attributes(attributes, mapper, object_):
    """Map the value of the named attributes of object by mapper.

    Args:
      attributes: A sequence of string, the attribute names to map.
      mapper: A callable that accepts the value of a field and returns
        the new value.
      object_: Some namedtuple object with attributes on it.
    Returns:
      A new instance of the same namedtuple with the named fields mapped by
      mapper.
    """
    return object_._replace(**{attribute: mapper(getattr(object_, attribute))
                               for attribute in attributes})
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.replace_namedtuple_values" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.misc_utils.replace_namedtuple_values(ntuple, predicate, mapper, memo=None)</code>


<a href="#beancount.utils.misc_utils.replace_namedtuple_values" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Recurse through all the members of namedtuples and lists, and for
members that match the given predicate, run them through the given mapper.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>ntuple</strong> – A namedtuple instance.</p></li>
            <li><p><strong>predicate</strong> – A predicate function that returns true if an attribute is to be
output.</p></li>
            <li><p><strong>mapper</strong> – A callable, that will accept a single argument and return its
replacement value.</p></li>
            <li><p><strong>memo</strong> – An optional memoizing dictionary. If a tuple has already been seen, the
recursion will be avoided.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  Attributes of the tuple and its sub-elements if the predicate is true.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def replace_namedtuple_values(ntuple, predicate, mapper, memo=None):
    """Recurse through all the members of namedtuples and lists, and for
    members that match the given predicate, run them through the given mapper.

    Args:
      ntuple: A namedtuple instance.
      predicate: A predicate function that returns true if an attribute is to be
        output.
      mapper: A callable, that will accept a single argument and return its
        replacement value.
      memo: An optional memoizing dictionary. If a tuple has already been seen, the
        recursion will be avoided.
    Yields:
      Attributes of the tuple and its sub-elements if the predicate is true.
    """
    if memo is None:
        memo = set()
    id_ntuple = id(ntuple)
    if id_ntuple in memo:
        return None
    memo.add(id_ntuple)

    # pylint: disable=unidiomatic-typecheck
    if not (type(ntuple) is not tuple and isinstance(ntuple, tuple)):
        return ntuple
    replacements = {}
    for attribute_name, attribute in zip(ntuple._fields, ntuple):
        if predicate(attribute):
            replacements[attribute_name] = mapper(attribute)
        elif type(attribute) is not tuple and isinstance(attribute, tuple):
            replacements[attribute_name] = replace_namedtuple_values(
                attribute, predicate, mapper, memo)
        elif type(attribute) in (list, tuple):
            replacements[attribute_name] = [
                replace_namedtuple_values(member, predicate, mapper, memo)
                for member in attribute]
    return ntuple._replace(**replacements)
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.skipiter" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.misc_utils.skipiter(iterable, num_skip)</code>


<a href="#beancount.utils.misc_utils.skipiter" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Skip some elements from an iterator.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>iterable</strong> – An iterator.</p></li>
            <li><p><strong>num_skip</strong> – The number of elements in the period.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  Elements from the iterable, with num_skip elements skipped.
  For example, skipiter(range(10), 3) yields [0, 3, 6, 9].</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def skipiter(iterable, num_skip):
    """Skip some elements from an iterator.

    Args:
      iterable: An iterator.
      num_skip: The number of elements in the period.
    Yields:
      Elements from the iterable, with num_skip elements skipped.
      For example, skipiter(range(10), 3) yields [0, 3, 6, 9].
    """
    assert num_skip &gt; 0
    sit = iter(iterable)
    while 1:
        try:
            value = next(sit)
        except StopIteration:
            return
        yield value
        for _ in range(num_skip-1):
            try:
                next(sit)
            except StopIteration:
                return
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.sorted_uniquify" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.misc_utils.sorted_uniquify(iterable, keyfunc=None, last=False)</code>


<a href="#beancount.utils.misc_utils.sorted_uniquify" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Given a sequence of elements, sort and remove duplicates of the given key.
Keep either the first or the last (by key) element of a sequence of
key-identical elements. This does <em>not</em> maintain the ordering of the
original elements, they are returned sorted (by key) instead.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>iterable</strong> – An iterable sequence.</p></li>
            <li><p><strong>keyfunc</strong> – A function that extracts from the elements the sort key
to use and uniquify on. If left unspecified, the identify function
is used and the uniquification occurs on the elements themselves.</p></li>
            <li><p><strong>last</strong> – A boolean, True if we should keep the last item of the same keys.
Otherwise keep the first.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  Elements from the iterable.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def sorted_uniquify(iterable, keyfunc=None, last=False):
    """Given a sequence of elements, sort and remove duplicates of the given key.
    Keep either the first or the last (by key) element of a sequence of
    key-identical elements. This does _not_ maintain the ordering of the
    original elements, they are returned sorted (by key) instead.

    Args:
      iterable: An iterable sequence.
      keyfunc: A function that extracts from the elements the sort key
        to use and uniquify on. If left unspecified, the identify function
        is used and the uniquification occurs on the elements themselves.
      last: A boolean, True if we should keep the last item of the same keys.
        Otherwise keep the first.
    Yields:
      Elements from the iterable.
    """
    if keyfunc is None:
        keyfunc = lambda x: x
    if last:
        prev_obj = UNSET
        prev_key = UNSET
        for obj in sorted(iterable, key=keyfunc):
            key = keyfunc(obj)
            if key != prev_key and prev_obj is not UNSET:
                yield prev_obj
            prev_obj = obj
            prev_key = key
        if prev_obj is not UNSET:
            yield prev_obj
    else:
        prev_key = UNSET
        for obj in sorted(iterable, key=keyfunc):
            key = keyfunc(obj)
            if key != prev_key:
                yield obj
                prev_key = key
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.staticvar" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.misc_utils.staticvar(varname, initial_value)</code>


<a href="#beancount.utils.misc_utils.staticvar" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Returns a decorator that defines a Python function attribute.</p>
<p>This is used to simulate a static function variable in Python.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>varname</strong> – A string, the name of the variable to define.</p></li>
            <li><p><strong>initial_value</strong> – The value to initialize the variable to.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A function decorator.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def staticvar(varname, initial_value):
    """Returns a decorator that defines a Python function attribute.

    This is used to simulate a static function variable in Python.

    Args:
      varname: A string, the name of the variable to define.
      initial_value: The value to initialize the variable to.
    Returns:
      A function decorator.
    """
    def deco(fun):
        setattr(fun, varname, initial_value)
        return fun
    return deco
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.swallow" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.misc_utils.swallow(*exception_types)</code>


<a href="#beancount.utils.misc_utils.swallow" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Catch and ignore certain exceptions.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>exception_types</strong> – A tuple of exception classes to ignore.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  None.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">@contextlib.contextmanager
def swallow(*exception_types):
    """Catch and ignore certain exceptions.

    Args:
      exception_types: A tuple of exception classes to ignore.
    Yields:
      None.
    """
    try:
        yield
    except Exception as exc:
        if not isinstance(exc, exception_types):
            raise
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.uniquify" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.misc_utils.uniquify(iterable, keyfunc=None, last=False)</code>


<a href="#beancount.utils.misc_utils.uniquify" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Given a sequence of elements, remove duplicates of the given key. Keep either
the first or the last element of a sequence of key-identical elements. Order
is maintained as much as possible. This does maintain the ordering of the
original elements, they are returned in the same order as the original
elements.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>iterable</strong> – An iterable sequence.</p></li>
            <li><p><strong>keyfunc</strong> – A function that extracts from the elements the sort key
to use and uniquify on. If left unspecified, the identify function
is used and the uniquification occurs on the elements themselves.</p></li>
            <li><p><strong>last</strong> – A boolean, True if we should keep the last item of the same keys.
Otherwise keep the first.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  Elements from the iterable.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def uniquify(iterable, keyfunc=None, last=False):
    """Given a sequence of elements, remove duplicates of the given key. Keep either
    the first or the last element of a sequence of key-identical elements. Order
    is maintained as much as possible. This does maintain the ordering of the
    original elements, they are returned in the same order as the original
    elements.

    Args:
      iterable: An iterable sequence.
      keyfunc: A function that extracts from the elements the sort key
        to use and uniquify on. If left unspecified, the identify function
        is used and the uniquification occurs on the elements themselves.
      last: A boolean, True if we should keep the last item of the same keys.
        Otherwise keep the first.
    Yields:
      Elements from the iterable.
    """
    if keyfunc is None:
        keyfunc = lambda x: x
    seen = set()
    if last:
        unique_reversed_list = []
        for obj in reversed(iterable):
            key = keyfunc(obj)
            if key not in seen:
                seen.add(key)
                unique_reversed_list.append(obj)
        yield from reversed(unique_reversed_list)
    else:
        for obj in iterable:
            key = keyfunc(obj)
            if key not in seen:
                seen.add(key)
                yield obj
</code></pre>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.utils.pager" class="doc doc-heading">
        <code>beancount.utils.pager</code>



<a href="#beancount.utils.pager" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Code to write output to a pager.</p>
<p>This module contains an object accumulates lines up to a minimum and then
decides whether to flush them to the original output directly if under the
threshold (no pager) or creates a pager and flushes the lines to it if above the
threshold and then forwards all future lines to it. The purpose of this object
is to pipe output to a pager only if the number of lines to be printed exceeds a
minimum number of lines.</p>
<p>The contextmanager is intended to be used to pipe output to a pager and wait on
the pager to complete before continuing. Simply write to the file object and
upon exit we close the file object. This also silences broken pipe errors
triggered by the user exiting the sub-process, and recovers from a failing pager
command by just using stdout.</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-class">



<h3 id="beancount.utils.pager.ConditionalPager" class="doc doc-heading">
        <code>
beancount.utils.pager.ConditionalPager        </code>



<a href="#beancount.utils.pager.ConditionalPager" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A proxy file for a pager that only creates a pager after a minimum number of
lines has been printed to it.</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.pager.ConditionalPager.__enter__" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.pager.ConditionalPager.__enter__(self)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.utils.pager.ConditionalPager.__enter__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Initialize the context manager and return this instance as it.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/pager.py</code></summary>
          <pre class="highlight"><code class="language-python">def __enter__(self):
    """Initialize the context manager and return this instance as it."""

    # The file and pipe object we're writing to. This gets set after the
    # number of accumulated lines reaches the threshold.
    if self.minlines:
        self.file = None
        self.pipe = None
    else:
        self.file, self.pipe = create_pager(self.command, self.default_file)

    # Lines accumulated before the threshold.
    self.accumulated_data = []
    self.accumulated_lines = 0

    # Return this object to be used as the context manager itself.
    return self
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.pager.ConditionalPager.__exit__" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.pager.ConditionalPager.__exit__(self, type, value, unused_traceback)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.utils.pager.ConditionalPager.__exit__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Context manager exit. This flushes the output to our output file.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>type</strong> – Optional exception type, as per context managers.</p></li>
            <li><p><strong>value</strong> – Optional exception value, as per context managers.</p></li>
            <li><p><strong>unused_traceback</strong> – Optional trace.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/pager.py</code></summary>
          <pre class="highlight"><code class="language-python">def __exit__(self, type, value, unused_traceback):
    """Context manager exit. This flushes the output to our output file.

    Args:
      type: Optional exception type, as per context managers.
      value: Optional exception value, as per context managers.
      unused_traceback: Optional trace.
    """
    try:
        if self.file:
            # Flush the output file and close it.
            self.file.flush()
        else:
            # Oops... we never reached the threshold. Flush the accumulated
            # output to the file.
            self.flush_accumulated(self.default_file)

        # Wait for the subprocess (if we have one).
        if self.pipe:
            self.file.close()
            self.pipe.wait()

    # Absorb broken pipes that may occur on flush or close above.
    except BrokenPipeError:
        return True

    # Absorb broken pipes.
    if isinstance(value, BrokenPipeError):
        return True
    elif value:
        raise
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.pager.ConditionalPager.__init__" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.pager.ConditionalPager.__init__(self, command, minlines=None)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.utils.pager.ConditionalPager.__init__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create a conditional pager.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>command</strong> – A string, the shell command to run as a pager.</p></li>
            <li><p><strong>minlines</strong> – If set, the number of lines under which you should not bother starting
a pager. This avoids kicking off a pager if the screen is high enough to
render the contents. If the value is unset, always starts a pager (which is
fine behavior too).</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/pager.py</code></summary>
          <pre class="highlight"><code class="language-python">def __init__(self, command, minlines=None):
    """Create a conditional pager.

    Args:
      command: A string, the shell command to run as a pager.
      minlines: If set, the number of lines under which you should not bother starting
        a pager. This avoids kicking off a pager if the screen is high enough to
        render the contents. If the value is unset, always starts a pager (which is
        fine behavior too).
    """
    self.command = command
    self.minlines = minlines
    self.default_file = (codecs.getwriter("utf-8")(sys.stdout.buffer)
                         if hasattr(sys.stdout, 'buffer') else
                         sys.stdout)
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.pager.ConditionalPager.flush_accumulated" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.pager.ConditionalPager.flush_accumulated(self, file)</code>


<a href="#beancount.utils.pager.ConditionalPager.flush_accumulated" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Flush the existing lines to the newly created pager.
This also disabled the accumulator.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>file</strong> – A file object to flush the accumulated data to.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/pager.py</code></summary>
          <pre class="highlight"><code class="language-python">def flush_accumulated(self, file):
    """Flush the existing lines to the newly created pager.
    This also disabled the accumulator.

    Args:
      file: A file object to flush the accumulated data to.
    """
    if self.accumulated_data:
        write = file.write
        for data in self.accumulated_data:
            write(data)
    self.accumulated_data = None
    self.accumulated_lines = None
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.pager.ConditionalPager.write" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.pager.ConditionalPager.write(self, data)</code>


<a href="#beancount.utils.pager.ConditionalPager.write" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Write the data out. Overridden from the file object interface.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>data</strong> – A string, data to write to the output.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/pager.py</code></summary>
          <pre class="highlight"><code class="language-python">def write(self, data):
    """Write the data out. Overridden from the file object interface.

    Args:
      data: A string, data to write to the output.
    """
    if self.file is None:
        # Accumulate the new lines.
        self.accumulated_lines += data.count('\n')
        self.accumulated_data.append(data)

        # If we've reached the threshold, create a file.
        if self.accumulated_lines &gt; self.minlines:
            self.file, self.pipe = create_pager(self.command, self.default_file)
            self.flush_accumulated(self.file)
    else:
        # We've already created a pager subprocess... flush the lines to it.
        self.file.write(data)
        # try:
        # except BrokenPipeError:
        #     # Make sure we don't barf on __exit__().
        #     self.file = self.pipe = None
        #     raise
</code></pre>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.pager.create_pager" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.pager.create_pager(command, file)</code>


<a href="#beancount.utils.pager.create_pager" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Try to create and return a pager subprocess.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>command</strong> – A string, the shell command to run as a pager.</p></li>
            <li><p><strong>file</strong> – The file object for the pager write to. This is also used as a
default if we failed to create the pager subprocess.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A pair of (file, pipe), a file object and an optional subprocess.Popen instance
to wait on. The pipe instance may be set to None if we failed to create a subprocess.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/pager.py</code></summary>
          <pre class="highlight"><code class="language-python">def create_pager(command, file):
    """Try to create and return a pager subprocess.

    Args:
      command: A string, the shell command to run as a pager.
      file: The file object for the pager write to. This is also used as a
        default if we failed to create the pager subprocess.
    Returns:
      A pair of (file, pipe), a file object and an optional subprocess.Popen instance
      to wait on. The pipe instance may be set to None if we failed to create a subprocess.
    """

    if command is None:
        command = os.environ.get('PAGER', DEFAULT_PAGER)
    if not command:
        command = DEFAULT_PAGER

    pipe = None

    # In case of using 'less', make sure the charset is set properly. In theory
    # you could override this by setting PAGER to "LESSCHARSET=utf-8 less" but
    # this shouldn't affect other programs and is unlikely to cause problems, so
    # we set it here to make default behavior work for most people (we always
    # write UTF-8).
    env = os.environ.copy()
    env['LESSCHARSET'] = "utf-8"

    try:
        pipe = subprocess.Popen(command, shell=True,
                                stdin=subprocess.PIPE,
                                stdout=file,
                                env=env)
    except OSError as exc:
        logging.error("Invalid pager: {}".format(exc))
    else:
        stdin_wrapper = io.TextIOWrapper(pipe.stdin, 'utf-8')
        file = stdin_wrapper
    return file, pipe
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.pager.flush_only" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.pager.flush_only(fileobj)</code>


<a href="#beancount.utils.pager.flush_only" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A contextmanager around a file object that does not close the file.</p>
<p>This is used to return a context manager on a file object but not close it.
We flush it instead. This is useful in order to provide an alternative to a
pager class as above.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>fileobj</strong> – A file object, to remain open after running the context manager.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  A context manager that yields this object.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/pager.py</code></summary>
          <pre class="highlight"><code class="language-python">@contextlib.contextmanager
def flush_only(fileobj):
    """A contextmanager around a file object that does not close the file.

    This is used to return a context manager on a file object but not close it.
    We flush it instead. This is useful in order to provide an alternative to a
    pager class as above.

    Args:
      fileobj: A file object, to remain open after running the context manager.
    Yields:
      A context manager that yields this object.
    """
    try:
        yield fileobj
    finally:
        fileobj.flush()
</code></pre>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.utils.snoop" class="doc doc-heading">
        <code>beancount.utils.snoop</code>



<a href="#beancount.utils.snoop" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Text manipulation utilities.</p>



  <div class="doc doc-children">











  <div class="doc doc-object doc-class">



<h3 id="beancount.utils.snoop.Snoop" class="doc doc-heading">
        <code>
beancount.utils.snoop.Snoop        </code>



<a href="#beancount.utils.snoop.Snoop" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A snooper callable that just saves the returned values of a
function. This is particularly useful for re.match and re.search in
conditionals, e.g.::</p>
<p>snoop = Snoop()
  ...
  if snoop(re.match(r"(\d+)-(\d+)-(\d+)", text)):
    year, month, date = snoop.value.group(1, 2, 3)</p>

<p><strong>Attributes:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>value</code></td>
        <td></td>
        <td><p>The last value snooped from a function call.</p></td>
      </tr>
      <tr>
        <td><code>history</code></td>
        <td></td>
        <td><p>If 'maxlen' was specified, the last few values
that were snooped.</p></td>
      </tr>
  </tbody>
</table>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.snoop.Snoop.__call__" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.snoop.Snoop.__call__(self, value)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.utils.snoop.Snoop.__call__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Save a value to the snooper. This is meant to wrap
a function call.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>value</strong> – The value to push/save.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>Value itself.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/snoop.py</code></summary>
          <pre class="highlight"><code class="language-python">def __call__(self, value):
    """Save a value to the snooper. This is meant to wrap
    a function call.

    Args:
      value: The value to push/save.
    Returns:
      Value itself.
    """
    self.value = value
    if self.history is not None:
        self.history.append(value)
    return value
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.snoop.Snoop.__getattr__" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.snoop.Snoop.__getattr__(self, attr)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.utils.snoop.Snoop.__getattr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Forward the attribute to the value.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>attr</strong> – A string, the name of the attribute.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>The value of the attribute.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/snoop.py</code></summary>
          <pre class="highlight"><code class="language-python">def __getattr__(self, attr):
    """Forward the attribute to the value.

    Args:
      attr: A string, the name of the attribute.
    Returns:
      The value of the attribute.
    """
    return getattr(self.value, attr)
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.snoop.Snoop.__init__" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.snoop.Snoop.__init__(self, maxlen=None)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.utils.snoop.Snoop.__init__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create a new snooper.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>maxlen</strong> – If specified, an integer, which enables the saving of that</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/snoop.py</code></summary>
          <pre class="highlight"><code class="language-python">def __init__(self, maxlen=None):
    """Create a new snooper.

    Args:
      maxlen: If specified, an integer, which enables the saving of that
      number of last values in the history attribute.
    """
    self.value = None
    self.history = (collections.deque(maxlen=maxlen)
                    if maxlen
                    else None)
</code></pre>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.snoop.snoopify" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.snoop.snoopify(function)</code>


<a href="#beancount.utils.snoop.snoopify" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Decorate a function as snoopable.</p>
<p>This is meant to reassign existing functions to a snoopable version of them.
For example, if you wanted 're.match' to be automatically snoopable, just
decorate it like this:</p>
<p>re.match = snoopify(re.match)</p>
<p>and then you can just call 're.match' in a conditional and then access
're.match.value' to get to the last returned value.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/snoop.py</code></summary>
          <pre class="highlight"><code class="language-python">def snoopify(function):
    """Decorate a function as snoopable.

    This is meant to reassign existing functions to a snoopable version of them.
    For example, if you wanted 're.match' to be automatically snoopable, just
    decorate it like this:

      re.match = snoopify(re.match)

    and then you can just call 're.match' in a conditional and then access
    're.match.value' to get to the last returned value.
    """
    @functools.wraps(function)
    def wrapper(*args, **kw):
        value = function(*args, **kw)
        wrapper.value = value
        return value
    wrapper.value = None
    return wrapper
</code></pre>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.utils.table" class="doc doc-heading">
        <code>beancount.utils.table</code>



<a href="#beancount.utils.table" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Table rendering.</p>



  <div class="doc doc-children">









  <div class="doc doc-object doc-class">



<h3 id="beancount.utils.table.Table" class="doc doc-heading">
        <code>
beancount.utils.table.Table            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.utils.table.Table" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Table(columns, header, body)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.table.Table.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.table.Table.__getnewargs__(self)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.utils.table.Table.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/table.py</code></summary>
          <pre class="highlight"><code class="language-python">def __getnewargs__(self):
    'Return self as a plain tuple.  Used by copy and pickle.'
    return _tuple(self)
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.table.Table.__new__" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.table.Table.__new__(_cls, columns, header, body)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.utils.table.Table.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of Table(columns, header, body)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.table.Table.__replace__" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.table.Table.__replace__(/, self, **kwds)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.utils.table.Table.__replace__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a new Table object replacing specified fields with new values</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/table.py</code></summary>
          <pre class="highlight"><code class="language-python">def _replace(self, /, **kwds):
    result = self._make(_map(kwds.pop, field_names, self))
    if kwds:
        raise TypeError(f'Got unexpected field names: {list(kwds)!r}')
    return result
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.table.Table.__repr__" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.table.Table.__repr__(self)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.utils.table.Table.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/table.py</code></summary>
          <pre class="highlight"><code class="language-python">def __repr__(self):
    'Return a nicely formatted representation string'
    return self.__class__.__name__ + repr_fmt % self
</code></pre>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.table.attribute_to_title" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.table.attribute_to_title(fieldname)</code>


<a href="#beancount.utils.table.attribute_to_title" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Convert programming id into readable field name.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>fieldname</strong> – A string, a programming ids, such as 'book_value'.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A readable string, such as 'Book Value.'</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/table.py</code></summary>
          <pre class="highlight"><code class="language-python">def attribute_to_title(fieldname):
    """Convert programming id into readable field name.

    Args:
      fieldname: A string, a programming ids, such as 'book_value'.
    Returns:
      A readable string, such as 'Book Value.'
   """
    return fieldname.replace('_', ' ').title()
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.table.compute_table_widths" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.table.compute_table_widths(rows)</code>


<a href="#beancount.utils.table.compute_table_widths" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Compute the max character widths of a list of rows.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>rows</strong> – A list of rows, which are sequences of strings.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of integers, the maximum widths required to render the columns of
this table.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>IndexError</code> – If the rows are of different lengths.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/table.py</code></summary>
          <pre class="highlight"><code class="language-python">def compute_table_widths(rows):
    """Compute the max character widths of a list of rows.

    Args:
      rows: A list of rows, which are sequences of strings.
    Returns:
      A list of integers, the maximum widths required to render the columns of
      this table.
    Raises:
      IndexError: If the rows are of different lengths.
    """
    row_iter = iter(rows)
    first_row = next(row_iter)
    num_columns = len(first_row)
    column_widths = [len(cell) for cell in first_row]
    for row in row_iter:
        for i, cell in enumerate(row):
            if not isinstance(cell, str):
                cell = str(cell)
            cell_len = len(cell)
            if cell_len &gt; column_widths[i]:
                column_widths[i] = cell_len
        if i+1 != num_columns:
            raise IndexError("Invalid number of rows")
    return column_widths
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.table.create_table" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.table.create_table(rows, field_spec=None)</code>


<a href="#beancount.utils.table.create_table" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Convert a list of tuples to an table report object.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>rows</strong> – A list of tuples.</p></li>
            <li><p><strong>field_spec</strong> – A list of strings, or a list of
(FIELDNAME-OR-INDEX, HEADER, FORMATTER-FUNCTION)
triplets, that selects a subset of the fields is to be rendered as well
as their ordering. If this is a dict, the values are functions to call
on the fields to render them. If a function is set to None, we will just
call str() on the field.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A Table instance.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/table.py</code></summary>
          <pre class="highlight"><code class="language-python">def create_table(rows, field_spec=None):
    """Convert a list of tuples to an table report object.

    Args:
      rows: A list of tuples.
      field_spec: A list of strings, or a list of
        (FIELDNAME-OR-INDEX, HEADER, FORMATTER-FUNCTION)
        triplets, that selects a subset of the fields is to be rendered as well
        as their ordering. If this is a dict, the values are functions to call
        on the fields to render them. If a function is set to None, we will just
        call str() on the field.
    Returns:
      A Table instance.
    """
    # Normalize field_spec to a dict.
    if field_spec is None:
        namedtuple_class = type(rows[0])
        field_spec = [(field, None, None)
                      for field in namedtuple_class._fields]

    elif isinstance(field_spec, (list, tuple)):
        new_field_spec = []
        for field in field_spec:
            if isinstance(field, tuple):
                assert len(field) &lt;= 3, field
                if len(field) == 1:
                    field = field[0]
                    new_field_spec.append((field, None, None))
                elif len(field) == 2:
                    field, header = field
                    new_field_spec.append((field, header, None))
                elif len(field) == 3:
                    new_field_spec.append(field)
            else:
                if isinstance(field, str):
                    title = attribute_to_title(field)
                elif isinstance(field, int):
                    title = "Field {}".format(field)
                else:
                    raise ValueError("Invalid type for column name")
                new_field_spec.append((field, title, None))

        field_spec = new_field_spec

    # Ensure a nicely formatted header.
    field_spec = [((name, attribute_to_title(name), formatter)
                   if header_ is None
                   else (name, header_, formatter))
                  for (name, header_, formatter) in field_spec]

    assert isinstance(field_spec, list), field_spec
    assert all(len(x) == 3 for x in field_spec), field_spec

    # Compute the column names.
    columns = [name for (name, _, __) in field_spec]

    # Compute the table header.
    header = [header_column for (_, header_column, __) in field_spec]

    # Compute the table body.
    body = []
    for row in rows:
        body_row = []
        for name, _, formatter in field_spec:
            if isinstance(name, str):
                value = getattr(row, name)
            elif isinstance(name, int):
                value = row[name]
            else:
                raise ValueError("Invalid type for column name")
            if value is not None:
                if formatter is not None:
                    value = formatter(value)
                else:
                    value = str(value)
            else:
                value = ''
            body_row.append(value)
        body.append(body_row)

    return Table(columns, header, body)
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.table.render_table" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.table.render_table(table_, output, output_format, css_id=None, css_class=None)</code>


<a href="#beancount.utils.table.render_table" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Render the given table to the output file object in the requested format.</p>
<p>The table gets written out to the 'output' file.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>table_</strong> – An instance of Table.</p></li>
            <li><p><strong>output</strong> – A file object you can write to.</p></li>
            <li><p><strong>output_format</strong> – A string, the format to write the table to,
either 'csv', 'txt' or 'html'.</p></li>
            <li><p><strong>css_id</strong> – A string, an optional CSS id for the table object (only used for HTML).</p></li>
            <li><p><strong>css_class</strong> – A string, an optional CSS class for the table object (only used for HTML).</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/table.py</code></summary>
          <pre class="highlight"><code class="language-python">def render_table(table_, output, output_format, css_id=None, css_class=None):
    """Render the given table to the output file object in the requested format.

    The table gets written out to the 'output' file.

    Args:
      table_: An instance of Table.
      output: A file object you can write to.
      output_format: A string, the format to write the table to,
        either 'csv', 'txt' or 'html'.
      css_id: A string, an optional CSS id for the table object (only used for HTML).
      css_class: A string, an optional CSS class for the table object (only used for HTML).
    """
    if output_format in ('txt', 'text'):
        text = table_to_text(table_, "  ", formats={'*': '&gt;', 'account': '&lt;'})
        output.write(text)

    elif output_format in ('csv',):
        table_to_csv(table_, file=output)

    elif output_format in ('htmldiv', 'html'):

        if output_format == 'html':
            output.write('&lt;html&gt;\n')
            output.write('&lt;body&gt;\n')

        output.write('&lt;div id="{}"&gt;\n'.format(css_id) if css_id else '&lt;div&gt;\n')
        classes = [css_class] if css_class else None
        table_to_html(table_, file=output, classes=classes)
        output.write('&lt;/div&gt;\n')

        if output_format == 'html':
            output.write('&lt;/body&gt;\n')
            output.write('&lt;/html&gt;\n')

    else:
        raise NotImplementedError("Unsupported format: {}".format(output_format))
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.table.table_to_csv" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.table.table_to_csv(table, file=None, **kwargs)</code>


<a href="#beancount.utils.table.table_to_csv" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Render a Table to a CSV file.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>table</strong> – An instance of a Table.</p></li>
            <li><p><strong>file</strong> – A file object to write to. If no object is provided, this
function returns a string.</p></li>
            <li><p><strong>**kwargs</strong> – Optional arguments forwarded to csv.writer().</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A string, the rendered table, or None, if a file object is provided
to write to.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/table.py</code></summary>
          <pre class="highlight"><code class="language-python">def table_to_csv(table, file=None, **kwargs):
    """Render a Table to a CSV file.

    Args:
      table: An instance of a Table.
      file: A file object to write to. If no object is provided, this
        function returns a string.
      **kwargs: Optional arguments forwarded to csv.writer().
    Returns:
      A string, the rendered table, or None, if a file object is provided
      to write to.
    """
    output_file = file or io.StringIO()

    writer = csv.writer(output_file, **kwargs)
    if table.header:
        writer.writerow(table.header)
    writer.writerows(table.body)

    if not file:
        return output_file.getvalue()
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.table.table_to_html" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.table.table_to_html(table, classes=None, file=None)</code>


<a href="#beancount.utils.table.table_to_html" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Render a Table to HTML.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>table</strong> – An instance of a Table.</p></li>
            <li><p><strong>classes</strong> – A list of string, CSS classes to set on the table.</p></li>
            <li><p><strong>file</strong> – A file object to write to. If no object is provided, this
function returns a string.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A string, the rendered table, or None, if a file object is provided
to write to.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/table.py</code></summary>
          <pre class="highlight"><code class="language-python">def table_to_html(table, classes=None, file=None):
    """Render a Table to HTML.

    Args:
      table: An instance of a Table.
      classes: A list of string, CSS classes to set on the table.
      file: A file object to write to. If no object is provided, this
        function returns a string.
    Returns:
      A string, the rendered table, or None, if a file object is provided
      to write to.
    """
    # Initialize file.
    oss = io.StringIO() if file is None else file
    oss.write('&lt;table class="{}"&gt;\n'.format(' '.join(classes or [])))

    # Render header.
    if table.header:
        oss.write('  &lt;thead&gt;\n')
        oss.write('    &lt;tr&gt;\n')
        for header in table.header:
            oss.write('      &lt;th&gt;{}&lt;/th&gt;\n'.format(header))
        oss.write('    &lt;/tr&gt;\n')
        oss.write('  &lt;/thead&gt;\n')

    # Render body.
    oss.write('  &lt;tbody&gt;\n')
    for row in table.body:
        oss.write('    &lt;tr&gt;\n')
        for cell in row:
            oss.write('      &lt;td&gt;{}&lt;/td&gt;\n'.format(cell))
        oss.write('    &lt;/tr&gt;\n')
    oss.write('  &lt;/tbody&gt;\n')

    # Render footer.
    oss.write('&lt;/table&gt;\n')
    if file is None:
        return oss.getvalue()
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.table.table_to_text" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.table.table_to_text(table, column_interspace=' ', formats=None)</code>


<a href="#beancount.utils.table.table_to_text" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Render a Table to ASCII text.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>table</strong> – An instance of a Table.</p></li>
            <li><p><strong>column_interspace</strong> – A string to render between the columns as spacer.</p></li>
            <li><p><strong>formats</strong> – An optional dict of column name to a format character that gets
inserted in a format string specified, like this (where '&lt;char&gt;' is):
{:&lt;char&gt;&lt;width&gt;}. A key of '<em>' will provide a default value, like
this, for example: (... formats={'</em>': '&gt;'}).</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A string, the rendered text table.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/table.py</code></summary>
          <pre class="highlight"><code class="language-python">def table_to_text(table,
                  column_interspace=" ",
                  formats=None):
    """Render a Table to ASCII text.

    Args:
      table: An instance of a Table.
      column_interspace: A string to render between the columns as spacer.
      formats: An optional dict of column name to a format character that gets
        inserted in a format string specified, like this (where '&lt;char&gt;' is):
        {:&lt;char&gt;&lt;width&gt;}. A key of '*' will provide a default value, like
        this, for example: (... formats={'*': '&gt;'}).
    Returns:
      A string, the rendered text table.
    """
    column_widths = compute_table_widths(itertools.chain([table.header],
                                                         table.body))

    # Insert column format chars and compute line formatting string.
    column_formats = []
    if formats:
        default_format = formats.get('*', None)
    for column, width in zip(table.columns, column_widths):
        if column and formats:
            format_ = formats.get(column, default_format)
            if format_:
                column_formats.append("{{:{}{:d}}}".format(format_, width))
            else:
                column_formats.append("{{:{:d}}}".format(width))
        else:
            column_formats.append("{{:{:d}}}".format(width))

    line_format = column_interspace.join(column_formats) + "\n"
    separator = line_format.format(*[('-' * width) for width in column_widths])

    # Render the header.
    oss = io.StringIO()
    if table.header:
        oss.write(line_format.format(*table.header))

    # Render the body.
    oss.write(separator)
    for row in table.body:
        oss.write(line_format.format(*row))
    oss.write(separator)

    return oss.getvalue()
</code></pre>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.utils.test_utils" class="doc doc-heading">
        <code>beancount.utils.test_utils</code>



<a href="#beancount.utils.test_utils" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Support utilities for testing scripts.</p>



  <div class="doc doc-children">









  <div class="doc doc-object doc-class">



<h3 id="beancount.utils.test_utils.ClickTestCase" class="doc doc-heading">
        <code>
beancount.utils.test_utils.ClickTestCase            (<a title="beancount.utils.test_utils.TestCase" href="#beancount.utils.test_utils.TestCase">TestCase</a>)
        </code>



<a href="#beancount.utils.test_utils.ClickTestCase" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Base class for command-line program test cases.</p>




  <div class="doc doc-children">












  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="beancount.utils.test_utils.RCall" class="doc doc-heading">
        <code>
beancount.utils.test_utils.RCall            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.utils.test_utils.RCall" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>RCall(args, kwargs, return_value)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.test_utils.RCall.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.test_utils.RCall.__getnewargs__(self)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.utils.test_utils.RCall.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def __getnewargs__(self):
    'Return self as a plain tuple.  Used by copy and pickle.'
    return _tuple(self)
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.test_utils.RCall.__new__" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.test_utils.RCall.__new__(_cls, args, kwargs, return_value)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.utils.test_utils.RCall.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of RCall(args, kwargs, return_value)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.test_utils.RCall.__replace__" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.test_utils.RCall.__replace__(/, self, **kwds)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.utils.test_utils.RCall.__replace__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a new RCall object replacing specified fields with new values</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def _replace(self, /, **kwds):
    result = self._make(_map(kwds.pop, field_names, self))
    if kwds:
        raise TypeError(f'Got unexpected field names: {list(kwds)!r}')
    return result
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.test_utils.RCall.__repr__" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.test_utils.RCall.__repr__(self)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.utils.test_utils.RCall.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def __repr__(self):
    'Return a nicely formatted representation string'
    return self.__class__.__name__ + repr_fmt % self
</code></pre>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="beancount.utils.test_utils.TestCase" class="doc doc-heading">
        <code>
beancount.utils.test_utils.TestCase            (<span title="unittest.case.TestCase">TestCase</span>)
        </code>



<a href="#beancount.utils.test_utils.TestCase" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">





  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.test_utils.TestCase.assertLines" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.test_utils.TestCase.assertLines(self, text1, text2, message=None)</code>


<a href="#beancount.utils.test_utils.TestCase.assertLines" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Compare the lines of text1 and text2, ignoring whitespace.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>text1</strong> – A string, the expected text.</p></li>
            <li><p><strong>text2</strong> – A string, the actual text.</p></li>
            <li><p><strong>message</strong> – An optional string message in case the assertion fails.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>AssertionError</code> – If the exception fails.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def assertLines(self, text1, text2, message=None):
    """Compare the lines of text1 and text2, ignoring whitespace.

    Args:
      text1: A string, the expected text.
      text2: A string, the actual text.
      message: An optional string message in case the assertion fails.
    Raises:
      AssertionError: If the exception fails.
    """
    clean_text1 = textwrap.dedent(text1.strip())
    clean_text2 = textwrap.dedent(text2.strip())
    lines1 = [line.strip() for line in clean_text1.splitlines()]
    lines2 = [line.strip() for line in clean_text2.splitlines()]

    # Compress all space longer than 4 spaces to exactly 4.
    # This affords us to be even looser.
    lines1 = [re.sub('    [ \t]*', '    ', line) for line in lines1]
    lines2 = [re.sub('    [ \t]*', '    ', line) for line in lines2]
    self.assertEqual(lines1, lines2, message)
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.test_utils.TestCase.assertOutput" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.test_utils.TestCase.assertOutput(self, expected_text)</code>


<a href="#beancount.utils.test_utils.TestCase.assertOutput" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Expect text printed to stdout.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>expected_text</strong> – A string, the text that should have been printed to stdout.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>AssertionError</code> – If the text differs.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">@contextlib.contextmanager
def assertOutput(self, expected_text):
    """Expect text printed to stdout.

    Args:
      expected_text: A string, the text that should have been printed to stdout.
    Raises:
      AssertionError: If the text differs.
    """
    with capture() as oss:
        yield oss
    self.assertLines(textwrap.dedent(expected_text), oss.getvalue())
</code></pre>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-class">



<h3 id="beancount.utils.test_utils.TmpFilesTestBase" class="doc doc-heading">
        <code>
beancount.utils.test_utils.TmpFilesTestBase            (<span title="unittest.case.TestCase">TestCase</span>)
        </code>



<a href="#beancount.utils.test_utils.TmpFilesTestBase" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A test utility base class that creates and cleans up a directory hierarchy.
This convenience is useful for testing functions that work on files, such as the
documents tests, or the accounts walk.</p>




  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.test_utils.TmpFilesTestBase.create_file_hierarchy" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.test_utils.TmpFilesTestBase.create_file_hierarchy(test_files, subdir='root')</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.utils.test_utils.TmpFilesTestBase.create_file_hierarchy" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>A test utility that creates a hierarchy of files.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>test_files</strong> – A list of strings, relative filenames to a temporary root
directory. If the filename ends with a '/', we create a directory;
otherwise, we create a regular file.</p></li>
            <li><p><strong>subdir</strong> – A string, the subdirectory name under the temporary directory
location, to create the hierarchy under.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A pair of strings, the temporary directory, and the subdirectory under
  that which hosts the root of the tree.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">@staticmethod
def create_file_hierarchy(test_files, subdir='root'):
    """A test utility that creates a hierarchy of files.

    Args:
      test_files: A list of strings, relative filenames to a temporary root
        directory. If the filename ends with a '/', we create a directory;
        otherwise, we create a regular file.
      subdir: A string, the subdirectory name under the temporary directory
        location, to create the hierarchy under.
    Returns:
      A pair of strings, the temporary directory, and the subdirectory under
        that which hosts the root of the tree.
    """
    tempdir = tempfile.mkdtemp(prefix="beancount-test-tmpdir.")
    root = path.join(tempdir, subdir)
    for filename in test_files:
        abs_filename = path.join(tempdir, filename)
        if filename.endswith('/'):
            os.makedirs(abs_filename)
        else:
            parent_dir = path.dirname(abs_filename)
            if not path.exists(parent_dir):
                os.makedirs(parent_dir)
            with open(abs_filename, 'w'): pass
    return tempdir, root
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.test_utils.TmpFilesTestBase.setUp" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.test_utils.TmpFilesTestBase.setUp(self)</code>


<a href="#beancount.utils.test_utils.TmpFilesTestBase.setUp" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Hook method for setting up the test fixture before exercising it.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def setUp(self):
    self.tempdir, self.root = self.create_file_hierarchy(self.TEST_DOCUMENTS)
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.test_utils.TmpFilesTestBase.tearDown" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.test_utils.TmpFilesTestBase.tearDown(self)</code>


<a href="#beancount.utils.test_utils.TmpFilesTestBase.tearDown" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Hook method for deconstructing the test fixture after testing it.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def tearDown(self):
    shutil.rmtree(self.tempdir, ignore_errors=True)
</code></pre>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.test_utils.capture" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.test_utils.capture(*attributes)</code>


<a href="#beancount.utils.test_utils.capture" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A context manager that captures what's printed to stdout.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>*attributes</strong> – A tuple of strings, the name of the sys attributes to override
with StringIO instances.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  A StringIO string accumulator.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def capture(*attributes):
    """A context manager that captures what's printed to stdout.

    Args:
      *attributes: A tuple of strings, the name of the sys attributes to override
        with StringIO instances.
    Yields:
      A StringIO string accumulator.
    """
    if not attributes:
        attributes = 'stdout'
    elif len(attributes) == 1:
        attributes = attributes[0]
    return patch(sys, attributes, io.StringIO)
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.test_utils.create_temporary_files" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.test_utils.create_temporary_files(root, contents_map)</code>


<a href="#beancount.utils.test_utils.create_temporary_files" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Create a number of temporary files under 'root'.</p>
<p>This routine is used to initialize the contents of multiple files under a
temporary directory.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>root</strong> – A string, the name of the directory under which to create the files.</p></li>
            <li><p><strong>contents_map</strong> – A dict of relative filenames to their contents. The content
strings will be automatically dedented for convenience. In addition, the
string 'ROOT' in the contents will be automatically replaced by the root
directory name.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def create_temporary_files(root, contents_map):
    """Create a number of temporary files under 'root'.

    This routine is used to initialize the contents of multiple files under a
    temporary directory.

    Args:
      root: A string, the name of the directory under which to create the files.
      contents_map: A dict of relative filenames to their contents. The content
        strings will be automatically dedented for convenience. In addition, the
        string 'ROOT' in the contents will be automatically replaced by the root
        directory name.
    """
    os.makedirs(root, exist_ok=True)
    for relative_filename, contents in contents_map.items():
        assert not path.isabs(relative_filename)
        filename = path.join(root, relative_filename)
        os.makedirs(path.dirname(filename), exist_ok=True)

        clean_contents = textwrap.dedent(contents.replace('{root}', root))
        with open(filename, 'w') as f:
            f.write(clean_contents)
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.test_utils.docfile" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.test_utils.docfile(function, **kwargs)</code>


<a href="#beancount.utils.test_utils.docfile" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A decorator that write the function's docstring to a temporary file
and calls the decorated function with the temporary filename.  This is
useful for writing tests.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>function</strong> – A function to decorate.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>The decorated function.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def docfile(function, **kwargs):
    """A decorator that write the function's docstring to a temporary file
    and calls the decorated function with the temporary filename.  This is
    useful for writing tests.

    Args:
      function: A function to decorate.
    Returns:
      The decorated function.
    """
    contents = kwargs.pop('contents', None)

    @functools.wraps(function)
    def new_function(self):
        allowed = ('buffering', 'encoding', 'newline', 'dir', 'prefix', 'suffix')
        if any(key not in allowed for key in kwargs):
            raise ValueError("Invalid kwarg to docfile_extra")
        with tempfile.NamedTemporaryFile('w', **kwargs) as file:
            text = contents or function.__doc__
            file.write(textwrap.dedent(text))
            file.flush()
            return function(self, file.name)
    new_function.__doc__ = None
    return new_function
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.test_utils.docfile_extra" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.test_utils.docfile_extra(**kwargs)</code>


<a href="#beancount.utils.test_utils.docfile_extra" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A decorator identical to @docfile,
but it also takes kwargs for the temporary file,
Kwargs:
  e.g. buffering, encoding, newline, dir, prefix, and suffix.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>docfile</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def docfile_extra(**kwargs):
    """
    A decorator identical to @docfile,
    but it also takes kwargs for the temporary file,
    Kwargs:
      e.g. buffering, encoding, newline, dir, prefix, and suffix.
    Returns:
      docfile
    """
    return functools.partial(docfile, **kwargs)
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.test_utils.environ" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.test_utils.environ(varname, newvalue)</code>


<a href="#beancount.utils.test_utils.environ" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A context manager which pushes varname's value and restores it later.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>varname</strong> – A string, the environ variable name.</p></li>
            <li><p><strong>newvalue</strong> – A string, the desired value.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">@contextlib.contextmanager
def environ(varname, newvalue):
    """A context manager which pushes varname's value and restores it later.

    Args:
      varname: A string, the environ variable name.
      newvalue: A string, the desired value.
    """
    oldvalue = os.environ.get(varname, None)
    os.environ[varname] = newvalue
    yield
    if oldvalue is not None:
        os.environ[varname] = oldvalue
    else:
        del os.environ[varname]
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.test_utils.find_python_lib" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.test_utils.find_python_lib()</code>


<a href="#beancount.utils.test_utils.find_python_lib" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Return the path to the root of the Python libraries.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A string, the root directory.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def find_python_lib():
    """Return the path to the root of the Python libraries.

    Returns:
      A string, the root directory.
    """
    return path.dirname(path.dirname(path.dirname(__file__)))
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.test_utils.find_repository_root" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.test_utils.find_repository_root(filename=None)</code>


<a href="#beancount.utils.test_utils.find_repository_root" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Return the path to the repository root.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>filename</strong> – A string, the name of a file within the repository.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A string, the root directory.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def find_repository_root(filename=None):
    """Return the path to the repository root.

    Args:
      filename: A string, the name of a file within the repository.
    Returns:
      A string, the root directory.
    """
    if filename is None:
        filename = __file__

    # Support root directory under Bazel.
    match = re.match(r"(.*\.runfiles/beancount)/", filename)
    if match:
        return match.group(1)

    while not path.exists(path.join(filename, 'pyproject.toml')):
        prev_filename = filename
        filename = path.dirname(filename)
        if prev_filename == filename:
            raise ValueError("Failed to find the root directory.")
    return filename
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.test_utils.make_failing_importer" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.test_utils.make_failing_importer(*removed_module_names)</code>


<a href="#beancount.utils.test_utils.make_failing_importer" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Make an importer that raise an ImportError for some modules.</p>
<p>Use it like this:</p>
<p>@mock.patch('builtins.<strong>import</strong>', make_failing_importer('setuptools'))
  def test_...</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>removed_module_name</strong> – The name of the module import that should raise an exception.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A decorated test decorator.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def make_failing_importer(*removed_module_names):
    """Make an importer that raise an ImportError for some modules.

    Use it like this:

      @mock.patch('builtins.__import__', make_failing_importer('setuptools'))
      def test_...

    Args:
      removed_module_name: The name of the module import that should raise an exception.
    Returns:
      A decorated test decorator.
    """
    def failing_import(name, *args, **kwargs):
        if name in removed_module_names:
            raise ImportError("Could not import {}".format(name))
        return builtins.__import__(name, *args, **kwargs)
    return failing_import
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.test_utils.nottest" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.test_utils.nottest(func)</code>


<a href="#beancount.utils.test_utils.nottest" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Make the given function not testable.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def nottest(func):
    "Make the given function not testable."
    func.__test__ = False
    return func
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.test_utils.patch" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.test_utils.patch(obj, attributes, replacement_type)</code>


<a href="#beancount.utils.test_utils.patch" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A context manager that temporarily patches an object's attributes.</p>
<p>All attributes in 'attributes' are saved and replaced by new instances
of type 'replacement_type'.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>obj</strong> – The object to patch up.</p></li>
            <li><p><strong>attributes</strong> – A string or a sequence of strings, the names of attributes to replace.</p></li>
            <li><p><strong>replacement_type</strong> – A callable to build replacement objects.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  An instance of a list of sequences of 'replacement_type'.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">@contextlib.contextmanager
def patch(obj, attributes, replacement_type):
    """A context manager that temporarily patches an object's attributes.

    All attributes in 'attributes' are saved and replaced by new instances
    of type 'replacement_type'.

    Args:
      obj: The object to patch up.
      attributes: A string or a sequence of strings, the names of attributes to replace.
      replacement_type: A callable to build replacement objects.
    Yields:
      An instance of a list of sequences of 'replacement_type'.
    """
    single = isinstance(attributes, str)
    if single:
        attributes = [attributes]

    saved = []
    replacements = []
    for attribute in attributes:
        replacement = replacement_type()
        replacements.append(replacement)
        saved.append(getattr(obj, attribute))
        setattr(obj, attribute, replacement)

    yield replacements[0] if single else replacements

    for attribute, saved_attr in zip(attributes, saved):
        setattr(obj, attribute, saved_attr)
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.test_utils.record" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.test_utils.record(fun)</code>


<a href="#beancount.utils.test_utils.record" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Decorates the function to intercept and record all calls and return values.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>fun</strong> – A callable to be decorated.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A wrapper function with a .calls attribute, a list of RCall instances.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def record(fun):
    """Decorates the function to intercept and record all calls and return values.

    Args:
      fun: A callable to be decorated.
    Returns:
      A wrapper function with a .calls attribute, a list of RCall instances.
    """
    @functools.wraps(fun)
    def wrapped(*args, **kw):
        return_value = fun(*args, **kw)
        wrapped.calls.append(RCall(args, kw, return_value))
        return return_value
    wrapped.calls = []
    return wrapped
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.test_utils.search_words" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.test_utils.search_words(words, line)</code>


<a href="#beancount.utils.test_utils.search_words" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Search for a sequence of words in a line.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>words</strong> – A list of strings, the words to look for, or a space-separated string.</p></li>
            <li><p><strong>line</strong> – A string, the line to search into.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A MatchObject, or None.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def search_words(words, line):
    """Search for a sequence of words in a line.

    Args:
      words: A list of strings, the words to look for, or a space-separated string.
      line: A string, the line to search into.
    Returns:
      A MatchObject, or None.
    """
    if isinstance(words, str):
        words = words.split()
    return re.search('.*'.join(r'\b{}\b'.format(word) for word in words), line)
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.test_utils.skipIfRaises" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.test_utils.skipIfRaises(*exc_types)</code>


<a href="#beancount.utils.test_utils.skipIfRaises" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A context manager (or decorator) that skips a test if an exception is raised.</p>
      <p>Yields:
  Nothing, for you to execute the function code.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>SkipTest</code> – if the test raised the expected exception.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">@contextlib.contextmanager
def skipIfRaises(*exc_types):
    """A context manager (or decorator) that skips a test if an exception is raised.

    Args:
      exc_type
    Yields:
      Nothing, for you to execute the function code.
    Raises:
      SkipTest: if the test raised the expected exception.
    """
    try:
        yield
    except exc_types as exception:
        raise unittest.SkipTest(exception)
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.test_utils.subprocess_env" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.test_utils.subprocess_env()</code>


<a href="#beancount.utils.test_utils.subprocess_env" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Return a dict to use as environment for running subprocesses.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A string, the root directory.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">def subprocess_env():
    """Return a dict to use as environment for running subprocesses.

    Returns:
      A string, the root directory.
    """
    # Ensure we have locations to invoke our Python executable and our
    # runnable binaries in the test environment to run subprocesses.
    binpath = ':'.join([
        path.dirname(sys.executable),
        path.join(find_repository_root(__file__), 'bin'),
        os.environ.get('PATH', '').strip(':')]).strip(':')
    return {'PATH': binpath,
            'PYTHONPATH': find_python_lib()}
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.test_utils.tempdir" class="doc doc-heading">
<code class="highlight language-python">beancount.utils.test_utils.tempdir(delete=True, **kw)</code>


<a href="#beancount.utils.test_utils.tempdir" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A context manager that creates a temporary directory and deletes its
contents unconditionally once done.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>delete</strong> – A boolean, true if we want to delete the directory after running.</p></li>
            <li><p><strong>**kw</strong> – Keyword arguments for mkdtemp.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  A string, the name of the temporary directory created.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <pre class="highlight"><code class="language-python">@contextlib.contextmanager
def tempdir(delete=True, **kw):
    """A context manager that creates a temporary directory and deletes its
    contents unconditionally once done.

    Args:
      delete: A boolean, true if we want to delete the directory after running.
      **kw: Keyword arguments for mkdtemp.
    Yields:
      A string, the name of the temporary directory created.
    """
    tempdir = tempfile.mkdtemp(prefix="beancount-test-tmpdir.", **kw)
    try:
        yield tempdir
    finally:
        if delete:
            shutil.rmtree(tempdir, ignore_errors=True)
</code></pre>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>




  </div>

    </div>

  </div>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="beancount.tools.html" class="btn btn-neutral" title="beancount.tools"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="beancount.tools.html" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
