<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="canonical" href="https://beancount.github.io/docs/api_reference/beancount.utils.html">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>beancount.utils - Beancount Documentation</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link href="../assets/_mkdocstrings.css" rel="stylesheet" />
  <link href="../css/custom.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "beancount.utils";
    var mkdocs_page_input_path = "api_reference/beancount.utils.md";
    var mkdocs_page_url = "/docs/api_reference/beancount.utils.html";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="icon icon-home"> Beancount Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../index.html">Index</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Outline</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="#">Documentation for Users</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../command_line_accounting_in_context.html">Command Line Accounting in Context</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../the_double_entry_counting_method.html">The Double Entry Counting Method</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../installing_beancount.html">Installing Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../running_beancount_and_generating_reports.html">Running Beancount and Generating Reports</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../getting_started_with_beancount.html">Getting Started with Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_language_syntax.html">Beancount Language Syntax</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_options_reference.html">Beancount Options Reference</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../precision_tolerances.html">Precision Tolerances</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_query_language.html">Beancount Query Language</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_cheat_sheet.html">Beancount Cheat Sheet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../how_inventories_work.html">How Inventories Work</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../exporting_your_portfolio.html">Exporting Your Portfolio</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../tutorial_example.html">Tutorial & Example</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_history_and_credits.html">Beancount History and Credits</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../a_comparison_of_beancount_and_ledger_hledger.html">A Comparison of Beancount and Ledger Hledger</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../fetching_prices_in_beancount.html">Fetching Prices in Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../importing_external_data.html">Importing External Data</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Cookbooks & Examples</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../command_line_accounting_cookbook.html">Command Line Accounting Cookbook</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../trading_with_beancount.html">Trading with Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../stock_vesting_in_beancount.html">Stock Vesting in Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../sharing_expenses_with_beancount.html">Sharing Expenses with Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../how_we_share_expenses.html">How We Share Expenses</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../health_care_expenses.html">Health Care Expenses</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../calculating_portolio_returns.html">Calculating Portfolio Returns</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../tracking_medical_claims.html">Tracking Out-of-Network Medical Claims in Beancount</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Documentation for Developers</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_scripting_plugins.html">Beancount Scripting Plugins</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_design_doc.html">Beancount Design Doc</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ledgerhub_design_doc.html">Ledgerhub Design Doc</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../external_contributions.html">External Contributions</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Enhancement Proposals & Discussions</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../a_proposal_for_an_improvement_on_inventory_booking.html">A Proposal for an Improvement on Inventory Booking</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../settlement_dates_in_beancount.html">Settlement Dates in Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../balance_assertions_in_beancount.html">Balance Assertions in Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../fund_accounting_with_beancount.html">Fund Accounting with Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../rounding_precision_in_beancount.html">Rounding Precision in Beancount</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Beancount 3</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_v3.html">Goals & Design</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../installing_beancount_v3.html">Installing Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_v3_dependencies.html">Dependencies</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beangulp.html">Beangulp</a>
                </li>
    </ul>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">API reference</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="index.html">beancount</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.core.html">beancount.core</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.loader.html">beancount.loader</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.ops.html">beancount.ops</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.parser.html">beancount.parser</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.plugins.html">beancount.plugins</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.scripts.html">beancount.scripts</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.tools.html">beancount.tools</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="beancount.utils.html">beancount.utils</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#beancount.utils">beancount.utils</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.utils.bisect_key">bisect_key</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.bisect_key.bisect_left_with_key">bisect_left_with_key()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.bisect_key.bisect_right_with_key">bisect_right_with_key()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.utils.date_utils">date_utils</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.date_utils.intimezone">intimezone()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.date_utils.iter_dates">iter_dates()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.date_utils.next_month">next_month()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.date_utils.render_ofx_date">render_ofx_date()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.utils.defdict">defdict</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.defdict.DefaultDictWithKey">DefaultDictWithKey</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.defdict.ImmutableDictWithDefault">ImmutableDictWithDefault</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.defdict.ImmutableDictWithDefault.__setitem__">__setitem__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.defdict.ImmutableDictWithDefault.get">get()</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.utils.encryption">encryption</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.encryption.is_encrypted_file">is_encrypted_file()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.encryption.is_gpg_installed">is_gpg_installed()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.encryption.read_encrypted_file">read_encrypted_file()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.utils.file_utils">file_utils</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.file_utils.chdir">chdir()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.file_utils.find_files">find_files()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.file_utils.guess_file_format">guess_file_format()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.file_utils.path_greedy_split">path_greedy_split()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.file_utils.touch_file">touch_file()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.utils.import_utils">import_utils</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.import_utils.import_symbol">import_symbol()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.utils.invariants">invariants</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.invariants.instrument_invariants">instrument_invariants()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.invariants.invariant_check">invariant_check()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.invariants.uninstrument_invariants">uninstrument_invariants()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.utils.memo">memo</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.memo.memoize_recent_fileobj">memoize_recent_fileobj()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.memo.now">now()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.utils.misc_utils">misc_utils</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.LineFileProxy">LineFileProxy</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.misc_utils.LineFileProxy.__init__">__init__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.misc_utils.LineFileProxy.close">close()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.misc_utils.LineFileProxy.flush">flush()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.misc_utils.LineFileProxy.write">write()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.TypeComparable">TypeComparable</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.box">box()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.cmptuple">cmptuple()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.compute_unique_clean_ids">compute_unique_clean_ids()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.deprecated">deprecated()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.dictmap">dictmap()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.escape_string">escape_string()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.filter_type">filter_type()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.first_paragraph">first_paragraph()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.get_screen_height">get_screen_height()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.get_screen_width">get_screen_width()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.get_tuple_values">get_tuple_values()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.groupby">groupby()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.idify">idify()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.import_curses">import_curses()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.is_sorted">is_sorted()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.log_time">log_time()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.longest">longest()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.map_namedtuple_attributes">map_namedtuple_attributes()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.replace_namedtuple_values">replace_namedtuple_values()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.skipiter">skipiter()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.sorted_uniquify">sorted_uniquify()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.staticvar">staticvar()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.swallow">swallow()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.uniquify">uniquify()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.utils.pager">pager</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.pager.ConditionalPager">ConditionalPager</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.pager.ConditionalPager.__enter__">__enter__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.pager.ConditionalPager.__exit__">__exit__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.pager.ConditionalPager.__init__">__init__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.pager.ConditionalPager.flush_accumulated">flush_accumulated()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.pager.ConditionalPager.write">write()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.pager.create_pager">create_pager()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.pager.flush_only">flush_only()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.utils.snoop">snoop</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.snoop.Snoop">Snoop</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.snoop.Snoop.__call__">__call__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.snoop.Snoop.__getattr__">__getattr__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.snoop.Snoop.__init__">__init__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.snoop.snoopify">snoopify()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.utils.table">table</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.table.Table">Table</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.table.Table.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.table.Table.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.table.Table.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.table.attribute_to_title">attribute_to_title()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.table.compute_table_widths">compute_table_widths()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.table.create_table">create_table()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.table.render_table">render_table()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.table.table_to_csv">table_to_csv()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.table.table_to_html">table_to_html()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.table.table_to_text">table_to_text()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.utils.test_utils">test_utils</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.ClickTestCase">ClickTestCase</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.RCall">RCall</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.test_utils.RCall.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.test_utils.RCall.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.test_utils.RCall.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.TestCase">TestCase</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.test_utils.TestCase.assertLines">assertLines()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.test_utils.TestCase.assertOutput">assertOutput()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.TmpFilesTestBase">TmpFilesTestBase</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.test_utils.TmpFilesTestBase.create_file_hierarchy">create_file_hierarchy()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.test_utils.TmpFilesTestBase.setUp">setUp()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.utils.test_utils.TmpFilesTestBase.tearDown">tearDown()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.capture">capture()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.create_temporary_files">create_temporary_files()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.docfile">docfile()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.docfile_extra">docfile_extra()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.environ">environ()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.find_python_lib">find_python_lib()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.find_repository_root">find_repository_root()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.make_failing_importer">make_failing_importer()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.nottest">nottest()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.patch">patch()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.record">record()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.search_words">search_words()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.skipIfRaises">skipIfRaises()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.subprocess_env">subprocess_env()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.tempdir">tempdir()</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Beancount Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
    
      
        
          <li>API reference &raquo;</li>
        
      
    
    <li>beancount.utils</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h1 id="beancountutils">beancount.utils<a class="headerlink" href="#beancountutils" title="Permanent link"></a></h1>


  <div class="doc doc-object doc-module">

<a id="beancount.utils"></a>
    <div class="doc doc-contents first">

      <p>Generic utility packages and functions.</p>



  <div class="doc doc-children">












  <div class="doc doc-object doc-module">



<h2 id="beancount.utils.bisect_key" class="doc doc-heading">
        <code>beancount.utils.bisect_key</code>



<a href="#beancount.utils.bisect_key" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>A version of bisect that accepts a custom key function, like the sorting ones do.</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.bisect_key.bisect_left_with_key" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">bisect_key</span><span class="o">.</span><span class="n">bisect_left_with_key</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#beancount.utils.bisect_key.bisect_left_with_key" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Find the last element before the given value in a sorted list.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>sequence</strong> – A sorted sequence of elements.</p></li>
            <li><p><strong>value</strong> – The value to search for.</p></li>
            <li><p><strong>key</strong> – An optional function used to extract the value from the elements of
sequence.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>Return the index. May return None.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/bisect_key.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">bisect_left_with_key</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find the last element before the given value in a sorted list.</span>

<span class="sd">    Args:</span>
<span class="sd">      sequence: A sorted sequence of elements.</span>
<span class="sd">      value: The value to search for.</span>
<span class="sd">      key: An optional function used to extract the value from the elements of</span>
<span class="sd">        sequence.</span>
<span class="sd">    Returns:</span>
<span class="sd">      Return the index. May return None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>  <span class="c1"># Identity.</span>

    <span class="n">lo</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">hi</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>

    <span class="k">while</span> <span class="n">lo</span> <span class="o">&lt;</span> <span class="n">hi</span><span class="p">:</span>
        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">lo</span> <span class="o">+</span> <span class="n">hi</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">key</span><span class="p">(</span><span class="n">sequence</span><span class="p">[</span><span class="n">mid</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">lo</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hi</span> <span class="o">=</span> <span class="n">mid</span>
    <span class="k">return</span> <span class="n">lo</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.bisect_key.bisect_right_with_key" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">bisect_key</span><span class="o">.</span><span class="n">bisect_right_with_key</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">lo</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#beancount.utils.bisect_key.bisect_right_with_key" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Like bisect.bisect_right, but with a key lookup parameter.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> – The list to search in.</p></li>
            <li><p><strong>x</strong> – The element to search for.</p></li>
            <li><p><strong>key</strong> – A function, to extract the value from the list.</p></li>
            <li><p><strong>lo</strong> – The smallest index to search.</p></li>
            <li><p><strong>hi</strong> – The largest index to search.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>As in bisect.bisect_right, an element from list 'a'.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/bisect_key.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">bisect_right_with_key</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">lo</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Like bisect.bisect_right, but with a key lookup parameter.</span>

<span class="sd">    Args:</span>
<span class="sd">      a: The list to search in.</span>
<span class="sd">      x: The element to search for.</span>
<span class="sd">      key: A function, to extract the value from the list.</span>
<span class="sd">      lo: The smallest index to search.</span>
<span class="sd">      hi: The largest index to search.</span>
<span class="sd">    Returns:</span>
<span class="sd">      As in bisect.bisect_right, an element from list &#39;a&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">lo</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;lo must be non-negative&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">hi</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">hi</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">lo</span> <span class="o">&lt;</span> <span class="n">hi</span><span class="p">:</span>
        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">lo</span> <span class="o">+</span> <span class="n">hi</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">key</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">mid</span><span class="p">]):</span>
            <span class="n">hi</span> <span class="o">=</span> <span class="n">mid</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lo</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">lo</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.utils.date_utils" class="doc doc-heading">
        <code>beancount.utils.date_utils</code>



<a href="#beancount.utils.date_utils" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Parse the date from various formats.</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.date_utils.intimezone" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">date_utils</span><span class="o">.</span><span class="n">intimezone</span><span class="p">(</span><span class="n">tz_value</span><span class="p">)</span></code>


<a href="#beancount.utils.date_utils.intimezone" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Temporarily reset the value of TZ.</p>
<p>This is used for testing.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>tz_value</strong> (<code>str</code>) – The value of TZ to set for the duration of this context.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A contextmanager in the given timezone locale.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/date_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">intimezone</span><span class="p">(</span><span class="n">tz_value</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Temporarily reset the value of TZ.</span>

<span class="sd">    This is used for testing.</span>

<span class="sd">    Args:</span>
<span class="sd">      tz_value: The value of TZ to set for the duration of this context.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A contextmanager in the given timezone locale.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tz_old</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;TZ&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;TZ&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tz_value</span>
    <span class="n">time</span><span class="o">.</span><span class="n">tzset</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">tz_old</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;TZ&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;TZ&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tz_old</span>
        <span class="n">time</span><span class="o">.</span><span class="n">tzset</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.date_utils.iter_dates" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">date_utils</span><span class="o">.</span><span class="n">iter_dates</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span></code>


<a href="#beancount.utils.date_utils.iter_dates" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Yield all the dates between 'start_date' and 'end_date'.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>start_date</strong> – An instance of datetime.date.</p></li>
            <li><p><strong>end_date</strong> – An instance of datetime.date.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  Instances of datetime.date.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/date_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">iter_dates</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Yield all the dates between &#39;start_date&#39; and &#39;end_date&#39;.</span>

<span class="sd">    Args:</span>
<span class="sd">      start_date: An instance of datetime.date.</span>
<span class="sd">      end_date: An instance of datetime.date.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Instances of datetime.date.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">oneday</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">start_date</span>
    <span class="k">while</span> <span class="n">date</span> <span class="o">&lt;</span> <span class="n">end_date</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">date</span>
        <span class="n">date</span> <span class="o">+=</span> <span class="n">oneday</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.date_utils.next_month" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">date_utils</span><span class="o">.</span><span class="n">next_month</span><span class="p">(</span><span class="n">date</span><span class="p">)</span></code>


<a href="#beancount.utils.date_utils.next_month" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Compute the date at the beginning of the following month from the given date.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>date</strong> – A datetime.date instance.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A datetime.date instance, the first day of the month following 'date'.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/date_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">next_month</span><span class="p">(</span><span class="n">date</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the date at the beginning of the following month from the given date.</span>

<span class="sd">    Args:</span>
<span class="sd">      date: A datetime.date instance.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A datetime.date instance, the first day of the month following &#39;date&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Compute the date at the beginning of the following month.</span>
    <span class="n">year</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">year</span>
    <span class="n">month</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">month</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">date</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
        <span class="n">year</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">month</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.date_utils.render_ofx_date" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">date_utils</span><span class="o">.</span><span class="n">render_ofx_date</span><span class="p">(</span><span class="n">dtime</span><span class="p">)</span></code>


<a href="#beancount.utils.date_utils.render_ofx_date" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Render a datetime to the OFX format.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>dtime</strong> – A datetime.datetime instance.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A string, rendered to milliseconds.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/date_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">render_ofx_date</span><span class="p">(</span><span class="n">dtime</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Render a datetime to the OFX format.</span>

<span class="sd">    Args:</span>
<span class="sd">      dtime: A datetime.datetime instance.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, rendered to milliseconds.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.</span><span class="si">{:03d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dtime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">dtime</span><span class="o">.</span><span class="n">microsecond</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.utils.defdict" class="doc doc-heading">
        <code>beancount.utils.defdict</code>



<a href="#beancount.utils.defdict" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>An instance of collections.defaultdict whose factory accepts a key.</p>
<p>Note: This really ought to be an enhancement to Python itself. I should bother
adding this in eventually.</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-class">



<h3 id="beancount.utils.defdict.DefaultDictWithKey" class="doc doc-heading">
        <code>
beancount.utils.defdict.DefaultDictWithKey            (<span title="collections.defaultdict">defaultdict</span>)
        </code>



<a href="#beancount.utils.defdict.DefaultDictWithKey" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A version of defaultdict whose factory accepts the key as an argument.
Note: collections.defaultdict would be improved by supporting this directly,
this is a common occurrence.</p>




  <div class="doc doc-children">












  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="beancount.utils.defdict.ImmutableDictWithDefault" class="doc doc-heading">
        <code>
beancount.utils.defdict.ImmutableDictWithDefault            (<span title="dict">dict</span>)
        </code>



<a href="#beancount.utils.defdict.ImmutableDictWithDefault" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>An immutable dict which returns a default value for missing keys.</p>
<p>This differs from a defaultdict in that it does not insert a missing default
value when one is materialized (from a missing fetch), and furthermore, the
set method is make unavailable to prevent mutation beyond construction.</p>




  <div class="doc doc-children">













  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.defdict.ImmutableDictWithDefault.__setitem__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">defdict</span><span class="o">.</span><span class="n">ImmutableDictWithDefault</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.utils.defdict.ImmutableDictWithDefault.__setitem__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Disallow mutating the dict in the usual way.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/defdict.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Disallow mutating the dict in the usual way.&quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.defdict.ImmutableDictWithDefault.get" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">defdict</span><span class="o">.</span><span class="n">ImmutableDictWithDefault</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">_</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#beancount.utils.defdict.ImmutableDictWithDefault.get" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return the value for key if key is in the dictionary, else default.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/defdict.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">_</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.utils.encryption" class="doc doc-heading">
        <code>beancount.utils.encryption</code>



<a href="#beancount.utils.encryption" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Support for encrypted tests.</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.encryption.is_encrypted_file" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">encryption</span><span class="o">.</span><span class="n">is_encrypted_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></code>


<a href="#beancount.utils.encryption.is_encrypted_file" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Return true if the given filename contains an encrypted file.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>filename</strong> – A path string.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A boolean, true if the file contains an encrypted file.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/encryption.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">is_encrypted_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return true if the given filename contains an encrypted file.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: A path string.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A boolean, true if the file contains an encrypted file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s2">&quot;.gpg&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s2">&quot;.asc&quot;</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">encfile</span><span class="p">:</span>
            <span class="n">head</span> <span class="o">=</span> <span class="n">encfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;--BEGIN PGP MESSAGE--&quot;</span><span class="p">,</span> <span class="n">head</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.encryption.is_gpg_installed" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">encryption</span><span class="o">.</span><span class="n">is_gpg_installed</span><span class="p">()</span></code>


<a href="#beancount.utils.encryption.is_gpg_installed" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Return true if GPG 1.4.x or 2.x are installed, which is what we use and support.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/encryption.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">is_gpg_installed</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return true if GPG 1.4.x or 2.x are installed, which is what we use and support.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">pipe</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;gpg&quot;</span><span class="p">,</span> <span class="s2">&quot;--version&quot;</span><span class="p">],</span> <span class="n">shell</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span>
        <span class="p">)</span>
        <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
        <span class="n">version_text</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pipe</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;gpg \(GnuPG\) (1\.4|2)\.&quot;</span><span class="p">,</span> <span class="n">version_text</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.encryption.read_encrypted_file" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">encryption</span><span class="o">.</span><span class="n">read_encrypted_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></code>


<a href="#beancount.utils.encryption.read_encrypted_file" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Decrypt and read an encrypted file without temporary storage.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>filename</strong> – A string, the path to the encrypted file.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A string, the contents of the file.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>OSError</code> – If we could not properly decrypt the file.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/encryption.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">read_encrypted_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decrypt and read an encrypted file without temporary storage.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: A string, the path to the encrypted file.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, the contents of the file.</span>
<span class="sd">    Raises:</span>
<span class="sd">      OSError: If we could not properly decrypt the file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;gpg&quot;</span><span class="p">,</span> <span class="s2">&quot;--batch&quot;</span><span class="p">,</span> <span class="s2">&quot;--decrypt&quot;</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">filename</span><span class="p">)]</span>
    <span class="n">pipe</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
        <span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span>
    <span class="p">)</span>
    <span class="n">contents</span><span class="p">,</span> <span class="n">errors</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">pipe</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span>
            <span class="s2">&quot;Could not decrypt file (</span><span class="si">{}</span><span class="s2">): </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pipe</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> <span class="n">errors</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">))</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">contents</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.utils.file_utils" class="doc doc-heading">
        <code>beancount.utils.file_utils</code>



<a href="#beancount.utils.file_utils" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>File utilities.</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.file_utils.chdir" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">file_utils</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span></code>


<a href="#beancount.utils.file_utils.chdir" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Temporarily chdir to the given directory.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>directory</strong> – The directory to switch do.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A context manager which restores the cwd after running.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/file_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">chdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Temporarily chdir to the given directory.</span>

<span class="sd">    Args:</span>
<span class="sd">      directory: The directory to switch do.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A context manager which restores the cwd after running.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">cwd</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.file_utils.find_files" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">file_utils</span><span class="o">.</span><span class="n">find_files</span><span class="p">(</span><span class="n">fords</span><span class="p">,</span> <span class="n">ignore_dirs</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;.hg&#39;</span><span class="p">,</span> <span class="s1">&#39;.svn&#39;</span><span class="p">,</span> <span class="s1">&#39;.git&#39;</span><span class="p">),</span> <span class="n">ignore_files</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;.DS_Store&#39;</span><span class="p">,))</span></code>


<a href="#beancount.utils.file_utils.find_files" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Enumerate the files under the given directories, stably.</p>
<p>Invalid file or directory names will be logged to the error log.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>fords</strong> – A list of strings, file or directory names.</p></li>
            <li><p><strong>ignore_dirs</strong> – A list of strings, filenames or directories to be ignored.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  Strings, full filenames from the given roots.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/file_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">find_files</span><span class="p">(</span><span class="n">fords</span><span class="p">,</span> <span class="n">ignore_dirs</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;.hg&quot;</span><span class="p">,</span> <span class="s2">&quot;.svn&quot;</span><span class="p">,</span> <span class="s2">&quot;.git&quot;</span><span class="p">),</span> <span class="n">ignore_files</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;.DS_Store&quot;</span><span class="p">,)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Enumerate the files under the given directories, stably.</span>

<span class="sd">    Invalid file or directory names will be logged to the error log.</span>

<span class="sd">    Args:</span>
<span class="sd">      fords: A list of strings, file or directory names.</span>
<span class="sd">      ignore_dirs: A list of strings, filenames or directories to be ignored.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Strings, full filenames from the given roots.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fords</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">fords</span> <span class="o">=</span> <span class="p">[</span><span class="n">fords</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fords</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">ford</span> <span class="ow">in</span> <span class="n">fords</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">ford</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">filenames</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">ford</span><span class="p">):</span>
                <span class="n">dirs</span><span class="p">[:]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">dirname</span> <span class="k">for</span> <span class="n">dirname</span> <span class="ow">in</span> <span class="n">dirs</span> <span class="k">if</span> <span class="n">dirname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignore_dirs</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">filenames</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">ignore_files</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">yield</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">ford</span><span class="p">)</span> <span class="ow">or</span> <span class="n">path</span><span class="o">.</span><span class="n">islink</span><span class="p">(</span><span class="n">ford</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">ford</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">ford</span><span class="p">):</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;File or directory &#39;</span><span class="si">{}</span><span class="s2">&#39; does not exist.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ford</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.file_utils.guess_file_format" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">file_utils</span><span class="o">.</span><span class="n">guess_file_format</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#beancount.utils.file_utils.guess_file_format" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Guess the file format from the filename.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>filename</strong> – A string, the name of the file. This can be None.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A string, the extension of the format, without a leading period.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/file_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">guess_file_format</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Guess the file format from the filename.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: A string, the name of the file. This can be None.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, the extension of the format, without a leading period.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.txt&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.text&quot;</span><span class="p">):</span>
            <span class="nb">format</span> <span class="o">=</span> <span class="s2">&quot;text&quot;</span>
        <span class="k">elif</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.csv&quot;</span><span class="p">):</span>
            <span class="nb">format</span> <span class="o">=</span> <span class="s2">&quot;csv&quot;</span>
        <span class="k">elif</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.html&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.xhtml&quot;</span><span class="p">):</span>
            <span class="nb">format</span> <span class="o">=</span> <span class="s2">&quot;html&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">format</span> <span class="o">=</span> <span class="n">default</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">format</span> <span class="o">=</span> <span class="n">default</span>
    <span class="k">return</span> <span class="nb">format</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.file_utils.path_greedy_split" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">file_utils</span><span class="o">.</span><span class="n">path_greedy_split</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></code>


<a href="#beancount.utils.file_utils.path_greedy_split" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Split a path, returning the longest possible extension.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>filename</strong> – A string, the filename to split.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A pair of basename, extension (which includes the leading period).</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/file_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">path_greedy_split</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Split a path, returning the longest possible extension.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: A string, the filename to split.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A pair of basename, extension (which includes the leading period).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">basename</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">basename</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">extension</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">extension</span> <span class="o">=</span> <span class="n">basename</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="n">basename</span> <span class="o">=</span> <span class="n">basename</span><span class="p">[:</span><span class="n">index</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="n">basename</span><span class="p">),</span> <span class="n">extension</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.file_utils.touch_file" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">file_utils</span><span class="o">.</span><span class="n">touch_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">*</span><span class="n">otherfiles</span><span class="p">)</span></code>


<a href="#beancount.utils.file_utils.touch_file" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Touch a file and wait until its timestamp has been changed.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>filename</strong> – A string path, the name of the file to touch.</p></li>
            <li><p><strong>otherfiles</strong> – A list of other files to ensure the timestamp is beyond of.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/file_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">touch_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">*</span><span class="n">otherfiles</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Touch a file and wait until its timestamp has been changed.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: A string path, the name of the file to touch.</span>
<span class="sd">      otherfiles: A list of other files to ensure the timestamp is beyond of.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Note: You could set os.stat_float_times() but then the main function would</span>
    <span class="c1"># have to set that up as well. It doesn&#39;t help so much, however, since</span>
    <span class="c1"># filesystems tend to have low resolutions, e.g. one second.</span>
    <span class="n">orig_mtime_ns</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">minfile</span><span class="p">)</span><span class="o">.</span><span class="n">st_mtime_ns</span> <span class="k">for</span> <span class="n">minfile</span> <span class="ow">in</span> <span class="p">(</span><span class="n">filename</span><span class="p">,)</span> <span class="o">+</span> <span class="n">otherfiles</span>
    <span class="p">)</span>
    <span class="n">delay_secs</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">utime</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay_secs</span><span class="p">)</span>
        <span class="n">new_stat</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">new_stat</span><span class="o">.</span><span class="n">st_mtime_ns</span> <span class="o">&gt;</span> <span class="n">orig_mtime_ns</span><span class="p">:</span>
            <span class="k">break</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.utils.import_utils" class="doc doc-heading">
        <code>beancount.utils.import_utils</code>



<a href="#beancount.utils.import_utils" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Utilities for importing symbols programmatically.</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.import_utils.import_symbol" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">import_utils</span><span class="o">.</span><span class="n">import_symbol</span><span class="p">(</span><span class="n">dotted_name</span><span class="p">)</span></code>


<a href="#beancount.utils.import_utils.import_symbol" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Import a symbol in an arbitrary module.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>dotted_name</strong> – A dotted path to a symbol.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>The object referenced by the given name.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>ImportError</code> – If the module not not be imported.</p></li>
            <li><p><code>AttributeError</code> – If the symbol could not be found in the module.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/import_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">import_symbol</span><span class="p">(</span><span class="n">dotted_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Import a symbol in an arbitrary module.</span>

<span class="sd">    Args:</span>
<span class="sd">      dotted_name: A dotted path to a symbol.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The object referenced by the given name.</span>
<span class="sd">    Raises:</span>
<span class="sd">      ImportError: If the module not not be imported.</span>
<span class="sd">      AttributeError: If the symbol could not be found in the module.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">comps</span> <span class="o">=</span> <span class="n">dotted_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
    <span class="n">module_name</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">comps</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">symbol_name</span> <span class="o">=</span> <span class="n">comps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">symbol_name</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.utils.invariants" class="doc doc-heading">
        <code>beancount.utils.invariants</code>



<a href="#beancount.utils.invariants" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Functions to register auxiliary functions on a class' methods to check for invariants.</p>
<p>This is intended to be used in a test, whereby your test will setup a class to
automatically run invariant verification functions before and after each
function call, to ensure some extra sanity checks that wouldn't be used in
non-tests.</p>
<p>Example: Instrument the Inventory class with the check_inventory_invariants()
function.</p>
<p>def setUp(module):
      instrument_invariants(Inventory,
                            check_inventory_invariants,
                            check_inventory_invariants)</p>
<p>def tearDown(module):
      uninstrument_invariants(Inventory)</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.invariants.instrument_invariants" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">invariants</span><span class="o">.</span><span class="n">instrument_invariants</span><span class="p">(</span><span class="n">klass</span><span class="p">,</span> <span class="n">prefun</span><span class="p">,</span> <span class="n">postfun</span><span class="p">)</span></code>


<a href="#beancount.utils.invariants.instrument_invariants" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Instrument the class 'klass' with pre/post invariant
checker functions.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>klass</strong> – A class object, whose methods to be instrumented.</p></li>
            <li><p><strong>prefun</strong> – A function that checks invariants pre-call.</p></li>
            <li><p><strong>postfun</strong> – A function that checks invariants pre-call.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/invariants.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">instrument_invariants</span><span class="p">(</span><span class="n">klass</span><span class="p">,</span> <span class="n">prefun</span><span class="p">,</span> <span class="n">postfun</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Instrument the class &#39;klass&#39; with pre/post invariant</span>
<span class="sd">    checker functions.</span>

<span class="sd">    Args:</span>
<span class="sd">      klass: A class object, whose methods to be instrumented.</span>
<span class="sd">      prefun: A function that checks invariants pre-call.</span>
<span class="sd">      postfun: A function that checks invariants pre-call.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">instrumented</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">attrname</span><span class="p">,</span> <span class="n">object_</span> <span class="ow">in</span> <span class="n">klass</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">attrname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">object_</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">FunctionType</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">instrumented</span><span class="p">[</span><span class="n">attrname</span><span class="p">]</span> <span class="o">=</span> <span class="n">object_</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">klass</span><span class="p">,</span> <span class="n">attrname</span><span class="p">,</span> <span class="n">invariant_check</span><span class="p">(</span><span class="n">object_</span><span class="p">,</span> <span class="n">prefun</span><span class="p">,</span> <span class="n">postfun</span><span class="p">))</span>
    <span class="n">klass</span><span class="o">.</span><span class="n">__instrumented</span> <span class="o">=</span> <span class="n">instrumented</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.invariants.invariant_check" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">invariants</span><span class="o">.</span><span class="n">invariant_check</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">prefun</span><span class="p">,</span> <span class="n">postfun</span><span class="p">)</span></code>


<a href="#beancount.utils.invariants.invariant_check" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Decorate a method with the pre/post invariant checkers.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>method</strong> – An unbound method to instrument.</p></li>
            <li><p><strong>prefun</strong> – A function that checks invariants pre-call.</p></li>
            <li><p><strong>postfun</strong> – A function that checks invariants post-call.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>An unbound method, decorated.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/invariants.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">invariant_check</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">prefun</span><span class="p">,</span> <span class="n">postfun</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decorate a method with the pre/post invariant checkers.</span>

<span class="sd">    Args:</span>
<span class="sd">      method: An unbound method to instrument.</span>
<span class="sd">      prefun: A function that checks invariants pre-call.</span>
<span class="sd">      postfun: A function that checks invariants post-call.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An unbound method, decorated.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reentrant</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">new_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">reentrant</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">reentrant</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">prefun</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">reentrant</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">postfun</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">reentrant</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">return</span> <span class="n">new_method</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.invariants.uninstrument_invariants" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">invariants</span><span class="o">.</span><span class="n">uninstrument_invariants</span><span class="p">(</span><span class="n">klass</span><span class="p">)</span></code>


<a href="#beancount.utils.invariants.uninstrument_invariants" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Undo the instrumentation for invariants.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>klass</strong> – A class object, whose methods to be uninstrumented.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/invariants.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">uninstrument_invariants</span><span class="p">(</span><span class="n">klass</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Undo the instrumentation for invariants.</span>

<span class="sd">    Args:</span>
<span class="sd">      klass: A class object, whose methods to be uninstrumented.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">instrumented</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">klass</span><span class="p">,</span> <span class="s2">&quot;__instrumented&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">instrumented</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">attrname</span><span class="p">,</span> <span class="n">object_</span> <span class="ow">in</span> <span class="n">instrumented</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">klass</span><span class="p">,</span> <span class="n">attrname</span><span class="p">,</span> <span class="n">object_</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">klass</span><span class="o">.</span><span class="n">__instrumented</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.utils.memo" class="doc doc-heading">
        <code>beancount.utils.memo</code>



<a href="#beancount.utils.memo" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Memoization utilities.</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.memo.memoize_recent_fileobj" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">memo</span><span class="o">.</span><span class="n">memoize_recent_fileobj</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">cache_filename</span><span class="p">,</span> <span class="n">expiration</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#beancount.utils.memo.memoize_recent_fileobj" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Memoize recent calls to the given function which returns a file object.</p>
<p>The results of the cache expire after some time.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>function</strong> – A callable object.</p></li>
            <li><p><strong>cache_filename</strong> – A string, the path to the database file to cache to.</p></li>
            <li><p><strong>expiration</strong> – The time during which the results will be kept valid. Use
'None' to never expire the cache (this is the default).</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A memoized version of the function.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/memo.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">memoize_recent_fileobj</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">cache_filename</span><span class="p">,</span> <span class="n">expiration</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Memoize recent calls to the given function which returns a file object.</span>

<span class="sd">    The results of the cache expire after some time.</span>

<span class="sd">    Args:</span>
<span class="sd">      function: A callable object.</span>
<span class="sd">      cache_filename: A string, the path to the database file to cache to.</span>
<span class="sd">      expiration: The time during which the results will be kept valid. Use</span>
<span class="sd">        &#39;None&#39; to never expire the cache (this is the default).</span>
<span class="sd">    Returns:</span>
<span class="sd">      A memoized version of the function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">urlcache</span> <span class="o">=</span> <span class="n">shelve</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">cache_filename</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">)</span>
    <span class="n">urlcache</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>  <span class="c1"># Note: &#39;shelve&#39; is not thread-safe.</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">memoized</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="c1"># Encode the arguments, including a date string in order to invalidate</span>
        <span class="c1"># results over some time.</span>
        <span class="n">md5</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>
        <span class="n">md5</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>
        <span class="n">md5</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">kw</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>

        <span class="n">hash_</span> <span class="o">=</span> <span class="n">md5</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
        <span class="n">time_now</span> <span class="o">=</span> <span class="n">now</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">urlcache</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
                <span class="n">time_orig</span><span class="p">,</span> <span class="n">contents</span> <span class="o">=</span> <span class="n">urlcache</span><span class="p">[</span><span class="n">hash_</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">expiration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">time_now</span> <span class="o">-</span> <span class="n">time_orig</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">expiration</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">fileobj</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fileobj</span><span class="p">:</span>
                <span class="n">contents</span> <span class="o">=</span> <span class="n">fileobj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="k">with</span> <span class="n">urlcache</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
                    <span class="n">urlcache</span><span class="p">[</span><span class="n">hash_</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">time_now</span><span class="p">,</span> <span class="n">contents</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">contents</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span> <span class="k">if</span> <span class="n">contents</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">memoized</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.memo.now" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">memo</span><span class="o">.</span><span class="n">now</span><span class="p">()</span></code>


<a href="#beancount.utils.memo.now" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Indirection on datetime.datetime.now() for testing.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/memo.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">now</span><span class="p">():</span>
    <span class="s2">&quot;Indirection on datetime.datetime.now() for testing.&quot;</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.utils.misc_utils" class="doc doc-heading">
        <code>beancount.utils.misc_utils</code>



<a href="#beancount.utils.misc_utils" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Generic utility packages and functions.</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-class">



<h3 id="beancount.utils.misc_utils.LineFileProxy" class="doc doc-heading">
        <code>
beancount.utils.misc_utils.LineFileProxy        </code>



<a href="#beancount.utils.misc_utils.LineFileProxy" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A file object that will delegate writing full lines to another logging function.
This may be used for writing data to a logging level without having to worry about
lines.</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.misc_utils.LineFileProxy.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">LineFileProxy</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line_writer</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">write_newlines</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.utils.misc_utils.LineFileProxy.__init__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Construct a new line delegator file object proxy.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>line_writer</strong> – A callable function, used to write to the delegated output.</p></li>
            <li><p><strong>prefix</strong> – An optional string, the prefix to insert before every line.</p></li>
            <li><p><strong>write_newlines</strong> – A boolean, true if we should output the newline characters.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line_writer</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">write_newlines</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Construct a new line delegator file object proxy.</span>

<span class="sd">    Args:</span>
<span class="sd">      line_writer: A callable function, used to write to the delegated output.</span>
<span class="sd">      prefix: An optional string, the prefix to insert before every line.</span>
<span class="sd">      write_newlines: A boolean, true if we should output the newline characters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">line_writer</span> <span class="o">=</span> <span class="n">line_writer</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write_newlines</span> <span class="o">=</span> <span class="n">write_newlines</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.misc_utils.LineFileProxy.close" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">LineFileProxy</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#beancount.utils.misc_utils.LineFileProxy.close" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Close the line delegator.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Close the line delegator.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.misc_utils.LineFileProxy.flush" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">LineFileProxy</span><span class="o">.</span><span class="n">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#beancount.utils.misc_utils.LineFileProxy.flush" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Flush the data to the line writer.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Flush the data to the line writer.&quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">line</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_newlines</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_writer</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.misc_utils.LineFileProxy.write" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">LineFileProxy</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span></code>


<a href="#beancount.utils.misc_utils.LineFileProxy.write" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Write some string data to the output.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>data</strong> – A string, with or without newlines.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write some string data to the output.</span>

<span class="sd">    Args:</span>
<span class="sd">      data: A string, with or without newlines.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="beancount.utils.misc_utils.TypeComparable" class="doc doc-heading">
        <code>
beancount.utils.misc_utils.TypeComparable        </code>



<a href="#beancount.utils.misc_utils.TypeComparable" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A base class whose equality comparison includes comparing the
type of the instance itself.</p>




  <div class="doc doc-children">












  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.box" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#beancount.utils.misc_utils.box" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A context manager that prints out a box around a block.
This is useful for printing out stuff from tests in a way that is readable.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>name</strong> – A string, the name of the box to use.</p></li>
            <li><p><strong>file</strong> – The file object to print to.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  None.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">box</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A context manager that prints out a box around a block.</span>
<span class="sd">    This is useful for printing out stuff from tests in a way that is readable.</span>

<span class="sd">    Args:</span>
<span class="sd">      name: A string, the name of the box to use.</span>
<span class="sd">      file: The file object to print to.</span>
<span class="sd">    Yields:</span>
<span class="sd">      None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">file</span> <span class="o">=</span> <span class="n">file</span> <span class="ow">or</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">header</span> <span class="o">=</span> <span class="s2">&quot;,--------(</span><span class="si">{}</span><span class="s2">)--------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">footer</span> <span class="o">=</span> <span class="s2">&quot;`</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">header</span> <span class="o">=</span> <span class="s2">&quot;,----------------</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">footer</span> <span class="o">=</span> <span class="s2">&quot;`----------------</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
    <span class="k">yield</span>
    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">footer</span><span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.cmptuple" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">cmptuple</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span></code>


<a href="#beancount.utils.misc_utils.cmptuple" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Manufacture a comparable namedtuple class, similar to collections.namedtuple.</p>
<p>A comparable named tuple is a tuple which compares to False if contents are
equal but the data types are different. We define this to supplement
collections.namedtuple because by default a namedtuple disregards the type
and we want to make precise comparisons for tests.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>name</strong> – The given name of the class.</p></li>
            <li><p><strong>attributes</strong> – A string or tuple of strings, with the names of the
attributes.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A new namedtuple-derived type that compares False with other
tuples with same contents.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">cmptuple</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">attributes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Manufacture a comparable namedtuple class, similar to collections.namedtuple.</span>

<span class="sd">    A comparable named tuple is a tuple which compares to False if contents are</span>
<span class="sd">    equal but the data types are different. We define this to supplement</span>
<span class="sd">    collections.namedtuple because by default a namedtuple disregards the type</span>
<span class="sd">    and we want to make precise comparisons for tests.</span>

<span class="sd">    Args:</span>
<span class="sd">      name: The given name of the class.</span>
<span class="sd">      attributes: A string or tuple of strings, with the names of the</span>
<span class="sd">        attributes.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new namedtuple-derived type that compares False with other</span>
<span class="sd">      tuples with same contents.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">base</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">attributes</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="p">(</span>
            <span class="n">TypeComparable</span><span class="p">,</span>
            <span class="n">base</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="p">{},</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.compute_unique_clean_ids" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">compute_unique_clean_ids</span><span class="p">(</span><span class="n">strings</span><span class="p">)</span></code>


<a href="#beancount.utils.misc_utils.compute_unique_clean_ids" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Given a sequence of strings, reduce them to corresponding ids without any
funny characters and insure that the list of ids is unique. Yields pairs
of (id, string) for the result.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>strings</strong> – A list of strings.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of (id, string) pairs.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">compute_unique_clean_ids</span><span class="p">(</span><span class="n">strings</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given a sequence of strings, reduce them to corresponding ids without any</span>
<span class="sd">    funny characters and insure that the list of ids is unique. Yields pairs</span>
<span class="sd">    of (id, string) for the result.</span>

<span class="sd">    Args:</span>
<span class="sd">      strings: A list of strings.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of (id, string) pairs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">string_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">strings</span><span class="p">)</span>

    <span class="c1"># Try multiple methods until we get one that has no collisions.</span>
    <span class="k">for</span> <span class="n">regexp</span><span class="p">,</span> <span class="n">replacement</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[^A-Za-z0-9.-]&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[^A-Za-z0-9_]&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
    <span class="p">]:</span>
        <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">idmap</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">mre</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">regexp</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">string_set</span><span class="p">:</span>
            <span class="n">id_</span> <span class="o">=</span> <span class="n">mre</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">replacement</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
                <span class="k">break</span>  <span class="c1"># Collision.</span>
            <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="n">idmap</span><span class="p">[</span><span class="n">id_</span><span class="p">]</span> <span class="o">=</span> <span class="n">string</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># Could not find a unique mapping.</span>

    <span class="k">return</span> <span class="n">idmap</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.deprecated" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code>


<a href="#beancount.utils.misc_utils.deprecated" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A decorator generator to mark functions as deprecated and log a warning.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">deprecated</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A decorator generator to mark functions as deprecated and log a warning.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">new_func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Call to deprecated function </span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">message</span><span class="p">),</span>
                <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">new_func</span>

    <span class="k">return</span> <span class="n">decorator</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.dictmap" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">dictmap</span><span class="p">(</span><span class="n">mdict</span><span class="p">,</span> <span class="n">keyfun</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">valfun</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#beancount.utils.misc_utils.dictmap" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Map a dictionary's value.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>mdict</strong> – A dict.</p></li>
            <li><p><strong>key</strong> – A callable to apply to the keys.</p></li>
            <li><p><strong>value</strong> – A callable to apply to the values.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">dictmap</span><span class="p">(</span><span class="n">mdict</span><span class="p">,</span> <span class="n">keyfun</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">valfun</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Map a dictionary&#39;s value.</span>

<span class="sd">    Args:</span>
<span class="sd">      mdict: A dict.</span>
<span class="sd">      key: A callable to apply to the keys.</span>
<span class="sd">      value: A callable to apply to the values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">keyfun</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">keyfun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>
    <span class="k">if</span> <span class="n">valfun</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">valfun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">keyfun</span><span class="p">(</span><span class="n">key</span><span class="p">):</span> <span class="n">valfun</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">mdict</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.escape_string" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">escape_string</span><span class="p">(</span><span class="n">string</span><span class="p">)</span></code>


<a href="#beancount.utils.misc_utils.escape_string" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Escape quotes and backslashes in payee and narration.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>string</strong> – Any string.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Returns.
  The input string, with offending characters replaced.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">escape_string</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Escape quotes and backslashes in payee and narration.</span>

<span class="sd">    Args:</span>
<span class="sd">      string: Any string.</span>
<span class="sd">    Returns.</span>
<span class="sd">      The input string, with offending characters replaced.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.filter_type" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">filter_type</span><span class="p">(</span><span class="n">elist</span><span class="p">,</span> <span class="n">types</span><span class="p">)</span></code>


<a href="#beancount.utils.misc_utils.filter_type" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Filter the given list to yield only instances of the given types.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>elist</strong> – A sequence of elements.</p></li>
            <li><p><strong>types</strong> – A sequence of types to include in the output list.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  Each element, if it is an instance of 'types'.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">filter_type</span><span class="p">(</span><span class="n">elist</span><span class="p">,</span> <span class="n">types</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter the given list to yield only instances of the given types.</span>

<span class="sd">    Args:</span>
<span class="sd">      elist: A sequence of elements.</span>
<span class="sd">      types: A sequence of types to include in the output list.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Each element, if it is an instance of &#39;types&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elist</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">types</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">yield</span> <span class="n">element</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.first_paragraph" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">first_paragraph</span><span class="p">(</span><span class="n">docstring</span><span class="p">)</span></code>


<a href="#beancount.utils.misc_utils.first_paragraph" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Return the first sentence of a docstring.
The sentence has to be delimited by an empty line.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>docstring</strong> – A doc string.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A string with just the first sentence on a single line.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">first_paragraph</span><span class="p">(</span><span class="n">docstring</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the first sentence of a docstring.</span>
<span class="sd">    The sentence has to be delimited by an empty line.</span>

<span class="sd">    Args:</span>
<span class="sd">      docstring: A doc string.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string with just the first sentence on a single line.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">docstring</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
    <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.get_screen_height" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">get_screen_height</span><span class="p">()</span></code>


<a href="#beancount.utils.misc_utils.get_screen_height" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Return the height of the terminal that runs this program.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>An integer, the number of characters the screen is high.
Return 0 if the terminal cannot be initialized.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_screen_height</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the height of the terminal that runs this program.</span>

<span class="sd">    Returns:</span>
<span class="sd">      An integer, the number of characters the screen is high.</span>
<span class="sd">      Return 0 if the terminal cannot be initialized.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_get_screen_value</span><span class="p">(</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.get_screen_width" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">get_screen_width</span><span class="p">()</span></code>


<a href="#beancount.utils.misc_utils.get_screen_width" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Return the width of the terminal that runs this program.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>An integer, the number of characters the screen is wide.
Return 0 if the terminal cannot be initialized.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_screen_width</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the width of the terminal that runs this program.</span>

<span class="sd">    Returns:</span>
<span class="sd">      An integer, the number of characters the screen is wide.</span>
<span class="sd">      Return 0 if the terminal cannot be initialized.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_get_screen_value</span><span class="p">(</span><span class="s2">&quot;cols&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.get_tuple_values" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">get_tuple_values</span><span class="p">(</span><span class="n">ntuple</span><span class="p">,</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">memo</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#beancount.utils.misc_utils.get_tuple_values" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Return all members referred to by this namedtuple instance that satisfy the
given predicate. This function also works recursively on its members which
are lists or tuples, and so it can be used for Transaction instances.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>ntuple</strong> – A tuple or namedtuple.</p></li>
            <li><p><strong>predicate</strong> – A predicate function that returns true if an attribute is to be
output.</p></li>
            <li><p><strong>memo</strong> – An optional memoizing dictionary. If a tuple has already been seen, the
recursion will be avoided.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  Attributes of the tuple and its sub-elements if the predicate is true.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_tuple_values</span><span class="p">(</span><span class="n">ntuple</span><span class="p">,</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">memo</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return all members referred to by this namedtuple instance that satisfy the</span>
<span class="sd">    given predicate. This function also works recursively on its members which</span>
<span class="sd">    are lists or tuples, and so it can be used for Transaction instances.</span>

<span class="sd">    Args:</span>
<span class="sd">      ntuple: A tuple or namedtuple.</span>
<span class="sd">      predicate: A predicate function that returns true if an attribute is to be</span>
<span class="sd">        output.</span>
<span class="sd">      memo: An optional memoizing dictionary. If a tuple has already been seen, the</span>
<span class="sd">        recursion will be avoided.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Attributes of the tuple and its sub-elements if the predicate is true.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">memo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">memo</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">id_ntuple</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">ntuple</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">id_ntuple</span> <span class="ow">in</span> <span class="n">memo</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">memo</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">id_ntuple</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">predicate</span><span class="p">(</span><span class="n">ntuple</span><span class="p">):</span>
        <span class="k">yield</span>
    <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">ntuple</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">predicate</span><span class="p">(</span><span class="n">attribute</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">attribute</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">get_tuple_values</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">memo</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.groupby" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">keyfun</span><span class="p">,</span> <span class="n">elements</span><span class="p">)</span></code>


<a href="#beancount.utils.misc_utils.groupby" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Group the elements as a dict of lists, where the key is computed using the
function 'keyfun'.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>keyfun</strong> – A callable, used to obtain the group key from each element.</p></li>
            <li><p><strong>elements</strong> – An iterable of the elements to group.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A dict of key to list of sequences.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">groupby</span><span class="p">(</span><span class="n">keyfun</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Group the elements as a dict of lists, where the key is computed using the</span>
<span class="sd">    function &#39;keyfun&#39;.</span>

<span class="sd">    Args:</span>
<span class="sd">      keyfun: A callable, used to obtain the group key from each element.</span>
<span class="sd">      elements: An iterable of the elements to group.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A dict of key to list of sequences.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Note: We could allow a custom aggregation function. Another option is</span>
    <span class="c1"># provide another method to reduce the list values of a dict, but that can</span>
    <span class="c1"># be accomplished using a dict comprehension.</span>
    <span class="n">grouped</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
        <span class="n">grouped</span><span class="p">[</span><span class="n">keyfun</span><span class="p">(</span><span class="n">element</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">grouped</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.idify" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">idify</span><span class="p">(</span><span class="n">string</span><span class="p">)</span></code>


<a href="#beancount.utils.misc_utils.idify" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Replace characters objectionable for a filename with underscores.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>string</strong> – Any string.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>The input string, with offending characters replaced.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">idify</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Replace characters objectionable for a filename with underscores.</span>

<span class="sd">    Args:</span>
<span class="sd">      string: Any string.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The input string, with offending characters replaced.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">sfrom</span><span class="p">,</span> <span class="n">sto</span> <span class="ow">in</span> <span class="p">[(</span><span class="sa">r</span><span class="s2">&quot;[ \(\)]+&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">),</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;_*\._*&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">)]:</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">sfrom</span><span class="p">,</span> <span class="n">sto</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
    <span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">string</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.import_curses" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">import_curses</span><span class="p">()</span></code>


<a href="#beancount.utils.misc_utils.import_curses" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Try to import the 'curses' module.
(This is used here in order to override for tests.)</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>The curses module, if it was possible to import it.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>ImportError</code> – If the module could not be imported.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">import_curses</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Try to import the &#39;curses&#39; module.</span>
<span class="sd">    (This is used here in order to override for tests.)</span>

<span class="sd">    Returns:</span>
<span class="sd">      The curses module, if it was possible to import it.</span>
<span class="sd">    Raises:</span>
<span class="sd">      ImportError: If the module could not be imported.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Note: There&#39;s a recipe for getting terminal size on Windows here, without</span>
    <span class="c1"># curses, I should probably implement that at some point:</span>
    <span class="c1"># https://stackoverflow.com/questions/263890/how-do-i-find-the-width-height-of-a-terminal-window</span>
    <span class="c1"># Also, consider just using &#39;blessings&#39; instead, which provides this across</span>
    <span class="c1"># multiple platforms.</span>

    <span class="kn">import</span> <span class="nn">curses</span>

    <span class="k">return</span> <span class="n">curses</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.is_sorted" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">is_sorted</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">key</span><span class="o">=&lt;</span><span class="n">function</span> <span class="o">&lt;</span><span class="k">lambda</span><span class="o">&gt;</span> <span class="n">at</span> <span class="mh">0x78fcde6aac00</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">cmp</span><span class="o">=&lt;</span><span class="n">function</span> <span class="o">&lt;</span><span class="k">lambda</span><span class="o">&gt;</span> <span class="n">at</span> <span class="mh">0x78fcde6aaca0</span><span class="o">&gt;</span><span class="p">)</span></code>


<a href="#beancount.utils.misc_utils.is_sorted" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Return true if the sequence is sorted.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>iterable</strong> – An iterable sequence.</p></li>
            <li><p><strong>key</strong> – A function to extract the quantity by which to sort.</p></li>
            <li><p><strong>cmp</strong> – A function that compares two elements of a sequence.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A boolean, true if the sequence is sorted.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">is_sorted</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="n">cmp</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return true if the sequence is sorted.</span>

<span class="sd">    Args:</span>
<span class="sd">      iterable: An iterable sequence.</span>
<span class="sd">      key: A function to extract the quantity by which to sort.</span>
<span class="sd">      cmp: A function that compares two elements of a sequence.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A boolean, true if the sequence is sorted.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">iterator</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">iterable</span><span class="p">)</span>
    <span class="n">prev</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">iterator</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">iterator</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cmp</span><span class="p">(</span><span class="n">prev</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">prev</span> <span class="o">=</span> <span class="n">element</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.log_time" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">log_time</span><span class="p">(</span><span class="n">operation_name</span><span class="p">,</span> <span class="n">log_timings</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>


<a href="#beancount.utils.misc_utils.log_time" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A context manager that times the block and logs it to info level.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>operation_name</strong> – A string, a label for the name of the operation.</p></li>
            <li><p><strong>log_timings</strong> – A function to write log messages to. If left to None,
no timings are written (this becomes a no-op).</p></li>
            <li><p><strong>indent</strong> – An integer, the indentation level for the format of the timing
line. This is useful if you're logging timing to a hierarchy of
operations.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  The start time of the operation.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">log_time</span><span class="p">(</span><span class="n">operation_name</span><span class="p">,</span> <span class="n">log_timings</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A context manager that times the block and logs it to info level.</span>

<span class="sd">    Args:</span>
<span class="sd">      operation_name: A string, a label for the name of the operation.</span>
<span class="sd">      log_timings: A function to write log messages to. If left to None,</span>
<span class="sd">        no timings are written (this becomes a no-op).</span>
<span class="sd">      indent: An integer, the indentation level for the format of the timing</span>
<span class="sd">        line. This is useful if you&#39;re logging timing to a hierarchy of</span>
<span class="sd">        operations.</span>
<span class="sd">    Yields:</span>
<span class="sd">      The start time of the operation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">time1</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
    <span class="k">yield</span> <span class="n">time1</span>
    <span class="n">time2</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">log_timings</span><span class="p">:</span>
        <span class="n">log_timings</span><span class="p">(</span>
            <span class="s2">&quot;Operation: </span><span class="si">{:48}</span><span class="s2"> Time: </span><span class="si">{}{:6.0f}</span><span class="s2"> ms&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">operation_name</span><span class="p">),</span> <span class="s2">&quot;      &quot;</span> <span class="o">*</span> <span class="n">indent</span><span class="p">,</span> <span class="p">(</span><span class="n">time2</span> <span class="o">-</span> <span class="n">time1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>
            <span class="p">)</span>
        <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.longest" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">longest</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span></code>


<a href="#beancount.utils.misc_utils.longest" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Return the longest of the given subsequences.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>seq</strong> – An iterable sequence of lists.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>The longest list from the sequence.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">longest</span><span class="p">(</span><span class="n">seq</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the longest of the given subsequences.</span>

<span class="sd">    Args:</span>
<span class="sd">      seq: An iterable sequence of lists.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The longest list from the sequence.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">longest</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">seq</span><span class="p">:</span>
        <span class="n">len_element</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">len_element</span> <span class="o">&gt;</span> <span class="n">length</span><span class="p">:</span>
            <span class="n">longest</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="n">element</span><span class="p">,</span> <span class="n">len_element</span>
    <span class="k">return</span> <span class="n">longest</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.map_namedtuple_attributes" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">map_namedtuple_attributes</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">object_</span><span class="p">)</span></code>


<a href="#beancount.utils.misc_utils.map_namedtuple_attributes" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Map the value of the named attributes of object by mapper.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>attributes</strong> – A sequence of string, the attribute names to map.</p></li>
            <li><p><strong>mapper</strong> – A callable that accepts the value of a field and returns
the new value.</p></li>
            <li><p><strong>object_</strong> – Some namedtuple object with attributes on it.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A new instance of the same namedtuple with the named fields mapped by
mapper.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">map_namedtuple_attributes</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">object_</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Map the value of the named attributes of object by mapper.</span>

<span class="sd">    Args:</span>
<span class="sd">      attributes: A sequence of string, the attribute names to map.</span>
<span class="sd">      mapper: A callable that accepts the value of a field and returns</span>
<span class="sd">        the new value.</span>
<span class="sd">      object_: Some namedtuple object with attributes on it.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new instance of the same namedtuple with the named fields mapped by</span>
<span class="sd">      mapper.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">object_</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span>
        <span class="o">**</span><span class="p">{</span><span class="n">attribute</span><span class="p">:</span> <span class="n">mapper</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">object_</span><span class="p">,</span> <span class="n">attribute</span><span class="p">))</span> <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">}</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.replace_namedtuple_values" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">replace_namedtuple_values</span><span class="p">(</span><span class="n">ntuple</span><span class="p">,</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">memo</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#beancount.utils.misc_utils.replace_namedtuple_values" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Recurse through all the members of namedtuples and lists, and for
members that match the given predicate, run them through the given mapper.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>ntuple</strong> – A namedtuple instance.</p></li>
            <li><p><strong>predicate</strong> – A predicate function that returns true if an attribute is to be
output.</p></li>
            <li><p><strong>mapper</strong> – A callable, that will accept a single argument and return its
replacement value.</p></li>
            <li><p><strong>memo</strong> – An optional memoizing dictionary. If a tuple has already been seen, the
recursion will be avoided.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  Attributes of the tuple and its sub-elements if the predicate is true.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">replace_namedtuple_values</span><span class="p">(</span><span class="n">ntuple</span><span class="p">,</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">memo</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Recurse through all the members of namedtuples and lists, and for</span>
<span class="sd">    members that match the given predicate, run them through the given mapper.</span>

<span class="sd">    Args:</span>
<span class="sd">      ntuple: A namedtuple instance.</span>
<span class="sd">      predicate: A predicate function that returns true if an attribute is to be</span>
<span class="sd">        output.</span>
<span class="sd">      mapper: A callable, that will accept a single argument and return its</span>
<span class="sd">        replacement value.</span>
<span class="sd">      memo: An optional memoizing dictionary. If a tuple has already been seen, the</span>
<span class="sd">        recursion will be avoided.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Attributes of the tuple and its sub-elements if the predicate is true.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">memo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">memo</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">id_ntuple</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">ntuple</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">id_ntuple</span> <span class="ow">in</span> <span class="n">memo</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">memo</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">id_ntuple</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">ntuple</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">tuple</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ntuple</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">ntuple</span>
    <span class="n">replacements</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">attribute_name</span><span class="p">,</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ntuple</span><span class="o">.</span><span class="n">_fields</span><span class="p">,</span> <span class="n">ntuple</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">predicate</span><span class="p">(</span><span class="n">attribute</span><span class="p">):</span>
            <span class="n">replacements</span><span class="p">[</span><span class="n">attribute_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapper</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">tuple</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">replacements</span><span class="p">[</span><span class="n">attribute_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">replace_namedtuple_values</span><span class="p">(</span>
                <span class="n">attribute</span><span class="p">,</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">memo</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">replacements</span><span class="p">[</span><span class="n">attribute_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">replace_namedtuple_values</span><span class="p">(</span><span class="n">member</span><span class="p">,</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">memo</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">attribute</span>
            <span class="p">]</span>
    <span class="k">return</span> <span class="n">ntuple</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="o">**</span><span class="n">replacements</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.skipiter" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">skipiter</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">num_skip</span><span class="p">)</span></code>


<a href="#beancount.utils.misc_utils.skipiter" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Skip some elements from an iterator.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>iterable</strong> – An iterator.</p></li>
            <li><p><strong>num_skip</strong> – The number of elements in the period.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  Elements from the iterable, with num_skip elements skipped.
  For example, skipiter(range(10), 3) yields [0, 3, 6, 9].</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">skipiter</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">num_skip</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Skip some elements from an iterator.</span>

<span class="sd">    Args:</span>
<span class="sd">      iterable: An iterator.</span>
<span class="sd">      num_skip: The number of elements in the period.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Elements from the iterable, with num_skip elements skipped.</span>
<span class="sd">      For example, skipiter(range(10), 3) yields [0, 3, 6, 9].</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">num_skip</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="n">sit</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span>
    <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">sit</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">yield</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_skip</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">next</span><span class="p">(</span><span class="n">sit</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                <span class="k">return</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.sorted_uniquify" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">sorted_uniquify</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">keyfunc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#beancount.utils.misc_utils.sorted_uniquify" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Given a sequence of elements, sort and remove duplicates of the given key.
Keep either the first or the last (by key) element of a sequence of
key-identical elements. This does <em>not</em> maintain the ordering of the
original elements, they are returned sorted (by key) instead.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>iterable</strong> – An iterable sequence.</p></li>
            <li><p><strong>keyfunc</strong> – A function that extracts from the elements the sort key
to use and uniquify on. If left unspecified, the identify function
is used and the uniquification occurs on the elements themselves.</p></li>
            <li><p><strong>last</strong> – A boolean, True if we should keep the last item of the same keys.
Otherwise keep the first.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  Elements from the iterable.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">sorted_uniquify</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">keyfunc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given a sequence of elements, sort and remove duplicates of the given key.</span>
<span class="sd">    Keep either the first or the last (by key) element of a sequence of</span>
<span class="sd">    key-identical elements. This does _not_ maintain the ordering of the</span>
<span class="sd">    original elements, they are returned sorted (by key) instead.</span>

<span class="sd">    Args:</span>
<span class="sd">      iterable: An iterable sequence.</span>
<span class="sd">      keyfunc: A function that extracts from the elements the sort key</span>
<span class="sd">        to use and uniquify on. If left unspecified, the identify function</span>
<span class="sd">        is used and the uniquification occurs on the elements themselves.</span>
<span class="sd">      last: A boolean, True if we should keep the last item of the same keys.</span>
<span class="sd">        Otherwise keep the first.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Elements from the iterable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">keyfunc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">keyfunc</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>
    <span class="k">if</span> <span class="n">last</span><span class="p">:</span>
        <span class="n">prev_obj</span> <span class="o">=</span> <span class="n">UNSET</span>
        <span class="n">prev_key</span> <span class="o">=</span> <span class="n">UNSET</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">keyfunc</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">keyfunc</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="n">prev_key</span> <span class="ow">and</span> <span class="n">prev_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">UNSET</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">prev_obj</span>
            <span class="n">prev_obj</span> <span class="o">=</span> <span class="n">obj</span>
            <span class="n">prev_key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="k">if</span> <span class="n">prev_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">UNSET</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">prev_obj</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">prev_key</span> <span class="o">=</span> <span class="n">UNSET</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">keyfunc</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">keyfunc</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="n">prev_key</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">obj</span>
                <span class="n">prev_key</span> <span class="o">=</span> <span class="n">key</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.staticvar" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">staticvar</span><span class="p">(</span><span class="n">varname</span><span class="p">,</span> <span class="n">initial_value</span><span class="p">)</span></code>


<a href="#beancount.utils.misc_utils.staticvar" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Returns a decorator that defines a Python function attribute.</p>
<p>This is used to simulate a static function variable in Python.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>varname</strong> – A string, the name of the variable to define.</p></li>
            <li><p><strong>initial_value</strong> – The value to initialize the variable to.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A function decorator.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">staticvar</span><span class="p">(</span><span class="n">varname</span><span class="p">,</span> <span class="n">initial_value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a decorator that defines a Python function attribute.</span>

<span class="sd">    This is used to simulate a static function variable in Python.</span>

<span class="sd">    Args:</span>
<span class="sd">      varname: A string, the name of the variable to define.</span>
<span class="sd">      initial_value: The value to initialize the variable to.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A function decorator.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">deco</span><span class="p">(</span><span class="n">fun</span><span class="p">):</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span> <span class="n">initial_value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fun</span>

    <span class="k">return</span> <span class="n">deco</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.swallow" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">swallow</span><span class="p">(</span><span class="o">*</span><span class="n">exception_types</span><span class="p">)</span></code>


<a href="#beancount.utils.misc_utils.swallow" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Catch and ignore certain exceptions.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>exception_types</strong> – A tuple of exception classes to ignore.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  None.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">swallow</span><span class="p">(</span><span class="o">*</span><span class="n">exception_types</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Catch and ignore certain exceptions.</span>

<span class="sd">    Args:</span>
<span class="sd">      exception_types: A tuple of exception classes to ignore.</span>
<span class="sd">    Yields:</span>
<span class="sd">      None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">exception_types</span><span class="p">):</span>
            <span class="k">raise</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.misc_utils.uniquify" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">uniquify</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">keyfunc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#beancount.utils.misc_utils.uniquify" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Given a sequence of elements, remove duplicates of the given key. Keep either
the first or the last element of a sequence of key-identical elements. Order
is maintained as much as possible. This does maintain the ordering of the
original elements, they are returned in the same order as the original
elements.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>iterable</strong> – An iterable sequence.</p></li>
            <li><p><strong>keyfunc</strong> – A function that extracts from the elements the sort key
to use and uniquify on. If left unspecified, the identify function
is used and the uniquification occurs on the elements themselves.</p></li>
            <li><p><strong>last</strong> – A boolean, True if we should keep the last item of the same keys.
Otherwise keep the first.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  Elements from the iterable.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">uniquify</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">keyfunc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given a sequence of elements, remove duplicates of the given key. Keep either</span>
<span class="sd">    the first or the last element of a sequence of key-identical elements. Order</span>
<span class="sd">    is maintained as much as possible. This does maintain the ordering of the</span>
<span class="sd">    original elements, they are returned in the same order as the original</span>
<span class="sd">    elements.</span>

<span class="sd">    Args:</span>
<span class="sd">      iterable: An iterable sequence.</span>
<span class="sd">      keyfunc: A function that extracts from the elements the sort key</span>
<span class="sd">        to use and uniquify on. If left unspecified, the identify function</span>
<span class="sd">        is used and the uniquification occurs on the elements themselves.</span>
<span class="sd">      last: A boolean, True if we should keep the last item of the same keys.</span>
<span class="sd">        Otherwise keep the first.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Elements from the iterable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">keyfunc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">keyfunc</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>
    <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">last</span><span class="p">:</span>
        <span class="n">unique_reversed_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">iterable</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">keyfunc</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
                <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="n">unique_reversed_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">yield from</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">unique_reversed_list</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">iterable</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">keyfunc</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
                <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">obj</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.utils.pager" class="doc doc-heading">
        <code>beancount.utils.pager</code>



<a href="#beancount.utils.pager" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Code to write output to a pager.</p>
<p>This module contains an object accumulates lines up to a minimum and then
decides whether to flush them to the original output directly if under the
threshold (no pager) or creates a pager and flushes the lines to it if above the
threshold and then forwards all future lines to it. The purpose of this object
is to pipe output to a pager only if the number of lines to be printed exceeds a
minimum number of lines.</p>
<p>The contextmanager is intended to be used to pipe output to a pager and wait on
the pager to complete before continuing. Simply write to the file object and
upon exit we close the file object. This also silences broken pipe errors
triggered by the user exiting the sub-process, and recovers from a failing pager
command by just using stdout.</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-class">



<h3 id="beancount.utils.pager.ConditionalPager" class="doc doc-heading">
        <code>
beancount.utils.pager.ConditionalPager        </code>



<a href="#beancount.utils.pager.ConditionalPager" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A proxy file for a pager that only creates a pager after a minimum number of
lines has been printed to it.</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.pager.ConditionalPager.__enter__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">pager</span><span class="o">.</span><span class="n">ConditionalPager</span><span class="o">.</span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.utils.pager.ConditionalPager.__enter__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Initialize the context manager and return this instance as it.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/pager.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the context manager and return this instance as it.&quot;&quot;&quot;</span>

    <span class="c1"># The file and pipe object we&#39;re writing to. This gets set after the</span>
    <span class="c1"># number of accumulated lines reaches the threshold.</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minlines</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipe</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipe</span> <span class="o">=</span> <span class="n">create_pager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">command</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_file</span><span class="p">)</span>

    <span class="c1"># Lines accumulated before the threshold.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">accumulated_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">accumulated_lines</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Return this object to be used as the context manager itself.</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.pager.ConditionalPager.__exit__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">pager</span><span class="o">.</span><span class="n">ConditionalPager</span><span class="o">.</span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">unused_traceback</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.utils.pager.ConditionalPager.__exit__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Context manager exit. This flushes the output to our output file.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>type</strong> – Optional exception type, as per context managers.</p></li>
            <li><p><strong>value</strong> – Optional exception value, as per context managers.</p></li>
            <li><p><strong>unused_traceback</strong> – Optional trace.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/pager.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">unused_traceback</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Context manager exit. This flushes the output to our output file.</span>

<span class="sd">    Args:</span>
<span class="sd">      type: Optional exception type, as per context managers.</span>
<span class="sd">      value: Optional exception value, as per context managers.</span>
<span class="sd">      unused_traceback: Optional trace.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">:</span>
            <span class="c1"># Flush the output file and close it.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Oops... we never reached the threshold. Flush the accumulated</span>
            <span class="c1"># output to the file.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flush_accumulated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_file</span><span class="p">)</span>

        <span class="c1"># Wait for the subprocess (if we have one).</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipe</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipe</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

    <span class="c1"># Absorb broken pipes that may occur on flush or close above.</span>
    <span class="k">except</span> <span class="ne">BrokenPipeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># Absorb broken pipes.</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="ne">BrokenPipeError</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">value</span><span class="p">:</span>
        <span class="k">raise</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.pager.ConditionalPager.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">pager</span><span class="o">.</span><span class="n">ConditionalPager</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">minlines</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.utils.pager.ConditionalPager.__init__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create a conditional pager.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>command</strong> – A string, the shell command to run as a pager.</p></li>
            <li><p><strong>minlines</strong> – If set, the number of lines under which you should not bother starting
a pager. This avoids kicking off a pager if the screen is high enough to
render the contents. If the value is unset, always starts a pager (which is
fine behavior too).</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/pager.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">minlines</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a conditional pager.</span>

<span class="sd">    Args:</span>
<span class="sd">      command: A string, the shell command to run as a pager.</span>
<span class="sd">      minlines: If set, the number of lines under which you should not bother starting</span>
<span class="sd">        a pager. This avoids kicking off a pager if the screen is high enough to</span>
<span class="sd">        render the contents. If the value is unset, always starts a pager (which is</span>
<span class="sd">        fine behavior too).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">command</span> <span class="o">=</span> <span class="n">command</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">minlines</span> <span class="o">=</span> <span class="n">minlines</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">default_file</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">codecs</span><span class="o">.</span><span class="n">getwriter</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">buffer</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="s2">&quot;buffer&quot;</span><span class="p">)</span>
        <span class="k">else</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.pager.ConditionalPager.flush_accumulated" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">pager</span><span class="o">.</span><span class="n">ConditionalPager</span><span class="o">.</span><span class="n">flush_accumulated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span></code>


<a href="#beancount.utils.pager.ConditionalPager.flush_accumulated" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Flush the existing lines to the newly created pager.
This also disabled the accumulator.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>file</strong> – A file object to flush the accumulated data to.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/pager.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">flush_accumulated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Flush the existing lines to the newly created pager.</span>
<span class="sd">    This also disabled the accumulator.</span>

<span class="sd">    Args:</span>
<span class="sd">      file: A file object to flush the accumulated data to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">accumulated_data</span><span class="p">:</span>
        <span class="n">write</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">write</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">accumulated_data</span><span class="p">:</span>
            <span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">accumulated_data</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">accumulated_lines</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.pager.ConditionalPager.write" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">pager</span><span class="o">.</span><span class="n">ConditionalPager</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span></code>


<a href="#beancount.utils.pager.ConditionalPager.write" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Write the data out. Overridden from the file object interface.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>data</strong> – A string, data to write to the output.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/pager.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write the data out. Overridden from the file object interface.</span>

<span class="sd">    Args:</span>
<span class="sd">      data: A string, data to write to the output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Accumulate the new lines.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accumulated_lines</span> <span class="o">+=</span> <span class="n">data</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accumulated_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># If we&#39;ve reached the threshold, create a file.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">accumulated_lines</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">minlines</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipe</span> <span class="o">=</span> <span class="n">create_pager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">command</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flush_accumulated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># We&#39;ve already created a pager subprocess... flush the lines to it.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="c1"># try:</span>
        <span class="c1"># except BrokenPipeError:</span>
        <span class="c1">#     # Make sure we don&#39;t barf on __exit__().</span>
        <span class="c1">#     self.file = self.pipe = None</span>
        <span class="c1">#     raise</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.pager.create_pager" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">pager</span><span class="o">.</span><span class="n">create_pager</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span></code>


<a href="#beancount.utils.pager.create_pager" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Try to create and return a pager subprocess.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>command</strong> – A string, the shell command to run as a pager.</p></li>
            <li><p><strong>file</strong> – The file object for the pager write to. This is also used as a
default if we failed to create the pager subprocess.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A pair of (file, pipe), a file object and an optional subprocess.Popen instance
to wait on. The pipe instance may be set to None if we failed to create a subprocess.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/pager.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">create_pager</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Try to create and return a pager subprocess.</span>

<span class="sd">    Args:</span>
<span class="sd">      command: A string, the shell command to run as a pager.</span>
<span class="sd">      file: The file object for the pager write to. This is also used as a</span>
<span class="sd">        default if we failed to create the pager subprocess.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A pair of (file, pipe), a file object and an optional subprocess.Popen instance</span>
<span class="sd">      to wait on. The pipe instance may be set to None if we failed to create a subprocess.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">command</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">command</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;PAGER&quot;</span><span class="p">,</span> <span class="n">DEFAULT_PAGER</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">command</span><span class="p">:</span>
        <span class="n">command</span> <span class="o">=</span> <span class="n">DEFAULT_PAGER</span>

    <span class="n">pipe</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># In case of using &#39;less&#39;, make sure the charset is set properly. In theory</span>
    <span class="c1"># you could override this by setting PAGER to &quot;LESSCHARSET=utf-8 less&quot; but</span>
    <span class="c1"># this shouldn&#39;t affect other programs and is unlikely to cause problems, so</span>
    <span class="c1"># we set it here to make default behavior work for most people (we always</span>
    <span class="c1"># write UTF-8).</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">env</span><span class="p">[</span><span class="s2">&quot;LESSCHARSET&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;utf-8&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">pipe</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
            <span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdin</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">file</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="n">env</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Invalid pager: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">exc</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">stdin_wrapper</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">TextIOWrapper</span><span class="p">(</span><span class="n">pipe</span><span class="o">.</span><span class="n">stdin</span><span class="p">,</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="n">file</span> <span class="o">=</span> <span class="n">stdin_wrapper</span>
    <span class="k">return</span> <span class="n">file</span><span class="p">,</span> <span class="n">pipe</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.pager.flush_only" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">pager</span><span class="o">.</span><span class="n">flush_only</span><span class="p">(</span><span class="n">fileobj</span><span class="p">)</span></code>


<a href="#beancount.utils.pager.flush_only" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A contextmanager around a file object that does not close the file.</p>
<p>This is used to return a context manager on a file object but not close it.
We flush it instead. This is useful in order to provide an alternative to a
pager class as above.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>fileobj</strong> – A file object, to remain open after running the context manager.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  A context manager that yields this object.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/pager.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">flush_only</span><span class="p">(</span><span class="n">fileobj</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A contextmanager around a file object that does not close the file.</span>

<span class="sd">    This is used to return a context manager on a file object but not close it.</span>
<span class="sd">    We flush it instead. This is useful in order to provide an alternative to a</span>
<span class="sd">    pager class as above.</span>

<span class="sd">    Args:</span>
<span class="sd">      fileobj: A file object, to remain open after running the context manager.</span>
<span class="sd">    Yields:</span>
<span class="sd">      A context manager that yields this object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">fileobj</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">fileobj</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.utils.snoop" class="doc doc-heading">
        <code>beancount.utils.snoop</code>



<a href="#beancount.utils.snoop" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Text manipulation utilities.</p>



  <div class="doc doc-children">











  <div class="doc doc-object doc-class">



<h3 id="beancount.utils.snoop.Snoop" class="doc doc-heading">
        <code>
beancount.utils.snoop.Snoop        </code>



<a href="#beancount.utils.snoop.Snoop" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A snooper callable that just saves the returned values of a
function. This is particularly useful for re.match and re.search in
conditionals, e.g.::</p>
<p>snoop = Snoop()
  ...
  if snoop(re.match(r"(\d+)-(\d+)-(\d+)", text)):
    year, month, date = snoop.value.group(1, 2, 3)</p>

<p><strong>Attributes:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>value</code></td>
        <td></td>
        <td><p>The last value snooped from a function call.</p></td>
      </tr>
      <tr>
        <td><code>history</code></td>
        <td></td>
        <td><p>If 'maxlen' was specified, the last few values
that were snooped.</p></td>
      </tr>
  </tbody>
</table>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.snoop.Snoop.__call__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">snoop</span><span class="o">.</span><span class="n">Snoop</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.utils.snoop.Snoop.__call__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Save a value to the snooper. This is meant to wrap
a function call.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>value</strong> – The value to push/save.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>Value itself.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/snoop.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Save a value to the snooper. This is meant to wrap</span>
<span class="sd">    a function call.</span>

<span class="sd">    Args:</span>
<span class="sd">      value: The value to push/save.</span>
<span class="sd">    Returns:</span>
<span class="sd">      Value itself.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.snoop.Snoop.__getattr__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">snoop</span><span class="o">.</span><span class="n">Snoop</span><span class="o">.</span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.utils.snoop.Snoop.__getattr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Forward the attribute to the value.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>attr</strong> – A string, the name of the attribute.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>The value of the attribute.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/snoop.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Forward the attribute to the value.</span>

<span class="sd">    Args:</span>
<span class="sd">      attr: A string, the name of the attribute.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The value of the attribute.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.snoop.Snoop.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">snoop</span><span class="o">.</span><span class="n">Snoop</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.utils.snoop.Snoop.__init__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create a new snooper.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>maxlen</strong> – If specified, an integer, which enables the saving of that</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/snoop.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a new snooper.</span>

<span class="sd">    Args:</span>
<span class="sd">      maxlen: If specified, an integer, which enables the saving of that</span>
<span class="sd">      number of last values in the history attribute.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">history</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">deque</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="n">maxlen</span><span class="p">)</span> <span class="k">if</span> <span class="n">maxlen</span> <span class="k">else</span> <span class="kc">None</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.snoop.snoopify" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">snoop</span><span class="o">.</span><span class="n">snoopify</span><span class="p">(</span><span class="n">function</span><span class="p">)</span></code>


<a href="#beancount.utils.snoop.snoopify" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Decorate a function as snoopable.</p>
<p>This is meant to reassign existing functions to a snoopable version of them.
For example, if you wanted 're.match' to be automatically snoopable, just
decorate it like this:</p>
<p>re.match = snoopify(re.match)</p>
<p>and then you can just call 're.match' in a conditional and then access
're.match.value' to get to the last returned value.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/snoop.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">snoopify</span><span class="p">(</span><span class="n">function</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decorate a function as snoopable.</span>

<span class="sd">    This is meant to reassign existing functions to a snoopable version of them.</span>
<span class="sd">    For example, if you wanted &#39;re.match&#39; to be automatically snoopable, just</span>
<span class="sd">    decorate it like this:</span>

<span class="sd">      re.match = snoopify(re.match)</span>

<span class="sd">    and then you can just call &#39;re.match&#39; in a conditional and then access</span>
<span class="sd">    &#39;re.match.value&#39; to get to the last returned value.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="n">wrapper</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="n">wrapper</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">wrapper</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.utils.table" class="doc doc-heading">
        <code>beancount.utils.table</code>



<a href="#beancount.utils.table" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Table rendering.</p>



  <div class="doc doc-children">









  <div class="doc doc-object doc-class">



<h3 id="beancount.utils.table.Table" class="doc doc-heading">
        <code>
beancount.utils.table.Table            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.utils.table.Table" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Table(columns, header, body)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.table.Table.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.utils.table.Table.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/table.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return self as a plain tuple.  Used by copy and pickle.&#39;</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.table.Table.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.utils.table.Table.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of Table(columns, header, body)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.table.Table.__repr__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.utils.table.Table.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/table.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return a nicely formatted representation string&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.table.attribute_to_title" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">attribute_to_title</span><span class="p">(</span><span class="n">fieldname</span><span class="p">)</span></code>


<a href="#beancount.utils.table.attribute_to_title" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Convert programming id into readable field name.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>fieldname</strong> – A string, a programming ids, such as 'book_value'.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A readable string, such as 'Book Value.'</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/table.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">attribute_to_title</span><span class="p">(</span><span class="n">fieldname</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert programming id into readable field name.</span>

<span class="sd">    Args:</span>
<span class="sd">      fieldname: A string, a programming ids, such as &#39;book_value&#39;.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A readable string, such as &#39;Book Value.&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">fieldname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.table.compute_table_widths" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">compute_table_widths</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span></code>


<a href="#beancount.utils.table.compute_table_widths" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Compute the max character widths of a list of rows.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>rows</strong> – A list of rows, which are sequences of strings.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of integers, the maximum widths required to render the columns of
this table.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>IndexError</code> – If the rows are of different lengths.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/table.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">compute_table_widths</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the max character widths of a list of rows.</span>

<span class="sd">    Args:</span>
<span class="sd">      rows: A list of rows, which are sequences of strings.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of integers, the maximum widths required to render the columns of</span>
<span class="sd">      this table.</span>
<span class="sd">    Raises:</span>
<span class="sd">      IndexError: If the rows are of different lengths.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">row_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
    <span class="n">first_row</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">row_iter</span><span class="p">)</span>
    <span class="n">num_columns</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">first_row</span><span class="p">)</span>
    <span class="n">column_widths</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">first_row</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">row_iter</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cell</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">cell</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
            <span class="n">cell_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cell_len</span> <span class="o">&gt;</span> <span class="n">column_widths</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">column_widths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">cell_len</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">!=</span> <span class="n">num_columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;Invalid number of rows&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">column_widths</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.table.create_table" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">create_table</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">field_spec</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#beancount.utils.table.create_table" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Convert a list of tuples to an table report object.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>rows</strong> – A list of tuples.</p></li>
            <li><p><strong>field_spec</strong> – A list of strings, or a list of
(FIELDNAME-OR-INDEX, HEADER, FORMATTER-FUNCTION)
triplets, that selects a subset of the fields is to be rendered as well
as their ordering. If this is a dict, the values are functions to call
on the fields to render them. If a function is set to None, we will just
call str() on the field.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A Table instance.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/table.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">create_table</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">field_spec</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a list of tuples to an table report object.</span>

<span class="sd">    Args:</span>
<span class="sd">      rows: A list of tuples.</span>
<span class="sd">      field_spec: A list of strings, or a list of</span>
<span class="sd">        (FIELDNAME-OR-INDEX, HEADER, FORMATTER-FUNCTION)</span>
<span class="sd">        triplets, that selects a subset of the fields is to be rendered as well</span>
<span class="sd">        as their ordering. If this is a dict, the values are functions to call</span>
<span class="sd">        on the fields to render them. If a function is set to None, we will just</span>
<span class="sd">        call str() on the field.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A Table instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Normalize field_spec to a dict.</span>
    <span class="k">if</span> <span class="n">field_spec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">namedtuple_class</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">field_spec</span> <span class="o">=</span> <span class="p">[(</span><span class="n">field</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">namedtuple_class</span><span class="o">.</span><span class="n">_fields</span><span class="p">]</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field_spec</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="n">new_field_spec</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">field_spec</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">field</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">field</span> <span class="o">=</span> <span class="n">field</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">new_field_spec</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">field</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">field</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="n">field</span>
                    <span class="n">new_field_spec</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">field</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">new_field_spec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">title</span> <span class="o">=</span> <span class="n">attribute_to_title</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Field </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid type for column name&quot;</span><span class="p">)</span>
                <span class="n">new_field_spec</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">field</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

        <span class="n">field_spec</span> <span class="o">=</span> <span class="n">new_field_spec</span>

    <span class="c1"># Ensure a nicely formatted header.</span>
    <span class="n">field_spec</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span>
            <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">attribute_to_title</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">formatter</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">header_</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">header_</span><span class="p">,</span> <span class="n">formatter</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">header_</span><span class="p">,</span> <span class="n">formatter</span><span class="p">)</span> <span class="ow">in</span> <span class="n">field_spec</span>
    <span class="p">]</span>

    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field_spec</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="n">field_spec</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">field_spec</span><span class="p">),</span> <span class="n">field_spec</span>

    <span class="c1"># Compute the column names.</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">)</span> <span class="ow">in</span> <span class="n">field_spec</span><span class="p">]</span>

    <span class="c1"># Compute the table header.</span>
    <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="n">header_column</span> <span class="k">for</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">header_column</span><span class="p">,</span> <span class="n">__</span><span class="p">)</span> <span class="ow">in</span> <span class="n">field_spec</span><span class="p">]</span>

    <span class="c1"># Compute the table body.</span>
    <span class="n">body</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
        <span class="n">body_row</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">formatter</span> <span class="ow">in</span> <span class="n">field_spec</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid type for column name&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">formatter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">formatter</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">body_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">body_row</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Table</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.table.render_table" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">render_table</span><span class="p">(</span><span class="n">table_</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">output_format</span><span class="p">,</span> <span class="n">css_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">css_class</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#beancount.utils.table.render_table" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Render the given table to the output file object in the requested format.</p>
<p>The table gets written out to the 'output' file.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>table_</strong> – An instance of Table.</p></li>
            <li><p><strong>output</strong> – A file object you can write to.</p></li>
            <li><p><strong>output_format</strong> – A string, the format to write the table to,
either 'csv', 'txt' or 'html'.</p></li>
            <li><p><strong>css_id</strong> – A string, an optional CSS id for the table object (only used for HTML).</p></li>
            <li><p><strong>css_class</strong> – A string, an optional CSS class for the table object (only used for HTML).</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/table.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">render_table</span><span class="p">(</span><span class="n">table_</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">output_format</span><span class="p">,</span> <span class="n">css_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">css_class</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Render the given table to the output file object in the requested format.</span>

<span class="sd">    The table gets written out to the &#39;output&#39; file.</span>

<span class="sd">    Args:</span>
<span class="sd">      table_: An instance of Table.</span>
<span class="sd">      output: A file object you can write to.</span>
<span class="sd">      output_format: A string, the format to write the table to,</span>
<span class="sd">        either &#39;csv&#39;, &#39;txt&#39; or &#39;html&#39;.</span>
<span class="sd">      css_id: A string, an optional CSS id for the table object (only used for HTML).</span>
<span class="sd">      css_class: A string, an optional CSS class for the table object (only used for HTML).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">output_format</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;txt&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">table_to_text</span><span class="p">(</span><span class="n">table_</span><span class="p">,</span> <span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="n">formats</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;*&quot;</span><span class="p">:</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;account&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;&quot;</span><span class="p">})</span>
        <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">output_format</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;csv&quot;</span><span class="p">,):</span>
        <span class="n">table_to_csv</span><span class="p">(</span><span class="n">table_</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">output_format</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;htmldiv&quot;</span><span class="p">,</span> <span class="s2">&quot;html&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s2">&quot;html&quot;</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&lt;html&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&lt;body&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;div id=&quot;</span><span class="si">{}</span><span class="s1">&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">css_id</span><span class="p">)</span> <span class="k">if</span> <span class="n">css_id</span> <span class="k">else</span> <span class="s2">&quot;&lt;div&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">css_class</span><span class="p">]</span> <span class="k">if</span> <span class="n">css_class</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">table_to_html</span><span class="p">(</span><span class="n">table_</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">output</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="n">classes</span><span class="p">)</span>
        <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&lt;/div&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s2">&quot;html&quot;</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&lt;/body&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&lt;/html&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Unsupported format: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_format</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.table.table_to_csv" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">table_to_csv</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#beancount.utils.table.table_to_csv" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Render a Table to a CSV file.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>table</strong> – An instance of a Table.</p></li>
            <li><p><strong>file</strong> – A file object to write to. If no object is provided, this
function returns a string.</p></li>
            <li><p><strong>**kwargs</strong> – Optional arguments forwarded to csv.writer().</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A string, the rendered table, or None, if a file object is provided
to write to.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/table.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">table_to_csv</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Render a Table to a CSV file.</span>

<span class="sd">    Args:</span>
<span class="sd">      table: An instance of a Table.</span>
<span class="sd">      file: A file object to write to. If no object is provided, this</span>
<span class="sd">        function returns a string.</span>
<span class="sd">      **kwargs: Optional arguments forwarded to csv.writer().</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, the rendered table, or None, if a file object is provided</span>
<span class="sd">      to write to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">output_file</span> <span class="o">=</span> <span class="n">file</span> <span class="ow">or</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>

    <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">table</span><span class="o">.</span><span class="n">header</span><span class="p">:</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>
    <span class="n">writer</span><span class="o">.</span><span class="n">writerows</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">file</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">output_file</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.table.table_to_html" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">table_to_html</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#beancount.utils.table.table_to_html" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Render a Table to HTML.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>table</strong> – An instance of a Table.</p></li>
            <li><p><strong>classes</strong> – A list of string, CSS classes to set on the table.</p></li>
            <li><p><strong>file</strong> – A file object to write to. If no object is provided, this
function returns a string.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A string, the rendered table, or None, if a file object is provided
to write to.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/table.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">table_to_html</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Render a Table to HTML.</span>

<span class="sd">    Args:</span>
<span class="sd">      table: An instance of a Table.</span>
<span class="sd">      classes: A list of string, CSS classes to set on the table.</span>
<span class="sd">      file: A file object to write to. If no object is provided, this</span>
<span class="sd">        function returns a string.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, the rendered table, or None, if a file object is provided</span>
<span class="sd">      to write to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Initialize file.</span>
    <span class="n">oss</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span> <span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">file</span>
    <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;table class=&quot;</span><span class="si">{}</span><span class="s1">&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">classes</span> <span class="ow">or</span> <span class="p">[])))</span>

    <span class="c1"># Render header.</span>
    <span class="k">if</span> <span class="n">table</span><span class="o">.</span><span class="n">header</span><span class="p">:</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  &lt;thead&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    &lt;tr&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">header</span><span class="p">:</span>
            <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;      &lt;th&gt;</span><span class="si">{}</span><span class="s2">&lt;/th&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">header</span><span class="p">))</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    &lt;/tr&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  &lt;/thead&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Render body.</span>
    <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  &lt;tbody&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    &lt;tr&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
            <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;      &lt;td&gt;</span><span class="si">{}</span><span class="s2">&lt;/td&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cell</span><span class="p">))</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    &lt;/tr&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  &lt;/tbody&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Render footer.</span>
    <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&lt;/table&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">oss</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.table.table_to_text" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">table_to_text</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">column_interspace</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">formats</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#beancount.utils.table.table_to_text" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Render a Table to ASCII text.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>table</strong> – An instance of a Table.</p></li>
            <li><p><strong>column_interspace</strong> – A string to render between the columns as spacer.</p></li>
            <li><p><strong>formats</strong> – An optional dict of column name to a format character that gets
inserted in a format string specified, like this (where '&lt;char&gt;' is):
{:&lt;char&gt;&lt;width&gt;}. A key of '<em>' will provide a default value, like
this, for example: (... formats={'</em>': '&gt;'}).</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A string, the rendered text table.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/table.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">table_to_text</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">column_interspace</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">formats</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Render a Table to ASCII text.</span>

<span class="sd">    Args:</span>
<span class="sd">      table: An instance of a Table.</span>
<span class="sd">      column_interspace: A string to render between the columns as spacer.</span>
<span class="sd">      formats: An optional dict of column name to a format character that gets</span>
<span class="sd">        inserted in a format string specified, like this (where &#39;&lt;char&gt;&#39; is):</span>
<span class="sd">        {:&lt;char&gt;&lt;width&gt;}. A key of &#39;*&#39; will provide a default value, like</span>
<span class="sd">        this, for example: (... formats={&#39;*&#39;: &#39;&gt;&#39;}).</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, the rendered text table.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">column_widths</span> <span class="o">=</span> <span class="n">compute_table_widths</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">([</span><span class="n">table</span><span class="o">.</span><span class="n">header</span><span class="p">],</span> <span class="n">table</span><span class="o">.</span><span class="n">body</span><span class="p">))</span>

    <span class="c1"># Insert column format chars and compute line formatting string.</span>
    <span class="n">column_formats</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">formats</span><span class="p">:</span>
        <span class="n">default_format</span> <span class="o">=</span> <span class="n">formats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">column</span><span class="p">,</span> <span class="n">width</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">column_widths</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">column</span> <span class="ow">and</span> <span class="n">formats</span><span class="p">:</span>
            <span class="n">format_</span> <span class="o">=</span> <span class="n">formats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">default_format</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">format_</span><span class="p">:</span>
                <span class="n">column_formats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{{:</span><span class="si">{}{:d}</span><span class="s2">}}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">format_</span><span class="p">,</span> <span class="n">width</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">column_formats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{{:</span><span class="si">{:d}</span><span class="s2">}}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">width</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">column_formats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{{:</span><span class="si">{:d}</span><span class="s2">}}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">width</span><span class="p">))</span>

    <span class="n">line_format</span> <span class="o">=</span> <span class="n">column_interspace</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">column_formats</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">separator</span> <span class="o">=</span> <span class="n">line_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="p">[(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span> <span class="k">for</span> <span class="n">width</span> <span class="ow">in</span> <span class="n">column_widths</span><span class="p">])</span>

    <span class="c1"># Render the header.</span>
    <span class="n">oss</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">table</span><span class="o">.</span><span class="n">header</span><span class="p">:</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">table</span><span class="o">.</span><span class="n">header</span><span class="p">))</span>

    <span class="c1"># Render the body.</span>
    <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">separator</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">row</span><span class="p">))</span>
    <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">separator</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">oss</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.utils.test_utils" class="doc doc-heading">
        <code>beancount.utils.test_utils</code>



<a href="#beancount.utils.test_utils" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Support utilities for testing scripts.</p>



  <div class="doc doc-children">









  <div class="doc doc-object doc-class">



<h3 id="beancount.utils.test_utils.ClickTestCase" class="doc doc-heading">
        <code>
beancount.utils.test_utils.ClickTestCase            (<a title="beancount.utils.test_utils.TestCase" href="#beancount.utils.test_utils.TestCase">TestCase</a>)
        </code>



<a href="#beancount.utils.test_utils.ClickTestCase" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Base class for command-line program test cases.</p>




  <div class="doc doc-children">












  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="beancount.utils.test_utils.RCall" class="doc doc-heading">
        <code>
beancount.utils.test_utils.RCall            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.utils.test_utils.RCall" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>RCall(args, kwargs, return_value)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.test_utils.RCall.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">test_utils</span><span class="o">.</span><span class="n">RCall</span><span class="o">.</span><span class="n">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.utils.test_utils.RCall.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return self as a plain tuple.  Used by copy and pickle.&#39;</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.test_utils.RCall.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">test_utils</span><span class="o">.</span><span class="n">RCall</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">return_value</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.utils.test_utils.RCall.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of RCall(args, kwargs, return_value)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.test_utils.RCall.__repr__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">test_utils</span><span class="o">.</span><span class="n">RCall</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.utils.test_utils.RCall.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return a nicely formatted representation string&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="beancount.utils.test_utils.TestCase" class="doc doc-heading">
        <code>
beancount.utils.test_utils.TestCase            (<span title="unittest.case.TestCase">TestCase</span>)
        </code>



<a href="#beancount.utils.test_utils.TestCase" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">





  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.test_utils.TestCase.assertLines" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">test_utils</span><span class="o">.</span><span class="n">TestCase</span><span class="o">.</span><span class="n">assertLines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#beancount.utils.test_utils.TestCase.assertLines" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Compare the lines of text1 and text2, ignoring whitespace.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>text1</strong> – A string, the expected text.</p></li>
            <li><p><strong>text2</strong> – A string, the actual text.</p></li>
            <li><p><strong>message</strong> – An optional string message in case the assertion fails.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>AssertionError</code> – If the exception fails.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">assertLines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compare the lines of text1 and text2, ignoring whitespace.</span>

<span class="sd">    Args:</span>
<span class="sd">      text1: A string, the expected text.</span>
<span class="sd">      text2: A string, the actual text.</span>
<span class="sd">      message: An optional string message in case the assertion fails.</span>
<span class="sd">    Raises:</span>
<span class="sd">      AssertionError: If the exception fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">clean_text1</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">text1</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="n">clean_text2</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">text2</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="n">lines1</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">clean_text1</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()]</span>
    <span class="n">lines2</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">clean_text2</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()]</span>

    <span class="c1"># Compress all space longer than 4 spaces to exactly 4.</span>
    <span class="c1"># This affords us to be even looser.</span>
    <span class="n">lines1</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;    [ </span><span class="se">\t</span><span class="s2">]*&quot;</span><span class="p">,</span> <span class="s2">&quot;    &quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines1</span><span class="p">]</span>
    <span class="n">lines2</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;    [ </span><span class="se">\t</span><span class="s2">]*&quot;</span><span class="p">,</span> <span class="s2">&quot;    &quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines2</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">lines1</span><span class="p">,</span> <span class="n">lines2</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.test_utils.TestCase.assertOutput" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">test_utils</span><span class="o">.</span><span class="n">TestCase</span><span class="o">.</span><span class="n">assertOutput</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expected_text</span><span class="p">)</span></code>


<a href="#beancount.utils.test_utils.TestCase.assertOutput" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Expect text printed to stdout.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>expected_text</strong> – A string, the text that should have been printed to stdout.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>AssertionError</code> – If the text differs.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">assertOutput</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expected_text</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Expect text printed to stdout.</span>

<span class="sd">    Args:</span>
<span class="sd">      expected_text: A string, the text that should have been printed to stdout.</span>
<span class="sd">    Raises:</span>
<span class="sd">      AssertionError: If the text differs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">capture</span><span class="p">()</span> <span class="k">as</span> <span class="n">oss</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">oss</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertLines</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">expected_text</span><span class="p">),</span> <span class="n">oss</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-class">



<h3 id="beancount.utils.test_utils.TmpFilesTestBase" class="doc doc-heading">
        <code>
beancount.utils.test_utils.TmpFilesTestBase            (<span title="unittest.case.TestCase">TestCase</span>)
        </code>



<a href="#beancount.utils.test_utils.TmpFilesTestBase" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A test utility base class that creates and cleans up a directory hierarchy.
This convenience is useful for testing functions that work on files, such as the
documents tests, or the accounts walk.</p>




  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.test_utils.TmpFilesTestBase.create_file_hierarchy" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">test_utils</span><span class="o">.</span><span class="n">TmpFilesTestBase</span><span class="o">.</span><span class="n">create_file_hierarchy</span><span class="p">(</span><span class="n">test_files</span><span class="p">,</span> <span class="n">subdir</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.utils.test_utils.TmpFilesTestBase.create_file_hierarchy" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>A test utility that creates a hierarchy of files.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>test_files</strong> – A list of strings, relative filenames to a temporary root
directory. If the filename ends with a '/', we create a directory;
otherwise, we create a regular file.</p></li>
            <li><p><strong>subdir</strong> – A string, the subdirectory name under the temporary directory
location, to create the hierarchy under.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A pair of strings, the temporary directory, and the subdirectory under
  that which hosts the root of the tree.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">create_file_hierarchy</span><span class="p">(</span><span class="n">test_files</span><span class="p">,</span> <span class="n">subdir</span><span class="o">=</span><span class="s2">&quot;root&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A test utility that creates a hierarchy of files.</span>

<span class="sd">    Args:</span>
<span class="sd">      test_files: A list of strings, relative filenames to a temporary root</span>
<span class="sd">        directory. If the filename ends with a &#39;/&#39;, we create a directory;</span>
<span class="sd">        otherwise, we create a regular file.</span>
<span class="sd">      subdir: A string, the subdirectory name under the temporary directory</span>
<span class="sd">        location, to create the hierarchy under.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A pair of strings, the temporary directory, and the subdirectory under</span>
<span class="sd">        that which hosts the root of the tree.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tempdir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;beancount-test-tmpdir.&quot;</span><span class="p">)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tempdir</span><span class="p">,</span> <span class="n">subdir</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">test_files</span><span class="p">:</span>
        <span class="n">abs_filename</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tempdir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">abs_filename</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parent_dir</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">abs_filename</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">parent_dir</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">parent_dir</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">abs_filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">):</span>
                <span class="k">pass</span>
    <span class="k">return</span> <span class="n">tempdir</span><span class="p">,</span> <span class="n">root</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.test_utils.TmpFilesTestBase.setUp" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">test_utils</span><span class="o">.</span><span class="n">TmpFilesTestBase</span><span class="o">.</span><span class="n">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#beancount.utils.test_utils.TmpFilesTestBase.setUp" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Hook method for setting up the test fixture before exercising it.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tempdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_file_hierarchy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TEST_DOCUMENTS</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.utils.test_utils.TmpFilesTestBase.tearDown" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">test_utils</span><span class="o">.</span><span class="n">TmpFilesTestBase</span><span class="o">.</span><span class="n">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#beancount.utils.test_utils.TmpFilesTestBase.tearDown" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Hook method for deconstructing the test fixture after testing it.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tempdir</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.test_utils.capture" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">test_utils</span><span class="o">.</span><span class="n">capture</span><span class="p">(</span><span class="o">*</span><span class="n">attributes</span><span class="p">)</span></code>


<a href="#beancount.utils.test_utils.capture" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A context manager that captures what's printed to stdout.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>*attributes</strong> – A tuple of strings, the name of the sys attributes to override
with StringIO instances.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  A StringIO string accumulator.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">capture</span><span class="p">(</span><span class="o">*</span><span class="n">attributes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A context manager that captures what&#39;s printed to stdout.</span>

<span class="sd">    Args:</span>
<span class="sd">      *attributes: A tuple of strings, the name of the sys attributes to override</span>
<span class="sd">        with StringIO instances.</span>
<span class="sd">    Yields:</span>
<span class="sd">      A StringIO string accumulator.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">attributes</span><span class="p">:</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="s2">&quot;stdout&quot;</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">patch</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="n">attributes</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.test_utils.create_temporary_files" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">test_utils</span><span class="o">.</span><span class="n">create_temporary_files</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">contents_map</span><span class="p">)</span></code>


<a href="#beancount.utils.test_utils.create_temporary_files" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Create a number of temporary files under 'root'.</p>
<p>This routine is used to initialize the contents of multiple files under a
temporary directory.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>root</strong> – A string, the name of the directory under which to create the files.</p></li>
            <li><p><strong>contents_map</strong> – A dict of relative filenames to their contents. The content
strings will be automatically dedented for convenience. In addition, the
string 'ROOT' in the contents will be automatically replaced by the root
directory name.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">create_temporary_files</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">contents_map</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a number of temporary files under &#39;root&#39;.</span>

<span class="sd">    This routine is used to initialize the contents of multiple files under a</span>
<span class="sd">    temporary directory.</span>

<span class="sd">    Args:</span>
<span class="sd">      root: A string, the name of the directory under which to create the files.</span>
<span class="sd">      contents_map: A dict of relative filenames to their contents. The content</span>
<span class="sd">        strings will be automatically dedented for convenience. In addition, the</span>
<span class="sd">        string &#39;ROOT&#39; in the contents will be automatically replaced by the root</span>
<span class="sd">        directory name.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">relative_filename</span><span class="p">,</span> <span class="n">contents</span> <span class="ow">in</span> <span class="n">contents_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">relative_filename</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">relative_filename</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">clean_contents</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">contents</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{root}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">root</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">clean_contents</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.test_utils.docfile" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">test_utils</span><span class="o">.</span><span class="n">docfile</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#beancount.utils.test_utils.docfile" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A decorator that write the function's docstring to a temporary file
and calls the decorated function with the temporary filename.  This is
useful for writing tests.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>function</strong> – A function to decorate.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>The decorated function.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">docfile</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A decorator that write the function&#39;s docstring to a temporary file</span>
<span class="sd">    and calls the decorated function with the temporary filename.  This is</span>
<span class="sd">    useful for writing tests.</span>

<span class="sd">    Args:</span>
<span class="sd">      function: A function to decorate.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The decorated function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">contents</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;contents&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">new_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">allowed</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;buffering&quot;</span><span class="p">,</span> <span class="s2">&quot;encoding&quot;</span><span class="p">,</span> <span class="s2">&quot;newline&quot;</span><span class="p">,</span> <span class="s2">&quot;dir&quot;</span><span class="p">,</span> <span class="s2">&quot;prefix&quot;</span><span class="p">,</span> <span class="s2">&quot;suffix&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowed</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid kwarg to docfile_extra&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">contents</span> <span class="ow">or</span> <span class="n">function</span><span class="o">.</span><span class="vm">__doc__</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
            <span class="n">file</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="n">new_function</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">new_function</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.test_utils.docfile_extra" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">test_utils</span><span class="o">.</span><span class="n">docfile_extra</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#beancount.utils.test_utils.docfile_extra" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A decorator identical to @docfile,
but it also takes kwargs for the temporary file,
Kwargs:
  e.g. buffering, encoding, newline, dir, prefix, and suffix.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>docfile</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">docfile_extra</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A decorator identical to @docfile,</span>
<span class="sd">    but it also takes kwargs for the temporary file,</span>
<span class="sd">    Kwargs:</span>
<span class="sd">      e.g. buffering, encoding, newline, dir, prefix, and suffix.</span>
<span class="sd">    Returns:</span>
<span class="sd">      docfile</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">docfile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.test_utils.environ" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">test_utils</span><span class="o">.</span><span class="n">environ</span><span class="p">(</span><span class="n">varname</span><span class="p">,</span> <span class="n">newvalue</span><span class="p">)</span></code>


<a href="#beancount.utils.test_utils.environ" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A context manager which pushes varname's value and restores it later.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>varname</strong> – A string, the environ variable name.</p></li>
            <li><p><strong>newvalue</strong> – A string, the desired value.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">environ</span><span class="p">(</span><span class="n">varname</span><span class="p">,</span> <span class="n">newvalue</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A context manager which pushes varname&#39;s value and restores it later.</span>

<span class="sd">    Args:</span>
<span class="sd">      varname: A string, the environ variable name.</span>
<span class="sd">      newvalue: A string, the desired value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">oldvalue</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">varname</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span> <span class="o">=</span> <span class="n">newvalue</span>
    <span class="k">yield</span>
    <span class="k">if</span> <span class="n">oldvalue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span> <span class="o">=</span> <span class="n">oldvalue</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.test_utils.find_python_lib" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">test_utils</span><span class="o">.</span><span class="n">find_python_lib</span><span class="p">()</span></code>


<a href="#beancount.utils.test_utils.find_python_lib" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Return the path to the root of the Python libraries.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A string, the root directory.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">find_python_lib</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the path to the root of the Python libraries.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A string, the root directory.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)))</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.test_utils.find_repository_root" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">test_utils</span><span class="o">.</span><span class="n">find_repository_root</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#beancount.utils.test_utils.find_repository_root" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Return the path to the repository root.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>filename</strong> – A string, the name of a file within the repository.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A string, the root directory.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">find_repository_root</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the path to the repository root.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: A string, the name of a file within the repository.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, the root directory.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="vm">__file__</span>

    <span class="c1"># Support root directory under Bazel.</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(.*\.runfiles/beancount)/&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">while</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;pyproject.toml&quot;</span><span class="p">)):</span>
        <span class="n">prev_filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prev_filename</span> <span class="o">==</span> <span class="n">filename</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Failed to find the root directory.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">filename</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.test_utils.make_failing_importer" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">test_utils</span><span class="o">.</span><span class="n">make_failing_importer</span><span class="p">(</span><span class="o">*</span><span class="n">removed_module_names</span><span class="p">)</span></code>


<a href="#beancount.utils.test_utils.make_failing_importer" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Make an importer that raise an ImportError for some modules.</p>
<p>Use it like this:</p>
<p>@mock.patch('builtins.<strong>import</strong>', make_failing_importer('setuptools'))
  def test_...</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>removed_module_name</strong> – The name of the module import that should raise an exception.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A decorated test decorator.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">make_failing_importer</span><span class="p">(</span><span class="o">*</span><span class="n">removed_module_names</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make an importer that raise an ImportError for some modules.</span>

<span class="sd">    Use it like this:</span>

<span class="sd">      @mock.patch(&#39;builtins.__import__&#39;, make_failing_importer(&#39;setuptools&#39;))</span>
<span class="sd">      def test_...</span>

<span class="sd">    Args:</span>
<span class="sd">      removed_module_name: The name of the module import that should raise an exception.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A decorated test decorator.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">failing_import</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">removed_module_names</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;Could not import </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">builtins</span><span class="o">.</span><span class="n">__import__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">failing_import</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.test_utils.nottest" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">test_utils</span><span class="o">.</span><span class="n">nottest</span><span class="p">(</span><span class="n">func</span><span class="p">)</span></code>


<a href="#beancount.utils.test_utils.nottest" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Make the given function not testable.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">nottest</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="s2">&quot;Make the given function not testable.&quot;</span>
    <span class="n">func</span><span class="o">.</span><span class="n">__test__</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">func</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.test_utils.patch" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">test_utils</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attributes</span><span class="p">,</span> <span class="n">replacement_type</span><span class="p">)</span></code>


<a href="#beancount.utils.test_utils.patch" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A context manager that temporarily patches an object's attributes.</p>
<p>All attributes in 'attributes' are saved and replaced by new instances
of type 'replacement_type'.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>obj</strong> – The object to patch up.</p></li>
            <li><p><strong>attributes</strong> – A string or a sequence of strings, the names of attributes to replace.</p></li>
            <li><p><strong>replacement_type</strong> – A callable to build replacement objects.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  An instance of a list of sequences of 'replacement_type'.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">patch</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attributes</span><span class="p">,</span> <span class="n">replacement_type</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A context manager that temporarily patches an object&#39;s attributes.</span>

<span class="sd">    All attributes in &#39;attributes&#39; are saved and replaced by new instances</span>
<span class="sd">    of type &#39;replacement_type&#39;.</span>

<span class="sd">    Args:</span>
<span class="sd">      obj: The object to patch up.</span>
<span class="sd">      attributes: A string or a sequence of strings, the names of attributes to replace.</span>
<span class="sd">      replacement_type: A callable to build replacement objects.</span>
<span class="sd">    Yields:</span>
<span class="sd">      An instance of a list of sequences of &#39;replacement_type&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">single</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">single</span><span class="p">:</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span><span class="n">attributes</span><span class="p">]</span>

    <span class="n">saved</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">replacements</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
        <span class="n">replacement</span> <span class="o">=</span> <span class="n">replacement_type</span><span class="p">()</span>
        <span class="n">replacements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">replacement</span><span class="p">)</span>
        <span class="n">saved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attribute</span><span class="p">))</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">replacement</span><span class="p">)</span>

    <span class="k">yield</span> <span class="n">replacements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">single</span> <span class="k">else</span> <span class="n">replacements</span>

    <span class="k">for</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">saved_attr</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">saved</span><span class="p">):</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">saved_attr</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.test_utils.record" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">test_utils</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">fun</span><span class="p">)</span></code>


<a href="#beancount.utils.test_utils.record" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Decorates the function to intercept and record all calls and return values.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>fun</strong> – A callable to be decorated.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A wrapper function with a .calls attribute, a list of RCall instances.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">record</span><span class="p">(</span><span class="n">fun</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decorates the function to intercept and record all calls and return values.</span>

<span class="sd">    Args:</span>
<span class="sd">      fun: A callable to be decorated.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A wrapper function with a .calls attribute, a list of RCall instances.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">fun</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">return_value</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="n">wrapped</span><span class="o">.</span><span class="n">calls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RCall</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kw</span><span class="p">,</span> <span class="n">return_value</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">return_value</span>

    <span class="n">wrapped</span><span class="o">.</span><span class="n">calls</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">return</span> <span class="n">wrapped</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.test_utils.search_words" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">test_utils</span><span class="o">.</span><span class="n">search_words</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span></code>


<a href="#beancount.utils.test_utils.search_words" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Search for a sequence of words in a line.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>words</strong> – A list of strings, the words to look for, or a space-separated string.</p></li>
            <li><p><strong>line</strong> – A string, the line to search into.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A MatchObject, or None.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">search_words</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Search for a sequence of words in a line.</span>

<span class="sd">    Args:</span>
<span class="sd">      words: A list of strings, the words to look for, or a space-separated string.</span>
<span class="sd">      line: A string, the line to search into.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A MatchObject, or None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">words</span> <span class="o">=</span> <span class="n">words</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;.*&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\b</span><span class="si">{}</span><span class="s2">\b&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">),</span> <span class="n">line</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.test_utils.skipIfRaises" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">test_utils</span><span class="o">.</span><span class="n">skipIfRaises</span><span class="p">(</span><span class="o">*</span><span class="n">exc_types</span><span class="p">)</span></code>


<a href="#beancount.utils.test_utils.skipIfRaises" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A context manager (or decorator) that skips a test if an exception is raised.</p>
      <p>Yields:
  Nothing, for you to execute the function code.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>SkipTest</code> – if the test raised the expected exception.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">skipIfRaises</span><span class="p">(</span><span class="o">*</span><span class="n">exc_types</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A context manager (or decorator) that skips a test if an exception is raised.</span>

<span class="sd">    Args:</span>
<span class="sd">      exc_type</span>
<span class="sd">    Yields:</span>
<span class="sd">      Nothing, for you to execute the function code.</span>
<span class="sd">    Raises:</span>
<span class="sd">      SkipTest: if the test raised the expected exception.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">except</span> <span class="n">exc_types</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">unittest</span><span class="o">.</span><span class="n">SkipTest</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.test_utils.subprocess_env" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">test_utils</span><span class="o">.</span><span class="n">subprocess_env</span><span class="p">()</span></code>


<a href="#beancount.utils.test_utils.subprocess_env" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Return a dict to use as environment for running subprocesses.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A string, the root directory.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">subprocess_env</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a dict to use as environment for running subprocesses.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A string, the root directory.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Ensure we have locations to invoke our Python executable and our</span>
    <span class="c1"># runnable binaries in the test environment to run subprocesses.</span>
    <span class="n">binpath</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">),</span>
            <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">find_repository_root</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s2">&quot;bin&quot;</span><span class="p">),</span>
            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;PATH&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;PATH&quot;</span><span class="p">:</span> <span class="n">binpath</span><span class="p">,</span> <span class="s2">&quot;PYTHONPATH&quot;</span><span class="p">:</span> <span class="n">find_python_lib</span><span class="p">()}</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.utils.test_utils.tempdir" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">test_utils</span><span class="o">.</span><span class="n">tempdir</span><span class="p">(</span><span class="n">delete</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></code>


<a href="#beancount.utils.test_utils.tempdir" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A context manager that creates a temporary directory and deletes its
contents unconditionally once done.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>delete</strong> – A boolean, true if we want to delete the directory after running.</p></li>
            <li><p><strong>**kw</strong> – Keyword arguments for mkdtemp.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  A string, the name of the temporary directory created.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">tempdir</span><span class="p">(</span><span class="n">delete</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A context manager that creates a temporary directory and deletes its</span>
<span class="sd">    contents unconditionally once done.</span>

<span class="sd">    Args:</span>
<span class="sd">      delete: A boolean, true if we want to delete the directory after running.</span>
<span class="sd">      **kw: Keyword arguments for mkdtemp.</span>
<span class="sd">    Yields:</span>
<span class="sd">      A string, the name of the temporary directory created.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tempdir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;beancount-test-tmpdir.&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">tempdir</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">delete</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">tempdir</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>




  </div>

    </div>

  </div>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="beancount.tools.html" class="btn btn-neutral" title="beancount.tools"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="beancount.tools.html" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
