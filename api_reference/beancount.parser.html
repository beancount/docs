<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="canonical" href="https://beancount.github.io/docs/api_reference/beancount.parser.html">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>beancount.parser - Beancount Documentation</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link href="../assets/_mkdocstrings.css" rel="stylesheet" />
  <link href="../css/custom.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "beancount.parser";
    var mkdocs_page_input_path = "api_reference/beancount.parser.md";
    var mkdocs_page_url = "/docs/api_reference/beancount.parser.html";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="icon icon-home"> Beancount Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../index.html">Index</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Outline</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="#">Documentation for Users</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../command_line_accounting_in_context.html">Command Line Accounting in Context</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../the_double_entry_counting_method.html">The Double Entry Counting Method</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../installing_beancount.html">Installing Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../running_beancount_and_generating_reports.html">Running Beancount and Generating Reports</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../getting_started_with_beancount.html">Getting Started with Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_language_syntax.html">Beancount Language Syntax</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_options_reference.html">Beancount Options Reference</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../precision_tolerances.html">Precision Tolerances</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_query_language.html">Beancount Query Language</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_cheat_sheet.html">Beancount Cheat Sheet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../how_inventories_work.html">How Inventories Work</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../exporting_your_portfolio.html">Exporting Your Portfolio</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../tutorial_example.html">Tutorial & Example</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_history_and_credits.html">Beancount History and Credits</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../a_comparison_of_beancount_and_ledger_hledger.html">A Comparison of Beancount and Ledger Hledger</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../fetching_prices_in_beancount.html">Fetching Prices in Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../importing_external_data.html">Importing External Data</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Cookbooks & Examples</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../command_line_accounting_cookbook.html">Command Line Accounting Cookbook</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../trading_with_beancount.html">Trading with Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../stock_vesting_in_beancount.html">Stock Vesting in Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../sharing_expenses_with_beancount.html">Sharing Expenses with Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../how_we_share_expenses.html">How We Share Expenses</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../health_care_expenses.html">Health Care Expenses</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../calculating_portolio_returns.html">Calculating Portfolio Returns</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../tracking_medical_claims.html">Tracking Out-of-Network Medical Claims in Beancount</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Documentation for Developers</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_scripting_plugins.html">Beancount Scripting Plugins</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_design_doc.html">Beancount Design Doc</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ledgerhub_design_doc.html">Ledgerhub Design Doc</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../external_contributions.html">External Contributions</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Enhancement Proposals & Discussions</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../a_proposal_for_an_improvement_on_inventory_booking.html">A Proposal for an Improvement on Inventory Booking</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../settlement_dates_in_beancount.html">Settlement Dates in Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../balance_assertions_in_beancount.html">Balance Assertions in Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../fund_accounting_with_beancount.html">Fund Accounting with Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../rounding_precision_in_beancount.html">Rounding Precision in Beancount</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Beancount 3</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_v3.html">Goals & Design</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../installing_beancount_v3.html">Installing Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_v3_dependencies.html">Dependencies</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beangulp.html">Beangulp</a>
                </li>
    </ul>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">API reference</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="index.html">beancount</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.core.html">beancount.core</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.loader.html">beancount.loader</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.ops.html">beancount.ops</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="beancount.parser.html">beancount.parser</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#beancount.parser">beancount.parser</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.parser.booking">booking</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking.BookingError">BookingError</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking.BookingError.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking.BookingError.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking.BookingError.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking.book">book()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking.convert_lot_specs_to_lots">convert_lot_specs_to_lots()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking.convert_spec_to_cost">convert_spec_to_cost()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking.validate_inventory_booking">validate_inventory_booking()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking.validate_missing_eliminated">validate_missing_eliminated()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.parser.booking_full">booking_full</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full.CategorizationError">CategorizationError</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_full.CategorizationError.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_full.CategorizationError.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_full.CategorizationError.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full.InterpolationError">InterpolationError</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_full.InterpolationError.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_full.InterpolationError.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_full.InterpolationError.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full.MissingType">MissingType</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full.ReductionError">ReductionError</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_full.ReductionError.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_full.ReductionError.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_full.ReductionError.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full.Refer">Refer</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_full.Refer.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_full.Refer.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_full.Refer.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full.SelfReduxError">SelfReduxError</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_full.SelfReduxError.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_full.SelfReduxError.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_full.SelfReduxError.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full.book">book()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full.book_reductions">book_reductions()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full.categorize_by_currency">categorize_by_currency()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full.compute_cost_number">compute_cost_number()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full.convert_costspec_to_cost">convert_costspec_to_cost()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full.get_bucket_currency">get_bucket_currency()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full.has_self_reduction">has_self_reduction()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full.interpolate_group">interpolate_group()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full.replace_currencies">replace_currencies()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full.unique_label">unique_label()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.parser.booking_method">booking_method</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_method.AmbiguousMatchError">AmbiguousMatchError</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_method.AmbiguousMatchError.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_method.AmbiguousMatchError.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_method.AmbiguousMatchError.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_method.booking_method_AVERAGE">booking_method_AVERAGE()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_method.booking_method_FIFO">booking_method_FIFO()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_method.booking_method_HIFO">booking_method_HIFO()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_method.booking_method_LIFO">booking_method_LIFO()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_method.booking_method_NONE">booking_method_NONE()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_method.booking_method_STRICT">booking_method_STRICT()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_method.booking_method_STRICT_WITH_SIZE">booking_method_STRICT_WITH_SIZE()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_method.handle_ambiguous_matches">handle_ambiguous_matches()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.parser.cmptest">cmptest</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.cmptest.TestCase">TestCase</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.cmptest.TestCase.assertEqualEntries">assertEqualEntries()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.cmptest.TestCase.assertExcludesEntries">assertExcludesEntries()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.cmptest.TestCase.assertIncludesEntries">assertIncludesEntries()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.cmptest.TestError">TestError</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.cmptest.read_string_or_entries">read_string_or_entries()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.parser.context">context</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.context.render_entry_context">render_entry_context()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.context.render_file_context">render_file_context()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.parser.grammar">grammar</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.grammar.Builder">Builder</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.account">account()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.amount">amount()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.balance">balance()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.build_grammar_error">build_grammar_error()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.close">close()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.commodity">commodity()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.compound_amount">compound_amount()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.cost_merge">cost_merge()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.cost_spec">cost_spec()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.custom">custom()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.custom_value">custom_value()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.document">document()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.event">event()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.finalize">finalize()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.get_entries">get_entries()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.get_long_string_maxlines">get_long_string_maxlines()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.get_options">get_options()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.handle_list">handle_list()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.include">include()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.key_value">key_value()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.note">note()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.open">open()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.option">option()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.pad">pad()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.pipe_deprecated_error">pipe_deprecated_error()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.plugin">plugin()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.popmeta">popmeta()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.poptag">poptag()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.posting">posting()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.price">price()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.pushmeta">pushmeta()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.pushtag">pushtag()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.query">query()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.store_result">store_result()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.tag_link_LINK">tag_link_LINK()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.tag_link_TAG">tag_link_TAG()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.tag_link_new">tag_link_new()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.transaction">transaction()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.grammar.CompoundAmount">CompoundAmount</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.CompoundAmount.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.CompoundAmount.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.CompoundAmount.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.grammar.DeprecatedError">DeprecatedError</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.DeprecatedError.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.DeprecatedError.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.DeprecatedError.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.grammar.KeyValue">KeyValue</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.KeyValue.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.KeyValue.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.KeyValue.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.grammar.ParserError">ParserError</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.ParserError.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.ParserError.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.ParserError.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.grammar.ParserSyntaxError">ParserSyntaxError</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.ParserSyntaxError.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.ParserSyntaxError.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.ParserSyntaxError.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.grammar.TagsLinks">TagsLinks</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.TagsLinks.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.TagsLinks.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.TagsLinks.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.grammar.ValueType">ValueType</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.ValueType.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.ValueType.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.ValueType.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.grammar.valid_account_regexp">valid_account_regexp()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.parser.hashsrc">hashsrc</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.hashsrc.check_parser_source_files">check_parser_source_files()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.hashsrc.gen_include">gen_include()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.hashsrc.hash_parser_source_files">hash_parser_source_files()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.parser.lexer">lexer</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.lexer.LexBuilder">LexBuilder</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.lexer.LexBuilder.build_lexer_error">build_lexer_error()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.lexer.LexerError">LexerError</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.lexer.LexerError.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.lexer.LexerError.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.lexer.LexerError.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.lexer.lex_iter">lex_iter()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.lexer.lex_iter_string">lex_iter_string()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.parser.options">options</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.options.OptDesc">OptDesc</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.options.OptDesc.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.options.OptDesc.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.options.OptDesc.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.options.OptGroup">OptGroup</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.options.OptGroup.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.options.OptGroup.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.options.OptGroup.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.options.Opt">Opt()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.options.get_account_types">get_account_types()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.options.get_current_accounts">get_current_accounts()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.options.get_previous_accounts">get_previous_accounts()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.options.get_unrealized_account">get_unrealized_account()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.options.list_options">list_options()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.options.options_validate_booking_method">options_validate_booking_method()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.options.options_validate_boolean">options_validate_boolean()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.options.options_validate_plugin">options_validate_plugin()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.options.options_validate_processing_mode">options_validate_processing_mode()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.options.options_validate_tolerance">options_validate_tolerance()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.options.options_validate_tolerance_map">options_validate_tolerance_map()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.parser.parser">parser</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.parser.is_entry_incomplete">is_entry_incomplete()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.parser.is_posting_incomplete">is_posting_incomplete()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.parser.parse_doc">parse_doc()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.parser.parse_file">parse_file()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.parser.parse_many">parse_many()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.parser.parse_one">parse_one()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.parser.parse_string">parse_string()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.parser.printer">printer</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.printer.EntryPrinter">EntryPrinter</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.printer.EntryPrinter.__call__">__call__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.printer.EntryPrinter.render_posting_strings">render_posting_strings()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.printer.EntryPrinter.write_entry_source">write_entry_source()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.parser.printer.EntryPrinter.write_metadata">write_metadata()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.printer.align_position_strings">align_position_strings()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.printer.format_entry">format_entry()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.printer.format_error">format_error()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.printer.print_entries">print_entries()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.printer.print_entry">print_entry()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.printer.print_error">print_error()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.printer.print_errors">print_errors()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.printer.render_flag">render_flag()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.printer.render_source">render_source()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.parser.version">version</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.parser.version.compute_version_string">compute_version_string()</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.plugins.html">beancount.plugins</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.scripts.html">beancount.scripts</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.tools.html">beancount.tools</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.utils.html">beancount.utils</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Beancount Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
    
      
        
          <li>API reference &raquo;</li>
        
      
    
    <li>beancount.parser</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h1 id="beancountparser">beancount.parser<a class="headerlink" href="#beancountparser" title="Permanent link"></a></h1>


  <div class="doc doc-object doc-module">

<a id="beancount.parser"></a>
    <div class="doc doc-contents first">

      <p>Parser module for beancount input files.</p>



  <div class="doc doc-children">












  <div class="doc doc-object doc-module">



<h2 id="beancount.parser.booking" class="doc doc-heading">
        <code>beancount.parser.booking</code>



<a href="#beancount.parser.booking" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Algorithms for 'booking' inventory, that is, the process of finding a
matching lot when reducing the content of an inventory.</p>



  <div class="doc doc-children">









  <div class="doc doc-object doc-class">



<h3 id="beancount.parser.booking.BookingError" class="doc doc-heading">
        <code>
beancount.parser.booking.BookingError            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.parser.booking.BookingError" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>BookingError(source, message, entry)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.booking.BookingError.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking</span><span class="o">.</span><span class="n">BookingError</span><span class="o">.</span><span class="n">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.parser.booking.BookingError.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/booking.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return self as a plain tuple.  Used by copy and pickle.&#39;</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.booking.BookingError.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking</span><span class="o">.</span><span class="n">BookingError</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.parser.booking.BookingError.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of BookingError(source, message, entry)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.booking.BookingError.__repr__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking</span><span class="o">.</span><span class="n">BookingError</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.parser.booking.BookingError.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/booking.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return a nicely formatted representation string&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.booking.book" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking</span><span class="o">.</span><span class="n">book</span><span class="p">(</span><span class="n">incomplete_entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="n">initial_balances</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#beancount.parser.booking.book" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Book inventory lots and complete all positions with incomplete numbers.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>incomplete_entries</strong> – A list of directives, with some postings possibly left
with incomplete amounts as produced by the parser.</p></li>
            <li><p><strong>options_map</strong> – An options dict as produced by the parser.</p></li>
            <li><p><strong>initial_balances</strong> – A dict of (account, inventory) pairs to start booking from.
This is useful when attempting to book on top of an existing state.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>A pair of
  entries</code> – A list of completed entries with all their postings completed.
  errors: New errors produced during interpolation.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/booking.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">book</span><span class="p">(</span><span class="n">incomplete_entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="n">initial_balances</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Book inventory lots and complete all positions with incomplete numbers.</span>

<span class="sd">    Args:</span>
<span class="sd">      incomplete_entries: A list of directives, with some postings possibly left</span>
<span class="sd">        with incomplete amounts as produced by the parser.</span>
<span class="sd">      options_map: An options dict as produced by the parser.</span>
<span class="sd">      initial_balances: A dict of (account, inventory) pairs to start booking from.</span>
<span class="sd">        This is useful when attempting to book on top of an existing state.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A pair of</span>
<span class="sd">        entries: A list of completed entries with all their postings completed.</span>
<span class="sd">        errors: New errors produced during interpolation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get the list of booking methods for each account.</span>
    <span class="n">booking_methods</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">options_map</span><span class="p">[</span><span class="s2">&quot;booking_method&quot;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">incomplete_entries</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Open</span><span class="p">)</span> <span class="ow">and</span> <span class="n">entry</span><span class="o">.</span><span class="n">booking</span><span class="p">:</span>
            <span class="n">booking_methods</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">account</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">booking</span>

    <span class="c1"># Do the booking here!</span>
    <span class="n">entries</span><span class="p">,</span> <span class="n">booking_errors</span> <span class="o">=</span> <span class="n">booking_full</span><span class="o">.</span><span class="n">book</span><span class="p">(</span>
        <span class="n">incomplete_entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="n">booking_methods</span><span class="p">,</span> <span class="n">initial_balances</span>
    <span class="p">)</span>

    <span class="c1"># Check for MISSING elements remaining.</span>
    <span class="n">missing_errors</span> <span class="o">=</span> <span class="n">validate_missing_eliminated</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">entries</span><span class="p">,</span> <span class="p">(</span><span class="n">booking_errors</span> <span class="o">+</span> <span class="n">missing_errors</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.booking.convert_lot_specs_to_lots" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking</span><span class="o">.</span><span class="n">convert_lot_specs_to_lots</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span></code>


<a href="#beancount.parser.booking.convert_lot_specs_to_lots" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>For all the entries, convert the posting's position's CostSpec to Cost
instances. In the simple method, the data provided in the CostSpec must
unambiguously provide a way to compute the cost amount.</p>
<p>This essentially replicates the way the old parser used to work, but
allowing positions to have the fuzzy lot specifications instead of the
resolved ones. We used to simply compute the costs locally, and this gets
rid of the CostSpec to produce the Cost without fuzzy matching. This is only
there for the sake of transition to the new matching logic.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of incomplete directives as per the parser.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of entries whose postings's position costs have been converted to
Cost instances but that may still be incomplete.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>ValueError</code> – If there's a unacceptable number.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/booking.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">convert_lot_specs_to_lots</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;For all the entries, convert the posting&#39;s position&#39;s CostSpec to Cost</span>
<span class="sd">    instances. In the simple method, the data provided in the CostSpec must</span>
<span class="sd">    unambiguously provide a way to compute the cost amount.</span>

<span class="sd">    This essentially replicates the way the old parser used to work, but</span>
<span class="sd">    allowing positions to have the fuzzy lot specifications instead of the</span>
<span class="sd">    resolved ones. We used to simply compute the costs locally, and this gets</span>
<span class="sd">    rid of the CostSpec to produce the Cost without fuzzy matching. This is only</span>
<span class="sd">    there for the sake of transition to the new matching logic.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of incomplete directives as per the parser.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of entries whose postings&#39;s position costs have been converted to</span>
<span class="sd">      Cost instances but that may still be incomplete.</span>
<span class="sd">    Raises:</span>
<span class="sd">      ValueError: If there&#39;s a unacceptable number.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">new_entries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Transaction</span><span class="p">):</span>
            <span class="n">new_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="n">new_postings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">units</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span>
                <span class="n">cost_spec</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span>
                <span class="n">cost</span> <span class="o">=</span> <span class="n">convert_spec_to_cost</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">cost_spec</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cost_spec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">cost</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">BookingError</span><span class="p">(</span>
                            <span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="s2">&quot;Cost syntax not supported; cost spec ignored&quot;</span><span class="p">,</span> <span class="kc">None</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

                <span class="k">if</span> <span class="n">cost</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">amount</span><span class="o">.</span><span class="n">Amount</span><span class="p">):</span>
                    <span class="c1"># If there is a cost, we don&#39;t allow either a cost value of</span>
                    <span class="c1"># zero, nor a zero number of units. Note that we allow a price</span>
                    <span class="c1"># of zero as the only special case (for conversion entries), but</span>
                    <span class="c1"># never for costs.</span>
                    <span class="k">if</span> <span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="o">==</span> <span class="n">ZERO</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Amount is zero: &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">units</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">cost</span><span class="o">.</span><span class="n">number</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">cost</span><span class="o">.</span><span class="n">number</span> <span class="o">&lt;</span> <span class="n">ZERO</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cost is negative: &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cost</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BookingError</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span> <span class="kc">None</span><span class="p">))</span>
                <span class="n">cost</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">new_postings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">cost</span><span class="o">=</span><span class="n">cost</span><span class="p">))</span>
        <span class="n">new_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">postings</span><span class="o">=</span><span class="n">new_postings</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">new_entries</span><span class="p">,</span> <span class="n">errors</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.booking.convert_spec_to_cost" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking</span><span class="o">.</span><span class="n">convert_spec_to_cost</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">cost_spec</span><span class="p">)</span></code>


<a href="#beancount.parser.booking.convert_spec_to_cost" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Convert a posting's CostSpec instance to a Cost.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>units</strong> – An instance of Amount.</p></li>
            <li><p><strong>cost_spec</strong> – An instance of CostSpec.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>An instance of Cost.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/booking.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">convert_spec_to_cost</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">cost_spec</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a posting&#39;s CostSpec instance to a Cost.</span>

<span class="sd">    Args:</span>
<span class="sd">      units: An instance of Amount.</span>
<span class="sd">      cost_spec: An instance of CostSpec.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An instance of Cost.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cost</span> <span class="o">=</span> <span class="n">cost_spec</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">amount</span><span class="o">.</span><span class="n">Amount</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cost_spec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">number_per</span><span class="p">,</span> <span class="n">number_total</span><span class="p">,</span> <span class="n">cost_currency</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">merge</span> <span class="o">=</span> <span class="n">cost_spec</span>

            <span class="c1"># Compute the cost.</span>
            <span class="k">if</span> <span class="n">number_per</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">MISSING</span> <span class="ow">or</span> <span class="n">number_total</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">number_total</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># Compute the per-unit cost if there is some total cost</span>
                    <span class="c1"># component involved.</span>
                    <span class="n">units_num</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">number</span>
                    <span class="n">cost_total</span> <span class="o">=</span> <span class="n">number_total</span>
                    <span class="k">if</span> <span class="n">number_per</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">MISSING</span><span class="p">:</span>
                        <span class="n">cost_total</span> <span class="o">+=</span> <span class="n">number_per</span> <span class="o">*</span> <span class="n">units_num</span>
                    <span class="n">unit_cost</span> <span class="o">=</span> <span class="n">cost_total</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">units_num</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">unit_cost</span> <span class="o">=</span> <span class="n">number_per</span>
                <span class="n">cost</span> <span class="o">=</span> <span class="n">position</span><span class="o">.</span><span class="n">Cost</span><span class="p">(</span><span class="n">unit_cost</span><span class="p">,</span> <span class="n">cost_currency</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cost</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">cost</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.booking.validate_inventory_booking" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking</span><span class="o">.</span><span class="n">validate_inventory_booking</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">unused_options_map</span><span class="p">,</span> <span class="n">booking_methods</span><span class="p">)</span></code>


<a href="#beancount.parser.booking.validate_inventory_booking" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Validate that no position at cost is allowed to go negative.</p>
<p>This routine checks that when a posting reduces a position, existing or not,
that the subsequent inventory does not result in a position with a negative
number of units. A negative number of units would only be required for short
trades of trading spreads on futures, and right now this is not supported.
It would not be difficult to support this, however, but we want to be strict
about it, because being pedantic about this is otherwise a great way to
detect user data entry mistakes.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives.</p></li>
            <li><p><strong>unused_options_map</strong> – An options map.</p></li>
            <li><p><strong>booking_methods</strong> – A mapping of account name to booking method, accumulated
in the main loop.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of errors.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/booking.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">validate_inventory_booking</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">unused_options_map</span><span class="p">,</span> <span class="n">booking_methods</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate that no position at cost is allowed to go negative.</span>

<span class="sd">    This routine checks that when a posting reduces a position, existing or not,</span>
<span class="sd">    that the subsequent inventory does not result in a position with a negative</span>
<span class="sd">    number of units. A negative number of units would only be required for short</span>
<span class="sd">    trades of trading spreads on futures, and right now this is not supported.</span>
<span class="sd">    It would not be difficult to support this, however, but we want to be strict</span>
<span class="sd">    about it, because being pedantic about this is otherwise a great way to</span>
<span class="sd">    detect user data entry mistakes.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      unused_options_map: An options map.</span>
<span class="sd">      booking_methods: A mapping of account name to booking method, accumulated</span>
<span class="sd">        in the main loop.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of errors.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">balances</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Transaction</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">:</span>
                <span class="c1"># Update the balance of each posting on its respective account</span>
                <span class="c1"># without allowing booking to a negative position, and if an error</span>
                <span class="c1"># is encountered, catch it and return it.</span>
                <span class="n">running_balance</span> <span class="o">=</span> <span class="n">balances</span><span class="p">[</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">]</span>
                <span class="n">position_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">running_balance</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">posting</span><span class="p">)</span>

                <span class="c1"># Skip this check if the booking method is set to ignore it.</span>
                <span class="k">if</span> <span class="n">booking_methods</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="n">data</span><span class="o">.</span><span class="n">Booking</span><span class="o">.</span><span class="n">NONE</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c1"># Check if the resulting inventory is mixed, which is not</span>
                <span class="c1"># allowed under the STRICT method.</span>
                <span class="k">if</span> <span class="n">running_balance</span><span class="o">.</span><span class="n">is_mixed</span><span class="p">():</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">BookingError</span><span class="p">(</span>
                            <span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
                            <span class="p">(</span>
                                <span class="s2">&quot;Reducing position results in inventory with positive &quot;</span>
                                <span class="s2">&quot;and negative lots: </span><span class="si">{}</span><span class="s2">&quot;</span>
                            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">position_</span><span class="p">),</span>
                            <span class="n">entry</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

    <span class="k">return</span> <span class="n">errors</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.booking.validate_missing_eliminated" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking</span><span class="o">.</span><span class="n">validate_missing_eliminated</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">unused_options_map</span><span class="p">)</span></code>


<a href="#beancount.parser.booking.validate_missing_eliminated" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Validate that all the missing bits of postings have been eliminated.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives.</p></li>
            <li><p><strong>unused_options_map</strong> – An options map.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of errors.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/booking.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">validate_missing_eliminated</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">unused_options_map</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate that all the missing bits of postings have been eliminated.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      unused_options_map: An options map.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of errors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Transaction</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">:</span>
                <span class="n">units</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span>
                <span class="n">cost</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">MISSING</span> <span class="ow">in</span> <span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">units</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
                    <span class="ow">or</span> <span class="n">cost</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="ow">and</span> <span class="n">MISSING</span> <span class="ow">in</span> <span class="p">(</span><span class="n">cost</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">cost</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="n">cost</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">cost</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
                <span class="p">):</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">BookingError</span><span class="p">(</span>
                            <span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="s2">&quot;Transaction has incomplete elements&quot;</span><span class="p">,</span> <span class="n">entry</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="k">break</span>
    <span class="k">return</span> <span class="n">errors</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.parser.booking_full" class="doc doc-heading">
        <code>beancount.parser.booking_full</code>



<a href="#beancount.parser.booking_full" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Full (new) booking implementation.</p>
<p>Problem description:</p>
<p>Interpolation and booking feed on each other, that is, numbers filled in from
interpolation might affect the booking process, and numbers derived from the
booking process may help carry out interpolation that would otherwise be
under-defined. Here's an example of interpolation helping the booking process:</p>
<p>Assume the ante-inventory of Assets:Investments contains two lots of shares of
HOOL, one at 100.00 USD and the other at 101.00 USD and apply this transaction:</p>
<pre><code>2015-09-30 *
  Assets:Investments   -10 HOOL {USD}
  Assets:Cash               1000 USD
  Income:Gains              -200 USD
</code></pre>
<p>Interpolation is unambiguously able to back out a cost of 100 USD / HOOL, which
would then result in an unambiguous booking result.</p>
<p>On the other hand, consider this transaction:</p>
<pre><code>2015-09-30 *
  Assets:Investments    -10 HOOL {USD}
  Assets:Cash               1000 USD
  Income:Gains
</code></pre>
<p>Now the interpolation cannot succeed. If the Assets:Investments account is
configured to use the FIFO method, the 10 oldest shares would be selected for
the cost, and we could then interpolate the capital gains correctly.</p>
<p>First observation: The second case is much more frequent than the first, and the
first is easily resolved manually by requiring a particular cost be specified.
Moreover, in many cases there isn't just a single lot of shares to be reduced
from and figuring out the correct set of shares given a target cost is an
underspecified problem.</p>
<p>Second observation: Booking can only be achieved for inventory reductions, not
for augmentations. Therefore, we should carry out booking on inventory
reductions and fail early if reduction is undefined there, and leave inventory
augmentations with missing numbers undefined, so that interpolation can fill
them in at a later stage.</p>
<p>Note that one case we'd like to but may not be able to handle is of a reduction
with interpolated price, like this:</p>
<pre><code>2015-09-30 *
  Assets:Investments        -10 HOOL {100.00 # USD}
  Expenses:Commission      9.95 USD
  Assets:Cash            990.05 USD
</code></pre>
<p>Therefore we choose to</p>
<p>1) Carry out booking first, on inventory reductions only, and leave inventory
   augmentations as they are, possibly undefined. The 'cost' attributed of
   booked postings are converted from CostSpec to Cost. Augmented postings with
   missing amounts are left as CostSpec instances in order to allow for
   interpolation of total vs. per-unit amount.</p>
<p>2) Compute interpolations on the resulting postings. Undefined costs for
   inventory augmentations may be filled in by interpolations at this stage (if
   possible).</p>
<p>3) Finally, convert the interpolated CostSpec instances to Cost instances.</p>
<p>Improving on this algorithm would require running a loop over the booking and
interpolation steps until all numbers are resolved or no more inference can
occur. We may consider that for later, as an experimental feature. My hunch is
that there are so few cases for which this would be useful that we won't bother
improving on the algorithm above.</p>



  <div class="doc doc-children">









  <div class="doc doc-object doc-class">



<h3 id="beancount.parser.booking_full.CategorizationError" class="doc doc-heading">
        <code>
beancount.parser.booking_full.CategorizationError            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.parser.booking_full.CategorizationError" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>CategorizationError(source, message, entry)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.booking_full.CategorizationError.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking_full</span><span class="o">.</span><span class="n">CategorizationError</span><span class="o">.</span><span class="n">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.parser.booking_full.CategorizationError.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return self as a plain tuple.  Used by copy and pickle.&#39;</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.booking_full.CategorizationError.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking_full</span><span class="o">.</span><span class="n">CategorizationError</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.parser.booking_full.CategorizationError.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of CategorizationError(source, message, entry)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.booking_full.CategorizationError.__repr__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking_full</span><span class="o">.</span><span class="n">CategorizationError</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.parser.booking_full.CategorizationError.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return a nicely formatted representation string&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="beancount.parser.booking_full.InterpolationError" class="doc doc-heading">
        <code>
beancount.parser.booking_full.InterpolationError            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.parser.booking_full.InterpolationError" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>InterpolationError(source, message, entry)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.booking_full.InterpolationError.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking_full</span><span class="o">.</span><span class="n">InterpolationError</span><span class="o">.</span><span class="n">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.parser.booking_full.InterpolationError.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return self as a plain tuple.  Used by copy and pickle.&#39;</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.booking_full.InterpolationError.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking_full</span><span class="o">.</span><span class="n">InterpolationError</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.parser.booking_full.InterpolationError.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of InterpolationError(source, message, entry)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.booking_full.InterpolationError.__repr__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking_full</span><span class="o">.</span><span class="n">InterpolationError</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.parser.booking_full.InterpolationError.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return a nicely formatted representation string&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="beancount.parser.booking_full.MissingType" class="doc doc-heading">
        <code>
beancount.parser.booking_full.MissingType            (<span title="enum.Enum">Enum</span>)
        </code>



<a href="#beancount.parser.booking_full.MissingType" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>The type of missing number.</p>




  <div class="doc doc-children">















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="beancount.parser.booking_full.ReductionError" class="doc doc-heading">
        <code>
beancount.parser.booking_full.ReductionError            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.parser.booking_full.ReductionError" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>ReductionError(source, message, entry)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.booking_full.ReductionError.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking_full</span><span class="o">.</span><span class="n">ReductionError</span><span class="o">.</span><span class="n">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.parser.booking_full.ReductionError.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return self as a plain tuple.  Used by copy and pickle.&#39;</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.booking_full.ReductionError.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking_full</span><span class="o">.</span><span class="n">ReductionError</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.parser.booking_full.ReductionError.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of ReductionError(source, message, entry)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.booking_full.ReductionError.__repr__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking_full</span><span class="o">.</span><span class="n">ReductionError</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.parser.booking_full.ReductionError.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return a nicely formatted representation string&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="beancount.parser.booking_full.Refer" class="doc doc-heading">
        <code>
beancount.parser.booking_full.Refer            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.parser.booking_full.Refer" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Refer(index, units_currency, cost_currency, price_currency)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.booking_full.Refer.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking_full</span><span class="o">.</span><span class="n">Refer</span><span class="o">.</span><span class="n">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.parser.booking_full.Refer.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return self as a plain tuple.  Used by copy and pickle.&#39;</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.booking_full.Refer.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking_full</span><span class="o">.</span><span class="n">Refer</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">units_currency</span><span class="p">,</span> <span class="n">cost_currency</span><span class="p">,</span> <span class="n">price_currency</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.parser.booking_full.Refer.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of Refer(index, units_currency, cost_currency, price_currency)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.booking_full.Refer.__repr__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking_full</span><span class="o">.</span><span class="n">Refer</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.parser.booking_full.Refer.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return a nicely formatted representation string&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="beancount.parser.booking_full.SelfReduxError" class="doc doc-heading">
        <code>
beancount.parser.booking_full.SelfReduxError            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.parser.booking_full.SelfReduxError" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>SelfReduxError(source, message, entry)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.booking_full.SelfReduxError.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking_full</span><span class="o">.</span><span class="n">SelfReduxError</span><span class="o">.</span><span class="n">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.parser.booking_full.SelfReduxError.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return self as a plain tuple.  Used by copy and pickle.&#39;</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.booking_full.SelfReduxError.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking_full</span><span class="o">.</span><span class="n">SelfReduxError</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.parser.booking_full.SelfReduxError.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of SelfReduxError(source, message, entry)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.booking_full.SelfReduxError.__repr__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking_full</span><span class="o">.</span><span class="n">SelfReduxError</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.parser.booking_full.SelfReduxError.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return a nicely formatted representation string&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.booking_full.book" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking_full</span><span class="o">.</span><span class="n">book</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="n">methods</span><span class="p">,</span> <span class="n">initial_balances</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#beancount.parser.booking_full.book" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Interpolate missing data from the entries using the full historical algorithm.
See the internal implementation _book() for details.
This method only stripes some of the return values.</p>
<p>See _book() for arguments and return values.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">book</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="n">methods</span><span class="p">,</span> <span class="n">initial_balances</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interpolate missing data from the entries using the full historical algorithm.</span>
<span class="sd">    See the internal implementation _book() for details.</span>
<span class="sd">    This method only stripes some of the return values.</span>

<span class="sd">    See _book() for arguments and return values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_book</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="n">methods</span><span class="p">,</span> <span class="n">initial_balances</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.booking_full.book_reductions" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking_full</span><span class="o">.</span><span class="n">book_reductions</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">group_postings</span><span class="p">,</span> <span class="n">balances</span><span class="p">,</span> <span class="n">methods</span><span class="p">)</span></code>


<a href="#beancount.parser.booking_full.book_reductions" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Book inventory reductions against the ante-balances.</p>
<p>This function accepts a dict of (account, Inventory balance) and for each
posting that is a reduction against its inventory, attempts to find a
corresponding lot or list of lots to reduce the balance with.</p>
<ul>
<li>
<p>For reducing lots, the CostSpec instance of the posting is replaced by a
  Cost instance.</p>
</li>
<li>
<p>For augmenting lots, the CostSpec instance of the posting is left alone,
  except for its date, which is inherited from the parent Transaction.</p>
</li>
</ul>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entry</strong> – An instance of Transaction. This is only used to refer to when
logging errors.</p></li>
            <li><p><strong>group_postings</strong> – A list of Posting instances for the group.</p></li>
            <li><p><strong>balances</strong> – A dict of account name to inventory contents.</p></li>
            <li><p><strong>methods</strong> – A mapping of account name to their corresponding booking
method enum.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>A pair of
  booked_postings</code> – A list of booked postings, with reducing lots resolved
    against specific position in the corresponding accounts'
    ante-inventory balances. Note single reducing posting in the input may
    result in multiple postings in the output. Also note that augmenting
    postings held-at-cost will still refer to 'cost' instances of
    CostSpec, left to be interpolated later.
  errors: A list of errors, if there were any.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">book_reductions</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">group_postings</span><span class="p">,</span> <span class="n">balances</span><span class="p">,</span> <span class="n">methods</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Book inventory reductions against the ante-balances.</span>

<span class="sd">    This function accepts a dict of (account, Inventory balance) and for each</span>
<span class="sd">    posting that is a reduction against its inventory, attempts to find a</span>
<span class="sd">    corresponding lot or list of lots to reduce the balance with.</span>

<span class="sd">    * For reducing lots, the CostSpec instance of the posting is replaced by a</span>
<span class="sd">      Cost instance.</span>

<span class="sd">    * For augmenting lots, the CostSpec instance of the posting is left alone,</span>
<span class="sd">      except for its date, which is inherited from the parent Transaction.</span>

<span class="sd">    Args:</span>
<span class="sd">      entry: An instance of Transaction. This is only used to refer to when</span>
<span class="sd">        logging errors.</span>
<span class="sd">      group_postings: A list of Posting instances for the group.</span>
<span class="sd">      balances: A dict of account name to inventory contents.</span>
<span class="sd">      methods: A mapping of account name to their corresponding booking</span>
<span class="sd">        method enum.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A pair of</span>
<span class="sd">        booked_postings: A list of booked postings, with reducing lots resolved</span>
<span class="sd">          against specific position in the corresponding accounts&#39;</span>
<span class="sd">          ante-inventory balances. Note single reducing posting in the input may</span>
<span class="sd">          result in multiple postings in the output. Also note that augmenting</span>
<span class="sd">          postings held-at-cost will still refer to &#39;cost&#39; instances of</span>
<span class="sd">          CostSpec, left to be interpolated later.</span>
<span class="sd">        errors: A list of errors, if there were any.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># A local copy of the balances dictionary which is updated just for the</span>
    <span class="c1"># duration of this function&#39;s updates, in order to take into account the</span>
    <span class="c1"># cumulative effect of all the postings inferred here</span>
    <span class="n">local_balances</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">empty</span> <span class="o">=</span> <span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">()</span>
    <span class="n">booked_postings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">group_postings</span><span class="p">:</span>
        <span class="c1"># Process a single posting.</span>
        <span class="n">units</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span>
        <span class="n">costspec</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span>
        <span class="n">account</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">account</span>

        <span class="c1"># Note: We ensure there is no mutation on &#39;balances&#39; to keep this</span>
        <span class="c1"># function without side-effects. Note that we may be able to optimize</span>
        <span class="c1"># performance later on by giving up this property.</span>
        <span class="c1">#</span>
        <span class="c1"># Also note that if there is no existing balance, then won&#39;t be any lot</span>
        <span class="c1"># reduction because none of the postings will be able to match against</span>
        <span class="c1"># any currencies of the balance.</span>
        <span class="k">if</span> <span class="n">account</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">local_balances</span><span class="p">:</span>
            <span class="n">previous_balance</span> <span class="o">=</span> <span class="n">balances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">empty</span><span class="p">)</span>
            <span class="n">local_balances</span><span class="p">[</span><span class="n">account</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">previous_balance</span><span class="p">)</span>
        <span class="n">balance</span> <span class="o">=</span> <span class="n">local_balances</span><span class="p">[</span><span class="n">account</span><span class="p">]</span>

        <span class="c1"># Check if this is a lot held at cost.</span>
        <span class="k">if</span> <span class="n">costspec</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
            <span class="c1"># This posting is not held at cost; we do nothing.</span>
            <span class="n">booked_postings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">posting</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># This posting is held at cost; figure out if it&#39;s a reduction or an</span>
            <span class="c1"># augmentation.</span>
            <span class="n">method</span> <span class="o">=</span> <span class="n">methods</span><span class="p">[</span><span class="n">account</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Booking</span><span class="o">.</span><span class="n">NONE</span>
                <span class="ow">and</span> <span class="n">balance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="n">balance</span><span class="o">.</span><span class="n">is_reduced_by</span><span class="p">(</span><span class="n">units</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="c1"># This posting is a reduction.</span>

                <span class="c1"># Match the positions.</span>
                <span class="n">cost_number</span> <span class="o">=</span> <span class="n">compute_cost_number</span><span class="p">(</span><span class="n">costspec</span><span class="p">,</span> <span class="n">units</span><span class="p">)</span>
                <span class="n">matches</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="n">balance</span><span class="p">:</span>
                    <span class="c1"># Skip inventory contents of a different currency.</span>
                    <span class="k">if</span> <span class="n">units</span><span class="o">.</span><span class="n">currency</span> <span class="ow">and</span> <span class="n">position</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span> <span class="o">!=</span> <span class="n">units</span><span class="o">.</span><span class="n">currency</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="c1"># Skip balance positions not held at cost.</span>
                    <span class="k">if</span> <span class="n">position</span><span class="o">.</span><span class="n">cost</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">cost_number</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">position</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">number</span> <span class="o">!=</span> <span class="n">cost_number</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="nb">isinstance</span><span class="p">(</span><span class="n">costspec</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
                        <span class="ow">and</span> <span class="n">position</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">currency</span> <span class="o">!=</span> <span class="n">costspec</span><span class="o">.</span><span class="n">currency</span>
                    <span class="p">):</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">costspec</span><span class="o">.</span><span class="n">date</span> <span class="ow">and</span> <span class="n">position</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">date</span> <span class="o">!=</span> <span class="n">costspec</span><span class="o">.</span><span class="n">date</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">costspec</span><span class="o">.</span><span class="n">label</span> <span class="ow">and</span> <span class="n">position</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">label</span> <span class="o">!=</span> <span class="n">costspec</span><span class="o">.</span><span class="n">label</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>

                <span class="c1"># Check for ambiguous matches.</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">ReductionError</span><span class="p">(</span>
                            <span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
                            <span class="s1">&#39;No position matches &quot;</span><span class="si">{}</span><span class="s1">&quot; against balance </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">posting</span><span class="p">,</span> <span class="n">balance</span>
                            <span class="p">),</span>
                            <span class="n">entry</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="k">return</span> <span class="p">[],</span> <span class="n">errors</span>  <span class="c1"># This is irreconcilable, remove these postings.</span>

                <span class="c1"># TODO(blais): We&#39;ll have to change this, as we want to allow</span>
                <span class="c1"># positions crossing from negative to positive and vice-versa in</span>
                <span class="c1"># a simple application. See {d3cbd78f1029}.</span>
                <span class="n">reduction_postings</span><span class="p">,</span> <span class="n">matched_postings</span><span class="p">,</span> <span class="n">ambi_errors</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">booking_method</span><span class="o">.</span><span class="n">handle_ambiguous_matches</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">ambi_errors</span><span class="p">:</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ambi_errors</span><span class="p">)</span>
                    <span class="k">return</span> <span class="p">[],</span> <span class="n">errors</span>

                <span class="c1"># Add the reductions to the resulting list of booked postings.</span>
                <span class="n">booked_postings</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">reduction_postings</span><span class="p">)</span>

                <span class="c1"># Update the local balance in order to avoid matching against</span>
                <span class="c1"># the same postings twice when processing multiple postings in</span>
                <span class="c1"># the same transaction. Note that we only do this for postings</span>
                <span class="c1"># held at cost because the other postings may need interpolation</span>
                <span class="c1"># in order to be resolved properly.</span>
                <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">reduction_postings</span><span class="p">:</span>
                    <span class="n">balance</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">posting</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># This posting is an augmentation.</span>
                <span class="c1">#</span>
                <span class="c1"># Note that we do not convert the CostSpec instances to Cost</span>
                <span class="c1"># instances, because we want to let the subsequent interpolation</span>
                <span class="c1"># process able to interpolate either the cost per-unit or the</span>
                <span class="c1"># total cost, separately.</span>

                <span class="c1"># Put in the date of the parent Transaction if there is no</span>
                <span class="c1"># explicit date specified on the spec.</span>
                <span class="k">if</span> <span class="n">costspec</span><span class="o">.</span><span class="n">date</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">dated_costspec</span> <span class="o">=</span> <span class="n">costspec</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">entry</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
                    <span class="n">posting</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">cost</span><span class="o">=</span><span class="n">dated_costspec</span><span class="p">)</span>

                <span class="c1"># FIXME: Insert unique ids for trade tracking; right now this</span>
                <span class="c1"># creates ambiguous matches errors (and it shouldn&#39;t).</span>
                <span class="c1"># # Insert a unique label if there isn&#39;t one.</span>
                <span class="c1"># if posting.cost is not None and posting.cost.label is None:</span>
                <span class="c1">#     posting = posting._replace(</span>
                <span class="c1">#         cost=posting.cost._replace(label=unique_label()))</span>

                <span class="n">booked_postings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">posting</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">booked_postings</span><span class="p">,</span> <span class="n">errors</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.booking_full.categorize_by_currency" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking_full</span><span class="o">.</span><span class="n">categorize_by_currency</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">balances</span><span class="p">)</span></code>


<a href="#beancount.parser.booking_full.categorize_by_currency" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Group the postings by the currency they declare.</p>
<p>This is used to prepare the postings for the next stages: Interpolation and
booking will then be carried out separately on each currency group. At the
outset of this routine, we should have distinct groups of currencies without
any ambiguities regarding which currency they need to balance against.</p>
<p>Here's how this works.</p>
<ul>
<li>
<p>First we apply the constraint that cost-currency and price-currency must
  match, if there is both a cost and a price. This reduces the space of
  possibilities somewhat.</p>
</li>
<li>
<p>If the currency is explicitly specified, we put the posting in that
  currency's bucket.</p>
</li>
<li>
<p>If not, we have a few methods left to disambiguate the currency:</p>
</li>
<li>
<p>We look at the remaining postings... if they are all of a single
     currency, the posting must be in that currency too.</p>
</li>
<li>
<p>If we cannot do that, we inspect the contents of the inventory of the
     account for the posting. If all the contents are of a single currency,
     we use that one.</p>
</li>
</ul>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>postings</strong> – A list of incomplete postings to categorize.</p></li>
            <li><p><strong>balances</strong> – A dict of currency to inventory contents before the transaction is
applied.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>A list of (currency string, list of tuples) items describing each postings
and its interpolated currencies, and a list of generated errors for
currency interpolation. The entry's original postings are left unmodified.
Each tuple in the value-list contains</code> – index: The posting index in the original entry.
  units_currency: The interpolated currency for units.
  cost_currency: The interpolated currency for cost.
  price_currency: The interpolated currency for price.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">categorize_by_currency</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">balances</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Group the postings by the currency they declare.</span>

<span class="sd">    This is used to prepare the postings for the next stages: Interpolation and</span>
<span class="sd">    booking will then be carried out separately on each currency group. At the</span>
<span class="sd">    outset of this routine, we should have distinct groups of currencies without</span>
<span class="sd">    any ambiguities regarding which currency they need to balance against.</span>

<span class="sd">    Here&#39;s how this works.</span>

<span class="sd">    - First we apply the constraint that cost-currency and price-currency must</span>
<span class="sd">      match, if there is both a cost and a price. This reduces the space of</span>
<span class="sd">      possibilities somewhat.</span>

<span class="sd">    - If the currency is explicitly specified, we put the posting in that</span>
<span class="sd">      currency&#39;s bucket.</span>

<span class="sd">    - If not, we have a few methods left to disambiguate the currency:</span>

<span class="sd">      1. We look at the remaining postings... if they are all of a single</span>
<span class="sd">         currency, the posting must be in that currency too.</span>

<span class="sd">      2. If we cannot do that, we inspect the contents of the inventory of the</span>
<span class="sd">         account for the posting. If all the contents are of a single currency,</span>
<span class="sd">         we use that one.</span>

<span class="sd">    Args:</span>
<span class="sd">      postings: A list of incomplete postings to categorize.</span>
<span class="sd">      balances: A dict of currency to inventory contents before the transaction is</span>
<span class="sd">        applied.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of (currency string, list of tuples) items describing each postings</span>
<span class="sd">      and its interpolated currencies, and a list of generated errors for</span>
<span class="sd">      currency interpolation. The entry&#39;s original postings are left unmodified.</span>
<span class="sd">      Each tuple in the value-list contains:</span>
<span class="sd">        index: The posting index in the original entry.</span>
<span class="sd">        units_currency: The interpolated currency for units.</span>
<span class="sd">        cost_currency: The interpolated currency for cost.</span>
<span class="sd">        price_currency: The interpolated currency for price.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">groups</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">sortdict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">auto_postings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">unknown</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">posting</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">):</span>
        <span class="n">units</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span>
        <span class="n">cost</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span>
        <span class="n">price</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">price</span>

        <span class="c1"># Extract and override the currencies locally.</span>
        <span class="n">units_currency</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">units</span><span class="o">.</span><span class="n">currency</span> <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">MISSING</span> <span class="ow">and</span> <span class="n">units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="n">cost_currency</span> <span class="o">=</span> <span class="n">cost</span><span class="o">.</span><span class="n">currency</span> <span class="k">if</span> <span class="n">cost</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">MISSING</span> <span class="ow">and</span> <span class="n">cost</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">price_currency</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">price</span><span class="o">.</span><span class="n">currency</span> <span class="k">if</span> <span class="n">price</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">MISSING</span> <span class="ow">and</span> <span class="n">price</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>

        <span class="c1"># First we apply the constraint that cost-currency and price-currency</span>
        <span class="c1"># must match, if there is both a cost and a price. This reduces the</span>
        <span class="c1"># space of possibilities somewhat.</span>
        <span class="k">if</span> <span class="n">cost_currency</span> <span class="ow">is</span> <span class="n">MISSING</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">price_currency</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">cost_currency</span> <span class="o">=</span> <span class="n">price_currency</span>
        <span class="k">if</span> <span class="n">price_currency</span> <span class="ow">is</span> <span class="n">MISSING</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cost_currency</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">price_currency</span> <span class="o">=</span> <span class="n">cost_currency</span>

        <span class="n">refer</span> <span class="o">=</span> <span class="n">Refer</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">units_currency</span><span class="p">,</span> <span class="n">cost_currency</span><span class="p">,</span> <span class="n">price_currency</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="n">MISSING</span> <span class="ow">and</span> <span class="n">price_currency</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Bucket auto-postings separately from unknown.</span>
            <span class="n">auto_postings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">refer</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Bucket with what we know so far.</span>
            <span class="n">currency</span> <span class="o">=</span> <span class="n">get_bucket_currency</span><span class="p">(</span><span class="n">refer</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">currency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sortdict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
                <span class="n">groups</span><span class="p">[</span><span class="n">currency</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">refer</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If we need to infer the currency, store in unknown.</span>
                <span class="n">unknown</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">refer</span><span class="p">)</span>

    <span class="c1"># We look at the remaining postings... if they are all of a single currency,</span>
    <span class="c1"># the posting must be in that currency too.</span>
    <span class="k">if</span> <span class="n">unknown</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">unknown</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">units_currency</span><span class="p">,</span> <span class="n">cost_currency</span><span class="p">,</span> <span class="n">price_currency</span><span class="p">)</span> <span class="o">=</span> <span class="n">unknown</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="n">other_currency</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="k">if</span> <span class="n">price_currency</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">cost_currency</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Infer to the units currency.</span>
            <span class="n">units_currency</span> <span class="o">=</span> <span class="n">other_currency</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Infer to the cost and price currencies.</span>
            <span class="k">if</span> <span class="n">price_currency</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
                <span class="n">price_currency</span> <span class="o">=</span> <span class="n">other_currency</span>
            <span class="k">if</span> <span class="n">cost_currency</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
                <span class="n">cost_currency</span> <span class="o">=</span> <span class="n">other_currency</span>

        <span class="n">refer</span> <span class="o">=</span> <span class="n">Refer</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">units_currency</span><span class="p">,</span> <span class="n">cost_currency</span><span class="p">,</span> <span class="n">price_currency</span><span class="p">)</span>
        <span class="n">currency</span> <span class="o">=</span> <span class="n">get_bucket_currency</span><span class="p">(</span><span class="n">refer</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">currency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">sortdict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="n">groups</span><span class="p">[</span><span class="n">currency</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">refer</span><span class="p">)</span>

    <span class="c1"># Finally, try to resolve all the unknown legs using the inventory contents</span>
    <span class="c1"># of each account.</span>
    <span class="k">for</span> <span class="n">refer</span> <span class="ow">in</span> <span class="n">unknown</span><span class="p">:</span>
        <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">units_currency</span><span class="p">,</span> <span class="n">cost_currency</span><span class="p">,</span> <span class="n">price_currency</span><span class="p">)</span> <span class="o">=</span> <span class="n">refer</span>
        <span class="n">posting</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">balance</span> <span class="o">=</span> <span class="n">balances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">balance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">balance</span> <span class="o">=</span> <span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">units_currency</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
            <span class="n">balance_currencies</span> <span class="o">=</span> <span class="n">balance</span><span class="o">.</span><span class="n">currencies</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">balance_currencies</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">units_currency</span> <span class="o">=</span> <span class="n">balance_currencies</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">cost_currency</span> <span class="ow">is</span> <span class="n">MISSING</span> <span class="ow">or</span> <span class="n">price_currency</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
            <span class="n">balance_cost_currencies</span> <span class="o">=</span> <span class="n">balance</span><span class="o">.</span><span class="n">cost_currencies</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">balance_cost_currencies</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">balance_cost_currency</span> <span class="o">=</span> <span class="n">balance_cost_currencies</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">price_currency</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
                    <span class="n">price_currency</span> <span class="o">=</span> <span class="n">balance_cost_currency</span>
                <span class="k">if</span> <span class="n">cost_currency</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
                    <span class="n">cost_currency</span> <span class="o">=</span> <span class="n">balance_cost_currency</span>

        <span class="n">refer</span> <span class="o">=</span> <span class="n">Refer</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">units_currency</span><span class="p">,</span> <span class="n">cost_currency</span><span class="p">,</span> <span class="n">price_currency</span><span class="p">)</span>
        <span class="n">currency</span> <span class="o">=</span> <span class="n">get_bucket_currency</span><span class="p">(</span><span class="n">refer</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">currency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sortdict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
            <span class="n">groups</span><span class="p">[</span><span class="n">currency</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">refer</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">CategorizationError</span><span class="p">(</span>
                    <span class="n">posting</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="s2">&quot;Failed to categorize posting </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">entry</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="c1"># Fill in missing units currencies if some remain as missing. This may occur</span>
    <span class="c1"># if we used the cost or price to bucket the currency but the units currency</span>
    <span class="c1"># was missing.</span>
    <span class="k">for</span> <span class="n">currency</span><span class="p">,</span> <span class="n">refers</span> <span class="ow">in</span> <span class="n">groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">rindex</span><span class="p">,</span> <span class="n">refer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">refers</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">refer</span><span class="o">.</span><span class="n">units_currency</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
                <span class="n">posting</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">[</span><span class="n">refer</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
                <span class="n">balance</span> <span class="o">=</span> <span class="n">balances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">balance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">balance_currencies</span> <span class="o">=</span> <span class="n">balance</span><span class="o">.</span><span class="n">currencies</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">balance_currencies</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">refers</span><span class="p">[</span><span class="n">rindex</span><span class="p">]</span> <span class="o">=</span> <span class="n">refer</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">units_currency</span><span class="o">=</span><span class="n">balance_currencies</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>

    <span class="c1"># Deal with auto-postings.</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">auto_postings</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">refer</span> <span class="o">=</span> <span class="n">auto_postings</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">posting</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">[</span><span class="n">refer</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">CategorizationError</span><span class="p">(</span>
                <span class="n">posting</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
                <span class="s2">&quot;You may not have more than one auto-posting per currency&quot;</span><span class="p">,</span>
                <span class="n">entry</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">auto_postings</span> <span class="o">=</span> <span class="n">auto_postings</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">refer</span> <span class="ow">in</span> <span class="n">auto_postings</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">currency</span><span class="p">,</span> <span class="n">glist</span> <span class="ow">in</span> <span class="n">groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">sortdict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="n">refer</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="n">glist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Refer</span><span class="p">(</span><span class="n">refer</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">currency</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

    <span class="c1"># Issue error for all currencies which we could not resolve.</span>
    <span class="k">for</span> <span class="n">currency</span><span class="p">,</span> <span class="n">refers</span> <span class="ow">in</span> <span class="n">groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">refer</span> <span class="ow">in</span> <span class="n">refers</span><span class="p">:</span>
            <span class="n">posting</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">[</span><span class="n">refer</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">currency</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="p">(</span><span class="n">refer</span><span class="o">.</span><span class="n">units_currency</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="n">refer</span><span class="o">.</span><span class="n">cost_currency</span><span class="p">,</span> <span class="s2">&quot;cost&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="n">refer</span><span class="o">.</span><span class="n">price_currency</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">),</span>
            <span class="p">]:</span>
                <span class="k">if</span> <span class="n">currency</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">CategorizationError</span><span class="p">(</span>
                            <span class="n">posting</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
                            <span class="s2">&quot;Could not resolve </span><span class="si">{}</span><span class="s2"> currency&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">),</span>
                            <span class="n">entry</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

    <span class="n">sorted_groups</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">sortdict</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">sorted_groups</span><span class="p">,</span> <span class="n">errors</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.booking_full.compute_cost_number" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking_full</span><span class="o">.</span><span class="n">compute_cost_number</span><span class="p">(</span><span class="n">costspec</span><span class="p">,</span> <span class="n">units</span><span class="p">)</span></code>


<a href="#beancount.parser.booking_full.compute_cost_number" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Given a CostSpec, return the cost number, if possible to compute.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>costspec</strong> – A parsed instance of CostSpec.</p></li>
            <li><p><strong>units</strong> – An instance of Amount for the units of the position.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>If it is not possible to calculate the cost, return None.
Otherwise, returns a Decimal instance, the per-unit cost.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">compute_cost_number</span><span class="p">(</span><span class="n">costspec</span><span class="p">,</span> <span class="n">units</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given a CostSpec, return the cost number, if possible to compute.</span>

<span class="sd">    Args:</span>
<span class="sd">      costspec: A parsed instance of CostSpec.</span>
<span class="sd">      units: An instance of Amount for the units of the position.</span>
<span class="sd">    Returns:</span>
<span class="sd">      If it is not possible to calculate the cost, return None.</span>
<span class="sd">      Otherwise, returns a Decimal instance, the per-unit cost.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">number_per</span> <span class="o">=</span> <span class="n">costspec</span><span class="o">.</span><span class="n">number_per</span>
    <span class="n">number_total</span> <span class="o">=</span> <span class="n">costspec</span><span class="o">.</span><span class="n">number_total</span>
    <span class="k">if</span> <span class="n">MISSING</span> <span class="ow">in</span> <span class="p">(</span><span class="n">number_per</span><span class="p">,</span> <span class="n">number_total</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">number_total</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Compute the per-unit cost if there is some total cost</span>
        <span class="c1"># component involved.</span>
        <span class="n">cost_total</span> <span class="o">=</span> <span class="n">number_total</span>
        <span class="n">units_number</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">number_per</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cost_total</span> <span class="o">+=</span> <span class="n">number_per</span> <span class="o">*</span> <span class="n">units_number</span>
        <span class="n">unit_cost</span> <span class="o">=</span> <span class="n">cost_total</span> <span class="o">/</span> <span class="n">units_number</span>
    <span class="k">elif</span> <span class="n">number_per</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">unit_cost</span> <span class="o">=</span> <span class="n">number_per</span>
    <span class="k">return</span> <span class="n">unit_cost</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.booking_full.convert_costspec_to_cost" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking_full</span><span class="o">.</span><span class="n">convert_costspec_to_cost</span><span class="p">(</span><span class="n">posting</span><span class="p">)</span></code>


<a href="#beancount.parser.booking_full.convert_costspec_to_cost" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Convert an instance of CostSpec to Cost, if present on the posting.</p>
<p>If the posting has no cost, it itself is just returned.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>posting</strong> – An instance of Posting.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>An instance of Posting with a possibly replaced 'cost' attribute.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">convert_costspec_to_cost</span><span class="p">(</span><span class="n">posting</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert an instance of CostSpec to Cost, if present on the posting.</span>

<span class="sd">    If the posting has no cost, it itself is just returned.</span>

<span class="sd">    Args:</span>
<span class="sd">      posting: An instance of Posting.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An instance of Posting with a possibly replaced &#39;cost&#39; attribute.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cost</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cost</span><span class="p">,</span> <span class="n">position</span><span class="o">.</span><span class="n">CostSpec</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cost</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">number_per</span> <span class="o">=</span> <span class="n">cost</span><span class="o">.</span><span class="n">number_per</span>
            <span class="n">number_total</span> <span class="o">=</span> <span class="n">cost</span><span class="o">.</span><span class="n">number_total</span>
            <span class="k">if</span> <span class="n">number_total</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Compute the per-unit cost if there is some total cost</span>
                <span class="c1"># component involved.</span>
                <span class="n">units_number</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
                <span class="n">cost_total</span> <span class="o">=</span> <span class="n">number_total</span>
                <span class="k">if</span> <span class="n">number_per</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">MISSING</span><span class="p">:</span>
                    <span class="n">cost_total</span> <span class="o">+=</span> <span class="n">number_per</span> <span class="o">*</span> <span class="n">units_number</span>
                <span class="n">unit_cost</span> <span class="o">=</span> <span class="n">cost_total</span> <span class="o">/</span> <span class="n">units_number</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">unit_cost</span> <span class="o">=</span> <span class="n">number_per</span>
            <span class="n">new_cost</span> <span class="o">=</span> <span class="n">Cost</span><span class="p">(</span><span class="n">unit_cost</span><span class="p">,</span> <span class="n">cost</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="n">cost</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">cost</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
            <span class="n">posting</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="n">new_cost</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">posting</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.booking_full.get_bucket_currency" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking_full</span><span class="o">.</span><span class="n">get_bucket_currency</span><span class="p">(</span><span class="n">refer</span><span class="p">)</span></code>


<a href="#beancount.parser.booking_full.get_bucket_currency" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Given currency references for a posting, return the bucket currency.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>refer</strong> – An instance of Refer.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A currency string.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_bucket_currency</span><span class="p">(</span><span class="n">refer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given currency references for a posting, return the bucket currency.</span>

<span class="sd">    Args:</span>
<span class="sd">      refer: An instance of Refer.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A currency string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">currency</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">refer</span><span class="o">.</span><span class="n">cost_currency</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">currency</span> <span class="o">=</span> <span class="n">refer</span><span class="o">.</span><span class="n">cost_currency</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">refer</span><span class="o">.</span><span class="n">price_currency</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">currency</span> <span class="o">=</span> <span class="n">refer</span><span class="o">.</span><span class="n">price_currency</span>
    <span class="k">elif</span> <span class="p">(</span>
        <span class="n">refer</span><span class="o">.</span><span class="n">cost_currency</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="ow">and</span> <span class="n">refer</span><span class="o">.</span><span class="n">price_currency</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">refer</span><span class="o">.</span><span class="n">units_currency</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="n">currency</span> <span class="o">=</span> <span class="n">refer</span><span class="o">.</span><span class="n">units_currency</span>
    <span class="k">return</span> <span class="n">currency</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.booking_full.has_self_reduction" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking_full</span><span class="o">.</span><span class="n">has_self_reduction</span><span class="p">(</span><span class="n">postings</span><span class="p">,</span> <span class="n">methods</span><span class="p">)</span></code>


<a href="#beancount.parser.booking_full.has_self_reduction" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Return true if the postings potentially reduce each other at cost.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>postings</strong> – A list of postings with uninterpolated CostSpec cost instances.</p></li>
            <li><p><strong>methods</strong> – A mapping of account name to their corresponding booking
method.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A boolean, true if there's a potential for self-reduction.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">has_self_reduction</span><span class="p">(</span><span class="n">postings</span><span class="p">,</span> <span class="n">methods</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return true if the postings potentially reduce each other at cost.</span>

<span class="sd">    Args:</span>
<span class="sd">      postings: A list of postings with uninterpolated CostSpec cost instances.</span>
<span class="sd">      methods: A mapping of account name to their corresponding booking</span>
<span class="sd">        method.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A boolean, true if there&#39;s a potential for self-reduction.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># A mapping of (currency, cost-currency) and sign.</span>
    <span class="n">cost_changes</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">postings</span><span class="p">:</span>
        <span class="n">cost</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span>
        <span class="k">if</span> <span class="n">cost</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">methods</span><span class="p">[</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">]</span> <span class="ow">is</span> <span class="n">Booking</span><span class="o">.</span><span class="n">NONE</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">,</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="o">&gt;</span> <span class="n">ZERO</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">cost_changes</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">sign</span><span class="p">)</span> <span class="o">!=</span> <span class="n">sign</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.booking_full.interpolate_group" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking_full</span><span class="o">.</span><span class="n">interpolate_group</span><span class="p">(</span><span class="n">postings</span><span class="p">,</span> <span class="n">balances</span><span class="p">,</span> <span class="n">currency</span><span class="p">,</span> <span class="n">tolerances</span><span class="p">)</span></code>


<a href="#beancount.parser.booking_full.interpolate_group" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Interpolate missing numbers in the set of postings.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>postings</strong> – A list of Posting instances.</p></li>
            <li><p><strong>balances</strong> – A dict of account to its ante-inventory.</p></li>
            <li><p><strong>currency</strong> – The weight currency of this group, used for reporting errors.</p></li>
            <li><p><strong>tolerances</strong> – A dict of currency to tolerance values.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>A tuple of
  postings</code> – A list of new posting instances.
  errors: A list of errors generated during interpolation.
  interpolated: A boolean, true if we did have to interpolate.</p>
<p>In the case of an error, this returns the original list of postings, which
is still incomplete. If an error is returned, you should probably skip the
transaction altogether, or just not include the postings in it. (An
alternative behaviour would be to return only the list of valid postings,
but that would likely result in an unbalanced transaction. We do it this
way by choice.)</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">interpolate_group</span><span class="p">(</span><span class="n">postings</span><span class="p">,</span> <span class="n">balances</span><span class="p">,</span> <span class="n">currency</span><span class="p">,</span> <span class="n">tolerances</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interpolate missing numbers in the set of postings.</span>

<span class="sd">    Args:</span>
<span class="sd">      postings: A list of Posting instances.</span>
<span class="sd">      balances: A dict of account to its ante-inventory.</span>
<span class="sd">      currency: The weight currency of this group, used for reporting errors.</span>
<span class="sd">      tolerances: A dict of currency to tolerance values.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A tuple of</span>
<span class="sd">        postings: A list of new posting instances.</span>
<span class="sd">        errors: A list of errors generated during interpolation.</span>
<span class="sd">        interpolated: A boolean, true if we did have to interpolate.</span>

<span class="sd">      In the case of an error, this returns the original list of postings, which</span>
<span class="sd">      is still incomplete. If an error is returned, you should probably skip the</span>
<span class="sd">      transaction altogether, or just not include the postings in it. (An</span>
<span class="sd">      alternative behaviour would be to return only the list of valid postings,</span>
<span class="sd">      but that would likely result in an unbalanced transaction. We do it this</span>
<span class="sd">      way by choice.)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Figure out which type of amount is missing, by creating a list of</span>
    <span class="c1"># incomplete postings and which type of units is missing.</span>
    <span class="n">incomplete</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">posting</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">postings</span><span class="p">):</span>
        <span class="n">units</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span>
        <span class="n">cost</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span>
        <span class="n">price</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">price</span>

        <span class="c1"># Identify incomplete parts of the Posting components.</span>
        <span class="k">if</span> <span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
            <span class="n">incomplete</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">MissingType</span><span class="o">.</span><span class="n">UNITS</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cost</span><span class="p">,</span> <span class="n">CostSpec</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">cost</span> <span class="ow">and</span> <span class="n">cost</span><span class="o">.</span><span class="n">number_per</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
                <span class="n">incomplete</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">MissingType</span><span class="o">.</span><span class="n">COST_PER</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">cost</span> <span class="ow">and</span> <span class="n">cost</span><span class="o">.</span><span class="n">number_total</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
                <span class="n">incomplete</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">MissingType</span><span class="o">.</span><span class="n">COST_TOTAL</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Check that a resolved instance of Cost never needs interpolation.</span>
            <span class="c1">#</span>
            <span class="c1"># Note that in theory we could support the interpolation of regular</span>
            <span class="c1"># per-unit costs in these if we wanted to; but because they&#39;re all</span>
            <span class="c1"># reducing postings that have been booked earlier, those never need</span>
            <span class="c1"># to be interpolated.</span>
            <span class="k">if</span> <span class="n">cost</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
                    <span class="n">cost</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">Decimal</span>
                <span class="p">),</span> <span class="s2">&quot;Internal error: cost has no number: </span><span class="si">{}</span><span class="s2">; on postings: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">cost</span><span class="p">,</span> <span class="n">postings</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">price</span> <span class="ow">and</span> <span class="n">price</span><span class="o">.</span><span class="n">number</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
            <span class="n">incomplete</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">MissingType</span><span class="o">.</span><span class="n">PRICE</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>

    <span class="c1"># The replacement posting for the incomplete posting of this group.</span>
    <span class="n">new_posting</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">incomplete</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># If there are no missing numbers, just convert the CostSpec to Cost and</span>
        <span class="c1"># return that.</span>
        <span class="n">out_postings</span> <span class="o">=</span> <span class="p">[</span><span class="n">convert_costspec_to_cost</span><span class="p">(</span><span class="n">posting</span><span class="p">)</span> <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">postings</span><span class="p">]</span>

    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">incomplete</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># If there is more than a single value to be interpolated, generate an</span>
        <span class="c1"># error and return no postings.</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">posting_index</span> <span class="o">=</span> <span class="n">incomplete</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">InterpolationError</span><span class="p">(</span>
                <span class="n">postings</span><span class="p">[</span><span class="n">posting_index</span><span class="p">]</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
                <span class="s2">&quot;Too many missing numbers for currency group &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">currency</span><span class="p">),</span>
                <span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">out_postings</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If there is a single missing number, calculate it and fill it in here.</span>
        <span class="n">missing</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">incomplete</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">incomplete_posting</span> <span class="o">=</span> <span class="n">postings</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

        <span class="c1"># Convert augmenting postings&#39; costs from CostSpec to corresponding Cost</span>
        <span class="c1"># instances, except for the incomplete posting.</span>
        <span class="n">new_postings</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span>
                <span class="n">posting</span>
                <span class="k">if</span> <span class="n">posting</span> <span class="ow">is</span> <span class="n">incomplete_posting</span>
                <span class="k">else</span> <span class="n">convert_costspec_to_cost</span><span class="p">(</span><span class="n">posting</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">postings</span>
        <span class="p">]</span>

        <span class="c1"># Compute the balance of the other postings.</span>
        <span class="n">residual</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">compute_residual</span><span class="p">(</span>
            <span class="n">posting</span> <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">new_postings</span> <span class="k">if</span> <span class="n">posting</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">incomplete_posting</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">residual</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Internal error in grouping postings by currencies.&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">residual</span><span class="o">.</span><span class="n">is_empty</span><span class="p">():</span>
            <span class="n">respos</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">residual</span><span class="p">))</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">respos</span><span class="o">.</span><span class="n">cost</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="p">),</span> <span class="s2">&quot;Internal error; cost appears in weight calculation.&quot;</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">respos</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span> <span class="o">==</span> <span class="n">currency</span>
            <span class="p">),</span> <span class="s2">&quot;Internal error; residual different than currency group.&quot;</span>
            <span class="n">weight</span> <span class="o">=</span> <span class="o">-</span><span class="n">respos</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span>
            <span class="n">weight_currency</span> <span class="o">=</span> <span class="n">respos</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">weight</span> <span class="o">=</span> <span class="n">ZERO</span>
            <span class="n">weight_currency</span> <span class="o">=</span> <span class="n">currency</span>

        <span class="k">if</span> <span class="n">missing</span> <span class="o">==</span> <span class="n">MissingType</span><span class="o">.</span><span class="n">UNITS</span><span class="p">:</span>
            <span class="n">units</span> <span class="o">=</span> <span class="n">incomplete_posting</span><span class="o">.</span><span class="n">units</span>
            <span class="n">cost</span> <span class="o">=</span> <span class="n">incomplete_posting</span><span class="o">.</span><span class="n">cost</span>
            <span class="k">if</span> <span class="n">cost</span><span class="p">:</span>
                <span class="c1"># Handle the special case where we only have total cost.</span>
                <span class="k">if</span> <span class="n">cost</span><span class="o">.</span><span class="n">number_per</span> <span class="o">==</span> <span class="n">ZERO</span><span class="p">:</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">InterpolationError</span><span class="p">(</span>
                            <span class="n">incomplete_posting</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
                            <span class="s2">&quot;Cannot infer per-unit cost only from total&quot;</span><span class="p">,</span>
                            <span class="kc">None</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="k">return</span> <span class="n">postings</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="kc">True</span>

                <span class="k">assert</span> <span class="p">(</span>
                    <span class="n">cost</span><span class="o">.</span><span class="n">currency</span> <span class="o">==</span> <span class="n">weight_currency</span>
                <span class="p">),</span> <span class="s2">&quot;Internal error; residual currency different than missing currency.&quot;</span>
                <span class="n">cost_total</span> <span class="o">=</span> <span class="n">cost</span><span class="o">.</span><span class="n">number_total</span> <span class="ow">or</span> <span class="n">ZERO</span>
                <span class="n">units_number</span> <span class="o">=</span> <span class="p">(</span><span class="n">weight</span> <span class="o">-</span> <span class="n">cost_total</span><span class="p">)</span> <span class="o">/</span> <span class="n">cost</span><span class="o">.</span><span class="n">number_per</span>

            <span class="k">elif</span> <span class="n">incomplete_posting</span><span class="o">.</span><span class="n">price</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="n">incomplete_posting</span><span class="o">.</span><span class="n">price</span><span class="o">.</span><span class="n">currency</span> <span class="o">==</span> <span class="n">weight_currency</span>
                <span class="p">),</span> <span class="s2">&quot;Internal error; residual currency different than missing currency.&quot;</span>
                <span class="n">units_number</span> <span class="o">=</span> <span class="n">weight</span> <span class="o">/</span> <span class="n">incomplete_posting</span><span class="o">.</span><span class="n">price</span><span class="o">.</span><span class="n">number</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="n">units</span><span class="o">.</span><span class="n">currency</span> <span class="o">==</span> <span class="n">weight_currency</span>
                <span class="p">),</span> <span class="s2">&quot;Internal error; residual currency different than missing currency.&quot;</span>
                <span class="n">units_number</span> <span class="o">=</span> <span class="n">weight</span>

            <span class="c1"># Quantize the interpolated units if necessary.</span>
            <span class="n">units_number</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">quantize_with_tolerance</span><span class="p">(</span>
                <span class="n">tolerances</span><span class="p">,</span> <span class="n">units</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="n">units_number</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">weight</span> <span class="o">!=</span> <span class="n">ZERO</span><span class="p">:</span>
                <span class="n">new_pos</span> <span class="o">=</span> <span class="n">Position</span><span class="p">(</span><span class="n">Amount</span><span class="p">(</span><span class="n">units_number</span><span class="p">,</span> <span class="n">units</span><span class="o">.</span><span class="n">currency</span><span class="p">),</span> <span class="n">cost</span><span class="p">)</span>
                <span class="n">new_posting</span> <span class="o">=</span> <span class="n">incomplete_posting</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span>
                    <span class="n">units</span><span class="o">=</span><span class="n">new_pos</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="n">new_pos</span><span class="o">.</span><span class="n">cost</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_posting</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">elif</span> <span class="n">missing</span> <span class="o">==</span> <span class="n">MissingType</span><span class="o">.</span><span class="n">COST_PER</span><span class="p">:</span>
            <span class="n">units</span> <span class="o">=</span> <span class="n">incomplete_posting</span><span class="o">.</span><span class="n">units</span>
            <span class="n">cost</span> <span class="o">=</span> <span class="n">incomplete_posting</span><span class="o">.</span><span class="n">cost</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">cost</span><span class="o">.</span><span class="n">currency</span> <span class="o">==</span> <span class="n">weight_currency</span>
            <span class="p">),</span> <span class="s2">&quot;Internal error; residual currency different than missing currency.&quot;</span>
            <span class="k">if</span> <span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="o">!=</span> <span class="n">ZERO</span><span class="p">:</span>
                <span class="n">number_per</span> <span class="o">=</span> <span class="p">(</span><span class="n">weight</span> <span class="o">-</span> <span class="p">(</span><span class="n">cost</span><span class="o">.</span><span class="n">number_total</span> <span class="ow">or</span> <span class="n">ZERO</span><span class="p">))</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">number</span>
                <span class="n">new_cost</span> <span class="o">=</span> <span class="n">cost</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">number_per</span><span class="o">=</span><span class="n">number_per</span><span class="p">)</span>
                <span class="n">new_pos</span> <span class="o">=</span> <span class="n">Position</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">new_cost</span><span class="p">)</span>
                <span class="n">new_posting</span> <span class="o">=</span> <span class="n">incomplete_posting</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span>
                    <span class="n">units</span><span class="o">=</span><span class="n">new_pos</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="n">new_pos</span><span class="o">.</span><span class="n">cost</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_posting</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">elif</span> <span class="n">missing</span> <span class="o">==</span> <span class="n">MissingType</span><span class="o">.</span><span class="n">COST_TOTAL</span><span class="p">:</span>
            <span class="n">units</span> <span class="o">=</span> <span class="n">incomplete_posting</span><span class="o">.</span><span class="n">units</span>
            <span class="n">cost</span> <span class="o">=</span> <span class="n">incomplete_posting</span><span class="o">.</span><span class="n">cost</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">cost</span><span class="o">.</span><span class="n">currency</span> <span class="o">==</span> <span class="n">weight_currency</span>
            <span class="p">),</span> <span class="s2">&quot;Internal error; residual currency different than missing currency.&quot;</span>
            <span class="n">number_total</span> <span class="o">=</span> <span class="n">weight</span> <span class="o">-</span> <span class="n">cost</span><span class="o">.</span><span class="n">number_per</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">number</span>
            <span class="n">new_cost</span> <span class="o">=</span> <span class="n">cost</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">number_total</span><span class="o">=</span><span class="n">number_total</span><span class="p">)</span>
            <span class="n">new_pos</span> <span class="o">=</span> <span class="n">Position</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">new_cost</span><span class="p">)</span>
            <span class="n">new_posting</span> <span class="o">=</span> <span class="n">incomplete_posting</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span>
                <span class="n">units</span><span class="o">=</span><span class="n">new_pos</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="n">new_pos</span><span class="o">.</span><span class="n">cost</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="n">missing</span> <span class="o">==</span> <span class="n">MissingType</span><span class="o">.</span><span class="n">PRICE</span><span class="p">:</span>
            <span class="n">units</span> <span class="o">=</span> <span class="n">incomplete_posting</span><span class="o">.</span><span class="n">units</span>
            <span class="n">cost</span> <span class="o">=</span> <span class="n">incomplete_posting</span><span class="o">.</span><span class="n">cost</span>
            <span class="k">if</span> <span class="n">cost</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">InterpolationError</span><span class="p">(</span>
                        <span class="n">incomplete_posting</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
                        <span class="s2">&quot;Cannot infer price for postings with units held at cost&quot;</span><span class="p">,</span>
                        <span class="kc">None</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">postings</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">price</span> <span class="o">=</span> <span class="n">incomplete_posting</span><span class="o">.</span><span class="n">price</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="n">price</span><span class="o">.</span><span class="n">currency</span> <span class="o">==</span> <span class="n">weight_currency</span>
                <span class="p">),</span> <span class="s2">&quot;Internal error; residual currency different than missing currency.&quot;</span>
                <span class="n">new_price_number</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">weight</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
                <span class="n">new_posting</span> <span class="o">=</span> <span class="n">incomplete_posting</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span>
                    <span class="n">price</span><span class="o">=</span><span class="n">Amount</span><span class="p">(</span><span class="n">new_price_number</span><span class="p">,</span> <span class="n">price</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
                <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Internal error; Invalid missing type.&quot;</span>

        <span class="c1"># Replace the number in the posting.</span>
        <span class="k">if</span> <span class="n">new_posting</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Set meta-data on the new posting to indicate it was interpolated.</span>
            <span class="k">if</span> <span class="n">new_posting</span><span class="o">.</span><span class="n">meta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">new_posting</span> <span class="o">=</span> <span class="n">new_posting</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">meta</span><span class="o">=</span><span class="p">{})</span>
            <span class="n">new_posting</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="n">interpolate</span><span class="o">.</span><span class="n">AUTOMATIC_META</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># Convert augmenting posting costs from CostSpec to a corresponding</span>
            <span class="c1"># Cost instance.</span>
            <span class="n">new_postings</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">convert_costspec_to_cost</span><span class="p">(</span><span class="n">new_posting</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">new_postings</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">out_postings</span> <span class="o">=</span> <span class="n">new_postings</span>

    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">cost</span><span class="p">,</span> <span class="n">CostSpec</span><span class="p">)</span> <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">out_postings</span><span class="p">)</span>

    <span class="c1"># Check that units are non-zero and that no cost remains negative; issue an</span>
    <span class="c1"># error if this is the case.</span>
    <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">out_postings</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="c1"># If there is a cost, we don&#39;t allow either a cost value of zero,</span>
        <span class="c1"># nor a zero number of units. Note that we allow a price of zero as</span>
        <span class="c1"># the only special case allowed (for conversion entries), but never</span>
        <span class="c1"># for costs.</span>
        <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="o">==</span> <span class="n">ZERO</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">InterpolationError</span><span class="p">(</span>
                    <span class="n">posting</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="s1">&#39;Amount is zero: &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="p">),</span> <span class="kc">None</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">number</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">number</span> <span class="o">&lt;</span> <span class="n">ZERO</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">InterpolationError</span><span class="p">(</span>
                    <span class="n">posting</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="s1">&#39;Cost is negative: &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">cost</span><span class="p">),</span> <span class="kc">None</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">out_postings</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="p">(</span><span class="n">new_posting</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.booking_full.replace_currencies" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking_full</span><span class="o">.</span><span class="n">replace_currencies</span><span class="p">(</span><span class="n">postings</span><span class="p">,</span> <span class="n">refer_groups</span><span class="p">)</span></code>


<a href="#beancount.parser.booking_full.replace_currencies" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Replace resolved currencies in the entry's Postings.</p>
<p>This essentially applies the findings of categorize_by_currency() to produce
new postings with all currencies resolved.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>postings</strong> – A list of Posting instances to replace.</p></li>
            <li><p><strong>refer_groups</strong> – A list of (currency, list of posting references) items as
returned by categorize_by_currency().</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A new list of items of (currency, list of Postings), postings for which the
currencies have been replaced by their interpolated currency values.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">replace_currencies</span><span class="p">(</span><span class="n">postings</span><span class="p">,</span> <span class="n">refer_groups</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Replace resolved currencies in the entry&#39;s Postings.</span>

<span class="sd">    This essentially applies the findings of categorize_by_currency() to produce</span>
<span class="sd">    new postings with all currencies resolved.</span>

<span class="sd">    Args:</span>
<span class="sd">      postings: A list of Posting instances to replace.</span>
<span class="sd">      refer_groups: A list of (currency, list of posting references) items as</span>
<span class="sd">        returned by categorize_by_currency().</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new list of items of (currency, list of Postings), postings for which the</span>
<span class="sd">      currencies have been replaced by their interpolated currency values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">new_groups</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">currency</span><span class="p">,</span> <span class="n">refers</span> <span class="ow">in</span> <span class="n">refer_groups</span><span class="p">:</span>
        <span class="n">new_postings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">refer</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">refers</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
            <span class="n">posting</span> <span class="o">=</span> <span class="n">postings</span><span class="p">[</span><span class="n">refer</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
            <span class="n">units</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span>
            <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="n">MISSING</span> <span class="ow">or</span> <span class="n">units</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">posting</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">Amount</span><span class="p">(</span><span class="n">MISSING</span><span class="p">,</span> <span class="n">refer</span><span class="o">.</span><span class="n">units_currency</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">replace</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">cost</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span>
                <span class="n">price</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">price</span>
                <span class="k">if</span> <span class="n">units</span><span class="o">.</span><span class="n">currency</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
                    <span class="n">units</span> <span class="o">=</span> <span class="n">Amount</span><span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">refer</span><span class="o">.</span><span class="n">units_currency</span><span class="p">)</span>
                    <span class="n">replace</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">cost</span> <span class="ow">and</span> <span class="n">cost</span><span class="o">.</span><span class="n">currency</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
                    <span class="n">cost</span> <span class="o">=</span> <span class="n">cost</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">currency</span><span class="o">=</span><span class="n">refer</span><span class="o">.</span><span class="n">cost_currency</span><span class="p">)</span>
                    <span class="n">replace</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">price</span> <span class="ow">and</span> <span class="n">price</span><span class="o">.</span><span class="n">currency</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
                    <span class="n">price</span> <span class="o">=</span> <span class="n">Amount</span><span class="p">(</span><span class="n">price</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">refer</span><span class="o">.</span><span class="n">price_currency</span><span class="p">)</span>
                    <span class="n">replace</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">replace</span><span class="p">:</span>
                    <span class="n">posting</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="n">cost</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="n">price</span><span class="p">)</span>
            <span class="n">new_postings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">posting</span><span class="p">)</span>
        <span class="n">new_groups</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">currency</span><span class="p">,</span> <span class="n">new_postings</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">new_groups</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.booking_full.unique_label" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking_full</span><span class="o">.</span><span class="n">unique_label</span><span class="p">()</span></code>


<a href="#beancount.parser.booking_full.unique_label" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Return a globally unique label for cost entries.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">unique_label</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="s2">&quot;Return a globally unique label for cost entries.&quot;</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.parser.booking_method" class="doc doc-heading">
        <code>beancount.parser.booking_method</code>



<a href="#beancount.parser.booking_method" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Implementations of all the particular booking methods.
This code is used by the full booking algorithm.</p>



  <div class="doc doc-children">









  <div class="doc doc-object doc-class">



<h3 id="beancount.parser.booking_method.AmbiguousMatchError" class="doc doc-heading">
        <code>
beancount.parser.booking_method.AmbiguousMatchError            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.parser.booking_method.AmbiguousMatchError" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>AmbiguousMatchError(source, message, entry)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.booking_method.AmbiguousMatchError.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking_method</span><span class="o">.</span><span class="n">AmbiguousMatchError</span><span class="o">.</span><span class="n">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.parser.booking_method.AmbiguousMatchError.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/booking_method.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return self as a plain tuple.  Used by copy and pickle.&#39;</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.booking_method.AmbiguousMatchError.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking_method</span><span class="o">.</span><span class="n">AmbiguousMatchError</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.parser.booking_method.AmbiguousMatchError.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of AmbiguousMatchError(source, message, entry)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.booking_method.AmbiguousMatchError.__repr__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking_method</span><span class="o">.</span><span class="n">AmbiguousMatchError</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.parser.booking_method.AmbiguousMatchError.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/booking_method.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return a nicely formatted representation string&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.booking_method.booking_method_AVERAGE" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking_method</span><span class="o">.</span><span class="n">booking_method_AVERAGE</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span></code>


<a href="#beancount.parser.booking_method.booking_method_AVERAGE" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>AVERAGE booking method implementation.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/booking_method.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">booking_method_AVERAGE</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;AVERAGE booking method implementation.&quot;&quot;&quot;</span>
    <span class="n">booked_reductions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">booked_matches</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[</span><span class="n">AmbiguousMatchError</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="s2">&quot;AVERAGE method is not supported&quot;</span><span class="p">,</span> <span class="n">entry</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">booked_reductions</span><span class="p">,</span> <span class="n">booked_matches</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="kc">False</span>

    <span class="c1"># FIXME: Future implementation here.</span>

    <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
        <span class="c1"># DISABLED - This is the code for AVERAGE, which is currently disabled.</span>

        <span class="c1"># If there is more than a single match we need to ultimately merge the</span>
        <span class="c1"># postings. Also, if the reducing posting provides a specific cost, we</span>
        <span class="c1"># need to update the cost basis as well. Both of these cases are carried</span>
        <span class="c1"># out by removing all the matches and readding them later on.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">number_per</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">)</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">number_total</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="c1"># There is no cost. Just reduce the one leg. This should be the</span>
            <span class="c1"># normal case if we always merge augmentations and the user lets</span>
            <span class="c1"># Beancount deal with the cost.</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">sign</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="o">&lt;</span> <span class="n">ZERO</span> <span class="k">else</span> <span class="mi">1</span>
            <span class="n">number</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">))</span>
            <span class="n">match_units</span> <span class="o">=</span> <span class="n">Amount</span><span class="p">(</span><span class="n">number</span> <span class="o">*</span> <span class="n">sign</span><span class="p">,</span> <span class="n">match</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
            <span class="n">booked_reductions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">match_units</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">cost</span><span class="p">))</span>
            <span class="n">_insufficient</span> <span class="o">=</span> <span class="n">match_units</span><span class="o">.</span><span class="n">number</span> <span class="o">!=</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Merge the matching postings to a single one.</span>
            <span class="n">merged_units</span> <span class="o">=</span> <span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">()</span>
            <span class="n">merged_cost</span> <span class="o">=</span> <span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
                <span class="n">merged_units</span><span class="o">.</span><span class="n">add_amount</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
                <span class="n">merged_cost</span><span class="o">.</span><span class="n">add_amount</span><span class="p">(</span><span class="n">convert</span><span class="o">.</span><span class="n">get_weight</span><span class="p">(</span><span class="n">match</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">merged_units</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">merged_cost</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">AmbiguousMatchError</span><span class="p">(</span>
                        <span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
                        <span class="s2">&quot;Cannot merge positions in multiple currencies: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                <span class="n">position</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">match_posting</span><span class="p">)</span>
                                <span class="k">for</span> <span class="n">match_posting</span> <span class="ow">in</span> <span class="n">matches</span>
                            <span class="p">)</span>
                        <span class="p">),</span>
                        <span class="n">entry</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">number_per</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span>
                    <span class="n">posting</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">number_total</span><span class="p">,</span> <span class="n">Decimal</span>
                <span class="p">):</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">AmbiguousMatchError</span><span class="p">(</span>
                            <span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
                            <span class="s2">&quot;Explicit cost reductions aren&#39;t supported yet: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">position</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">posting</span><span class="p">)</span>
                            <span class="p">),</span>
                            <span class="n">entry</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Insert postings to remove all the matches.</span>
                    <span class="n">booked_reductions</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                        <span class="n">posting</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span>
                            <span class="n">units</span><span class="o">=-</span><span class="n">match</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">cost</span><span class="p">,</span> <span class="n">flag</span><span class="o">=</span><span class="n">flags</span><span class="o">.</span><span class="n">FLAG_MERGING</span>
                        <span class="p">)</span>
                        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">matches</span>
                    <span class="p">)</span>
                    <span class="n">units</span> <span class="o">=</span> <span class="n">merged_units</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">units</span>
                    <span class="n">date</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">date</span>  <span class="c1">## FIXME: Select which one,</span>
                    <span class="c1">## oldest or latest.</span>
                    <span class="n">cost_units</span> <span class="o">=</span> <span class="n">merged_cost</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">units</span>
                    <span class="n">cost</span> <span class="o">=</span> <span class="n">Cost</span><span class="p">(</span>
                        <span class="n">cost_units</span><span class="o">.</span><span class="n">number</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">cost_units</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="kc">None</span>
                    <span class="p">)</span>

                    <span class="c1"># Insert a posting to refill those with a replacement match.</span>
                    <span class="n">booked_reductions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">posting</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="n">cost</span><span class="p">,</span> <span class="n">flag</span><span class="o">=</span><span class="n">flags</span><span class="o">.</span><span class="n">FLAG_MERGING</span><span class="p">)</span>
                    <span class="p">)</span>

                    <span class="c1"># Now, match the reducing request against this lot.</span>
                    <span class="n">booked_reductions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">posting</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="n">cost</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">_insufficient</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.booking_method.booking_method_FIFO" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking_method</span><span class="o">.</span><span class="n">booking_method_FIFO</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span></code>


<a href="#beancount.parser.booking_method.booking_method_FIFO" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>FIFO booking method implementation.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/booking_method.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">booking_method_FIFO</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;FIFO booking method implementation.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_booking_method_xifo</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.booking_method.booking_method_HIFO" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking_method</span><span class="o">.</span><span class="n">booking_method_HIFO</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span></code>


<a href="#beancount.parser.booking_method.booking_method_HIFO" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>HIFO booking method implementation.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/booking_method.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">booking_method_HIFO</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;HIFO booking method implementation.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_booking_method_xifo</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span><span class="p">,</span> <span class="s2">&quot;number&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.booking_method.booking_method_LIFO" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking_method</span><span class="o">.</span><span class="n">booking_method_LIFO</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span></code>


<a href="#beancount.parser.booking_method.booking_method_LIFO" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>LIFO booking method implementation.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/booking_method.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">booking_method_LIFO</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;LIFO booking method implementation.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_booking_method_xifo</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.booking_method.booking_method_NONE" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking_method</span><span class="o">.</span><span class="n">booking_method_NONE</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span></code>


<a href="#beancount.parser.booking_method.booking_method_NONE" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>NONE booking method implementation.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/booking_method.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">booking_method_NONE</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;NONE booking method implementation.&quot;&quot;&quot;</span>

    <span class="c1"># This never needs to match against any existing positions... we</span>
    <span class="c1"># disregard the matches, there&#39;s never any error. Note that this never</span>
    <span class="c1"># gets called in practice, we want to treat NONE postings as</span>
    <span class="c1"># augmentations. Default behaviour is to return them with their original</span>
    <span class="c1"># CostSpec, and the augmentation code will handle signaling an error if</span>
    <span class="c1"># there is insufficient detail to carry out the conversion to an</span>
    <span class="c1"># instance of Cost.</span>

    <span class="c1"># Note that it&#39;s an interesting question whether a reduction on an</span>
    <span class="c1"># account with NONE method which happens to match a single position</span>
    <span class="c1"># ought to be matched against it. We don&#39;t allow it for now.</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">posting</span><span class="p">],</span> <span class="p">[],</span> <span class="kc">False</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.booking_method.booking_method_STRICT" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking_method</span><span class="o">.</span><span class="n">booking_method_STRICT</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span></code>


<a href="#beancount.parser.booking_method.booking_method_STRICT" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Strict booking method. This method fails if there are ambiguous matches.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/booking_method.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">booking_method_STRICT</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Strict booking method. This method fails if there are ambiguous matches.&quot;&quot;&quot;</span>
    <span class="n">booked_reductions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">booked_matches</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">insufficient</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># In strict mode, we require at most a single matching posting.</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># If the total requested to reduce matches the sum of all the</span>
        <span class="c1"># ambiguous postings, match against all of them.</span>
        <span class="n">sum_matches</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sum_matches</span> <span class="o">==</span> <span class="o">-</span><span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">:</span>
            <span class="n">booked_reductions</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="n">posting</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">units</span><span class="o">=-</span><span class="n">match</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">cost</span><span class="p">)</span> <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">matches</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">AmbiguousMatchError</span><span class="p">(</span>
                    <span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
                    <span class="s1">&#39;Ambiguous matches for &quot;</span><span class="si">{}</span><span class="s1">&quot;: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">position</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">posting</span><span class="p">),</span>
                        <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                            <span class="n">position</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">match_posting</span><span class="p">)</span> <span class="k">for</span> <span class="n">match_posting</span> <span class="ow">in</span> <span class="n">matches</span>
                        <span class="p">),</span>
                    <span class="p">),</span>
                    <span class="n">entry</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Replace the posting&#39;s units and cost values.</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="o">&lt;</span> <span class="n">ZERO</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="n">number</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">))</span>
        <span class="n">match_units</span> <span class="o">=</span> <span class="n">Amount</span><span class="p">(</span><span class="n">number</span> <span class="o">*</span> <span class="n">sign</span><span class="p">,</span> <span class="n">match</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
        <span class="n">booked_reductions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">match_units</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">cost</span><span class="p">))</span>
        <span class="n">booked_matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
        <span class="n">insufficient</span> <span class="o">=</span> <span class="n">match_units</span><span class="o">.</span><span class="n">number</span> <span class="o">!=</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span>

    <span class="k">return</span> <span class="n">booked_reductions</span><span class="p">,</span> <span class="n">booked_matches</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">insufficient</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.booking_method.booking_method_STRICT_WITH_SIZE" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking_method</span><span class="o">.</span><span class="n">booking_method_STRICT_WITH_SIZE</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span></code>


<a href="#beancount.parser.booking_method.booking_method_STRICT_WITH_SIZE" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Strict booking method, but disambiguate further with sizes.</p>
<p>This booking method applies the same algorithm as the STRICT method, but if
only one of the ambiguous lots matches the desired size, select that one
automatically.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/booking_method.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">booking_method_STRICT_WITH_SIZE</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Strict booking method, but disambiguate further with sizes.</span>

<span class="sd">    This booking method applies the same algorithm as the STRICT method, but if</span>
<span class="sd">    only one of the ambiguous lots matches the desired size, select that one</span>
<span class="sd">    automatically.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">(</span><span class="n">booked_reductions</span><span class="p">,</span> <span class="n">booked_matches</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">insufficient</span><span class="p">)</span> <span class="o">=</span> <span class="n">booking_method_STRICT</span><span class="p">(</span>
        <span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span>
    <span class="p">)</span>

    <span class="c1"># If we couldn&#39;t match strictly, attempt to find a match with the same</span>
    <span class="c1"># number of units. If there is one or more of these, accept the oldest lot.</span>
    <span class="k">if</span> <span class="n">errors</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">number</span> <span class="o">=</span> <span class="o">-</span><span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span>
        <span class="n">matching_units</span> <span class="o">=</span> <span class="p">[</span><span class="n">match</span> <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">matches</span> <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="n">match</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">matching_units</span><span class="p">:</span>
            <span class="n">matching_units</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">match</span><span class="p">:</span> <span class="n">match</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>

            <span class="c1"># Replace the posting&#39;s units and cost values.</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">matching_units</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">booked_reductions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">units</span><span class="o">=-</span><span class="n">match</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">cost</span><span class="p">))</span>
            <span class="n">booked_matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
            <span class="n">insufficient</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">return</span> <span class="n">booked_reductions</span><span class="p">,</span> <span class="n">booked_matches</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">insufficient</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.booking_method.handle_ambiguous_matches" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">booking_method</span><span class="o">.</span><span class="n">handle_ambiguous_matches</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span></code>


<a href="#beancount.parser.booking_method.handle_ambiguous_matches" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Handle ambiguous matches by dispatching to a particular method.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entry</strong> – The parent Transaction instance.</p></li>
            <li><p><strong>posting</strong> – An instance of Posting, the reducing posting which we're
attempting to match.</p></li>
            <li><p><strong>matches</strong> – A list of matching Position instances from the ante-inventory.
Those positions are known to already match the 'posting' spec.</p></li>
            <li><p><strong>methods</strong> – A mapping of account name to their corresponding booking
method.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>A triple of
  booked_reductions</code> – A list of matched Posting instances, whose 'cost'
    attributes are ensured to be of type Cost.
  errors: A list of errors to be generated.
  insufficient: A boolean, true if we could not find enough matches to
  cover the entire position.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/booking_method.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">handle_ambiguous_matches</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handle ambiguous matches by dispatching to a particular method.</span>

<span class="sd">    Args:</span>
<span class="sd">      entry: The parent Transaction instance.</span>
<span class="sd">      posting: An instance of Posting, the reducing posting which we&#39;re</span>
<span class="sd">        attempting to match.</span>
<span class="sd">      matches: A list of matching Position instances from the ante-inventory.</span>
<span class="sd">        Those positions are known to already match the &#39;posting&#39; spec.</span>
<span class="sd">      methods: A mapping of account name to their corresponding booking</span>
<span class="sd">        method.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A triple of</span>
<span class="sd">        booked_reductions: A list of matched Posting instances, whose &#39;cost&#39;</span>
<span class="sd">          attributes are ensured to be of type Cost.</span>
<span class="sd">        errors: A list of errors to be generated.</span>
<span class="sd">        insufficient: A boolean, true if we could not find enough matches to</span>
<span class="sd">        cover the entire position.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">Booking</span><span class="p">),</span> <span class="s2">&quot;Invalid type: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">matches</span><span class="p">,</span> <span class="s2">&quot;Internal error: Invalid call with no matches&quot;</span>

    <span class="c1"># method = globals()[&#39;booking_method_{}&#39;.format(method.name)]</span>
    <span class="n">method</span> <span class="o">=</span> <span class="n">_BOOKING_METHODS</span><span class="p">[</span><span class="n">method</span><span class="p">]</span>
    <span class="p">(</span><span class="n">booked_reductions</span><span class="p">,</span> <span class="n">booked_matches</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">insufficient</span><span class="p">)</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span>
        <span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">insufficient</span><span class="p">:</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">AmbiguousMatchError</span><span class="p">(</span>
                <span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
                <span class="s1">&#39;Not enough lots to reduce &quot;</span><span class="si">{}</span><span class="s1">&quot;: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">position</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">posting</span><span class="p">),</span>
                    <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="n">position</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">match_posting</span><span class="p">)</span> <span class="k">for</span> <span class="n">match_posting</span> <span class="ow">in</span> <span class="n">matches</span>
                    <span class="p">),</span>
                <span class="p">),</span>
                <span class="n">entry</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">booked_reductions</span><span class="p">,</span> <span class="n">booked_matches</span><span class="p">,</span> <span class="n">errors</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.parser.cmptest" class="doc doc-heading">
        <code>beancount.parser.cmptest</code>



<a href="#beancount.parser.cmptest" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Support utilities for testing scripts.</p>



  <div class="doc doc-children">









  <div class="doc doc-object doc-class">



<h3 id="beancount.parser.cmptest.TestCase" class="doc doc-heading">
        <code>
beancount.parser.cmptest.TestCase            (<span title="unittest.case.TestCase">TestCase</span>)
        </code>



<a href="#beancount.parser.cmptest.TestCase" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">





  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.cmptest.TestCase.assertEqualEntries" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">cmptest</span><span class="o">.</span><span class="n">TestCase</span><span class="o">.</span><span class="n">assertEqualEntries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expected_entries</span><span class="p">,</span> <span class="n">actual_entries</span><span class="p">,</span> <span class="n">allow_incomplete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#beancount.parser.cmptest.TestCase.assertEqualEntries" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Check that two lists of entries are equal.</p>
<p>Entries can be provided either as a list of directives or as a
string.  In the latter case, the string is parsed with
beancount.parser.parse_string() and the resulting directives
list is used. If allow_incomplete is True, light-weight
booking is performed before comparing the directive lists,
allowing to compare transactions with incomplete postings.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>expected_entries</strong> – Expected entries.</p></li>
            <li><p><strong>actual_entries</strong> – Actual entries.</p></li>
            <li><p><strong>allow_incomplete</strong> – Perform booking before comparison.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>AssertionError</code> – If the exception fails.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/cmptest.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">assertEqualEntries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expected_entries</span><span class="p">,</span> <span class="n">actual_entries</span><span class="p">,</span> <span class="n">allow_incomplete</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check that two lists of entries are equal.</span>

<span class="sd">    Entries can be provided either as a list of directives or as a</span>
<span class="sd">    string.  In the latter case, the string is parsed with</span>
<span class="sd">    beancount.parser.parse_string() and the resulting directives</span>
<span class="sd">    list is used. If allow_incomplete is True, light-weight</span>
<span class="sd">    booking is performed before comparing the directive lists,</span>
<span class="sd">    allowing to compare transactions with incomplete postings.</span>

<span class="sd">    Args:</span>
<span class="sd">      expected_entries: Expected entries.</span>
<span class="sd">      actual_entries: Actual entries.</span>
<span class="sd">      allow_incomplete: Perform booking before comparison.</span>

<span class="sd">    Raises:</span>
<span class="sd">      AssertionError: If the exception fails.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">expected_entries</span> <span class="o">=</span> <span class="n">read_string_or_entries</span><span class="p">(</span><span class="n">expected_entries</span><span class="p">,</span> <span class="n">allow_incomplete</span><span class="p">)</span>
    <span class="n">actual_entries</span> <span class="o">=</span> <span class="n">read_string_or_entries</span><span class="p">(</span><span class="n">actual_entries</span><span class="p">,</span> <span class="n">allow_incomplete</span><span class="p">)</span>

    <span class="n">same</span><span class="p">,</span> <span class="n">expected_missing</span><span class="p">,</span> <span class="n">actual_missing</span> <span class="o">=</span> <span class="n">compare</span><span class="o">.</span><span class="n">compare_entries</span><span class="p">(</span>
        <span class="n">expected_entries</span><span class="p">,</span> <span class="n">actual_entries</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">same</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">expected_missing</span> <span class="ow">or</span> <span class="n">actual_missing</span><span class="p">,</span> <span class="s2">&quot;Missing is missing: </span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">expected_missing</span><span class="p">,</span> <span class="n">actual_missing</span>
        <span class="p">)</span>
        <span class="n">oss</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">expected_missing</span><span class="p">:</span>
            <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Present in expected set and not in actual set:</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">expected_missing</span><span class="p">:</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">printer</span><span class="o">.</span><span class="n">format_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">actual_missing</span><span class="p">:</span>
            <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Present in actual set and not in expected set:</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">actual_missing</span><span class="p">:</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">printer</span><span class="o">.</span><span class="n">format_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="n">oss</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.cmptest.TestCase.assertExcludesEntries" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">cmptest</span><span class="o">.</span><span class="n">TestCase</span><span class="o">.</span><span class="n">assertExcludesEntries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subset_entries</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="n">allow_incomplete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#beancount.parser.cmptest.TestCase.assertExcludesEntries" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Check that subset_entries is not included in entries.</p>
<p>Entries can be provided either as a list of directives or as a
string. In the latter case, the string is parsed with
beancount.parser.parse_string() and the resulting directives
list is used. If allow_incomplete is True, light-weight
booking is performed before comparing the directive lists,
allowing to compare transactions with incomplete postings.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>subset_entries</strong> – Subset entries.</p></li>
            <li><p><strong>entries</strong> – Entries.</p></li>
            <li><p><strong>allow_incomplete</strong> – Perform booking before comparison.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>AssertionError</code> – If the exception fails.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/cmptest.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">assertExcludesEntries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subset_entries</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="n">allow_incomplete</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check that subset_entries is not included in entries.</span>

<span class="sd">    Entries can be provided either as a list of directives or as a</span>
<span class="sd">    string. In the latter case, the string is parsed with</span>
<span class="sd">    beancount.parser.parse_string() and the resulting directives</span>
<span class="sd">    list is used. If allow_incomplete is True, light-weight</span>
<span class="sd">    booking is performed before comparing the directive lists,</span>
<span class="sd">    allowing to compare transactions with incomplete postings.</span>

<span class="sd">    Args:</span>
<span class="sd">      subset_entries: Subset entries.</span>
<span class="sd">      entries: Entries.</span>
<span class="sd">      allow_incomplete: Perform booking before comparison.</span>

<span class="sd">    Raises:</span>
<span class="sd">      AssertionError: If the exception fails.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">subset_entries</span> <span class="o">=</span> <span class="n">read_string_or_entries</span><span class="p">(</span><span class="n">subset_entries</span><span class="p">,</span> <span class="n">allow_incomplete</span><span class="p">)</span>
    <span class="n">entries</span> <span class="o">=</span> <span class="n">read_string_or_entries</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>

    <span class="n">excludes</span><span class="p">,</span> <span class="n">extra</span> <span class="o">=</span> <span class="n">compare</span><span class="o">.</span><span class="n">excludes_entries</span><span class="p">(</span><span class="n">subset_entries</span><span class="p">,</span> <span class="n">entries</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">excludes</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">extra</span><span class="p">,</span> <span class="s2">&quot;Extra is empty: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">extra</span><span class="p">)</span>
        <span class="n">oss</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">extra</span><span class="p">:</span>
            <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Extra from from first/excluded set:</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">extra</span><span class="p">:</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">printer</span><span class="o">.</span><span class="n">format_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="n">oss</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.cmptest.TestCase.assertIncludesEntries" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">cmptest</span><span class="o">.</span><span class="n">TestCase</span><span class="o">.</span><span class="n">assertIncludesEntries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subset_entries</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="n">allow_incomplete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#beancount.parser.cmptest.TestCase.assertIncludesEntries" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Check that subset_entries is included in entries.</p>
<p>Entries can be provided either as a list of directives or as a
string.  In the latter case, the string is parsed with
beancount.parser.parse_string() and the resulting directives
list is used. If allow_incomplete is True, light-weight
booking is performed before comparing the directive lists,
allowing to compare transactions with incomplete postings.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>subset_entries</strong> – Subset entries.</p></li>
            <li><p><strong>entries</strong> – Entries.</p></li>
            <li><p><strong>allow_incomplete</strong> – Perform booking before comparison.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>AssertionError</code> – If the exception fails.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/cmptest.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">assertIncludesEntries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subset_entries</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="n">allow_incomplete</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check that subset_entries is included in entries.</span>

<span class="sd">    Entries can be provided either as a list of directives or as a</span>
<span class="sd">    string.  In the latter case, the string is parsed with</span>
<span class="sd">    beancount.parser.parse_string() and the resulting directives</span>
<span class="sd">    list is used. If allow_incomplete is True, light-weight</span>
<span class="sd">    booking is performed before comparing the directive lists,</span>
<span class="sd">    allowing to compare transactions with incomplete postings.</span>

<span class="sd">    Args:</span>
<span class="sd">      subset_entries: Subset entries.</span>
<span class="sd">      entries: Entries.</span>
<span class="sd">      allow_incomplete: Perform booking before comparison.</span>

<span class="sd">    Raises:</span>
<span class="sd">      AssertionError: If the exception fails.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">subset_entries</span> <span class="o">=</span> <span class="n">read_string_or_entries</span><span class="p">(</span><span class="n">subset_entries</span><span class="p">,</span> <span class="n">allow_incomplete</span><span class="p">)</span>
    <span class="n">entries</span> <span class="o">=</span> <span class="n">read_string_or_entries</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>

    <span class="n">includes</span><span class="p">,</span> <span class="n">missing</span> <span class="o">=</span> <span class="n">compare</span><span class="o">.</span><span class="n">includes_entries</span><span class="p">(</span><span class="n">subset_entries</span><span class="p">,</span> <span class="n">entries</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">includes</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">missing</span><span class="p">,</span> <span class="s2">&quot;Missing is empty: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span>
        <span class="n">oss</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
            <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Missing from from expected set:</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">missing</span><span class="p">:</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">printer</span><span class="o">.</span><span class="n">format_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="n">oss</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="beancount.parser.cmptest.TestError" class="doc doc-heading">
        <code>
beancount.parser.cmptest.TestError            (<span title="Exception">Exception</span>)
        </code>



<a href="#beancount.parser.cmptest.TestError" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Errors within the test implementation itself. These should never occur.</p>



    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.cmptest.read_string_or_entries" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">cmptest</span><span class="o">.</span><span class="n">read_string_or_entries</span><span class="p">(</span><span class="n">entries_or_str</span><span class="p">,</span> <span class="n">allow_incomplete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#beancount.parser.cmptest.read_string_or_entries" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Read a string of entries or just entries.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries_or_str</strong> – Either a list of directives, or a string containing directives.</p></li>
            <li><p><strong>allow_incomplete</strong> – A boolean, true if we allow incomplete inputs and perform
light-weight booking.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of directives.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/cmptest.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">read_string_or_entries</span><span class="p">(</span><span class="n">entries_or_str</span><span class="p">,</span> <span class="n">allow_incomplete</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read a string of entries or just entries.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries_or_str: Either a list of directives, or a string containing directives.</span>
<span class="sd">      allow_incomplete: A boolean, true if we allow incomplete inputs and perform</span>
<span class="sd">        light-weight booking.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of directives.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entries_or_str</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">options_map</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_string</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">entries_or_str</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">allow_incomplete</span><span class="p">:</span>
            <span class="c1"># Do a simplistic local conversion in order to call the comparison.</span>
            <span class="n">entries</span> <span class="o">=</span> <span class="p">[</span><span class="n">_local_booking</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Don&#39;t accept incomplete entries either.</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">is_entry_incomplete</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">TestError</span><span class="p">(</span><span class="s2">&quot;Entries in assertions may not use interpolation.&quot;</span><span class="p">)</span>

            <span class="n">entries</span><span class="p">,</span> <span class="n">booking_errors</span> <span class="o">=</span> <span class="n">booking</span><span class="o">.</span><span class="n">book</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">)</span>
            <span class="n">errors</span> <span class="o">=</span> <span class="n">errors</span> <span class="o">+</span> <span class="n">booking_errors</span>

        <span class="c1"># Don&#39;t tolerate errors.</span>
        <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
            <span class="n">oss</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
            <span class="n">printer</span><span class="o">.</span><span class="n">print_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">oss</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">TestError</span><span class="p">(</span><span class="s2">&quot;Unexpected errors in expected: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">oss</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()))</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entries_or_str</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="s2">&quot;Expecting list: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entries_or_str</span><span class="p">)</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="n">entries_or_str</span>

    <span class="k">return</span> <span class="n">entries</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.parser.context" class="doc doc-heading">
        <code>beancount.parser.context</code>



<a href="#beancount.parser.context" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Produce a rendering of the account balances just before and after a
particular entry is applied.</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.context.render_entry_context" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">render_entry_context</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">parsed_entry</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#beancount.parser.context.render_entry_context" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Render the context before and after a particular transaction is applied.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives.</p></li>
            <li><p><strong>options_map</strong> – A dict of options, as produced by the parser.</p></li>
            <li><p><strong>entry</strong> – The entry instance which should be rendered. (Note that this object is
expected to be in the set of entries, not just structurally equal.)</p></li>
            <li><p><strong>parsed_entry</strong> – An optional incomplete, parsed but not booked nor interpolated
entry. If this is provided, this is used for inspecting the list of prior
accounts and it is also rendered.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A multiline string of text, which consists of the context before the
transaction is applied, the transaction itself, and the context after it
is applied. You can just print that, it is in form that is intended to be
consumed by the user.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/context.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">render_entry_context</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">parsed_entry</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Render the context before and after a particular transaction is applied.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      options_map: A dict of options, as produced by the parser.</span>
<span class="sd">      entry: The entry instance which should be rendered. (Note that this object is</span>
<span class="sd">        expected to be in the set of entries, not just structurally equal.)</span>
<span class="sd">      parsed_entry: An optional incomplete, parsed but not booked nor interpolated</span>
<span class="sd">        entry. If this is provided, this is used for inspecting the list of prior</span>
<span class="sd">        accounts and it is also rendered.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A multiline string of text, which consists of the context before the</span>
<span class="sd">      transaction is applied, the transaction itself, and the context after it</span>
<span class="sd">      is applied. You can just print that, it is in form that is intended to be</span>
<span class="sd">      consumed by the user.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">oss</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
    <span class="n">pr</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="nb">print</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">oss</span><span class="p">)</span>
    <span class="n">header</span> <span class="o">=</span> <span class="s2">&quot;** </span><span class="si">{}</span><span class="s2"> --------------------------------&quot;</span>

    <span class="n">meta</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">meta</span>
    <span class="n">pr</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Transaction Id&quot;</span><span class="p">))</span>
    <span class="n">pr</span><span class="p">()</span>
    <span class="n">pr</span><span class="p">(</span><span class="s2">&quot;Hash:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">compare</span><span class="o">.</span><span class="n">hash_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">)))</span>
    <span class="n">pr</span><span class="p">(</span><span class="s2">&quot;Location: </span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">],</span> <span class="n">meta</span><span class="p">[</span><span class="s2">&quot;lineno&quot;</span><span class="p">]))</span>
    <span class="n">pr</span><span class="p">()</span>
    <span class="n">pr</span><span class="p">()</span>

    <span class="c1"># Get the list of accounts sorted by the order in which they appear in the</span>
    <span class="c1"># closest entry.</span>
    <span class="n">order</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">parsed_entry</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">parsed_entry</span> <span class="o">=</span> <span class="n">entry</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parsed_entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Transaction</span><span class="p">):</span>
        <span class="n">order</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">:</span> <span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">posting</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">parsed_entry</span><span class="o">.</span><span class="n">postings</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="n">accounts</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
        <span class="n">getters</span><span class="o">.</span><span class="n">get_entry_accounts</span><span class="p">(</span><span class="n">parsed_entry</span><span class="p">),</span>
        <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">account</span><span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="mi">10000</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># Accumulate the balances of these accounts up to the entry.</span>
    <span class="n">balance_before</span><span class="p">,</span> <span class="n">balance_after</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">compute_entry_context</span><span class="p">(</span>
        <span class="n">entries</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">additional_accounts</span><span class="o">=</span><span class="n">accounts</span>
    <span class="p">)</span>

    <span class="c1"># Create a format line for printing the contents of account balances.</span>
    <span class="n">max_account_width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">accounts</span><span class="p">))</span> <span class="k">if</span> <span class="n">accounts</span> <span class="k">else</span> <span class="mi">1</span>
    <span class="n">position_line</span> <span class="o">=</span> <span class="s2">&quot;{{:1}} {{:</span><span class="si">{width}</span><span class="s2">}}  {{:&gt;49}}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">max_account_width</span><span class="p">)</span>

    <span class="c1"># Print the context before.</span>
    <span class="n">pr</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Balances before transaction&quot;</span><span class="p">))</span>
    <span class="n">pr</span><span class="p">()</span>
    <span class="n">before_hashes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">average_costs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">account</span> <span class="ow">in</span> <span class="n">accounts</span><span class="p">:</span>
        <span class="n">balance</span> <span class="o">=</span> <span class="n">balance_before</span><span class="p">[</span><span class="n">account</span><span class="p">]</span>

        <span class="n">pc_balances</span> <span class="o">=</span> <span class="n">balance</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">currency</span><span class="p">,</span> <span class="n">pc_balance</span> <span class="ow">in</span> <span class="n">pc_balances</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pc_balance</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">average_costs</span><span class="p">[</span><span class="n">account</span><span class="p">]</span> <span class="o">=</span> <span class="n">pc_balance</span><span class="o">.</span><span class="n">average</span><span class="p">()</span>

        <span class="n">positions</span> <span class="o">=</span> <span class="n">balance</span><span class="o">.</span><span class="n">get_positions</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">:</span>
            <span class="n">before_hashes</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">account</span><span class="p">,</span> <span class="nb">hash</span><span class="p">(</span><span class="n">position</span><span class="p">)))</span>
            <span class="n">pr</span><span class="p">(</span><span class="n">position_line</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">position</span><span class="p">)))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">positions</span><span class="p">:</span>
            <span class="n">pr</span><span class="p">(</span><span class="n">position_line</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="n">pr</span><span class="p">()</span>
    <span class="n">pr</span><span class="p">()</span>

    <span class="c1"># Print average cost per account, if relevant.</span>
    <span class="k">if</span> <span class="n">average_costs</span><span class="p">:</span>
        <span class="n">pr</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Average Costs&quot;</span><span class="p">))</span>
        <span class="n">pr</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">account</span><span class="p">,</span> <span class="n">average_cost</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">average_costs</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="n">average_cost</span><span class="p">:</span>
                <span class="n">pr</span><span class="p">(</span><span class="n">position_line</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">position</span><span class="p">)))</span>
        <span class="n">pr</span><span class="p">()</span>
        <span class="n">pr</span><span class="p">()</span>

    <span class="c1"># Print the entry itself.</span>
    <span class="n">dcontext</span> <span class="o">=</span> <span class="n">options_map</span><span class="p">[</span><span class="s2">&quot;dcontext&quot;</span><span class="p">]</span>
    <span class="n">pr</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Unbooked Transaction&quot;</span><span class="p">))</span>
    <span class="n">pr</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">parsed_entry</span><span class="p">:</span>
        <span class="n">printer</span><span class="o">.</span><span class="n">print_entry</span><span class="p">(</span><span class="n">parsed_entry</span><span class="p">,</span> <span class="n">dcontext</span><span class="p">,</span> <span class="n">render_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">oss</span><span class="p">)</span>
    <span class="n">pr</span><span class="p">()</span>

    <span class="n">pr</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Transaction&quot;</span><span class="p">))</span>
    <span class="n">pr</span><span class="p">()</span>
    <span class="n">printer</span><span class="o">.</span><span class="n">print_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">dcontext</span><span class="p">,</span> <span class="n">render_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">oss</span><span class="p">)</span>
    <span class="n">pr</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Transaction</span><span class="p">):</span>
        <span class="n">pr</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Residual and Tolerances&quot;</span><span class="p">))</span>
        <span class="n">pr</span><span class="p">()</span>

        <span class="c1"># Print residuals.</span>
        <span class="n">residual</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">compute_residual</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">residual</span><span class="o">.</span><span class="n">is_empty</span><span class="p">():</span>
            <span class="c1"># Note: We render the residual at maximum precision, for debugging.</span>
            <span class="n">pr</span><span class="p">(</span><span class="s2">&quot;Residual: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">residual</span><span class="p">))</span>

        <span class="c1"># Dump the tolerances used.</span>
        <span class="n">tolerances</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">infer_tolerances</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">,</span> <span class="n">options_map</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tolerances</span><span class="p">:</span>
            <span class="n">pr</span><span class="p">(</span>
                <span class="s2">&quot;Tolerances: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">tolerances</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Compute the total cost basis.</span>
        <span class="n">cost_basis</span> <span class="o">=</span> <span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">(</span>
            <span class="n">pos</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span> <span class="k">if</span> <span class="n">pos</span><span class="o">.</span><span class="n">cost</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">)</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">convert</span><span class="o">.</span><span class="n">get_cost</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cost_basis</span><span class="o">.</span><span class="n">is_empty</span><span class="p">():</span>
            <span class="n">pr</span><span class="p">(</span><span class="s2">&quot;Basis: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cost_basis</span><span class="p">))</span>
        <span class="n">pr</span><span class="p">()</span>
        <span class="n">pr</span><span class="p">()</span>

    <span class="c1"># Print the context after.</span>
    <span class="n">pr</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Balances after transaction&quot;</span><span class="p">))</span>
    <span class="n">pr</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">account</span> <span class="ow">in</span> <span class="n">accounts</span><span class="p">:</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="n">balance_after</span><span class="p">[</span><span class="n">account</span><span class="p">]</span><span class="o">.</span><span class="n">get_positions</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">:</span>
            <span class="n">changed</span> <span class="o">=</span> <span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="nb">hash</span><span class="p">(</span><span class="n">position</span><span class="p">))</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">before_hashes</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="n">position_line</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="k">if</span> <span class="n">changed</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">position</span><span class="p">)),</span>
                <span class="n">file</span><span class="o">=</span><span class="n">oss</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">positions</span><span class="p">:</span>
            <span class="n">pr</span><span class="p">(</span><span class="n">position_line</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="n">pr</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">oss</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.context.render_file_context" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">render_file_context</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span></code>


<a href="#beancount.parser.context.render_file_context" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Render the context before and after a particular transaction is applied.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives.</p></li>
            <li><p><strong>options_map</strong> – A dict of options, as produced by the parser.</p></li>
            <li><p><strong>filename</strong> – A string, the name of the file from which the transaction was parsed.</p></li>
            <li><p><strong>lineno</strong> – An integer, the line number in the file the transaction was parsed from.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A multiline string of text, which consists of the context before the
transaction is applied, the transaction itself, and the context after it
is applied. You can just print that, it is in form that is intended to be
consumed by the user.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/context.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">render_file_context</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Render the context before and after a particular transaction is applied.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      options_map: A dict of options, as produced by the parser.</span>
<span class="sd">      filename: A string, the name of the file from which the transaction was parsed.</span>
<span class="sd">      lineno: An integer, the line number in the file the transaction was parsed from.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A multiline string of text, which consists of the context before the</span>
<span class="sd">      transaction is applied, the transaction itself, and the context after it</span>
<span class="sd">      is applied. You can just print that, it is in form that is intended to be</span>
<span class="sd">      consumed by the user.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find the closest entry.</span>
    <span class="n">closest_entry</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">find_closest</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">closest_entry</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s2">&quot;No entry could be found before </span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">))</span>

    <span class="c1"># Run just the parser stage (no booking nor interpolation, which would</span>
    <span class="c1"># remove the postings) on the input file to produced the corresponding</span>
    <span class="c1"># unbooked transaction, so that we can get the list of accounts.</span>
    <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="n">parsed_entries</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">__</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="c1"># Note: We cannot bisect as we cannot rely on sorting behavior from the parser.</span>
        <span class="n">lineno</span> <span class="o">=</span> <span class="n">closest_entry</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;lineno&quot;</span><span class="p">]</span>
        <span class="n">closest_parsed_entries</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">parsed_entry</span>
            <span class="k">for</span> <span class="n">parsed_entry</span> <span class="ow">in</span> <span class="n">parsed_entries</span>
            <span class="k">if</span> <span class="n">parsed_entry</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;lineno&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">lineno</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">closest_parsed_entries</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># This is an internal error, this should never occur.</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Parsed entry corresponding to real entry not found in original filename.&quot;</span>
            <span class="p">)</span>
        <span class="n">closest_parsed_entry</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">closest_parsed_entries</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">closest_parsed_entry</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">render_entry_context</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="n">closest_entry</span><span class="p">,</span> <span class="n">closest_parsed_entry</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.parser.grammar" class="doc doc-heading">
        <code>beancount.parser.grammar</code>



<a href="#beancount.parser.grammar" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Builder for Beancount grammar.</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-class">



<h3 id="beancount.parser.grammar.Builder" class="doc doc-heading">
        <code>
beancount.parser.grammar.Builder            (<a title="beancount.parser.lexer.LexBuilder" href="#beancount.parser.lexer.LexBuilder">LexBuilder</a>)
        </code>



<a href="#beancount.parser.grammar.Builder" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A builder used by the lexer and grammar parser as callbacks to create
the data objects corresponding to rules parsed from the input file.</p>




  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.account" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">account</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">account</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.account" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Check account name validity.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>account</strong> – a str, the account name.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A string, the account name.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">account</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">account</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check account name validity.</span>

<span class="sd">    Args:</span>
<span class="sd">      account: a str, the account name.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, the account name.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_regexp</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">account</span><span class="p">):</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">ParserError</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="s2">&quot;Invalid account name: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">account</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="c1"># Intern account names. This should reduces memory usage a</span>
    <span class="c1"># fair bit because these strings are repeated liberally.</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">account</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.amount" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">amount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.amount" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Process an amount grammar rule.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>number</strong> – a Decimal instance, the number of the amount.</p></li>
            <li><p><strong>currency</strong> – a currency object (a str, really, see CURRENCY above)</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>An instance of Amount.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">amount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process an amount grammar rule.</span>

<span class="sd">    Args:</span>
<span class="sd">      number: a Decimal instance, the number of the amount.</span>
<span class="sd">      currency: a currency object (a str, really, see CURRENCY above)</span>
<span class="sd">    Returns:</span>
<span class="sd">      An instance of Amount.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Update the mapping that stores the parsed precisions.</span>
    <span class="c1"># Note: This is relatively slow, adds about 70ms because of number.as_tuple().</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dcupdate</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Amount</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.balance" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.balance" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Process an assertion directive.</p>
<p>We produce no errors here by default. We replace the failing ones in the
routine that does the verification later one, that these have succeeded
or failed.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>filename</strong> – The current filename.</p></li>
            <li><p><strong>lineno</strong> – The current line number.</p></li>
            <li><p><strong>date</strong> – A datetime object.</p></li>
            <li><p><strong>account</strong> – A string, the account to balance.</p></li>
            <li><p><strong>amount</strong> – The expected amount, to be checked.</p></li>
            <li><p><strong>tolerance</strong> – The tolerance number.</p></li>
            <li><p><strong>kvlist</strong> – a list of KeyValue instances.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A new Balance object.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">balance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process an assertion directive.</span>

<span class="sd">    We produce no errors here by default. We replace the failing ones in the</span>
<span class="sd">    routine that does the verification later one, that these have succeeded</span>
<span class="sd">    or failed.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: The current filename.</span>
<span class="sd">      lineno: The current line number.</span>
<span class="sd">      date: A datetime object.</span>
<span class="sd">      account: A string, the account to balance.</span>
<span class="sd">      amount: The expected amount, to be checked.</span>
<span class="sd">      tolerance: The tolerance number.</span>
<span class="sd">      kvlist: a list of KeyValue instances.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new Balance object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">diff_amount</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Balance</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">,</span> <span class="n">diff_amount</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.build_grammar_error" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">build_grammar_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">exc_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exc_traceback</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.build_grammar_error" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Build a grammar error and appends it to the list of pending errors.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>filename</strong> – The current filename</p></li>
            <li><p><strong>lineno</strong> – The current line number</p></li>
            <li><p><strong>excvalue</strong> – The exception value, or a str, the message of the error.</p></li>
            <li><p><strong>exc_type</strong> – An exception type, if an exception occurred.</p></li>
            <li><p><strong>exc_traceback</strong> – A traceback object.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">build_grammar_error</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">exc_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exc_traceback</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Build a grammar error and appends it to the list of pending errors.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: The current filename</span>
<span class="sd">      lineno: The current line number</span>
<span class="sd">      excvalue: The exception value, or a str, the message of the error.</span>
<span class="sd">      exc_type: An exception type, if an exception occurred.</span>
<span class="sd">      exc_traceback: A traceback object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">exc_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc_value</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
        <span class="n">strings</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exception_only</span><span class="p">(</span><span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">)</span>
        <span class="n">tblist</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">extract_tb</span><span class="p">(</span><span class="n">exc_traceback</span><span class="p">)</span>
        <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">__</span> <span class="o">=</span> <span class="n">tblist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> (</span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">strings</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc_value</span><span class="p">)</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ParserSyntaxError</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.close" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.close" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Process a close directive.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>filename</strong> – The current filename.</p></li>
            <li><p><strong>lineno</strong> – The current line number.</p></li>
            <li><p><strong>date</strong> – A datetime object.</p></li>
            <li><p><strong>account</strong> – A string, the name of the account.</p></li>
            <li><p><strong>kvlist</strong> – a list of KeyValue instances.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A new Close object.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process a close directive.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: The current filename.</span>
<span class="sd">      lineno: The current line number.</span>
<span class="sd">      date: A datetime object.</span>
<span class="sd">      account: A string, the name of the account.</span>
<span class="sd">      kvlist: a list of KeyValue instances.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new Close object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Close</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.commodity" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">commodity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">currency</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.commodity" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Process a close directive.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>filename</strong> – The current filename.</p></li>
            <li><p><strong>lineno</strong> – The current line number.</p></li>
            <li><p><strong>date</strong> – A datetime object.</p></li>
            <li><p><strong>currency</strong> – A string, the commodity being declared.</p></li>
            <li><p><strong>kvlist</strong> – a list of KeyValue instances.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A new Close object.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">commodity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">currency</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process a close directive.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: The current filename.</span>
<span class="sd">      lineno: The current line number.</span>
<span class="sd">      date: A datetime object.</span>
<span class="sd">      currency: A string, the commodity being declared.</span>
<span class="sd">      kvlist: a list of KeyValue instances.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new Close object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Commodity</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.compound_amount" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">compound_amount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">number_per</span><span class="p">,</span> <span class="n">number_total</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.compound_amount" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Process an amount grammar rule.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>number_per</strong> – a Decimal instance, the number of the cost per share.</p></li>
            <li><p><strong>number_total</strong> – a Decimal instance, the number of the cost over all shares.</p></li>
            <li><p><strong>currency</strong> – a currency object (a str, really, see CURRENCY above)</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A triple of (Decimal, Decimal, currency string) to be processed further when
creating the final per-unit cost number.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">compound_amount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">number_per</span><span class="p">,</span> <span class="n">number_total</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process an amount grammar rule.</span>

<span class="sd">    Args:</span>
<span class="sd">      number_per: a Decimal instance, the number of the cost per share.</span>
<span class="sd">      number_total: a Decimal instance, the number of the cost over all shares.</span>
<span class="sd">      currency: a currency object (a str, really, see CURRENCY above)</span>
<span class="sd">    Returns:</span>
<span class="sd">      A triple of (Decimal, Decimal, currency string) to be processed further when</span>
<span class="sd">      creating the final per-unit cost number.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Update the mapping that stores the parsed precisions.</span>
    <span class="c1"># Note: This is relatively slow, adds about 70ms because of number.as_tuple().</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dcupdate</span><span class="p">(</span><span class="n">number_per</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dcupdate</span><span class="p">(</span><span class="n">number_total</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span>

    <span class="c1"># Note that we are not able to reduce the value to a number per-share</span>
    <span class="c1"># here because we only get the number of units in the full lot spec.</span>
    <span class="k">return</span> <span class="n">CompoundAmount</span><span class="p">(</span><span class="n">number_per</span><span class="p">,</span> <span class="n">number_total</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.cost_merge" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">cost_merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.cost_merge" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create a 'merge cost' token.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">cost_merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a &#39;merge cost&#39; token.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">MERGE_COST</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.cost_spec" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">cost_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">cost_comp_list</span><span class="p">,</span> <span class="n">is_total</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.cost_spec" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Process a cost_spec grammar rule.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>cost_comp_list</strong> – A list of CompoundAmount, a datetime.date, or
label ID strings.</p></li>
            <li><p><strong>is_total</strong> – Assume only the total cost is specified; reject the &lt;number&gt; # &lt;number&gt;
  syntax, that is, no compound amounts may be specified. This is used to support
  the {{...}} syntax.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A cost-info tuple of CompoundAmount, lot date and label string. Any of these
may be set to a sentinel indicating "unset".</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">cost_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">cost_comp_list</span><span class="p">,</span> <span class="n">is_total</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process a cost_spec grammar rule.</span>

<span class="sd">    Args:</span>
<span class="sd">      cost_comp_list: A list of CompoundAmount, a datetime.date, or</span>
<span class="sd">        label ID strings.</span>
<span class="sd">      is_total: Assume only the total cost is specified; reject the &lt;number&gt; # &lt;number&gt;</span>
<span class="sd">          syntax, that is, no compound amounts may be specified. This is used to support</span>
<span class="sd">          the {{...}} syntax.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A cost-info tuple of CompoundAmount, lot date and label string. Any of these</span>
<span class="sd">      may be set to a sentinel indicating &quot;unset&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">cost_comp_list</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">CostSpec</span><span class="p">(</span><span class="n">MISSING</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">MISSING</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cost_comp_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="s2">&quot;Internal error in parser: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">cost_comp_list</span>
    <span class="p">)</span>

    <span class="n">compound_cost</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">date_</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">label</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">merge</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">cost_comp_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">CompoundAmount</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">compound_cost</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">compound_cost</span> <span class="o">=</span> <span class="n">comp</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">ParserError</span><span class="p">(</span>
                        <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">),</span>
                        <span class="s2">&quot;Duplicate cost: &#39;</span><span class="si">{}</span><span class="s2">&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">comp</span><span class="p">),</span>
                        <span class="kc">None</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">date</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">date_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">date_</span> <span class="o">=</span> <span class="n">comp</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">ParserError</span><span class="p">(</span>
                        <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">),</span>
                        <span class="s2">&quot;Duplicate date: &#39;</span><span class="si">{}</span><span class="s2">&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">comp</span><span class="p">),</span>
                        <span class="kc">None</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="k">elif</span> <span class="n">comp</span> <span class="ow">is</span> <span class="n">MERGE_COST</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">merge</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">merge</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">ParserError</span><span class="p">(</span>
                        <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">),</span>
                        <span class="s2">&quot;Cost merging is not supported yet&quot;</span><span class="p">,</span>
                        <span class="kc">None</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">ParserError</span><span class="p">(</span>
                        <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">),</span>
                        <span class="s2">&quot;Duplicate merge-cost spec&quot;</span><span class="p">,</span>
                        <span class="kc">None</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
                <span class="n">comp</span><span class="p">,</span> <span class="nb">str</span>
            <span class="p">),</span> <span class="s2">&quot;Currency component is not string: &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">comp</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">ParserError</span><span class="p">(</span>
                        <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">),</span>
                        <span class="s2">&quot;Duplicate label: &#39;</span><span class="si">{}</span><span class="s2">&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">comp</span><span class="p">),</span>
                        <span class="kc">None</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

    <span class="c1"># If there was a cost_comp_list, thus a &quot;{...}&quot; cost basis spec, you must</span>
    <span class="c1"># indicate that by creating a CompoundAmount(), always.</span>

    <span class="k">if</span> <span class="n">compound_cost</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">number_per</span><span class="p">,</span> <span class="n">number_total</span><span class="p">,</span> <span class="n">currency</span> <span class="o">=</span> <span class="n">MISSING</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">MISSING</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">number_per</span><span class="p">,</span> <span class="n">number_total</span><span class="p">,</span> <span class="n">currency</span> <span class="o">=</span> <span class="n">compound_cost</span>
        <span class="k">if</span> <span class="n">is_total</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">number_total</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">ParserError</span><span class="p">(</span>
                        <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">),</span>
                        <span class="p">(</span>
                            <span class="s2">&quot;Per-unit cost may not be specified using total cost &quot;</span>
                            <span class="s2">&quot;syntax: &#39;</span><span class="si">{}</span><span class="s2">&#39;; ignoring per-unit cost&quot;</span>
                        <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">compound_cost</span><span class="p">),</span>
                        <span class="kc">None</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="c1"># Ignore per-unit number.</span>
                <span class="n">number_per</span> <span class="o">=</span> <span class="n">ZERO</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># There&#39;s a single number specified; interpret it as a total cost.</span>
                <span class="n">number_total</span> <span class="o">=</span> <span class="n">number_per</span>
                <span class="n">number_per</span> <span class="o">=</span> <span class="n">ZERO</span>

    <span class="k">if</span> <span class="n">merge</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">merge</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="n">CostSpec</span><span class="p">(</span><span class="n">number_per</span><span class="p">,</span> <span class="n">number_total</span><span class="p">,</span> <span class="n">currency</span><span class="p">,</span> <span class="n">date_</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">merge</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.custom" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">dir_type</span><span class="p">,</span> <span class="n">custom_values</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.custom" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Process a custom directive.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>filename</strong> – the current filename.</p></li>
            <li><p><strong>lineno</strong> – the current line number.</p></li>
            <li><p><strong>date</strong> – a datetime object.</p></li>
            <li><p><strong>dir_type</strong> – A string, a type for the custom directive being parsed.</p></li>
            <li><p><strong>custom_values</strong> – A list of the various tokens seen on the same line.</p></li>
            <li><p><strong>kvlist</strong> – a list of KeyValue instances.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A new Custom object.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">custom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">dir_type</span><span class="p">,</span> <span class="n">custom_values</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process a custom directive.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: the current filename.</span>
<span class="sd">      lineno: the current line number.</span>
<span class="sd">      date: a datetime object.</span>
<span class="sd">      dir_type: A string, a type for the custom directive being parsed.</span>
<span class="sd">      custom_values: A list of the various tokens seen on the same line.</span>
<span class="sd">      kvlist: a list of KeyValue instances.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new Custom object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Custom</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">dir_type</span><span class="p">,</span> <span class="n">custom_values</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.custom_value" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">custom_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.custom_value" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create a custom value object, along with its type.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>value</strong> – One of the accepted custom values.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A pair of (value, dtype) where 'dtype' is the datatype is that of the
value.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">custom_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a custom value object, along with its type.</span>

<span class="sd">    Args:</span>
<span class="sd">      value: One of the accepted custom values.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A pair of (value, dtype) where &#39;dtype&#39; is the datatype is that of the</span>
<span class="sd">      value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ValueType</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.document" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">document</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">document_filename</span><span class="p">,</span> <span class="n">tags_links</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.document" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Process a document directive.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>filename</strong> – the current filename.</p></li>
            <li><p><strong>lineno</strong> – the current line number.</p></li>
            <li><p><strong>date</strong> – a datetime object.</p></li>
            <li><p><strong>account</strong> – an Account instance.</p></li>
            <li><p><strong>document_filename</strong> – a str, the name of the document file.</p></li>
            <li><p><strong>tags_links</strong> – The current TagsLinks accumulator.</p></li>
            <li><p><strong>kvlist</strong> – a list of KeyValue instances.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A new Document object.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">document</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">document_filename</span><span class="p">,</span> <span class="n">tags_links</span><span class="p">,</span> <span class="n">kvlist</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process a document directive.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: the current filename.</span>
<span class="sd">      lineno: the current line number.</span>
<span class="sd">      date: a datetime object.</span>
<span class="sd">      account: an Account instance.</span>
<span class="sd">      document_filename: a str, the name of the document file.</span>
<span class="sd">      tags_links: The current TagsLinks accumulator.</span>
<span class="sd">      kvlist: a list of KeyValue instances.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new Document object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">document_filename</span><span class="p">):</span>
        <span class="n">document_filename</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span>
            <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="n">document_filename</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="n">tags</span><span class="p">,</span> <span class="n">links</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finalize_tags_links</span><span class="p">(</span><span class="n">tags_links</span><span class="o">.</span><span class="n">tags</span><span class="p">,</span> <span class="n">tags_links</span><span class="o">.</span><span class="n">links</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Document</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">document_filename</span><span class="p">,</span> <span class="n">tags</span><span class="p">,</span> <span class="n">links</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.event" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">event_type</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.event" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Process an event directive.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>filename</strong> – the current filename.</p></li>
            <li><p><strong>lineno</strong> – the current line number.</p></li>
            <li><p><strong>date</strong> – a datetime object.</p></li>
            <li><p><strong>event_type</strong> – a str, the name of the event type.</p></li>
            <li><p><strong>description</strong> – a str, the event value, the contents.</p></li>
            <li><p><strong>kvlist</strong> – a list of KeyValue instances.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A new Event object.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">event_type</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process an event directive.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: the current filename.</span>
<span class="sd">      lineno: the current line number.</span>
<span class="sd">      date: a datetime object.</span>
<span class="sd">      event_type: a str, the name of the event type.</span>
<span class="sd">      description: a str, the event value, the contents.</span>
<span class="sd">      kvlist: a list of KeyValue instances.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new Event object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Event</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">event_type</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.finalize" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.finalize" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Finalize the parser, check for final errors and return the triple.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>A triple of
  entries</code> – A list of parsed directives, which may need completion.
  errors: A list of errors, hopefully empty.
  options_map: A dict of options.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Finalize the parser, check for final errors and return the triple.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A triple of</span>
<span class="sd">        entries: A list of parsed directives, which may need completion.</span>
<span class="sd">        errors: A list of errors, hopefully empty.</span>
<span class="sd">        options_map: A dict of options.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># If the user left some tags unbalanced, issue an error.</span>
    <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">ParserError</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="s2">&quot;Unbalanced pushed tag: &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># If the user left some metadata unpopped, issue an error.</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value_list</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">ParserError</span><span class="p">(</span>
                <span class="n">meta</span><span class="p">,</span>
                <span class="p">(</span><span class="s2">&quot;Unbalanced metadata key &#39;</span><span class="si">{}</span><span class="s2">&#39;; leftover metadata &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">key</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">value_list</span><span class="p">)</span>
                <span class="p">),</span>
                <span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># Weave the commas option in the DisplayContext itself, so it propagates</span>
    <span class="c1"># everywhere it is used automatically.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dcontext</span><span class="o">.</span><span class="n">set_commas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;render_commas&quot;</span><span class="p">])</span>

    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_entries</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_options</span><span class="p">())</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.get_entries" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">get_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.get_entries" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return the accumulated entries.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of sorted directives.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the accumulated entries.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A list of sorted directives.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">entry_sortkey</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.get_long_string_maxlines" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">get_long_string_maxlines</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.get_long_string_maxlines" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>See base class.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_long_string_maxlines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;See base class.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;long_string_maxlines&quot;</span><span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.get_options" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">get_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.get_options" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return the final options map.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A dict of option names to options.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the final options map.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A dict of option names to options.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Build and store the inferred DisplayContext instance.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;dcontext&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dcontext</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.handle_list" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">handle_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">object_list</span><span class="p">,</span> <span class="n">new_object</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.handle_list" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Handle a recursive list grammar rule, generically.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>object_list</strong> – the current list of objects.</p></li>
            <li><p><strong>new_object</strong> – the new object to be added.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>The new, updated list of objects.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">handle_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">object_list</span><span class="p">,</span> <span class="n">new_object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handle a recursive list grammar rule, generically.</span>

<span class="sd">    Args:</span>
<span class="sd">      object_list: the current list of objects.</span>
<span class="sd">      new_object: the new object to be added.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The new, updated list of objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">object_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">object_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">new_object</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">object_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_object</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">object_list</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.include" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">include_filename</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.include" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Process an include directive.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>filename</strong> – current filename.</p></li>
            <li><p><strong>lineno</strong> – current line number.</p></li>
            <li><p><strong>include_name</strong> – A string, the name of the file to include.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">include</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">include_filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process an include directive.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: current filename.</span>
<span class="sd">      lineno: current line number.</span>
<span class="sd">      include_name: A string, the name of the file to include.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;include&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">include_filename</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.key_value" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">key_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.key_value" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Process a document directive.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>filename</strong> – The current filename.</p></li>
            <li><p><strong>lineno</strong> – The current line number.</p></li>
            <li><p><strong>date</strong> – A datetime object.</p></li>
            <li><p><strong>account</strong> – A string, the account the document relates to.</p></li>
            <li><p><strong>document_filename</strong> – A str, the name of the document file.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A new KeyValue object.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">key_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process a document directive.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: The current filename.</span>
<span class="sd">      lineno: The current line number.</span>
<span class="sd">      date: A datetime object.</span>
<span class="sd">      account: A string, the account the document relates to.</span>
<span class="sd">      document_filename: A str, the name of the document file.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new KeyValue object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">KeyValue</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.note" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">note</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">comment</span><span class="p">,</span> <span class="n">tags_links</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.note" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Process a note directive.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>filename</strong> – The current filename.</p></li>
            <li><p><strong>lineno</strong> – The current line number.</p></li>
            <li><p><strong>date</strong> – A datetime object.</p></li>
            <li><p><strong>account</strong> – A string, the account to attach the note to.</p></li>
            <li><p><strong>comment</strong> – A str, the note's comments contents.</p></li>
            <li><p><strong>kvlist</strong> – a list of KeyValue instances.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A new Note object.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">note</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">comment</span><span class="p">,</span> <span class="n">tags_links</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process a note directive.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: The current filename.</span>
<span class="sd">      lineno: The current line number.</span>
<span class="sd">      date: A datetime object.</span>
<span class="sd">      account: A string, the account to attach the note to.</span>
<span class="sd">      comment: A str, the note&#39;s comments contents.</span>
<span class="sd">      kvlist: a list of KeyValue instances.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new Note object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span>
    <span class="n">tags</span><span class="p">,</span> <span class="n">links</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finalize_tags_links</span><span class="p">(</span><span class="n">tags_links</span><span class="o">.</span><span class="n">tags</span><span class="p">,</span> <span class="n">tags_links</span><span class="o">.</span><span class="n">links</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Note</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">comment</span><span class="p">,</span> <span class="n">tags</span><span class="p">,</span> <span class="n">links</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.open" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">currencies</span><span class="p">,</span> <span class="n">booking_str</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.open" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Process an open directive.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>filename</strong> – The current filename.</p></li>
            <li><p><strong>lineno</strong> – The current line number.</p></li>
            <li><p><strong>date</strong> – A datetime object.</p></li>
            <li><p><strong>account</strong> – A string, the name of the account.</p></li>
            <li><p><strong>currencies</strong> – A list of constraint currencies.</p></li>
            <li><p><strong>booking_str</strong> – A string, the booking method, or None if none was specified.</p></li>
            <li><p><strong>kvlist</strong> – a list of KeyValue instances.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A new Open object.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">currencies</span><span class="p">,</span> <span class="n">booking_str</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process an open directive.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: The current filename.</span>
<span class="sd">      lineno: The current line number.</span>
<span class="sd">      date: A datetime object.</span>
<span class="sd">      account: A string, the name of the account.</span>
<span class="sd">      currencies: A list of constraint currencies.</span>
<span class="sd">      booking_str: A string, the booking method, or None if none was specified.</span>
<span class="sd">      kvlist: a list of KeyValue instances.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new Open object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span>
    <span class="n">error</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">booking_str</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Note: Somehow the &#39;in&#39; membership operator is not defined on Enum.</span>
            <span class="n">booking</span> <span class="o">=</span> <span class="n">Booking</span><span class="p">[</span><span class="n">booking_str</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="c1"># If the per-account method is invalid, set it to the global</span>
            <span class="c1"># default method and continue.</span>
            <span class="n">booking</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;booking_method&quot;</span><span class="p">]</span>
            <span class="n">error</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">booking</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">entry</span> <span class="o">=</span> <span class="n">Open</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">currencies</span><span class="p">,</span> <span class="n">booking</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">ParserError</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="s2">&quot;Invalid booking method: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">booking_str</span><span class="p">),</span> <span class="n">entry</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">entry</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.option" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.option" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Process an option directive.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>filename</strong> – current filename.</p></li>
            <li><p><strong>lineno</strong> – current line number.</p></li>
            <li><p><strong>key</strong> – option's key (str)</p></li>
            <li><p><strong>value</strong> – option's value</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process an option directive.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: current filename.</span>
<span class="sd">      lineno: current line number.</span>
<span class="sd">      key: option&#39;s key (str)</span>
<span class="sd">      value: option&#39;s value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ParserError</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="s2">&quot;Invalid option: &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="kc">None</span><span class="p">))</span>

    <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">READ_ONLY_OPTIONS</span><span class="p">:</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">ParserError</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="s2">&quot;Option &#39;</span><span class="si">{}</span><span class="s2">&#39; may not be set&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">option_descriptor</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">OPTIONS</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="c1"># Issue a warning if the option is deprecated.</span>
        <span class="k">if</span> <span class="n">option_descriptor</span><span class="o">.</span><span class="n">deprecated</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">option_descriptor</span><span class="o">.</span><span class="n">deprecated</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="s2">&quot;Internal error.&quot;</span>
            <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">DeprecatedError</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">option_descriptor</span><span class="o">.</span><span class="n">deprecated</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Rename the option if it has an alias.</span>
        <span class="k">if</span> <span class="n">option_descriptor</span><span class="o">.</span><span class="n">alias</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">option_descriptor</span><span class="o">.</span><span class="n">alias</span>
            <span class="n">option_descriptor</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">OPTIONS</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="c1"># Convert the value, if necessary.</span>
        <span class="k">if</span> <span class="n">option_descriptor</span><span class="o">.</span><span class="n">converter</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">option_descriptor</span><span class="o">.</span><span class="n">converter</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">ParserError</span><span class="p">(</span>
                        <span class="n">meta</span><span class="p">,</span> <span class="s2">&quot;Error for option &#39;</span><span class="si">{}</span><span class="s2">&#39;: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">exc</span><span class="p">),</span> <span class="kc">None</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="k">return</span>

        <span class="n">option</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="c1"># Append to a list of values.</span>
            <span class="n">option</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="c1"># Set to a dict of values.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">ParserError</span><span class="p">(</span>
                        <span class="n">meta</span><span class="p">,</span> <span class="s2">&quot;Error for option &#39;</span><span class="si">{}</span><span class="s2">&#39;: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span> <span class="kc">None</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="k">return</span>
            <span class="n">dict_key</span><span class="p">,</span> <span class="n">dict_value</span> <span class="o">=</span> <span class="n">value</span>
            <span class="n">option</span><span class="p">[</span><span class="n">dict_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">dict_value</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="c1"># Convert to a boolean.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="s2">&quot;on&quot;</span><span class="p">})</span> <span class="ow">or</span> <span class="p">(</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Set the value.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="c1"># Refresh the list of valid account regexps as we go along.</span>
        <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;name_&quot;</span><span class="p">):</span>
            <span class="c1"># Update the set of valid account types.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">account_regexp</span> <span class="o">=</span> <span class="n">valid_account_regexp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.pad" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">source_account</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.pad" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Process a pad directive.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>filename</strong> – The current filename.</p></li>
            <li><p><strong>lineno</strong> – The current line number.</p></li>
            <li><p><strong>date</strong> – A datetime object.</p></li>
            <li><p><strong>account</strong> – A string, the account to be padded.</p></li>
            <li><p><strong>source_account</strong> – A string, the account to pad from.</p></li>
            <li><p><strong>kvlist</strong> – a list of KeyValue instances.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A new Pad object.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">pad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">source_account</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process a pad directive.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: The current filename.</span>
<span class="sd">      lineno: The current line number.</span>
<span class="sd">      date: A datetime object.</span>
<span class="sd">      account: A string, the account to be padded.</span>
<span class="sd">      source_account: A string, the account to pad from.</span>
<span class="sd">      kvlist: a list of KeyValue instances.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new Pad object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Pad</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">source_account</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.pipe_deprecated_error" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">pipe_deprecated_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.pipe_deprecated_error" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Issue a 'Pipe deprecated' error.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>filename</strong> – The current filename</p></li>
            <li><p><strong>lineno</strong> – The current line number</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">pipe_deprecated_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Issue a &#39;Pipe deprecated&#39; error.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: The current filename</span>
<span class="sd">      lineno: The current line number</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;allow_pipe_separator&quot;</span><span class="p">]:</span>
        <span class="k">return</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ParserSyntaxError</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="s2">&quot;Pipe symbol is deprecated.&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.plugin" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">plugin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">plugin_name</span><span class="p">,</span> <span class="n">plugin_config</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.plugin" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Process a plugin directive.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>filename</strong> – current filename.</p></li>
            <li><p><strong>lineno</strong> – current line number.</p></li>
            <li><p><strong>plugin_name</strong> – A string, the name of the plugin module to import.</p></li>
            <li><p><strong>plugin_config</strong> – A string or None, an optional configuration string to
pass in to the plugin module.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">plugin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">plugin_name</span><span class="p">,</span> <span class="n">plugin_config</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process a plugin directive.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: current filename.</span>
<span class="sd">      lineno: current line number.</span>
<span class="sd">      plugin_name: A string, the name of the plugin module to import.</span>
<span class="sd">      plugin_config: A string or None, an optional configuration string to</span>
<span class="sd">        pass in to the plugin module.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;plugin&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">plugin_name</span><span class="p">,</span> <span class="n">plugin_config</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.popmeta" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">popmeta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.popmeta" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Removed a key off the current set of stacks.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>key</strong> – A string, a key to be removed from the meta dict.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">popmeta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Removed a key off the current set of stacks.</span>

<span class="sd">    Args:</span>
<span class="sd">      key: A string, a key to be removed from the meta dict.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span>
        <span class="n">value_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">value_list</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">value_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">ParserError</span><span class="p">(</span>
                <span class="n">meta</span><span class="p">,</span> <span class="s2">&quot;Attempting to pop absent metadata key: &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="kc">None</span>
            <span class="p">)</span>
        <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.poptag" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">poptag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.poptag" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Pop a tag off the current set of stacks.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>tag</strong> – A string, a tag to be removed from the current set of tags.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">poptag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pop a tag off the current set of stacks.</span>

<span class="sd">    Args:</span>
<span class="sd">      tag: A string, a tag to be removed from the current set of tags.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">ParserError</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="s2">&quot;Attempting to pop absent tag: &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.posting" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">posting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">istotal</span><span class="p">,</span> <span class="n">flag</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.posting" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Process a posting grammar rule.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>filename</strong> – the current filename.</p></li>
            <li><p><strong>lineno</strong> – the current line number.</p></li>
            <li><p><strong>account</strong> – A string, the account of the posting.</p></li>
            <li><p><strong>units</strong> – An instance of Amount for the units.</p></li>
            <li><p><strong>cost</strong> – An instance of CostSpec for the cost.</p></li>
            <li><p><strong>price</strong> – Either None, or an instance of Amount that is the cost of the position.</p></li>
            <li><p><strong>istotal</strong> – A bool, True if the price is for the total amount being parsed, or
       False if the price is for each lot of the position.</p></li>
            <li><p><strong>flag</strong> – A string, one-character, the flag associated with this posting.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A new Posting object, with no parent entry.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">posting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">istotal</span><span class="p">,</span> <span class="n">flag</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process a posting grammar rule.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: the current filename.</span>
<span class="sd">      lineno: the current line number.</span>
<span class="sd">      account: A string, the account of the posting.</span>
<span class="sd">      units: An instance of Amount for the units.</span>
<span class="sd">      cost: An instance of CostSpec for the cost.</span>
<span class="sd">      price: Either None, or an instance of Amount that is the cost of the position.</span>
<span class="sd">      istotal: A bool, True if the price is for the total amount being parsed, or</span>
<span class="sd">               False if the price is for each lot of the position.</span>
<span class="sd">      flag: A string, one-character, the flag associated with this posting.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new Posting object, with no parent entry.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span>

    <span class="c1"># Prices may not be negative.</span>
    <span class="k">if</span> <span class="n">price</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">price</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">)</span> <span class="ow">and</span> <span class="n">price</span><span class="o">.</span><span class="n">number</span> <span class="o">&lt;</span> <span class="n">ZERO</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">ParserError</span><span class="p">(</span>
                <span class="n">meta</span><span class="p">,</span>
                <span class="p">(</span>
                    <span class="s2">&quot;Negative prices are not allowed: </span><span class="si">{}</span><span class="s2"> &quot;</span>
                    <span class="s2">&quot;(see http://furius.ca/beancount/doc/bug-negative-prices &quot;</span>
                    <span class="s2">&quot;for workaround)&quot;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">price</span><span class="p">),</span>
                <span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># Fix it and continue.</span>
        <span class="n">price</span> <span class="o">=</span> <span class="n">Amount</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">price</span><span class="o">.</span><span class="n">number</span><span class="p">),</span> <span class="n">price</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>

    <span class="c1"># If the price is specified for the entire amount, compute the effective</span>
    <span class="c1"># price here and forget about that detail of the input syntax.</span>
    <span class="k">if</span> <span class="n">istotal</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
            <span class="c1"># Note: we could potentially do a better job and attempt to fix</span>
            <span class="c1"># this up after interpolation, but this syntax is pretty rare</span>
            <span class="c1"># anyway.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">ParserError</span><span class="p">(</span>
                    <span class="n">meta</span><span class="p">,</span>
                    <span class="p">(</span><span class="s2">&quot;Total price on a posting without units: </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">price</span><span class="p">),</span>
                    <span class="kc">None</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">price</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">price_number</span> <span class="o">=</span> <span class="n">price</span><span class="o">.</span><span class="n">number</span>
            <span class="k">if</span> <span class="n">price_number</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">MISSING</span><span class="p">:</span>
                <span class="n">price_number</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">ZERO</span> <span class="k">if</span> <span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="o">==</span> <span class="n">ZERO</span> <span class="k">else</span> <span class="n">price_number</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">price</span> <span class="o">=</span> <span class="n">Amount</span><span class="p">(</span><span class="n">price_number</span><span class="p">,</span> <span class="n">price</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>

    <span class="c1"># Note: Allow zero prices because we need them for round-trips for</span>
    <span class="c1"># conversion entries.</span>
    <span class="c1">#</span>
    <span class="c1"># if price is not None and price.number == ZERO:</span>
    <span class="c1">#     self.errors.append(</span>
    <span class="c1">#         ParserError(meta, &quot;Price is zero: {}&quot;.format(price), None))</span>

    <span class="c1"># If both cost and price are specified, the currencies must match, or</span>
    <span class="c1"># that is an error.</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="n">cost</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="ow">and</span> <span class="n">price</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cost</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
        <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">price</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
        <span class="ow">and</span> <span class="n">cost</span><span class="o">.</span><span class="n">currency</span> <span class="o">!=</span> <span class="n">price</span><span class="o">.</span><span class="n">currency</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">ParserError</span><span class="p">(</span>
                <span class="n">meta</span><span class="p">,</span>
                <span class="s2">&quot;Cost and price currencies must match: </span><span class="si">{}</span><span class="s2"> != </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">cost</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="n">price</span><span class="o">.</span><span class="n">currency</span>
                <span class="p">),</span>
                <span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">Posting</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="nb">chr</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span> <span class="k">if</span> <span class="n">flag</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span> <span class="n">meta</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.price" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">price</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">currency</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.price" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Process a price directive.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>filename</strong> – the current filename.</p></li>
            <li><p><strong>lineno</strong> – the current line number.</p></li>
            <li><p><strong>date</strong> – a datetime object.</p></li>
            <li><p><strong>currency</strong> – the currency to be priced.</p></li>
            <li><p><strong>amount</strong> – an instance of Amount, that is the price of the currency.</p></li>
            <li><p><strong>kvlist</strong> – a list of KeyValue instances.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A new Price object.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">price</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">currency</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process a price directive.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: the current filename.</span>
<span class="sd">      lineno: the current line number.</span>
<span class="sd">      date: a datetime object.</span>
<span class="sd">      currency: the currency to be priced.</span>
<span class="sd">      amount: an instance of Amount, that is the price of the currency.</span>
<span class="sd">      kvlist: a list of KeyValue instances.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new Price object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Price</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">currency</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.pushmeta" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">pushmeta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">key_value</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.pushmeta" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Set a metadata field on the current key-value pairs to be added to transactions.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>key_value</strong> – A KeyValue instance, to be added to the dict of metadata.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">pushmeta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">key_value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set a metadata field on the current key-value pairs to be added to transactions.</span>

<span class="sd">    Args:</span>
<span class="sd">      key_value: A KeyValue instance, to be added to the dict of metadata.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">key_value</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.pushtag" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">pushtag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.pushtag" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Push a tag on the current set of tags.</p>
<p>Note that this does not need to be stack ordered.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>tag</strong> – A string, a tag to be added.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">pushtag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Push a tag on the current set of tags.</span>

<span class="sd">    Note that this does not need to be stack ordered.</span>

<span class="sd">    Args:</span>
<span class="sd">      tag: A string, a tag to be added.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.query" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">query_name</span><span class="p">,</span> <span class="n">query_string</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.query" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Process a document directive.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>filename</strong> – the current filename.</p></li>
            <li><p><strong>lineno</strong> – the current line number.</p></li>
            <li><p><strong>date</strong> – a datetime object.</p></li>
            <li><p><strong>query_name</strong> – a str, the name of the query.</p></li>
            <li><p><strong>query_string</strong> – a str, the SQL query itself.</p></li>
            <li><p><strong>kvlist</strong> – a list of KeyValue instances.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A new Query object.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">query_name</span><span class="p">,</span> <span class="n">query_string</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process a document directive.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: the current filename.</span>
<span class="sd">      lineno: the current line number.</span>
<span class="sd">      date: a datetime object.</span>
<span class="sd">      query_name: a str, the name of the query.</span>
<span class="sd">      query_string: a str, the SQL query itself.</span>
<span class="sd">      kvlist: a list of KeyValue instances.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new Query object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Query</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">query_name</span><span class="p">,</span> <span class="n">query_string</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.store_result" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">store_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">entries</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.store_result" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Start rule stores the final result here.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of entries to store.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">store_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">entries</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Start rule stores the final result here.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of entries to store.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">entries</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entries</span> <span class="o">=</span> <span class="n">entries</span>
    <span class="c1"># Also record the name of the processed file.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.tag_link_LINK" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">tag_link_LINK</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">tags_links</span><span class="p">,</span> <span class="n">link</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.tag_link_LINK" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Add a link to the TagsLinks accumulator.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>tags_links</strong> – The current TagsLinks accumulator.</p></li>
            <li><p><strong>link</strong> – A string, the new link to insert.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>An updated TagsLinks instance.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">tag_link_LINK</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">tags_links</span><span class="p">,</span> <span class="n">link</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a link to the TagsLinks accumulator.</span>

<span class="sd">    Args:</span>
<span class="sd">      tags_links: The current TagsLinks accumulator.</span>
<span class="sd">      link: A string, the new link to insert.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An updated TagsLinks instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tags_links</span><span class="o">.</span><span class="n">links</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tags_links</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.tag_link_TAG" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">tag_link_TAG</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">tags_links</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.tag_link_TAG" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Add a tag to the TagsLinks accumulator.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>tags_links</strong> – The current TagsLinks accumulator.</p></li>
            <li><p><strong>tag</strong> – A string, the new tag to insert.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>An updated TagsLinks instance.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">tag_link_TAG</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">tags_links</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a tag to the TagsLinks accumulator.</span>

<span class="sd">    Args:</span>
<span class="sd">      tags_links: The current TagsLinks accumulator.</span>
<span class="sd">      tag: A string, the new tag to insert.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An updated TagsLinks instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tags_links</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tags_links</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.tag_link_new" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">tag_link_new</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.tag_link_new" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create a new TagsLinks instance.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>An instance of TagsLinks, initialized with expected attributes.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">tag_link_new</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a new TagsLinks instance.</span>

<span class="sd">    Returns:</span>
<span class="sd">      An instance of TagsLinks, initialized with expected attributes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">TagsLinks</span><span class="p">(</span><span class="nb">set</span><span class="p">(),</span> <span class="nb">set</span><span class="p">())</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.Builder.transaction" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">txn_strings</span><span class="p">,</span> <span class="n">tags_links</span><span class="p">,</span> <span class="n">posting_or_kv_list</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.Builder.transaction" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Process a transaction directive.</p>
<p>All the postings of the transaction are available at this point, and so the
the transaction is balanced here, incomplete postings are completed with the
appropriate position, and errors are being accumulated on the builder to be
reported later on.</p>
<p>This is the main routine that takes up most of the parsing time; be very
careful with modifications here, they have an impact on performance.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>filename</strong> – the current filename.</p></li>
            <li><p><strong>lineno</strong> – the current line number.</p></li>
            <li><p><strong>date</strong> – a datetime object.</p></li>
            <li><p><strong>flag</strong> – a str, one-character, the flag associated with this transaction.</p></li>
            <li><p><strong>txn_strings</strong> – A list of strings, possibly empty, possibly longer.</p></li>
            <li><p><strong>tags_links</strong> – A TagsLinks namedtuple of tags, and/or links.</p></li>
            <li><p><strong>posting_or_kv_list</strong> – a list of Posting or KeyValue instances, to be inserted in
this transaction, or None, if no postings have been declared.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A new Transaction object.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">transaction</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">txn_strings</span><span class="p">,</span> <span class="n">tags_links</span><span class="p">,</span> <span class="n">posting_or_kv_list</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process a transaction directive.</span>

<span class="sd">    All the postings of the transaction are available at this point, and so the</span>
<span class="sd">    the transaction is balanced here, incomplete postings are completed with the</span>
<span class="sd">    appropriate position, and errors are being accumulated on the builder to be</span>
<span class="sd">    reported later on.</span>

<span class="sd">    This is the main routine that takes up most of the parsing time; be very</span>
<span class="sd">    careful with modifications here, they have an impact on performance.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: the current filename.</span>
<span class="sd">      lineno: the current line number.</span>
<span class="sd">      date: a datetime object.</span>
<span class="sd">      flag: a str, one-character, the flag associated with this transaction.</span>
<span class="sd">      txn_strings: A list of strings, possibly empty, possibly longer.</span>
<span class="sd">      tags_links: A TagsLinks namedtuple of tags, and/or links.</span>
<span class="sd">      posting_or_kv_list: a list of Posting or KeyValue instances, to be inserted in</span>
<span class="sd">        this transaction, or None, if no postings have been declared.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new Transaction object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span>

    <span class="c1"># Separate postings and key-values.</span>
    <span class="n">explicit_meta</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">postings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">tags</span><span class="p">,</span> <span class="n">links</span> <span class="o">=</span> <span class="n">tags_links</span><span class="o">.</span><span class="n">tags</span><span class="p">,</span> <span class="n">tags_links</span><span class="o">.</span><span class="n">links</span>
    <span class="k">if</span> <span class="n">posting_or_kv_list</span><span class="p">:</span>
        <span class="n">last_posting</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">posting_or_kv</span> <span class="ow">in</span> <span class="n">posting_or_kv_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">posting_or_kv</span><span class="p">,</span> <span class="n">Posting</span><span class="p">):</span>
                <span class="n">postings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">posting_or_kv</span><span class="p">)</span>
                <span class="n">last_posting</span> <span class="o">=</span> <span class="n">posting_or_kv</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">posting_or_kv</span><span class="p">,</span> <span class="n">TagsLinks</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">postings</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">ParserError</span><span class="p">(</span>
                            <span class="n">meta</span><span class="p">,</span>
                            <span class="s2">&quot;Tags or links not allowed after first &quot;</span>
                            <span class="o">+</span> <span class="s2">&quot;Posting: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">posting_or_kv</span><span class="p">),</span>
                            <span class="kc">None</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tags</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">posting_or_kv</span><span class="o">.</span><span class="n">tags</span><span class="p">)</span>
                    <span class="n">links</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">posting_or_kv</span><span class="o">.</span><span class="n">links</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">last_posting</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">explicit_meta</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span>
                        <span class="n">posting_or_kv</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">posting_or_kv</span><span class="o">.</span><span class="n">value</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">posting_or_kv</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">ParserError</span><span class="p">(</span>
                                <span class="n">meta</span><span class="p">,</span>
                                <span class="s2">&quot;Duplicate metadata field on entry: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                    <span class="n">posting_or_kv</span>
                                <span class="p">),</span>
                                <span class="kc">None</span><span class="p">,</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">last_posting</span><span class="o">.</span><span class="n">meta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">last_posting</span> <span class="o">=</span> <span class="n">last_posting</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">meta</span><span class="o">=</span><span class="p">{})</span>
                        <span class="n">postings</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">postings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">last_posting</span><span class="p">)</span>

                    <span class="n">value</span> <span class="o">=</span> <span class="n">last_posting</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span>
                        <span class="n">posting_or_kv</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">posting_or_kv</span><span class="o">.</span><span class="n">value</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">posting_or_kv</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">ParserError</span><span class="p">(</span>
                                <span class="n">meta</span><span class="p">,</span>
                                <span class="s2">&quot;Duplicate posting metadata field: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                    <span class="n">posting_or_kv</span>
                                <span class="p">),</span>
                                <span class="kc">None</span><span class="p">,</span>
                            <span class="p">)</span>
                        <span class="p">)</span>

    <span class="c1"># Freeze the tags &amp; links or set to default empty values.</span>
    <span class="n">tags</span><span class="p">,</span> <span class="n">links</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finalize_tags_links</span><span class="p">(</span><span class="n">tags</span><span class="p">,</span> <span class="n">links</span><span class="p">)</span>

    <span class="c1"># Initialize the metadata fields from the set of active values.</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value_list</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">meta</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Add on explicitly defined values.</span>
    <span class="k">if</span> <span class="n">explicit_meta</span><span class="p">:</span>
        <span class="n">meta</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">explicit_meta</span><span class="p">)</span>

    <span class="c1"># Unpack the transaction fields.</span>
    <span class="n">payee_narration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unpack_txn_strings</span><span class="p">(</span><span class="n">txn_strings</span><span class="p">,</span> <span class="n">meta</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">payee_narration</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">payee</span><span class="p">,</span> <span class="n">narration</span> <span class="o">=</span> <span class="n">payee_narration</span>

    <span class="c1"># We now allow a single posting when its balance is zero, so we</span>
    <span class="c1"># commented out the check below. If a transaction has a single posting</span>
    <span class="c1"># with a non-zero balance, it&#39;ll get caught below in the booking code.</span>
    <span class="c1">#</span>
    <span class="c1"># # Detect when a transaction does not have at least two legs.</span>
    <span class="c1"># if postings is None or len(postings) &lt; 2:</span>
    <span class="c1">#     self.errors.append(</span>
    <span class="c1">#         ParserError(meta,</span>
    <span class="c1">#                     &quot;Transaction with only one posting: {}&quot;.format(postings),</span>
    <span class="c1">#                     None))</span>
    <span class="c1">#     return None</span>

    <span class="c1"># If there are no postings, make sure we insert a list object.</span>
    <span class="k">if</span> <span class="n">postings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">postings</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Create the transaction.</span>
    <span class="k">return</span> <span class="n">Transaction</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="nb">chr</span><span class="p">(</span><span class="n">flag</span><span class="p">),</span> <span class="n">payee</span><span class="p">,</span> <span class="n">narration</span><span class="p">,</span> <span class="n">tags</span><span class="p">,</span> <span class="n">links</span><span class="p">,</span> <span class="n">postings</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="beancount.parser.grammar.CompoundAmount" class="doc doc-heading">
        <code>
beancount.parser.grammar.CompoundAmount            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.parser.grammar.CompoundAmount" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>CompoundAmount(number_per, number_total, currency)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.CompoundAmount.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">CompoundAmount</span><span class="o">.</span><span class="n">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.parser.grammar.CompoundAmount.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return self as a plain tuple.  Used by copy and pickle.&#39;</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.CompoundAmount.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">CompoundAmount</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">number_per</span><span class="p">,</span> <span class="n">number_total</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.parser.grammar.CompoundAmount.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of CompoundAmount(number_per, number_total, currency)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.CompoundAmount.__repr__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">CompoundAmount</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.parser.grammar.CompoundAmount.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return a nicely formatted representation string&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="beancount.parser.grammar.DeprecatedError" class="doc doc-heading">
        <code>
beancount.parser.grammar.DeprecatedError            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.parser.grammar.DeprecatedError" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>DeprecatedError(source, message, entry)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.DeprecatedError.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">DeprecatedError</span><span class="o">.</span><span class="n">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.parser.grammar.DeprecatedError.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return self as a plain tuple.  Used by copy and pickle.&#39;</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.DeprecatedError.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">DeprecatedError</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.parser.grammar.DeprecatedError.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of DeprecatedError(source, message, entry)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.DeprecatedError.__repr__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">DeprecatedError</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.parser.grammar.DeprecatedError.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return a nicely formatted representation string&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="beancount.parser.grammar.KeyValue" class="doc doc-heading">
        <code>
beancount.parser.grammar.KeyValue            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.parser.grammar.KeyValue" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>KeyValue(key, value)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.KeyValue.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">KeyValue</span><span class="o">.</span><span class="n">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.parser.grammar.KeyValue.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return self as a plain tuple.  Used by copy and pickle.&#39;</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.KeyValue.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">KeyValue</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.parser.grammar.KeyValue.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of KeyValue(key, value)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.KeyValue.__repr__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">KeyValue</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.parser.grammar.KeyValue.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return a nicely formatted representation string&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="beancount.parser.grammar.ParserError" class="doc doc-heading">
        <code>
beancount.parser.grammar.ParserError            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.parser.grammar.ParserError" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>ParserError(source, message, entry)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.ParserError.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">ParserError</span><span class="o">.</span><span class="n">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.parser.grammar.ParserError.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return self as a plain tuple.  Used by copy and pickle.&#39;</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.ParserError.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">ParserError</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.parser.grammar.ParserError.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of ParserError(source, message, entry)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.ParserError.__repr__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">ParserError</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.parser.grammar.ParserError.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return a nicely formatted representation string&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="beancount.parser.grammar.ParserSyntaxError" class="doc doc-heading">
        <code>
beancount.parser.grammar.ParserSyntaxError            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.parser.grammar.ParserSyntaxError" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>ParserSyntaxError(source, message, entry)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.ParserSyntaxError.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">ParserSyntaxError</span><span class="o">.</span><span class="n">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.parser.grammar.ParserSyntaxError.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return self as a plain tuple.  Used by copy and pickle.&#39;</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.ParserSyntaxError.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">ParserSyntaxError</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.parser.grammar.ParserSyntaxError.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of ParserSyntaxError(source, message, entry)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.ParserSyntaxError.__repr__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">ParserSyntaxError</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.parser.grammar.ParserSyntaxError.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return a nicely formatted representation string&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="beancount.parser.grammar.TagsLinks" class="doc doc-heading">
        <code>
beancount.parser.grammar.TagsLinks            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.parser.grammar.TagsLinks" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>TagsLinks(tags, links)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.TagsLinks.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">TagsLinks</span><span class="o">.</span><span class="n">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.parser.grammar.TagsLinks.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return self as a plain tuple.  Used by copy and pickle.&#39;</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.TagsLinks.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">TagsLinks</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">tags</span><span class="p">,</span> <span class="n">links</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.parser.grammar.TagsLinks.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of TagsLinks(tags, links)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.TagsLinks.__repr__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">TagsLinks</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.parser.grammar.TagsLinks.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return a nicely formatted representation string&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="beancount.parser.grammar.ValueType" class="doc doc-heading">
        <code>
beancount.parser.grammar.ValueType            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.parser.grammar.ValueType" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>ValueType(value, dtype)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.ValueType.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">ValueType</span><span class="o">.</span><span class="n">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.parser.grammar.ValueType.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return self as a plain tuple.  Used by copy and pickle.&#39;</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.ValueType.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">ValueType</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.parser.grammar.ValueType.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of ValueType(value, dtype)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.grammar.ValueType.__repr__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">ValueType</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.parser.grammar.ValueType.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return a nicely formatted representation string&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.grammar.valid_account_regexp" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">valid_account_regexp</span><span class="p">(</span><span class="n">options</span><span class="p">)</span></code>


<a href="#beancount.parser.grammar.valid_account_regexp" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Build a regexp to validate account names from the options.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>options</strong> – A dict of options, as per beancount.parser.options.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A string, a regular expression that will match all account names.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/grammar.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">valid_account_regexp</span><span class="p">(</span><span class="n">options</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Build a regexp to validate account names from the options.</span>

<span class="sd">    Args:</span>
<span class="sd">      options: A dict of options, as per beancount.parser.options.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, a regular expression that will match all account names.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">names</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span>
        <span class="n">options</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">,</span>
        <span class="p">(</span><span class="s2">&quot;name_assets&quot;</span><span class="p">,</span> <span class="s2">&quot;name_liabilities&quot;</span><span class="p">,</span> <span class="s2">&quot;name_equity&quot;</span><span class="p">,</span> <span class="s2">&quot;name_income&quot;</span><span class="p">,</span> <span class="s2">&quot;name_expenses&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># Replace the first term of the account regular expression with the specific</span>
    <span class="c1"># names allowed under the options configuration. This code is kept in sync</span>
    <span class="c1"># with {5672c7270e1e}.</span>
    <span class="k">return</span> <span class="n">regex</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="s2">&quot;(?:</span><span class="si">{}</span><span class="s2">)(?:</span><span class="si">{}{}</span><span class="s2">)+&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">names</span><span class="p">),</span> <span class="n">account</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span> <span class="n">account</span><span class="o">.</span><span class="n">ACC_COMP_NAME_RE</span><span class="p">)</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.parser.hashsrc" class="doc doc-heading">
        <code>beancount.parser.hashsrc</code>



<a href="#beancount.parser.hashsrc" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Compute a hash of the source files in order to warn when the source goes out of date.</p>



  <div class="doc doc-children">











  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.hashsrc.check_parser_source_files" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">hashsrc</span><span class="o">.</span><span class="n">check_parser_source_files</span><span class="p">(</span><span class="n">parser_module</span><span class="p">)</span></code>


<a href="#beancount.parser.hashsrc.check_parser_source_files" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Check the extension module's source hash and issue a warning if the
current source differs from that of the module.</p>
<p>If the source files aren't located in the Python source directory, ignore
the warning, we're probably running this from an installed based, in which
case we don't need to check anything (this check is useful only for people
running directly from source).</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/hashsrc.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">check_parser_source_files</span><span class="p">(</span><span class="n">parser_module</span><span class="p">:</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check the extension module&#39;s source hash and issue a warning if the</span>
<span class="sd">    current source differs from that of the module.</span>

<span class="sd">    If the source files aren&#39;t located in the Python source directory, ignore</span>
<span class="sd">    the warning, we&#39;re probably running this from an installed based, in which</span>
<span class="sd">    case we don&#39;t need to check anything (this check is useful only for people</span>
<span class="sd">    running directly from source).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parser_source_hash</span> <span class="o">=</span> <span class="n">hash_parser_source_files</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">parser_source_hash</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">parser_module</span><span class="o">.</span><span class="n">SOURCE_HASH</span> <span class="ow">and</span> <span class="n">parser_module</span><span class="o">.</span><span class="n">SOURCE_HASH</span> <span class="o">!=</span> <span class="n">parser_source_hash</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;The Beancount parser C extension module is out-of-date (&#39;</span><span class="si">{}</span><span class="s2">&#39; != &#39;</span><span class="si">{}</span><span class="s2">&#39;). &quot;</span>
                <span class="s2">&quot;You need to rebuild.&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">parser_module</span><span class="o">.</span><span class="n">SOURCE_HASH</span><span class="p">,</span> <span class="n">parser_source_hash</span><span class="p">)</span>
        <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.hashsrc.gen_include" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">hashsrc</span><span class="o">.</span><span class="n">gen_include</span><span class="p">()</span></code>


<a href="#beancount.parser.hashsrc.gen_include" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Generate an include file for the parser source hash.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/hashsrc.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">gen_include</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate an include file for the parser source hash.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">      #ifndef __BEANCOUNT_PARSER_PARSE_SOURCE_HASH_H__</span>
<span class="sd">      #define __BEANCOUNT_PARSER_PARSE_SOURCE_HASH_H__</span>

<span class="sd">      #define PARSER_SOURCE_HASH {source_hash}</span>

<span class="sd">      #endif // __BEANCOUNT_PARSER_PARSE_SOURCE_HASH_H__</span>
<span class="sd">    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">source_hash</span><span class="o">=</span><span class="n">hash_parser_source_files</span><span class="p">())</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.hashsrc.hash_parser_source_files" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">hashsrc</span><span class="o">.</span><span class="n">hash_parser_source_files</span><span class="p">()</span></code>


<a href="#beancount.parser.hashsrc.hash_parser_source_files" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Compute a unique hash of the parser's Python code in order to bake that into
the extension module. This is used at load-time to verify that the extension
module and the corresponding Python codes match each other. If not, it
issues a warning that you should rebuild your extension module.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A string, the hexadecimal unique hash of relevant source code that should
trigger a recompilation.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/hashsrc.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">hash_parser_source_files</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute a unique hash of the parser&#39;s Python code in order to bake that into</span>
<span class="sd">    the extension module. This is used at load-time to verify that the extension</span>
<span class="sd">    module and the corresponding Python codes match each other. If not, it</span>
<span class="sd">    issues a warning that you should rebuild your extension module.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A string, the hexadecimal unique hash of relevant source code that should</span>
<span class="sd">      trigger a recompilation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">md5</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">PARSER_SOURCE_FILES</span><span class="p">:</span>
        <span class="n">fullname</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fullname</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fullname</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">md5</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="c1"># Note: Prepend a character in front of the hash because under Windows MSDEV</span>
    <span class="c1"># removes escapes, and if the hash starts with a number it fails to</span>
    <span class="c1"># recognize this is a string. A small compromise for portability.</span>
    <span class="k">return</span> <span class="n">md5</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>







  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.parser.lexer" class="doc doc-heading">
        <code>beancount.parser.lexer</code>



<a href="#beancount.parser.lexer" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Beancount syntax lexer.</p>



  <div class="doc doc-children">









  <div class="doc doc-object doc-class">



<h3 id="beancount.parser.lexer.LexBuilder" class="doc doc-heading">
        <code>
beancount.parser.lexer.LexBuilder        </code>



<a href="#beancount.parser.lexer.LexBuilder" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A builder used only for building lexer objects.</p>




  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.lexer.LexBuilder.build_lexer_error" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">LexBuilder</span><span class="o">.</span><span class="n">build_lexer_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span></code>


<a href="#beancount.parser.lexer.LexBuilder.build_lexer_error" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Build a lexer error and appends it to the list of pending errors.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>message</strong> – The message of the error.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/lexer.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">build_lexer_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>  <span class="c1"># {0e31aeca3363}</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Build a lexer error and appends it to the list of pending errors.</span>

<span class="sd">    Args:</span>
<span class="sd">      message: The message of the error.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">LexerError</span><span class="p">(</span><span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">message</span><span class="p">),</span> <span class="kc">None</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="beancount.parser.lexer.LexerError" class="doc doc-heading">
        <code>
beancount.parser.lexer.LexerError            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.parser.lexer.LexerError" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>LexerError(source, message, entry)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.lexer.LexerError.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">LexerError</span><span class="o">.</span><span class="n">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.parser.lexer.LexerError.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/lexer.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return self as a plain tuple.  Used by copy and pickle.&#39;</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.lexer.LexerError.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">LexerError</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.parser.lexer.LexerError.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of LexerError(source, message, entry)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.lexer.LexerError.__repr__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">LexerError</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.parser.lexer.LexerError.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/lexer.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return a nicely formatted representation string&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.lexer.lex_iter" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lex_iter</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">builder</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#beancount.parser.lexer.lex_iter" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>An iterator that yields all the tokens in the given file.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>file</strong> – A string, the filename to run the lexer on, or a file object.</p></li>
            <li><p><strong>builder</strong> – A builder of your choice. If not specified, a LexBuilder is
used and discarded (along with its errors).</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  All the tokens in the input file as <code>(token, lineno, text,
  value)</code> tuples where <code>token</code> is a string representing the
  token kind, <code>lineno</code> is the line number in the input file
  where the token was matched, <code>mathed</code> is a bytes object
  containing the exact text matched, and <code>value</code> is the semantic
  value of the token or None.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/lexer.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">lex_iter</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">builder</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An iterator that yields all the tokens in the given file.</span>

<span class="sd">    Args:</span>
<span class="sd">      file: A string, the filename to run the lexer on, or a file object.</span>
<span class="sd">      builder: A builder of your choice. If not specified, a LexBuilder is</span>
<span class="sd">        used and discarded (along with its errors).</span>
<span class="sd">    Yields:</span>
<span class="sd">      All the tokens in the input file as ``(token, lineno, text,</span>
<span class="sd">      value)`` tuples where ``token`` is a string representing the</span>
<span class="sd">      token kind, ``lineno`` is the line number in the input file</span>
<span class="sd">      where the token was matched, ``mathed`` is a bytes object</span>
<span class="sd">      containing the exact text matched, and ``value`` is the semantic</span>
<span class="sd">      value of the token or None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">ExitStack</span><span class="p">()</span> <span class="k">as</span> <span class="n">ctx</span><span class="p">:</span>
        <span class="c1"># It would be more appropriate here to check for io.RawIOBase but</span>
        <span class="c1"># that does not work for io.BytesIO despite it implementing the</span>
        <span class="c1"># readinto() method.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">IOBase</span><span class="p">):</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">enter_context</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">builder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">builder</span> <span class="o">=</span> <span class="n">LexBuilder</span><span class="p">()</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">_parser</span><span class="o">.</span><span class="n">Parser</span><span class="p">(</span><span class="n">builder</span><span class="p">)</span>
        <span class="k">yield from</span> <span class="n">parser</span><span class="o">.</span><span class="n">lex</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.lexer.lex_iter_string" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lex_iter_string</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">builder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#beancount.parser.lexer.lex_iter_string" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>An iterator that yields all the tokens in the given string.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>string</strong> – a str or bytes, the contents of the ledger to be parsed.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>An iterator, see <code>lex_iter()</code> for details.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/lexer.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">lex_iter_string</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">builder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An iterator that yields all the tokens in the given string.</span>

<span class="sd">    Args:</span>
<span class="sd">      string: a str or bytes, the contents of the ledger to be parsed.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An iterator, see ``lex_iter()`` for details.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
    <span class="n">file</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
    <span class="k">yield from</span> <span class="n">lex_iter</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">builder</span><span class="o">=</span><span class="n">builder</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.parser.options" class="doc doc-heading">
        <code>beancount.parser.options</code>



<a href="#beancount.parser.options" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Declaration of options and their default values.</p>



  <div class="doc doc-children">
















  <div class="doc doc-object doc-class">



<h3 id="beancount.parser.options.OptDesc" class="doc doc-heading">
        <code>
beancount.parser.options.OptDesc            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.parser.options.OptDesc" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>OptDesc(name, default_value, example_value, converter, deprecated, alias)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.options.OptDesc.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">OptDesc</span><span class="o">.</span><span class="n">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.parser.options.OptDesc.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/options.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return self as a plain tuple.  Used by copy and pickle.&#39;</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.options.OptDesc.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">OptDesc</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">default_value</span><span class="p">,</span> <span class="n">example_value</span><span class="p">,</span> <span class="n">converter</span><span class="p">,</span> <span class="n">deprecated</span><span class="p">,</span> <span class="n">alias</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.parser.options.OptDesc.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of OptDesc(name, default_value, example_value, converter, deprecated, alias)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.options.OptDesc.__repr__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">OptDesc</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.parser.options.OptDesc.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/options.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return a nicely formatted representation string&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="beancount.parser.options.OptGroup" class="doc doc-heading">
        <code>
beancount.parser.options.OptGroup            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.parser.options.OptGroup" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>OptGroup(description, options)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.options.OptGroup.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">OptGroup</span><span class="o">.</span><span class="n">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.parser.options.OptGroup.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/options.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return self as a plain tuple.  Used by copy and pickle.&#39;</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.options.OptGroup.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">OptGroup</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.parser.options.OptGroup.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of OptGroup(description, options)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.options.OptGroup.__repr__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">OptGroup</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.parser.options.OptGroup.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/options.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return a nicely formatted representation string&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.options.Opt" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">Opt</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">default_value</span><span class="p">,</span> <span class="n">example_value</span><span class="o">=&lt;</span><span class="nb">object</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x78fcdfec0a20</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">converter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">deprecated</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">alias</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#beancount.parser.options.Opt" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Alternative constructor for OptDesc, with default values.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>name</strong> – See OptDesc.</p></li>
            <li><p><strong>default_value</strong> – See OptDesc.</p></li>
            <li><p><strong>example_value</strong> – See OptDesc.</p></li>
            <li><p><strong>converter</strong> – See OptDesc.</p></li>
            <li><p><strong>deprecated</strong> – See OptDesc.</p></li>
            <li><p><strong>alias</strong> – See OptDesc.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>An instance of OptDesc.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/options.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">Opt</span><span class="p">(</span>
    <span class="n">name</span><span class="p">,</span> <span class="n">default_value</span><span class="p">,</span> <span class="n">example_value</span><span class="o">=</span><span class="n">UNSET</span><span class="p">,</span> <span class="n">converter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">deprecated</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">alias</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Alternative constructor for OptDesc, with default values.</span>

<span class="sd">    Args:</span>
<span class="sd">      name: See OptDesc.</span>
<span class="sd">      default_value: See OptDesc.</span>
<span class="sd">      example_value: See OptDesc.</span>
<span class="sd">      converter: See OptDesc.</span>
<span class="sd">      deprecated: See OptDesc.</span>
<span class="sd">      alias: See OptDesc.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An instance of OptDesc.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">example_value</span> <span class="ow">is</span> <span class="n">UNSET</span><span class="p">:</span>
        <span class="n">example_value</span> <span class="o">=</span> <span class="n">default_value</span>
    <span class="k">return</span> <span class="n">OptDesc</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">default_value</span><span class="p">,</span> <span class="n">example_value</span><span class="p">,</span> <span class="n">converter</span><span class="p">,</span> <span class="n">deprecated</span><span class="p">,</span> <span class="n">alias</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.options.get_account_types" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get_account_types</span><span class="p">(</span><span class="n">options</span><span class="p">)</span></code>


<a href="#beancount.parser.options.get_account_types" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Extract the account type names from the parser's options.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>options</strong> – a dict of ledger options.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>An instance of AccountTypes, that contains all the prefixes.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/options.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_account_types</span><span class="p">(</span><span class="n">options</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract the account type names from the parser&#39;s options.</span>

<span class="sd">    Args:</span>
<span class="sd">      options: a dict of ledger options.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An instance of AccountTypes, that contains all the prefixes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">account_types</span><span class="o">.</span><span class="n">AccountTypes</span><span class="p">(</span>
        <span class="o">*</span><span class="p">[</span>
            <span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="s2">&quot;name_assets&quot;</span><span class="p">,</span>
                <span class="s2">&quot;name_liabilities&quot;</span><span class="p">,</span>
                <span class="s2">&quot;name_equity&quot;</span><span class="p">,</span>
                <span class="s2">&quot;name_income&quot;</span><span class="p">,</span>
                <span class="s2">&quot;name_expenses&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">]</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.options.get_current_accounts" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get_current_accounts</span><span class="p">(</span><span class="n">options</span><span class="p">)</span></code>


<a href="#beancount.parser.options.get_current_accounts" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Return account names for the current earnings and conversion accounts.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>options</strong> – a dict of ledger options.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A tuple of 2 account objects, one for booking current earnings, and one
for current conversions.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/options.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_current_accounts</span><span class="p">(</span><span class="n">options</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return account names for the current earnings and conversion accounts.</span>

<span class="sd">    Args:</span>
<span class="sd">      options: a dict of ledger options.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A tuple of 2 account objects, one for booking current earnings, and one</span>
<span class="sd">      for current conversions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">equity</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;name_equity&quot;</span><span class="p">]</span>
    <span class="n">account_current_earnings</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">equity</span><span class="p">,</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;account_current_earnings&quot;</span><span class="p">])</span>
    <span class="n">account_current_conversions</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">equity</span><span class="p">,</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;account_current_conversions&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">account_current_earnings</span><span class="p">,</span> <span class="n">account_current_conversions</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.options.get_previous_accounts" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get_previous_accounts</span><span class="p">(</span><span class="n">options</span><span class="p">)</span></code>


<a href="#beancount.parser.options.get_previous_accounts" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Return account names for the previous earnings, balances and conversion accounts.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>options</strong> – a dict of ledger options.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A tuple of 3 account objects, for booking previous earnings,
previous balances, and previous conversions.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/options.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_previous_accounts</span><span class="p">(</span><span class="n">options</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return account names for the previous earnings, balances and conversion accounts.</span>

<span class="sd">    Args:</span>
<span class="sd">      options: a dict of ledger options.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A tuple of 3 account objects, for booking previous earnings,</span>
<span class="sd">      previous balances, and previous conversions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">equity</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;name_equity&quot;</span><span class="p">]</span>
    <span class="n">account_previous_earnings</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">equity</span><span class="p">,</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;account_previous_earnings&quot;</span><span class="p">])</span>
    <span class="n">account_previous_balances</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">equity</span><span class="p">,</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;account_previous_balances&quot;</span><span class="p">])</span>
    <span class="n">account_previous_conversions</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">equity</span><span class="p">,</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;account_previous_conversions&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">account_previous_earnings</span><span class="p">,</span>
        <span class="n">account_previous_balances</span><span class="p">,</span>
        <span class="n">account_previous_conversions</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.options.get_unrealized_account" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get_unrealized_account</span><span class="p">(</span><span class="n">options</span><span class="p">)</span></code>


<a href="#beancount.parser.options.get_unrealized_account" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Return the full account name for the unrealized account.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>options</strong> – a dict of ledger options.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A tuple of 2 account objects, one for booking current earnings, and one
for current conversions.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/options.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_unrealized_account</span><span class="p">(</span><span class="n">options</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the full account name for the unrealized account.</span>

<span class="sd">    Args:</span>
<span class="sd">      options: a dict of ledger options.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A tuple of 2 account objects, one for booking current earnings, and one</span>
<span class="sd">      for current conversions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">income</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;name_income&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">account</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">income</span><span class="p">,</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;account_unrealized_gains&quot;</span><span class="p">])</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.options.list_options" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">list_options</span><span class="p">()</span></code>


<a href="#beancount.parser.options.list_options" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Produce a formatted text of the available options and their description.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A string, formatted nicely to be printed in 80 columns.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/options.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">list_options</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Produce a formatted text of the available options and their description.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A string, formatted nicely to be printed in 80 columns.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">oss</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">PUBLIC_OPTION_GROUPS</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">desc</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;option &quot;</span><span class="si">{}</span><span class="s1">&quot; &quot;</span><span class="si">{}</span><span class="s1">&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">desc</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">desc</span><span class="o">.</span><span class="n">example_value</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">desc</span><span class="o">.</span><span class="n">deprecated</span><span class="p">:</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span>
                        <span class="s2">&quot;THIS OPTION IS DEPRECATED: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">desc</span><span class="o">.</span><span class="n">deprecated</span><span class="p">),</span>
                        <span class="n">initial_indent</span><span class="o">=</span><span class="s2">&quot;  &quot;</span><span class="p">,</span>
                        <span class="n">subsequent_indent</span><span class="o">=</span><span class="s2">&quot;  &quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">description</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">description</span><span class="p">,</span> <span class="n">initial_indent</span><span class="o">=</span><span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="n">subsequent_indent</span><span class="o">=</span><span class="s2">&quot;  &quot;</span><span class="p">))</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">desc</span><span class="o">.</span><span class="n">default_value</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">set</span><span class="p">)):</span>
            <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  (This option may be supplied multiple times.)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">oss</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.options.options_validate_booking_method" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">options_validate_booking_method</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>


<a href="#beancount.parser.options.options_validate_booking_method" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Validate a booking method name.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>value</strong> – A string, the value provided as option.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>The new value, converted, if the conversion is successful.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>ValueError</code> – If the value is invalid.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/options.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">options_validate_booking_method</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate a booking method name.</span>

<span class="sd">    Args:</span>
<span class="sd">      value: A string, the value provided as option.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The new value, converted, if the conversion is successful.</span>
<span class="sd">    Raises:</span>
<span class="sd">      ValueError: If the value is invalid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">Booking</span><span class="p">[</span><span class="n">value</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">))</span> <span class="kn">from</span> <span class="nn">exc</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.options.options_validate_boolean" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">options_validate_boolean</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>


<a href="#beancount.parser.options.options_validate_boolean" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Validate a boolean option.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>value</strong> – A string, the value provided as option.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>The new value, converted, if the conversion is successful.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>ValueError</code> – If the value is invalid.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/options.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">options_validate_boolean</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate a boolean option.</span>

<span class="sd">    Args:</span>
<span class="sd">      value: A string, the value provided as option.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The new value, converted, if the conversion is successful.</span>
<span class="sd">    Raises:</span>
<span class="sd">      ValueError: If the value is invalid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="s2">&quot;yes&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.options.options_validate_plugin" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">options_validate_plugin</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>


<a href="#beancount.parser.options.options_validate_plugin" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Validate the plugin option.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>value</strong> – A string, the value provided as option.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>The new value, converted, if the conversion is successful.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>ValueError</code> – If the value is invalid.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/options.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">options_validate_plugin</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate the plugin option.</span>

<span class="sd">    Args:</span>
<span class="sd">      value: A string, the value provided as option.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The new value, converted, if the conversion is successful.</span>
<span class="sd">    Raises:</span>
<span class="sd">      ValueError: If the value is invalid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Process the &#39;plugin&#39; option specially: accept an optional</span>
    <span class="c1"># argument from it. NOTE: We will eventually phase this out and</span>
    <span class="c1"># replace it by a dedicated &#39;plugin&#39; directive.</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;(.*):(.*)&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
        <span class="n">plugin_name</span><span class="p">,</span> <span class="n">plugin_config</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plugin_name</span><span class="p">,</span> <span class="n">plugin_config</span> <span class="o">=</span> <span class="n">value</span><span class="p">,</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">plugin_name</span><span class="p">,</span> <span class="n">plugin_config</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.options.options_validate_processing_mode" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">options_validate_processing_mode</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>


<a href="#beancount.parser.options.options_validate_processing_mode" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Validate the options processing mode.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>value</strong> – A string, the value provided as option.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>The new value, converted, if the conversion is successful.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>ValueError</code> – If the value is invalid.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/options.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">options_validate_processing_mode</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate the options processing mode.</span>

<span class="sd">    Args:</span>
<span class="sd">      value: A string, the value provided as option.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The new value, converted, if the conversion is successful.</span>
<span class="sd">    Raises:</span>
<span class="sd">      ValueError: If the value is invalid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;raw&quot;</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid value &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.options.options_validate_tolerance" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">options_validate_tolerance</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>


<a href="#beancount.parser.options.options_validate_tolerance" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Validate the tolerance option.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>value</strong> – A string, the value provided as option.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>The new value, converted, if the conversion is successful.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>ValueError</code> – If the value is invalid.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/options.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">options_validate_tolerance</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate the tolerance option.</span>

<span class="sd">    Args:</span>
<span class="sd">      value: A string, the value provided as option.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The new value, converted, if the conversion is successful.</span>
<span class="sd">    Raises:</span>
<span class="sd">      ValueError: If the value is invalid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">D</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.options.options_validate_tolerance_map" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">options_validate_tolerance_map</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>


<a href="#beancount.parser.options.options_validate_tolerance_map" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Validate an option with a map of currency/tolerance pairs in a string.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>value</strong> – A string, the value provided as option.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>The new value, converted, if the conversion is successful.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>ValueError</code> – If the value is invalid.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/options.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">options_validate_tolerance_map</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate an option with a map of currency/tolerance pairs in a string.</span>

<span class="sd">    Args:</span>
<span class="sd">      value: A string, the value provided as option.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The new value, converted, if the conversion is successful.</span>
<span class="sd">    Raises:</span>
<span class="sd">      ValueError: If the value is invalid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Process the setting of a key-value, whereby the value is a Decimal</span>
    <span class="c1"># representation.</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;(.*):(.*)&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid value &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
    <span class="n">currency</span><span class="p">,</span> <span class="n">tolerance_str</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="n">D</span><span class="p">(</span><span class="n">tolerance_str</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.parser.parser" class="doc doc-heading">
        <code>beancount.parser.parser</code>



<a href="#beancount.parser.parser" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Beancount syntax parser.</p>
<p>IMPORTANT: The parser (and its grammar builder) produces "incomplete"
Transaction objects. This means that some of the data can be found missing from
the output of the parser and some of the data types vary slightly. Missing
components are replaced not by None, but by a special constant 'NA' which helps
diagnose problems if a user inadvertently attempts to work on an incomplete
posting instead of a complete one. Those incomplete entries are then run through
the "booking" routines which do two things simultaneously:</p>
<ol>
<li>They find matching lots for reducing inventory positions, and</li>
<li>They interpolate missing numbers.</li>
</ol>
<p>In doing so they normalize the entries to "complete" entries by converting a
position/lot's "cost" attribute from a CostSpec to a Cost. A Cost is similar to
an Amount in that it shares "number" and "currency" attributes, but also has a
label and a lot date. A CostSpec is similar to a Cost, but has all optional
data; it consists in a specification for matching against a particular inventory
lot.</p>
<p>Other parts of a posting may also be missing, not just parts of the cost.
Leaving out some parts of the input is used to invoke interpolation, to tell
Beancount to automatically compute the missing numbers (if possible).</p>
<p>Missing components will be set to the special value
"beancount.core.number.MISSING" until inventory booking and number interpolation
has been completed. The "MISSING" value should never appear in completed, loaded
transaction postings.</p>
<p>For instance, all of the units may be missing:</p>
<p>INPUT: Assets:Account
  posting.units = MISSING</p>
<p>Or just the number of the units:</p>
<p>INPUT: Assets:Account                    USD
  posting.units = Amount(MISSING, "USD")</p>
<p>You must always specify the currency.</p>
<p>If a price annotation is simply absent, it appears as None:</p>
<p>INPUT: Assets:Account                 2 MXN
  posting.price = None</p>
<p>However, you may indicate that there is a price but have Beancount compute it
automatically:</p>
<p>INPUT: Assets:Account                 2 MXN @
  posting.price = Amount(MISSING, MISSING)</p>
<p>Indicating the conversion currency is also possible (and recommended):</p>
<p>INPUT: Assets:Account                 2 MXN @ USD
  posting.price = Amount(MISSING, "USD")</p>
<p>If a cost specification is provided, a "cost" attribute it set but it does not
refer to a Cost instance (as in complete entries) but rather to a CostSpec
instance. Some of the fields of a CostSpec may be MISSING if they were not
specified in the input. For example:</p>
<p>INPUT: Assets:Account  1 HOOL {100 # 5 USD}
  posting.cost = CostSpec(Decimal("100"), Decimal("5"), "USD", None, None, False))</p>
<p>Note how we never consider the label of date override to be MISSING; this is
because those inputs are optional: A missing label is simply left unset in the
computed Cost, and a missing date override uses the date of the transaction
that contains the posting.</p>
<p>You can indicate that there is a total number to be filled in like this:</p>
<p>INPUT: Assets:Account  1 HOOL {100 # USD}
  posting.cost = CostSpec(Decimal("100"), MISSING, "USD", None, None, False))</p>
<p>This is in contrast to the total value simple not being used:</p>
<p>INPUT: Assets:Account  1 HOOL {100 USD}
  posting.cost = CostSpec(Decimal("100"), None, "USD", None, None, False))</p>
<p>Both per-unit and total numbers may be omitted as well, in which case, only the
number-per-unit portion of the CostSpec will appear as MISSING:</p>
<p>INPUT: Assets:Account  1 HOOL {USD}
  posting.cost = CostSpec(MISSING, None, "USD", None, None, False))</p>
<p>And furthermore, all the cost basis may be missing:</p>
<p>INPUT: Assets:Account  1 HOOL {}
  posting.cost = CostSpec(MISSING, None, MISSING, None, None, False))</p>
<p>If you ask for the lots to be merged, you get this:</p>
<p>INPUT: Assets:Account  1 HOOL {*}
  posting.cost = CostSpec(MISSING, None, MISSING, None, None, True))</p>
<p>The numbers have to be computed by Beancount, so we output this with MISSING
values.</p>
<p>Of course, you can provide only the non-basis information, like just the date
or label:</p>
<p>INPUT: Assets:Account  1 HOOL {2015-09-21}
  posting.cost = CostSpec(MISSING, None, MISSING, date(2015, 9, 21), None, True)</p>
<p>See the test beancount.parser.grammar_test.TestIncompleteInputs for examples and
corresponding expected values.</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.parser.is_entry_incomplete" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">is_entry_incomplete</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span></code>


<a href="#beancount.parser.parser.is_entry_incomplete" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Detect the presence of elided amounts in Transactions.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A directive.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A boolean, true if there are some missing portions of any postings found.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/parser.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">is_entry_incomplete</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detect the presence of elided amounts in Transactions.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A directive.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A boolean, true if there are some missing portions of any postings found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Transaction</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">is_posting_incomplete</span><span class="p">(</span><span class="n">posting</span><span class="p">)</span> <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.parser.is_posting_incomplete" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">is_posting_incomplete</span><span class="p">(</span><span class="n">posting</span><span class="p">)</span></code>


<a href="#beancount.parser.parser.is_posting_incomplete" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Detect the presence of any elided amounts in a Posting.</p>
<p>If any of the possible amounts are missing, this returns True.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A directive.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A boolean, true if there are some missing portions of any postings found.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/parser.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">is_posting_incomplete</span><span class="p">(</span><span class="n">posting</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detect the presence of any elided amounts in a Posting.</span>

<span class="sd">    If any of the possible amounts are missing, this returns True.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A directive.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A boolean, true if there are some missing portions of any postings found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">units</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span>
    <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="n">MISSING</span> <span class="ow">or</span> <span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="ow">is</span> <span class="n">MISSING</span> <span class="ow">or</span> <span class="n">units</span><span class="o">.</span><span class="n">currency</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="n">price</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">price</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="n">price</span> <span class="ow">is</span> <span class="n">MISSING</span>
        <span class="ow">or</span> <span class="n">price</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="ow">and</span> <span class="p">(</span><span class="n">price</span><span class="o">.</span><span class="n">number</span> <span class="ow">is</span> <span class="n">MISSING</span> <span class="ow">or</span> <span class="n">price</span><span class="o">.</span><span class="n">currency</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="n">cost</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span>
    <span class="k">if</span> <span class="n">cost</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span>
        <span class="n">cost</span><span class="o">.</span><span class="n">number_per</span> <span class="ow">is</span> <span class="n">MISSING</span>
        <span class="ow">or</span> <span class="n">cost</span><span class="o">.</span><span class="n">number_total</span> <span class="ow">is</span> <span class="n">MISSING</span>
        <span class="ow">or</span> <span class="n">cost</span><span class="o">.</span><span class="n">currency</span> <span class="ow">is</span> <span class="n">MISSING</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.parser.parse_doc" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_doc</span><span class="p">(</span><span class="n">expect_errors</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_incomplete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#beancount.parser.parser.parse_doc" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Factory of decorators that parse the function's docstring as an argument.</p>
<p>Note that the decorators thus generated only run the parser on the tests,
not the loader, so is no validation, balance checks, nor plugins applied to
the parsed text.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>expect_errors</strong> – A boolean or None, with the following semantics,
True: Expect errors and fail if there are none.
False: Expect no errors and fail if there are some.
None: Do nothing, no check.</p></li>
            <li><p><strong>allow_incomplete</strong> – A boolean, if true, allow incomplete input. Otherwise
barf if the input would require interpolation. The default value is set
not to allow it because we want to minimize the features tests depend on.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A decorator for test functions.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/parser.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">parse_doc</span><span class="p">(</span><span class="n">expect_errors</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_incomplete</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Factory of decorators that parse the function&#39;s docstring as an argument.</span>

<span class="sd">    Note that the decorators thus generated only run the parser on the tests,</span>
<span class="sd">    not the loader, so is no validation, balance checks, nor plugins applied to</span>
<span class="sd">    the parsed text.</span>

<span class="sd">    Args:</span>
<span class="sd">      expect_errors: A boolean or None, with the following semantics,</span>
<span class="sd">        True: Expect errors and fail if there are none.</span>
<span class="sd">        False: Expect no errors and fail if there are some.</span>
<span class="sd">        None: Do nothing, no check.</span>
<span class="sd">      allow_incomplete: A boolean, if true, allow incomplete input. Otherwise</span>
<span class="sd">        barf if the input would require interpolation. The default value is set</span>
<span class="sd">        not to allow it because we want to minimize the features tests depend on.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A decorator for test functions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">fun</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A decorator that parses the function&#39;s docstring as an argument.</span>

<span class="sd">        Args:</span>
<span class="sd">          fun: the function object to be decorated.</span>
<span class="sd">        Returns:</span>
<span class="sd">          A decorated test function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getfile</span><span class="p">(</span><span class="n">fun</span><span class="p">)</span>
        <span class="n">lines</span><span class="p">,</span> <span class="n">lineno</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsourcelines</span><span class="p">(</span><span class="n">fun</span><span class="p">)</span>

        <span class="c1"># Skip over decorator invocation and function definition. This</span>
        <span class="c1"># is imperfect as it assumes that each consumes exactly one</span>
        <span class="c1"># line, but this is by far the most common case, and this is</span>
        <span class="c1"># mainly used in test, thus it is good enough.</span>
        <span class="n">lineno</span> <span class="o">+=</span> <span class="mi">2</span>

        <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">fun</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">fun</span><span class="o">.</span><span class="vm">__doc__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;You need to insert a docstring on </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">fun</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="p">)</span>
            <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">options_map</span> <span class="o">=</span> <span class="n">parse_string</span><span class="p">(</span>
                <span class="n">fun</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">,</span> <span class="n">report_filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">report_firstline</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">dedent</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_incomplete</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span>
                <span class="n">is_entry_incomplete</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;parse_doc() may not use interpolation.&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">expect_errors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">expect_errors</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">errors</span><span class="p">:</span>
                    <span class="n">oss</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
                    <span class="n">printer</span><span class="o">.</span><span class="n">print_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">oss</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Unexpected errors found:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">oss</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()))</span>
                <span class="k">elif</span> <span class="n">expect_errors</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">errors</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Expected errors, none found:&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">fun</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">options_map</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">wrapper</span>

    <span class="k">return</span> <span class="n">decorator</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.parser.parse_file" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_file</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">report_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">report_firstline</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></code>


<a href="#beancount.parser.parser.parse_file" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Parse a beancount input file and return Ledger with the list of
transactions and tree of accounts.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>file</strong> – file object or path to the file to be parsed.</p></li>
            <li><p><strong>kw</strong> – a dict of keywords to be applied to the C parser.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A tuple of (
  list of entries parsed in the file,
  list of errors that were encountered during parsing, and
  a dict of the option values that were parsed from the file.)</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/parser.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">parse_file</span><span class="p">(</span>
    <span class="n">file</span><span class="p">,</span> <span class="n">report_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">report_firstline</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse a beancount input file and return Ledger with the list of</span>
<span class="sd">    transactions and tree of accounts.</span>

<span class="sd">    Args:</span>
<span class="sd">      file: file object or path to the file to be parsed.</span>
<span class="sd">      kw: a dict of keywords to be applied to the C parser.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A tuple of (</span>
<span class="sd">        list of entries parsed in the file,</span>
<span class="sd">        list of errors that were encountered during parsing, and</span>
<span class="sd">        a dict of the option values that were parsed from the file.)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">codecs</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Only UTF-8 encoded files are supported.&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">ExitStack</span><span class="p">()</span> <span class="k">as</span> <span class="n">ctx</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">file</span> <span class="o">==</span> <span class="s2">&quot;-&quot;</span><span class="p">:</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">buffer</span>
        <span class="c1"># It would be more appropriate here to check for io.RawIOBase but</span>
        <span class="c1"># that does not work for io.BytesIO despite it implementing the</span>
        <span class="c1"># readinto() method.</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">IOBase</span><span class="p">):</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">enter_context</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
        <span class="n">builder</span> <span class="o">=</span> <span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="p">()</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">_parser</span><span class="o">.</span><span class="n">Parser</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">report_filename</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">report_firstline</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">builder</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.parser.parse_many" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_many</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>


<a href="#beancount.parser.parser.parse_many" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Parse a string with a snippet of Beancount input and replace vars from caller.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>string</strong> – A string with some Beancount input.</p></li>
            <li><p><strong>level</strong> – The number of extra stacks to ignore.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of entries.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>AssertionError</code> – If there are any errors.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/parser.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">parse_many</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse a string with a snippet of Beancount input and replace vars from caller.</span>

<span class="sd">    Args:</span>
<span class="sd">      string: A string with some Beancount input.</span>
<span class="sd">      level: The number of extra stacks to ignore.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of entries.</span>
<span class="sd">    Raises:</span>
<span class="sd">      AssertionError: If there are any errors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get the locals in the stack for the callers and produce the final text.</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">varkwds</span> <span class="o">=</span> <span class="n">frame</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">f_locals</span>
    <span class="n">input_string</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">varkwds</span><span class="p">))</span>

    <span class="c1"># Parse entries and check there are no errors.</span>
    <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">__</span> <span class="o">=</span> <span class="n">parse_string</span><span class="p">(</span><span class="n">input_string</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">errors</span>

    <span class="k">return</span> <span class="n">entries</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.parser.parse_one" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_one</span><span class="p">(</span><span class="n">string</span><span class="p">)</span></code>


<a href="#beancount.parser.parser.parse_one" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Parse a string with single Beancount directive and replace vars from caller.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>string</strong> – A string with some Beancount input.</p></li>
            <li><p><strong>level</strong> – The number of extra stacks to ignore.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of entries.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>AssertionError</code> – If there are any errors.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/parser.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">parse_one</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse a string with single Beancount directive and replace vars from caller.</span>

<span class="sd">    Args:</span>
<span class="sd">      string: A string with some Beancount input.</span>
<span class="sd">      level: The number of extra stacks to ignore.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of entries.</span>
<span class="sd">    Raises:</span>
<span class="sd">      AssertionError: If there are any errors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">entries</span> <span class="o">=</span> <span class="n">parse_many</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">entries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.parser.parse_string" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_string</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">report_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dedent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></code>


<a href="#beancount.parser.parser.parse_string" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Parse a beancount input file and return Ledger with the list of
transactions and tree of accounts.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>string</strong> – A string, the contents to be parsed instead of a file's.</p></li>
            <li><p><strong>report_filename</strong> – A string, the source filename from which this string
has been extracted, if any. This is stored in the metadata of the
parsed entries.</p></li>
            <li><p><strong>dedent</strong> – Whether to run textwrap.dedent() on the string before parsing.</p></li>
            <li><p><strong>**kw</strong> – See parse.c.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>Same as the output of parse_file().</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/parser.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">parse_string</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">report_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dedent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse a beancount input file and return Ledger with the list of</span>
<span class="sd">    transactions and tree of accounts.</span>

<span class="sd">    Args:</span>
<span class="sd">      string: A string, the contents to be parsed instead of a file&#39;s.</span>
<span class="sd">      report_filename: A string, the source filename from which this string</span>
<span class="sd">        has been extracted, if any. This is stored in the metadata of the</span>
<span class="sd">        parsed entries.</span>
<span class="sd">      dedent: Whether to run textwrap.dedent() on the string before parsing.</span>
<span class="sd">      **kw: See parse.c.</span>
<span class="sd">    Return:</span>
<span class="sd">      Same as the output of parse_file().</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dedent</span><span class="p">:</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">report_filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">report_filename</span> <span class="o">=</span> <span class="s2">&quot;&lt;string&gt;&quot;</span>
    <span class="n">file</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">parse_file</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">report_filename</span><span class="o">=</span><span class="n">report_filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.parser.printer" class="doc doc-heading">
        <code>beancount.parser.printer</code>



<a href="#beancount.parser.printer" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Conversion from internal data structures to text.</p>



  <div class="doc doc-children">









  <div class="doc doc-object doc-class">



<h3 id="beancount.parser.printer.EntryPrinter" class="doc doc-heading">
        <code>
beancount.parser.printer.EntryPrinter        </code>



<a href="#beancount.parser.printer.EntryPrinter" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A multi-method interface for printing all directive types.</p>

<p><strong>Attributes:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>dcontext</code></td>
        <td></td>
        <td><p>An instance of DisplayContext with which to render all the numbers.</p></td>
      </tr>
      <tr>
        <td><code>render_weight</code></td>
        <td></td>
        <td><p>A boolean, true if we should render the weight of the postings
as a comment, for debugging.</p></td>
      </tr>
      <tr>
        <td><code>min_width_account</code></td>
        <td></td>
        <td><p>An integer, the minimum width to leave for the account name.</p></td>
      </tr>
      <tr>
        <td><code>prefix</code></td>
        <td></td>
        <td><p>User-specific prefix for custom indentation (for Fava).</p></td>
      </tr>
      <tr>
        <td><code>stringify_invalid_types</code></td>
        <td></td>
        <td><p>If a metadata value is invalid, force a conversion to
string for printout.</p></td>
      </tr>
  </tbody>
</table>



  <div class="doc doc-children">























  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.printer.EntryPrinter.__call__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">EntryPrinter</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.parser.printer.EntryPrinter.__call__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Render a directive.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>obj</strong> – The directive to be rendered.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A string, the rendered directive.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/printer.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Render a directive.</span>

<span class="sd">    Args:</span>
<span class="sd">      obj: The directive to be rendered.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, the rendered directive.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">oss</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>

    <span class="c1"># We write optional entry source for every entry type, hence writing it here</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write_entry_source</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="n">oss</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">method</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">oss</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">oss</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.printer.EntryPrinter.render_posting_strings" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">EntryPrinter</span><span class="o">.</span><span class="n">render_posting_strings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">posting</span><span class="p">)</span></code>


<a href="#beancount.parser.printer.EntryPrinter.render_posting_strings" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>This renders the three components of a posting: the account and its optional
posting flag, the position, and finally, the weight of the position. The
purpose is to align these in the caller.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>posting</strong> – An instance of Posting, the posting to render.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>A tuple of
  flag_account</code> – A string, the account name including the flag.
  position_str: A string, the rendered position string.
  weight_str: A string, the rendered weight of the posting.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/printer.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">render_posting_strings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">posting</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This renders the three components of a posting: the account and its optional</span>
<span class="sd">    posting flag, the position, and finally, the weight of the position. The</span>
<span class="sd">    purpose is to align these in the caller.</span>

<span class="sd">    Args:</span>
<span class="sd">      posting: An instance of Posting, the posting to render.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A tuple of</span>
<span class="sd">        flag_account: A string, the account name including the flag.</span>
<span class="sd">        position_str: A string, the rendered position string.</span>
<span class="sd">        weight_str: A string, the rendered weight of the posting.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Render a string of the flag and the account.</span>
    <span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">render_flag</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">flag</span><span class="p">))</span> <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">flag</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="n">flag_account</span> <span class="o">=</span> <span class="n">flag</span> <span class="o">+</span> <span class="n">posting</span><span class="o">.</span><span class="n">account</span>

    <span class="c1"># Render a string with the amount and cost and optional price, if</span>
    <span class="c1"># present. Also render a string with the weight.</span>
    <span class="n">weight_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="n">amount</span><span class="o">.</span><span class="n">Amount</span><span class="p">):</span>
        <span class="n">position_str</span> <span class="o">=</span> <span class="n">position</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">posting</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dformat</span><span class="p">)</span>
        <span class="c1"># Note: we render weights at maximum precision, for debugging.</span>
        <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">cost</span><span class="p">,</span> <span class="n">position</span><span class="o">.</span><span class="n">Cost</span><span class="p">)</span>
            <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">weight_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">convert</span><span class="o">.</span><span class="n">get_weight</span><span class="p">(</span><span class="n">posting</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">position_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">price</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">position_str</span> <span class="o">+=</span> <span class="s2">&quot; @ </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">price</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dformat_max</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">flag_account</span><span class="p">,</span> <span class="n">position_str</span><span class="p">,</span> <span class="n">weight_str</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.printer.EntryPrinter.write_entry_source" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">EntryPrinter</span><span class="o">.</span><span class="n">write_entry_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">oss</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#beancount.parser.printer.EntryPrinter.write_entry_source" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Write source file and line number in a format interpretable as a message
location for Emacs, VSCode or other editors. As this is for
"debugging" purposes, this information will be commented out by a
semicolon.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>meta</strong> – A dict that contains the metadata for this directive.</p></li>
            <li><p><strong>oss</strong> – A file object to write to.</p></li>
            <li><p><strong>prefix</strong> – User-specific prefix for custom indentation</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/printer.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">write_entry_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">oss</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write source file and line number in a format interpretable as a message</span>
<span class="sd">    location for Emacs, VSCode or other editors. As this is for</span>
<span class="sd">    &quot;debugging&quot; purposes, this information will be commented out by a</span>
<span class="sd">    semicolon.</span>

<span class="sd">    Args:</span>
<span class="sd">      meta: A dict that contains the metadata for this directive.</span>
<span class="sd">      oss: A file object to write to.</span>
<span class="sd">      prefix: User-specific prefix for custom indentation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_source</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span>

    <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">; source: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">render_source</span><span class="p">(</span><span class="n">meta</span><span class="p">)))</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.parser.printer.EntryPrinter.write_metadata" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">EntryPrinter</span><span class="o">.</span><span class="n">write_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">oss</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#beancount.parser.printer.EntryPrinter.write_metadata" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Write metadata to the file object, excluding filename and line number.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>meta</strong> – A dict that contains the metadata for this directive.</p></li>
            <li><p><strong>oss</strong> – A file object to write to.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/printer.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">write_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">oss</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write metadata to the file object, excluding filename and line number.</span>

<span class="sd">    Args:</span>
<span class="sd">      meta: A dict that contains the metadata for this directive.</span>
<span class="sd">      oss: A file object to write to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">meta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span>

    <span class="c1"># Note: meta.items() is assumed stable from 3.7 onwards; we&#39;re not sorting</span>
    <span class="c1"># on purpose in order to keep the original insertion order in print.</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">meta</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">META_IGNORE</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">):</span>
            <span class="n">value_str</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">value_str</span> <span class="o">=</span> <span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">escape_string</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="n">Decimal</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">amount</span><span class="o">.</span><span class="n">Amount</span><span class="p">,</span> <span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">)):</span>
                <span class="n">value_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                <span class="n">value_str</span> <span class="o">=</span> <span class="s2">&quot;TRUE&quot;</span> <span class="k">if</span> <span class="n">value</span> <span class="k">else</span> <span class="s2">&quot;FALSE&quot;</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">)):</span>
                <span class="k">pass</span>  <span class="c1"># Ignore dicts, don&#39;t print them out.</span>
            <span class="k">elif</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">value_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># Render null metadata as empty, on purpose.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stringify_invalid_types</span><span class="p">:</span>
                    <span class="c1"># This is only intended to be used during development,</span>
                    <span class="c1"># when debugging for custom values of data types</span>
                    <span class="c1"># attached directly and not coming from the parser.</span>
                    <span class="n">value_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unexpected value: &#39;</span><span class="si">{!r}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">value_str</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}{}</span><span class="s2">: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value_str</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.printer.align_position_strings" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">align_position_strings</span><span class="p">(</span><span class="n">strings</span><span class="p">)</span></code>


<a href="#beancount.parser.printer.align_position_strings" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A helper used to align rendered amounts positions to their first currency
character (an uppercase letter). This class accepts a list of rendered
positions and calculates the necessary width to render them stacked in a
column so that the first currency word aligns. It does not go beyond that
(further currencies, e.g. for the price or cost, are not aligned).</p>
<p>This is perhaps best explained with an example. The following positions will
be aligned around the column marked with '^':</p>
<pre><code>      45 HOOL {504.30 USD}
       4 HOOL {504.30 USD, 2014-11-11}
    9.95 USD
</code></pre>
<p>-22473.32 CAD @ 1.10 USD
             ^</p>
<p>Strings without a currency character will be rendered flush left.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>strings</strong> – A list of rendered position or amount strings.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A pair of a list of aligned strings and the width of the aligned strings.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/printer.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">align_position_strings</span><span class="p">(</span><span class="n">strings</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A helper used to align rendered amounts positions to their first currency</span>
<span class="sd">    character (an uppercase letter). This class accepts a list of rendered</span>
<span class="sd">    positions and calculates the necessary width to render them stacked in a</span>
<span class="sd">    column so that the first currency word aligns. It does not go beyond that</span>
<span class="sd">    (further currencies, e.g. for the price or cost, are not aligned).</span>

<span class="sd">    This is perhaps best explained with an example. The following positions will</span>
<span class="sd">    be aligned around the column marked with &#39;^&#39;:</span>

<span class="sd">              45 HOOL {504.30 USD}</span>
<span class="sd">               4 HOOL {504.30 USD, 2014-11-11}</span>
<span class="sd">            9.95 USD</span>
<span class="sd">       -22473.32 CAD @ 1.10 USD</span>
<span class="sd">                 ^</span>

<span class="sd">    Strings without a currency character will be rendered flush left.</span>

<span class="sd">    Args:</span>
<span class="sd">      strings: A list of rendered position or amount strings.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A pair of a list of aligned strings and the width of the aligned strings.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Maximum length before the alignment character.</span>
    <span class="n">max_before</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># Maximum length after the alignment character.</span>
    <span class="n">max_after</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># Maximum length of unknown strings.</span>
    <span class="n">max_unknown</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">string_items</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">search</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;[A-Z]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">search</span>
    <span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">strings</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">search</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">max_before</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">max_before</span><span class="p">)</span>
                <span class="n">max_after</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">-</span> <span class="n">index</span><span class="p">,</span> <span class="n">max_after</span><span class="p">)</span>
                <span class="n">string_items</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">index</span><span class="p">,</span> <span class="n">string</span><span class="p">))</span>
                <span class="k">continue</span>
        <span class="c1"># else</span>
        <span class="n">max_unknown</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">string</span><span class="p">),</span> <span class="n">max_unknown</span><span class="p">)</span>
        <span class="n">string_items</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="kc">None</span><span class="p">,</span> <span class="n">string</span><span class="p">))</span>

    <span class="c1"># Compute formatting string.</span>
    <span class="n">max_total</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_before</span> <span class="o">+</span> <span class="n">max_after</span><span class="p">,</span> <span class="n">max_unknown</span><span class="p">)</span>
    <span class="n">max_after_prime</span> <span class="o">=</span> <span class="n">max_total</span> <span class="o">-</span> <span class="n">max_before</span>
    <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;{{:&gt;</span><span class="si">{0}</span><span class="s2">}}{{:</span><span class="si">{1}</span><span class="s2">}}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_before</span><span class="p">,</span> <span class="n">max_after_prime</span><span class="p">)</span><span class="o">.</span><span class="n">format</span>
    <span class="n">fmt_unknown</span> <span class="o">=</span> <span class="s2">&quot;{{:&lt;</span><span class="si">{0}</span><span class="s2">}}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_total</span><span class="p">)</span><span class="o">.</span><span class="n">format</span>

    <span class="c1"># Align the strings and return them.</span>

    <span class="n">aligned_strings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">string_items</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">=</span> <span class="n">fmt</span><span class="p">(</span><span class="n">string</span><span class="p">[:</span><span class="n">index</span><span class="p">],</span> <span class="n">string</span><span class="p">[</span><span class="n">index</span><span class="p">:])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">=</span> <span class="n">fmt_unknown</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="n">aligned_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">aligned_strings</span><span class="p">,</span> <span class="n">max_total</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.printer.format_entry" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">format_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">dcontext</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">render_weights</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">write_source</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#beancount.parser.printer.format_entry" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Format an entry into a string in the same input syntax the parser accepts.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entry</strong> – An entry instance.</p></li>
            <li><p><strong>dcontext</strong> – An instance of DisplayContext used to format the numbers.</p></li>
            <li><p><strong>render_weights</strong> – A boolean, true to render the weights for debugging.</p></li>
            <li><p><strong>write_source</strong> – If true a source file and line number will be written for
each entry in a format interpretable as a message location for Emacs,
VSCode or other editors. As this is for
"debugging" purposes, this information will be commented out by a
semicolon.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A string, the formatted entry.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/printer.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">format_entry</span><span class="p">(</span>
    <span class="n">entry</span><span class="p">,</span> <span class="n">dcontext</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">render_weights</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">write_source</span><span class="o">=</span><span class="kc">False</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Format an entry into a string in the same input syntax the parser accepts.</span>

<span class="sd">    Args:</span>
<span class="sd">      entry: An entry instance.</span>
<span class="sd">      dcontext: An instance of DisplayContext used to format the numbers.</span>
<span class="sd">      render_weights: A boolean, true to render the weights for debugging.</span>
<span class="sd">      write_source: If true a source file and line number will be written for</span>
<span class="sd">        each entry in a format interpretable as a message location for Emacs,</span>
<span class="sd">        VSCode or other editors. As this is for</span>
<span class="sd">        &quot;debugging&quot; purposes, this information will be commented out by a</span>
<span class="sd">        semicolon.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, the formatted entry.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">EntryPrinter</span><span class="p">(</span><span class="n">dcontext</span><span class="p">,</span> <span class="n">render_weights</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span> <span class="n">write_source</span><span class="o">=</span><span class="n">write_source</span><span class="p">)(</span>
        <span class="n">entry</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.printer.format_error" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">format_error</span><span class="p">(</span><span class="n">error</span><span class="p">)</span></code>


<a href="#beancount.parser.printer.format_error" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Given an error objects, return a formatted string for it.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>error</strong> – a namedtuple objects representing an error. It has to have an
'entry' attribute that may be either a single directive object or a
list of directive objects.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A string, the errors rendered.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/printer.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">format_error</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given an error objects, return a formatted string for it.</span>

<span class="sd">    Args:</span>
<span class="sd">      error: a namedtuple objects representing an error. It has to have an</span>
<span class="sd">        &#39;entry&#39; attribute that may be either a single directive object or a</span>
<span class="sd">        list of directive objects.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, the errors rendered.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">oss</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
    <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">render_source</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">source</span><span class="p">),</span> <span class="n">error</span><span class="o">.</span><span class="n">message</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">error</span><span class="o">.</span><span class="n">entry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">entry</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">entry</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">error</span><span class="o">.</span><span class="n">entry</span><span class="p">]</span>
        <span class="n">error_string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">format_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">)</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="n">error_string</span><span class="p">,</span> <span class="s2">&quot;   &quot;</span><span class="p">))</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">oss</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.printer.print_entries" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">print_entries</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">dcontext</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">render_weights</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">write_source</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#beancount.parser.printer.print_entries" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A convenience function that prints a list of entries to a file.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives.</p></li>
            <li><p><strong>dcontext</strong> – An instance of DisplayContext used to format the numbers.</p></li>
            <li><p><strong>render_weights</strong> – A boolean, true to render the weights for debugging.</p></li>
            <li><p><strong>file</strong> – An optional file object to write the entries to.</p></li>
            <li><p><strong>prefix</strong> – User-specific prefix for custom indentation (for Fava).</p></li>
            <li><p><strong>write_source</strong> – If true a source file and line number will be written for
each entry in a format interpretable as a message location for Emacs,
VSCode or other editors. This is usefull for "debugging" peurposes,
especially in a multi-file setup</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/printer.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">print_entries</span><span class="p">(</span>
    <span class="n">entries</span><span class="p">,</span> <span class="n">dcontext</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">render_weights</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">write_source</span><span class="o">=</span><span class="kc">False</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A convenience function that prints a list of entries to a file.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      dcontext: An instance of DisplayContext used to format the numbers.</span>
<span class="sd">      render_weights: A boolean, true to render the weights for debugging.</span>
<span class="sd">      file: An optional file object to write the entries to.</span>
<span class="sd">      prefix: User-specific prefix for custom indentation (for Fava).</span>
<span class="sd">      write_source: If true a source file and line number will be written for</span>
<span class="sd">        each entry in a format interpretable as a message location for Emacs,</span>
<span class="sd">        VSCode or other editors. This is usefull for &quot;debugging&quot; peurposes,</span>
<span class="sd">        especially in a multi-file setup</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="s2">&quot;Entries is not a list: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">file</span> <span class="ow">or</span> <span class="p">(</span>
        <span class="n">codecs</span><span class="o">.</span><span class="n">getwriter</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">buffer</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="s2">&quot;buffer&quot;</span><span class="p">)</span>
        <span class="k">else</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">prefix</span><span class="p">:</span>
        <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
    <span class="n">previous_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">entries</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">entries</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">eprinter</span> <span class="o">=</span> <span class="n">EntryPrinter</span><span class="p">(</span><span class="n">dcontext</span><span class="p">,</span> <span class="n">render_weights</span><span class="p">,</span> <span class="n">write_source</span><span class="o">=</span><span class="n">write_source</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="c1"># Insert a newline between transactions and between blocks of directives</span>
        <span class="c1"># of the same type.</span>
        <span class="n">entry_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">entry_type</span> <span class="ow">in</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Transaction</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Commodity</span><span class="p">)</span>
            <span class="ow">or</span> <span class="n">entry_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">previous_type</span>
            <span class="ow">or</span> <span class="n">write_source</span>
        <span class="p">):</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">previous_type</span> <span class="o">=</span> <span class="n">entry_type</span>

        <span class="n">string</span> <span class="o">=</span> <span class="n">eprinter</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
        <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.printer.print_entry" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">print_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">dcontext</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">render_weights</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">write_source</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#beancount.parser.printer.print_entry" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A convenience function that prints a single entry to a file.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entry</strong> – A directive entry.</p></li>
            <li><p><strong>dcontext</strong> – An instance of DisplayContext used to format the numbers.</p></li>
            <li><p><strong>render_weights</strong> – A boolean, true to render the weights for debugging.</p></li>
            <li><p><strong>file</strong> – An optional file object to write the entries to.</p></li>
            <li><p><strong>write_source</strong> – If true a source file and line number will be written for
each entry in a format interpretable as a message location for Emacs,
VSCode or other editors. This is usefull for "debugging" purposes,
especially in a multi-file setup</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/printer.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">print_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">dcontext</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">render_weights</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">write_source</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A convenience function that prints a single entry to a file.</span>

<span class="sd">    Args:</span>
<span class="sd">      entry: A directive entry.</span>
<span class="sd">      dcontext: An instance of DisplayContext used to format the numbers.</span>
<span class="sd">      render_weights: A boolean, true to render the weights for debugging.</span>
<span class="sd">      file: An optional file object to write the entries to.</span>
<span class="sd">      write_source: If true a source file and line number will be written for</span>
<span class="sd">        each entry in a format interpretable as a message location for Emacs,</span>
<span class="sd">        VSCode or other editors. This is usefull for &quot;debugging&quot; purposes,</span>
<span class="sd">        especially in a multi-file setup</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO(blais): DO remove this now, it&#39;s a huge annoyance not to be able to</span>
    <span class="c1"># print in-between other statements.</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">file</span> <span class="ow">or</span> <span class="p">(</span>
        <span class="n">codecs</span><span class="o">.</span><span class="n">getwriter</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">buffer</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="s2">&quot;buffer&quot;</span><span class="p">)</span>
        <span class="k">else</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
    <span class="p">)</span>
    <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">format_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">dcontext</span><span class="p">,</span> <span class="n">render_weights</span><span class="p">,</span> <span class="n">write_source</span><span class="o">=</span><span class="n">write_source</span><span class="p">))</span>
    <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.printer.print_error" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">print_error</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#beancount.parser.printer.print_error" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A convenience function that prints a single error to a file.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>error</strong> – An error object.</p></li>
            <li><p><strong>file</strong> – An optional file object to write the errors to.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/printer.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">print_error</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A convenience function that prints a single error to a file.</span>

<span class="sd">    Args:</span>
<span class="sd">      error: An error object.</span>
<span class="sd">      file: An optional file object to write the errors to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">file</span> <span class="ow">or</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
    <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">format_error</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
    <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.printer.print_errors" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">print_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#beancount.parser.printer.print_errors" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A convenience function that prints a list of errors to a file.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>errors</strong> – A list of errors.</p></li>
            <li><p><strong>file</strong> – An optional file object to write the errors to.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/printer.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">print_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A convenience function that prints a list of errors to a file.</span>

<span class="sd">    Args:</span>
<span class="sd">      errors: A list of errors.</span>
<span class="sd">      file: An optional file object to write the errors to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">file</span> <span class="ow">or</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
    <span class="k">if</span> <span class="n">prefix</span><span class="p">:</span>
        <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">:</span>
        <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">format_error</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
        <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.printer.render_flag" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">render_flag</span><span class="p">(</span><span class="n">inflag</span><span class="p">)</span></code>


<a href="#beancount.parser.printer.render_flag" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Render a flag, which can be None, a symbol of a character to a string.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/parser/printer.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">render_flag</span><span class="p">(</span><span class="n">inflag</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Render a flag, which can be None, a symbol of a character to a string.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">inflag</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>
    <span class="k">return</span> <span class="n">inflag</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.printer.render_source" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">render_source</span><span class="p">(</span><span class="n">meta</span><span class="p">)</span></code>


<a href="#beancount.parser.printer.render_source" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Render the source for errors in a way that it will be both detected by
Emacs and align and rendered nicely.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>meta</strong> – A dict with the metadata.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A string, rendered to be interpretable as a message location for Emacs or
other editors.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/printer.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">render_source</span><span class="p">(</span><span class="n">meta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Render the source for errors in a way that it will be both detected by</span>
<span class="sd">    Emacs and align and rendered nicely.</span>

<span class="sd">    Args:</span>
<span class="sd">      meta: A dict with the metadata.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, rendered to be interpretable as a message location for Emacs or</span>
<span class="sd">      other editors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">:</span><span class="si">{:8}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">],</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;lineno&quot;</span><span class="p">]))</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.parser.version" class="doc doc-heading">
        <code>beancount.parser.version</code>



<a href="#beancount.parser.version" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Implement common options across all programs.</p>



  <div class="doc doc-children">











  <div class="doc doc-object doc-function">



<h3 id="beancount.parser.version.compute_version_string" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">compute_version_string</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="n">changeset</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span></code>


<a href="#beancount.parser.version.compute_version_string" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Compute a version string from the changeset and timestamp baked in the parser.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>version</strong> – A string, the version number.</p></li>
            <li><p><strong>changeset</strong> – A string, a version control string identifying the commit of the version.</p></li>
            <li><p><strong>timestamp</strong> – An integer, the UNIX epoch timestamp of the changeset.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A human-readable string for the version.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/parser/version.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">compute_version_string</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="n">changeset</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute a version string from the changeset and timestamp baked in the parser.</span>

<span class="sd">    Args:</span>
<span class="sd">      version: A string, the version number.</span>
<span class="sd">      changeset: A string, a version control string identifying the commit of the version.</span>
<span class="sd">      timestamp: An integer, the UNIX epoch timestamp of the changeset.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A human-readable string for the version.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Shorten changeset.</span>
    <span class="k">if</span> <span class="n">changeset</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;hg:&quot;</span><span class="p">,</span> <span class="n">changeset</span><span class="p">):</span>
            <span class="n">changeset</span> <span class="o">=</span> <span class="n">changeset</span><span class="p">[:</span><span class="mi">15</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;git:&quot;</span><span class="p">,</span> <span class="n">changeset</span><span class="p">):</span>
            <span class="n">changeset</span> <span class="o">=</span> <span class="n">changeset</span><span class="p">[:</span><span class="mi">12</span><span class="p">]</span>

    <span class="c1"># Convert timestamp to a date.</span>
    <span class="n">date</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">timestamp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>

    <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;Beancount </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">changeset</span> <span class="ow">or</span> <span class="n">date</span><span class="p">:</span>
        <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">version</span><span class="p">,</span> <span class="s2">&quot;; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="n">changeset</span><span class="p">,</span> <span class="n">date</span><span class="p">])))</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">version</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>




  </div>

    </div>

  </div>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="beancount.plugins.html" class="btn btn-neutral float-right" title="beancount.plugins">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="beancount.ops.html" class="btn btn-neutral" title="beancount.ops"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="beancount.ops.html" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="beancount.plugins.html" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
