<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="canonical" href="https://beancount.github.io/docs/api_reference/beancount.loader.html">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>beancount.loader - Beancount Documentation</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link href="../assets/_mkdocstrings.css" rel="stylesheet" />
  <link href="../css/custom.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "beancount.loader";
    var mkdocs_page_input_path = "api_reference/beancount.loader.md";
    var mkdocs_page_url = "/docs/api_reference/beancount.loader.html";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="icon icon-home"> Beancount Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../index.html">Index</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Outline</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="#">Documentation for Users</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../command_line_accounting_in_context.html">Command Line Accounting in Context</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../the_double_entry_counting_method.html">The Double Entry Counting Method</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../installing_beancount.html">Installing Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../running_beancount_and_generating_reports.html">Running Beancount and Generating Reports</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../getting_started_with_beancount.html">Getting Started with Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_language_syntax.html">Beancount Language Syntax</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_options_reference.html">Beancount Options Reference</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../precision_tolerances.html">Precision Tolerances</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_query_language.html">Beancount Query Language</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_cheat_sheet.html">Beancount Cheat Sheet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../how_inventories_work.html">How Inventories Work</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../exporting_your_portfolio.html">Exporting Your Portfolio</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../tutorial_example.html">Tutorial & Example</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_history_and_credits.html">Beancount History and Credits</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../a_comparison_of_beancount_and_ledger_hledger.html">A Comparison of Beancount and Ledger Hledger</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../fetching_prices_in_beancount.html">Fetching Prices in Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../importing_external_data.html">Importing External Data</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Cookbooks & Examples</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../command_line_accounting_cookbook.html">Command Line Accounting Cookbook</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../trading_with_beancount.html">Trading with Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../stock_vesting_in_beancount.html">Stock Vesting in Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../sharing_expenses_with_beancount.html">Sharing Expenses with Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../how_we_share_expenses.html">How We Share Expenses</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../health_care_expenses.html">Health Care Expenses</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../calculating_portolio_returns.html">Calculating Portfolio Returns</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../tracking_medical_claims.html">Tracking Out-of-Network Medical Claims in Beancount</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Documentation for Developers</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_scripting_plugins.html">Beancount Scripting Plugins</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_design_doc.html">Beancount Design Doc</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ledgerhub_design_doc.html">Ledgerhub Design Doc</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../external_contributions.html">External Contributions</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Enhancement Proposals & Discussions</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../a_proposal_for_an_improvement_on_inventory_booking.html">A Proposal for an Improvement on Inventory Booking</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../settlement_dates_in_beancount.html">Settlement Dates in Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../balance_assertions_in_beancount.html">Balance Assertions in Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../fund_accounting_with_beancount.html">Fund Accounting with Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../rounding_precision_in_beancount.html">Rounding Precision in Beancount</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Beancount 3</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_v3.html">Goals & Design</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../installing_beancount_v3.html">Installing Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_v3_dependencies.html">Dependencies</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beangulp.html">Beangulp</a>
                </li>
    </ul>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">API reference</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="index.html">beancount</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.core.html">beancount.core</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="beancount.loader.html">beancount.loader</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#beancount.loader">beancount.loader</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.loader.LoadError">LoadError</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.loader.LoadError.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.loader.LoadError.__new__">__new__()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.loader.LoadError.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.loader.aggregate_options_map">aggregate_options_map()</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.loader.combine_plugins">combine_plugins()</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.loader.compute_input_hash">compute_input_hash()</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.loader.delete_cache_function">delete_cache_function()</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.loader.get_cache_filename">get_cache_filename()</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.loader.initialize">initialize()</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.loader.load_doc">load_doc()</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.loader.load_encrypted_file">load_encrypted_file()</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.loader.load_file">load_file()</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.loader.load_string">load_string()</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.loader.needs_refresh">needs_refresh()</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.loader.pickle_cache_function">pickle_cache_function()</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.loader.run_transformations">run_transformations()</a>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.ops.html">beancount.ops</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.parser.html">beancount.parser</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.plugins.html">beancount.plugins</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.scripts.html">beancount.scripts</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.tools.html">beancount.tools</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.utils.html">beancount.utils</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Beancount Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
    
      
        
          <li>API reference &raquo;</li>
        
      
    
    <li>beancount.loader</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h1 id="beancountloader">beancount.loader<a class="headerlink" href="#beancountloader" title="Permanent link"></a></h1>


  <div class="doc doc-object doc-module">

<a id="beancount.loader"></a>
    <div class="doc doc-contents first">

      <p>Loader code. This is the main entry point to load up a file.</p>



  <div class="doc doc-children">

















  <div class="doc doc-object doc-class">



<h2 id="beancount.loader.LoadError" class="doc doc-heading">
        <code>
beancount.loader.LoadError            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.loader.LoadError" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>LoadError(source, message, entry)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h3 id="beancount.loader.LoadError.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">LoadError</span><span class="o">.</span><span class="n">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.loader.LoadError.__getnewargs__" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/loader.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return self as a plain tuple.  Used by copy and pickle.&#39;</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="beancount.loader.LoadError.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">LoadError</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.loader.LoadError.__new__" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Create new instance of LoadError(source, message, entry)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="beancount.loader.LoadError.__repr__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">LoadError</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.loader.LoadError.__repr__" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/loader.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return a nicely formatted representation string&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h2 id="beancount.loader.aggregate_options_map" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">aggregate_options_map</span><span class="p">(</span><span class="n">options_map</span><span class="p">,</span> <span class="n">other_options_map</span><span class="p">)</span></code>


<a href="#beancount.loader.aggregate_options_map" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Aggregate some of the attributes of options map.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>options_map</strong> – The target map in which we want to aggregate attributes.
Note: This value is mutated in-place.</p></li>
            <li><p><strong>other_options_map</strong> – A list of other options maps, some of whose values
we'd like to see aggregated.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/loader.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">aggregate_options_map</span><span class="p">(</span><span class="n">options_map</span><span class="p">,</span> <span class="n">other_options_map</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Aggregate some of the attributes of options map.</span>

<span class="sd">    Args:</span>
<span class="sd">      options_map: The target map in which we want to aggregate attributes.</span>
<span class="sd">        Note: This value is mutated in-place.</span>
<span class="sd">      other_options_map: A list of other options maps, some of whose values</span>
<span class="sd">        we&#39;d like to see aggregated.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">options_map</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">options_map</span><span class="p">)</span>

    <span class="n">currencies</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">options_map</span><span class="p">[</span><span class="s2">&quot;operating_currency&quot;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">omap</span> <span class="ow">in</span> <span class="n">other_options_map</span><span class="p">:</span>
        <span class="n">currencies</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">omap</span><span class="p">[</span><span class="s2">&quot;operating_currency&quot;</span><span class="p">])</span>
        <span class="n">options_map</span><span class="p">[</span><span class="s2">&quot;dcontext&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update_from</span><span class="p">(</span><span class="n">omap</span><span class="p">[</span><span class="s2">&quot;dcontext&quot;</span><span class="p">])</span>
    <span class="n">options_map</span><span class="p">[</span><span class="s2">&quot;operating_currency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">uniquify</span><span class="p">(</span><span class="n">currencies</span><span class="p">))</span>

    <span class="c1"># Produce a &#39;pythonpath&#39; value for transformers.</span>
    <span class="n">pythonpath</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">omap</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">((</span><span class="n">options_map</span><span class="p">,),</span> <span class="n">other_options_map</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">omap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;insert_pythonpath&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">pythonpath</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">omap</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]))</span>
    <span class="n">options_map</span><span class="p">[</span><span class="s2">&quot;pythonpath&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">pythonpath</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">options_map</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="beancount.loader.combine_plugins" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">combine_plugins</span><span class="p">(</span><span class="o">*</span><span class="n">plugin_modules</span><span class="p">)</span></code>


<a href="#beancount.loader.combine_plugins" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Combine the plugins from the given plugin modules.</p>
<p>This is used to create plugins of plugins.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>*plugins_modules</strong> – A sequence of module objects.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list that can be assigned to the new module's <strong>plugins</strong> attribute.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/loader.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">combine_plugins</span><span class="p">(</span><span class="o">*</span><span class="n">plugin_modules</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Combine the plugins from the given plugin modules.</span>

<span class="sd">    This is used to create plugins of plugins.</span>
<span class="sd">    Args:</span>
<span class="sd">      *plugins_modules: A sequence of module objects.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list that can be assigned to the new module&#39;s __plugins__ attribute.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">modules</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="n">plugin_modules</span><span class="p">:</span>
        <span class="n">modules</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">module</span><span class="o">.</span><span class="n">__plugins__</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">modules</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="beancount.loader.compute_input_hash" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">compute_input_hash</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span></code>


<a href="#beancount.loader.compute_input_hash" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Compute a hash of the input data.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>filenames</strong> – A list of input files. Order is not relevant.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/loader.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">compute_input_hash</span><span class="p">(</span><span class="n">filenames</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute a hash of the input data.</span>

<span class="sd">    Args:</span>
<span class="sd">      filenames: A list of input files. Order is not relevant.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">md5</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">filenames</span><span class="p">):</span>
        <span class="n">md5</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">filename</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">stat</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">md5</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;dd&quot;</span><span class="p">,</span> <span class="n">stat</span><span class="o">.</span><span class="n">st_mtime_ns</span><span class="p">,</span> <span class="n">stat</span><span class="o">.</span><span class="n">st_size</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">md5</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="beancount.loader.delete_cache_function" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">delete_cache_function</span><span class="p">(</span><span class="n">cache_getter</span><span class="p">,</span> <span class="n">function</span><span class="p">)</span></code>


<a href="#beancount.loader.delete_cache_function" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>A wrapper that removes the cached filename.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>cache_getter</strong> – A function of one argument, the top-level filename, which
will return the name of the corresponding cache file.</p></li>
            <li><p><strong>function</strong> – A function object to decorate for caching.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A decorated function which will delete the cached filename, if it exists.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/loader.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">delete_cache_function</span><span class="p">(</span><span class="n">cache_getter</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A wrapper that removes the cached filename.</span>

<span class="sd">    Args:</span>
<span class="sd">      cache_getter: A function of one argument, the top-level filename, which</span>
<span class="sd">        will return the name of the corresponding cache file.</span>
<span class="sd">      function: A function object to decorate for caching.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A decorated function which will delete the cached filename, if it exists.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="n">toplevel_filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="c1"># Delete the cache.</span>
        <span class="n">cache_filename</span> <span class="o">=</span> <span class="n">cache_getter</span><span class="p">(</span><span class="n">toplevel_filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cache_filename</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">cache_filename</span><span class="p">)</span>

        <span class="c1"># Invoke the original function.</span>
        <span class="k">return</span> <span class="n">function</span><span class="p">(</span><span class="n">toplevel_filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapped</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="beancount.loader.get_cache_filename" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">get_cache_filename</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span></code>


<a href="#beancount.loader.get_cache_filename" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Compute the cache filename from a given pattern and the top-level filename.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>pattern</strong> (<code>str</code>) – A cache filename or pattern. If the pattern contains '{filename}' this
will get replaced by the top-level filename. This may be absolute or relative.</p></li>
            <li><p><strong>filename</strong> (<code>str</code>) – The top-level filename.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>str</code> – The resolved cache filename.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/loader.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_cache_filename</span><span class="p">(</span><span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the cache filename from a given pattern and the top-level filename.</span>

<span class="sd">    Args:</span>
<span class="sd">      pattern: A cache filename or pattern. If the pattern contains &#39;{filename}&#39; this</span>
<span class="sd">        will get replaced by the top-level filename. This may be absolute or relative.</span>
<span class="sd">      filename: The top-level filename.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The resolved cache filename.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">abs_filename</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">pattern</span><span class="p">):</span>
        <span class="n">abs_pattern</span> <span class="o">=</span> <span class="n">pattern</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">abs_pattern</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">abs_filename</span><span class="p">),</span> <span class="n">pattern</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">abs_pattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="beancount.loader.initialize" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">use_cache</span><span class="p">,</span> <span class="n">cache_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#beancount.loader.initialize" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Initialize the loader.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/loader.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">use_cache</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">cache_filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the loader.&quot;&quot;&quot;</span>

    <span class="c1"># Unless an environment variable disables it, use the pickle load cache</span>
    <span class="c1"># automatically. Note that this works across all Python programs running the</span>
    <span class="c1"># loader which is why it&#39;s located here.</span>

    <span class="k">global</span> <span class="n">_load_file</span>

    <span class="c1"># Make a function to compute the cache filename.</span>
    <span class="n">cache_pattern</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">cache_filename</span>
        <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;BEANCOUNT_LOAD_CACHE_FILENAME&quot;</span><span class="p">)</span>
        <span class="ow">or</span> <span class="n">PICKLE_CACHE_FILENAME</span>
    <span class="p">)</span>
    <span class="n">cache_getter</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">get_cache_filename</span><span class="p">,</span> <span class="n">cache_pattern</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">use_cache</span><span class="p">:</span>
        <span class="n">_load_file</span> <span class="o">=</span> <span class="n">pickle_cache_function</span><span class="p">(</span>
            <span class="n">cache_getter</span><span class="p">,</span> <span class="n">PICKLE_CACHE_THRESHOLD</span><span class="p">,</span> <span class="n">_uncached_load_file</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cache_filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Cache disabled; &quot;</span>
                <span class="s2">&quot;Explicitly overridden cache filename </span><span class="si">%s</span><span class="s2"> will be ignored.&quot;</span><span class="p">,</span>
                <span class="n">cache_filename</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">_load_file</span> <span class="o">=</span> <span class="n">delete_cache_function</span><span class="p">(</span><span class="n">cache_getter</span><span class="p">,</span> <span class="n">_uncached_load_file</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="beancount.loader.load_doc" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">load_doc</span><span class="p">(</span><span class="n">expect_errors</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#beancount.loader.load_doc" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>A factory of decorators that loads the docstring and calls the function with entries.</p>
<p>This is an incredibly convenient tool to write lots of tests. Write a
unittest using the standard TestCase class and put the input entries in the
function's docstring.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>expect_errors</strong> – A boolean or None, with the following semantics,
True: Expect errors and fail if there are none.
False: Expect no errors and fail if there are some.
None: Do nothing, no check.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A wrapped method that accepts a single 'self' argument.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/loader.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">load_doc</span><span class="p">(</span><span class="n">expect_errors</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A factory of decorators that loads the docstring and calls the function with entries.</span>

<span class="sd">    This is an incredibly convenient tool to write lots of tests. Write a</span>
<span class="sd">    unittest using the standard TestCase class and put the input entries in the</span>
<span class="sd">    function&#39;s docstring.</span>

<span class="sd">    Args:</span>
<span class="sd">      expect_errors: A boolean or None, with the following semantics,</span>
<span class="sd">        True: Expect errors and fail if there are none.</span>
<span class="sd">        False: Expect no errors and fail if there are some.</span>
<span class="sd">        None: Do nothing, no check.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A wrapped method that accepts a single &#39;self&#39; argument.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">fun</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A decorator that parses the function&#39;s docstring as an argument.</span>

<span class="sd">        Args:</span>
<span class="sd">          fun: A callable method, that accepts the three return arguments that</span>
<span class="sd">              load() returns.</span>
<span class="sd">        Returns:</span>
<span class="sd">          A decorated test function.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">fun</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">options_map</span> <span class="o">=</span> <span class="n">load_string</span><span class="p">(</span><span class="n">fun</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">,</span> <span class="n">dedent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">expect_errors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">expect_errors</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">errors</span><span class="p">:</span>
                    <span class="n">oss</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
                    <span class="n">printer</span><span class="o">.</span><span class="n">print_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">oss</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Unexpected errors found:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">oss</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()))</span>
                <span class="k">elif</span> <span class="n">expect_errors</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">errors</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Expected errors, none found:&quot;</span><span class="p">)</span>

            <span class="c1"># Note: Even if we expected no errors, we call this function with an</span>
            <span class="c1"># empty &#39;errors&#39; list. This is so that the interface does not change</span>
            <span class="c1"># based on the arguments to the decorator, which would be somewhat</span>
            <span class="c1"># ugly and which would require explanation.</span>
            <span class="k">return</span> <span class="n">fun</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">options_map</span><span class="p">)</span>

        <span class="n">wrapper</span><span class="o">.</span><span class="n">__input__</span> <span class="o">=</span> <span class="n">wrapper</span><span class="o">.</span><span class="vm">__doc__</span>
        <span class="n">wrapper</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">wrapper</span>

    <span class="k">return</span> <span class="n">decorator</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="beancount.loader.load_encrypted_file" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">load_encrypted_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">log_timings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">log_errors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">extra_validations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dedent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#beancount.loader.load_encrypted_file" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Load an encrypted Beancount input file.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>filename</strong> – The name of an encrypted file to be parsed.</p></li>
            <li><p><strong>log_timings</strong> – See load_string().</p></li>
            <li><p><strong>log_errors</strong> – See load_string().</p></li>
            <li><p><strong>extra_validations</strong> – See load_string().</p></li>
            <li><p><strong>dedent</strong> – See load_string().</p></li>
            <li><p><strong>encoding</strong> – See load_string().</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A triple of (entries, errors, option_map) where "entries" is a date-sorted
list of entries from the file, "errors" a list of error objects generated
while parsing and validating the file, and "options_map", a dict of the
options parsed from the file.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/loader.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">load_encrypted_file</span><span class="p">(</span>
    <span class="n">filename</span><span class="p">,</span>
    <span class="n">log_timings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">log_errors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">extra_validations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dedent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load an encrypted Beancount input file.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: The name of an encrypted file to be parsed.</span>
<span class="sd">      log_timings: See load_string().</span>
<span class="sd">      log_errors: See load_string().</span>
<span class="sd">      extra_validations: See load_string().</span>
<span class="sd">      dedent: See load_string().</span>
<span class="sd">      encoding: See load_string().</span>
<span class="sd">    Returns:</span>
<span class="sd">      A triple of (entries, errors, option_map) where &quot;entries&quot; is a date-sorted</span>
<span class="sd">      list of entries from the file, &quot;errors&quot; a list of error objects generated</span>
<span class="sd">      while parsing and validating the file, and &quot;options_map&quot;, a dict of the</span>
<span class="sd">      options parsed from the file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">contents</span> <span class="o">=</span> <span class="n">encryption</span><span class="o">.</span><span class="n">read_encrypted_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">load_string</span><span class="p">(</span>
        <span class="n">contents</span><span class="p">,</span>
        <span class="n">log_timings</span><span class="o">=</span><span class="n">log_timings</span><span class="p">,</span>
        <span class="n">log_errors</span><span class="o">=</span><span class="n">log_errors</span><span class="p">,</span>
        <span class="n">extra_validations</span><span class="o">=</span><span class="n">extra_validations</span><span class="p">,</span>
        <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="beancount.loader.load_file" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">load_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">log_timings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">log_errors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">extra_validations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#beancount.loader.load_file" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Open a Beancount input file, parse it, run transformations and validate.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>filename</strong> – The name of the file to be parsed.</p></li>
            <li><p><strong>log_timings</strong> – A file object or function to write timings to,
or None, if it should remain quiet. (Note that this is intended to use
the logging methods and does not insert a newline.)</p></li>
            <li><p><strong>log_errors</strong> – A file object or function to write errors to,
or None, if it should remain quiet.</p></li>
            <li><p><strong>extra_validations</strong> – A list of extra validation functions to run after loading
this list of entries.</p></li>
            <li><p><strong>encoding</strong> – A string or None, the encoding to decode the input filename with.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A triple of (entries, errors, option_map) where "entries" is a date-sorted
list of entries from the file, "errors" a list of error objects generated
while parsing and validating the file, and "options_map", a dict of the
options parsed from the file.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/loader.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">load_file</span><span class="p">(</span>
    <span class="n">filename</span><span class="p">,</span> <span class="n">log_timings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">log_errors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">extra_validations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Open a Beancount input file, parse it, run transformations and validate.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: The name of the file to be parsed.</span>
<span class="sd">      log_timings: A file object or function to write timings to,</span>
<span class="sd">        or None, if it should remain quiet. (Note that this is intended to use</span>
<span class="sd">        the logging methods and does not insert a newline.)</span>
<span class="sd">      log_errors: A file object or function to write errors to,</span>
<span class="sd">        or None, if it should remain quiet.</span>
<span class="sd">      extra_validations: A list of extra validation functions to run after loading</span>
<span class="sd">        this list of entries.</span>
<span class="sd">      encoding: A string or None, the encoding to decode the input filename with.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A triple of (entries, errors, option_map) where &quot;entries&quot; is a date-sorted</span>
<span class="sd">      list of entries from the file, &quot;errors&quot; a list of error objects generated</span>
<span class="sd">      while parsing and validating the file, and &quot;options_map&quot;, a dict of the</span>
<span class="sd">      options parsed from the file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">expandvars</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">filename</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">encryption</span><span class="o">.</span><span class="n">is_encrypted_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="c1"># Note: Caching is not supported for encrypted files.</span>
        <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">options_map</span> <span class="o">=</span> <span class="n">load_encrypted_file</span><span class="p">(</span>
            <span class="n">filename</span><span class="p">,</span> <span class="n">log_timings</span><span class="p">,</span> <span class="n">log_errors</span><span class="p">,</span> <span class="n">extra_validations</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">options_map</span> <span class="o">=</span> <span class="n">_load_file</span><span class="p">(</span>
            <span class="n">filename</span><span class="p">,</span> <span class="n">log_timings</span><span class="p">,</span> <span class="n">extra_validations</span><span class="p">,</span> <span class="n">encoding</span>
        <span class="p">)</span>
        <span class="n">_log_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">log_errors</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">options_map</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="beancount.loader.load_string" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">load_string</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">log_timings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">log_errors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">extra_validations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dedent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#beancount.loader.load_string" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Open a Beancount input string, parse it, run transformations and validate.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>string</strong> – A Beancount input string.</p></li>
            <li><p><strong>log_timings</strong> – A file object or function to write timings to,
or None, if it should remain quiet.</p></li>
            <li><p><strong>log_errors</strong> – A file object or function to write errors to,
or None, if it should remain quiet.</p></li>
            <li><p><strong>extra_validations</strong> – A list of extra validation functions to run after loading
this list of entries.</p></li>
            <li><p><strong>dedent</strong> – A boolean, if set, remove the whitespace in front of the lines.</p></li>
            <li><p><strong>encoding</strong> – A string or None, the encoding to decode the input string with.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A triple of (entries, errors, option_map) where "entries" is a date-sorted
list of entries from the string, "errors" a list of error objects
generated while parsing and validating the string, and "options_map", a
dict of the options parsed from the string.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/loader.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">load_string</span><span class="p">(</span>
    <span class="n">string</span><span class="p">,</span>
    <span class="n">log_timings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">log_errors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">extra_validations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dedent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Open a Beancount input string, parse it, run transformations and validate.</span>

<span class="sd">    Args:</span>
<span class="sd">      string: A Beancount input string.</span>
<span class="sd">      log_timings: A file object or function to write timings to,</span>
<span class="sd">        or None, if it should remain quiet.</span>
<span class="sd">      log_errors: A file object or function to write errors to,</span>
<span class="sd">        or None, if it should remain quiet.</span>
<span class="sd">      extra_validations: A list of extra validation functions to run after loading</span>
<span class="sd">        this list of entries.</span>
<span class="sd">      dedent: A boolean, if set, remove the whitespace in front of the lines.</span>
<span class="sd">      encoding: A string or None, the encoding to decode the input string with.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A triple of (entries, errors, option_map) where &quot;entries&quot; is a date-sorted</span>
<span class="sd">      list of entries from the string, &quot;errors&quot; a list of error objects</span>
<span class="sd">      generated while parsing and validating the string, and &quot;options_map&quot;, a</span>
<span class="sd">      dict of the options parsed from the string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dedent</span><span class="p">:</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
    <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">options_map</span> <span class="o">=</span> <span class="n">_load</span><span class="p">(</span>
        <span class="p">[(</span><span class="n">string</span><span class="p">,</span> <span class="kc">False</span><span class="p">)],</span> <span class="n">log_timings</span><span class="p">,</span> <span class="n">extra_validations</span><span class="p">,</span> <span class="n">encoding</span>
    <span class="p">)</span>
    <span class="n">_log_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">log_errors</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">options_map</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="beancount.loader.needs_refresh" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">needs_refresh</span><span class="p">(</span><span class="n">options_map</span><span class="p">)</span></code>


<a href="#beancount.loader.needs_refresh" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Predicate that returns true if at least one of the input files may have changed.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>options_map</strong> – An options dict as per the parser.</p></li>
            <li><p><strong>mtime</strong> – A modified time, to check if it covers the include files in the options_map.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A boolean, true if the input is obsoleted by changes in the input files.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/loader.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">needs_refresh</span><span class="p">(</span><span class="n">options_map</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Predicate that returns true if at least one of the input files may have changed.</span>

<span class="sd">    Args:</span>
<span class="sd">      options_map: An options dict as per the parser.</span>
<span class="sd">      mtime: A modified time, to check if it covers the include files in the options_map.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A boolean, true if the input is obsoleted by changes in the input files.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">options_map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="n">input_hash</span> <span class="o">=</span> <span class="n">compute_input_hash</span><span class="p">(</span><span class="n">options_map</span><span class="p">[</span><span class="s2">&quot;include&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="s2">&quot;input_hash&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">options_map</span> <span class="ow">or</span> <span class="n">input_hash</span> <span class="o">!=</span> <span class="n">options_map</span><span class="p">[</span><span class="s2">&quot;input_hash&quot;</span><span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="beancount.loader.pickle_cache_function" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">pickle_cache_function</span><span class="p">(</span><span class="n">cache_getter</span><span class="p">,</span> <span class="n">time_threshold</span><span class="p">,</span> <span class="n">function</span><span class="p">)</span></code>


<a href="#beancount.loader.pickle_cache_function" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Decorate a loader function to make it loads its result from a pickle cache.</p>
<p>This considers the first argument as a top-level filename and assumes the
function to be cached returns an (entries, errors, options_map) triple. We
use the 'include' option value in order to check whether any of the included
files has changed. It's essentially a special case for an on-disk memoizer.
If any of the included files are more recent than the cache, the function is
recomputed and the cache refreshed.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>cache_getter</strong> – A function of one argument, the top-level filename, which
will return the name of the corresponding cache file.</p></li>
            <li><p><strong>time_threshold</strong> – A float, the number of seconds below which we don't bother
caching.</p></li>
            <li><p><strong>function</strong> – A function object to decorate for caching.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A decorated function which will pull its result from a cache file if
it is available.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/loader.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">pickle_cache_function</span><span class="p">(</span><span class="n">cache_getter</span><span class="p">,</span> <span class="n">time_threshold</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decorate a loader function to make it loads its result from a pickle cache.</span>

<span class="sd">    This considers the first argument as a top-level filename and assumes the</span>
<span class="sd">    function to be cached returns an (entries, errors, options_map) triple. We</span>
<span class="sd">    use the &#39;include&#39; option value in order to check whether any of the included</span>
<span class="sd">    files has changed. It&#39;s essentially a special case for an on-disk memoizer.</span>
<span class="sd">    If any of the included files are more recent than the cache, the function is</span>
<span class="sd">    recomputed and the cache refreshed.</span>

<span class="sd">    Args:</span>
<span class="sd">      cache_getter: A function of one argument, the top-level filename, which</span>
<span class="sd">        will return the name of the corresponding cache file.</span>
<span class="sd">      time_threshold: A float, the number of seconds below which we don&#39;t bother</span>
<span class="sd">        caching.</span>
<span class="sd">      function: A function object to decorate for caching.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A decorated function which will pull its result from a cache file if</span>
<span class="sd">      it is available.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="n">toplevel_filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">cache_filename</span> <span class="o">=</span> <span class="n">cache_getter</span><span class="p">(</span><span class="n">toplevel_filename</span><span class="p">)</span>

        <span class="c1"># Read the cache if it exists in order to get the list of files whose</span>
        <span class="c1"># timestamps to check.</span>
        <span class="n">exists</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cache_filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exists</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cache_filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                    <span class="c1"># Note: Not a big fan of doing this, but here we handle all</span>
                    <span class="c1"># possible exceptions because unpickling of an old or</span>
                    <span class="c1"># corrupted pickle file manifests as a variety of different</span>
                    <span class="c1"># exception types.</span>

                    <span class="c1"># The cache file is corrupted; ignore it and recompute.</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Cache file is corrupted: </span><span class="si">%s</span><span class="s2">; recomputing.&quot;</span><span class="p">,</span> <span class="n">exc</span><span class="p">)</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Check that the latest timestamp has not been written after the</span>
                    <span class="c1"># cache file.</span>
                    <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">options_map</span> <span class="o">=</span> <span class="n">result</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">needs_refresh</span><span class="p">(</span><span class="n">options_map</span><span class="p">):</span>
                        <span class="c1"># All timestamps are legit; cache hit.</span>
                        <span class="k">return</span> <span class="n">result</span>

        <span class="c1"># We failed; recompute the value.</span>
        <span class="k">if</span> <span class="n">exists</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">cache_filename</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="c1"># Warn for errors on read-only filesystems.</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Could not remove picklecache file </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">cache_filename</span><span class="p">,</span> <span class="n">exc</span>
                <span class="p">)</span>

        <span class="n">time_before</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">toplevel_filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="n">time_after</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># Overwrite the cache file if the time it takes to compute it</span>
        <span class="c1"># justifies it.</span>
        <span class="k">if</span> <span class="n">time_after</span> <span class="o">-</span> <span class="n">time_before</span> <span class="o">&gt;</span> <span class="n">time_threshold</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cache_filename</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Could not write to picklecache file </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">cache_filename</span><span class="p">,</span> <span class="n">exc</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">return</span> <span class="n">wrapped</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="beancount.loader.run_transformations" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">run_transformations</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">parse_errors</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="n">log_timings</span><span class="p">)</span></code>


<a href="#beancount.loader.run_transformations" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Run the various transformations on the entries.</p>
<p>This is where entries are being synthesized, checked, plugins are run, etc.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives as read from the parser.</p></li>
            <li><p><strong>parse_errors</strong> – A list of errors so far.</p></li>
            <li><p><strong>options_map</strong> – An options dict as read from the parser.</p></li>
            <li><p><strong>log_timings</strong> – A function to write timing log entries to, or None, if it
should be quiet.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of modified entries, and a list of errors, also possibly modified.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/loader.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">run_transformations</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">parse_errors</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="n">log_timings</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run the various transformations on the entries.</span>

<span class="sd">    This is where entries are being synthesized, checked, plugins are run, etc.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives as read from the parser.</span>
<span class="sd">      parse_errors: A list of errors so far.</span>
<span class="sd">      options_map: An options dict as read from the parser.</span>
<span class="sd">      log_timings: A function to write timing log entries to, or None, if it</span>
<span class="sd">        should be quiet.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of modified entries, and a list of errors, also possibly modified.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># A list of errors to extend (make a copy to avoid modifying the input).</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">parse_errors</span><span class="p">)</span>

    <span class="c1"># Process the plugins.</span>
    <span class="k">if</span> <span class="n">options_map</span><span class="p">[</span><span class="s2">&quot;plugin_processing_mode&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;raw&quot;</span><span class="p">:</span>
        <span class="n">plugins_iter</span> <span class="o">=</span> <span class="n">options_map</span><span class="p">[</span><span class="s2">&quot;plugin&quot;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">options_map</span><span class="p">[</span><span class="s2">&quot;plugin_processing_mode&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
        <span class="n">plugins_iter</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
            <span class="n">PLUGINS_PRE</span><span class="p">,</span> <span class="n">options_map</span><span class="p">[</span><span class="s2">&quot;plugin&quot;</span><span class="p">],</span> <span class="n">PLUGINS_AUTO</span><span class="p">,</span> <span class="n">PLUGINS_POST</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="s2">&quot;Invalid value for plugin_processing_mode: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">options_map</span><span class="p">[</span><span class="s2">&quot;plugin_processing_mode&quot;</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="k">for</span> <span class="n">plugin_name</span><span class="p">,</span> <span class="n">plugin_config</span> <span class="ow">in</span> <span class="n">plugins_iter</span><span class="p">:</span>
        <span class="c1"># Issue a warning on a renamed module.</span>
        <span class="n">renamed_name</span> <span class="o">=</span> <span class="n">RENAMED_MODULES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">plugin_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">renamed_name</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Deprecation notice: Module &#39;</span><span class="si">{}</span><span class="s2">&#39; has been renamed to &#39;</span><span class="si">{}</span><span class="s2">&#39;; &quot;</span>
                <span class="s2">&quot;please adjust your plugin directive.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">plugin_name</span><span class="p">,</span> <span class="n">renamed_name</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">plugin_name</span> <span class="o">=</span> <span class="n">renamed_name</span>

        <span class="c1"># Try to import the module.</span>
        <span class="c1">#</span>
        <span class="c1"># Note: We intercept import errors and continue but let other plugin</span>
        <span class="c1"># import time exceptions fail a run, by choice.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">plugin_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="s2">&quot;__plugins__&quot;</span><span class="p">):</span>
                <span class="k">continue</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="c1"># Upon failure, just issue an error.</span>
            <span class="n">formatted_traceback</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  &quot;</span><span class="p">)</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">LoadError</span><span class="p">(</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">new_metadata</span><span class="p">(</span><span class="s2">&quot;&lt;load&gt;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="s1">&#39;Error importing &quot;</span><span class="si">{}</span><span class="s1">&quot;: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">plugin_name</span><span class="p">,</span> <span class="n">formatted_traceback</span><span class="p">),</span>
                    <span class="kc">None</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">continue</span>

        <span class="c1"># Apply it.</span>
        <span class="k">with</span> <span class="n">misc_utils</span><span class="o">.</span><span class="n">log_time</span><span class="p">(</span><span class="n">plugin_name</span><span class="p">,</span> <span class="n">log_timings</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
            <span class="c1"># Run each transformer function in the plugin.</span>
            <span class="k">for</span> <span class="n">function_name</span> <span class="ow">in</span> <span class="n">module</span><span class="o">.</span><span class="n">__plugins__</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">function_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="c1"># Support plugin functions provided by name.</span>
                    <span class="n">callback</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">function_name</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Support function types directly, not just names.</span>
                    <span class="n">callback</span> <span class="o">=</span> <span class="n">function_name</span>

                <span class="c1"># Provide arguments if config is provided.</span>
                <span class="c1"># TODO(blais): Make this consistent in v3, not conditional.</span>
                <span class="n">args</span> <span class="o">=</span> <span class="p">()</span> <span class="k">if</span> <span class="n">plugin_config</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">(</span><span class="n">plugin_config</span><span class="p">,)</span>

                <span class="c1"># Catch all exceptions raised in running the plugin, except exits.</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">entries</span><span class="p">,</span> <span class="n">plugin_errors</span> <span class="o">=</span> <span class="n">callback</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">plugin_errors</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                    <span class="c1"># Allow the user to exit in a plugin.</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="ne">SystemExit</span><span class="p">):</span>
                        <span class="k">raise</span>

                    <span class="c1"># Upon failure, just issue an error.</span>
                    <span class="n">formatted_traceback</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  &quot;</span><span class="p">)</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">LoadError</span><span class="p">(</span>
                            <span class="n">data</span><span class="o">.</span><span class="n">new_metadata</span><span class="p">(</span><span class="s2">&quot;&lt;load&gt;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                            <span class="s1">&#39;Error applying plugin &quot;</span><span class="si">{}</span><span class="s1">&quot;: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">plugin_name</span><span class="p">,</span> <span class="n">formatted_traceback</span>
                            <span class="p">),</span>
                            <span class="kc">None</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="k">continue</span>

            <span class="c1"># Ensure that the entries are sorted. Don&#39;t trust the plugins</span>
            <span class="c1"># themselves.</span>
            <span class="n">entries</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">entry_sortkey</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="beancount.ops.html" class="btn btn-neutral float-right" title="beancount.ops">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="beancount.core.html" class="btn btn-neutral" title="beancount.core"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="beancount.core.html" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="beancount.ops.html" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
