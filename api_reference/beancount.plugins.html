<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="canonical" href="https://beancount.github.io/docs/api_reference/beancount.plugins.html">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>beancount.plugins - Beancount Documentation</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link href="../assets/_mkdocstrings.css" rel="stylesheet" />
  <link href="../css/custom.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "beancount.plugins";
    var mkdocs_page_input_path = "api_reference/beancount.plugins.md";
    var mkdocs_page_url = "/docs/api_reference/beancount.plugins.html";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="icon icon-home"> Beancount Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../index.html">Index</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Outline</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="#">Documentation for Users</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../command_line_accounting_in_context.html">Command Line Accounting in Context</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../the_double_entry_counting_method.html">The Double Entry Counting Method</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../installing_beancount.html">Installing Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../running_beancount_and_generating_reports.html">Running Beancount and Generating Reports</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../getting_started_with_beancount.html">Getting Started with Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_language_syntax.html">Beancount Language Syntax</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_options_reference.html">Beancount Options Reference</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../precision_tolerances.html">Precision Tolerances</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_query_language.html">Beancount Query Language</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_cheat_sheet.html">Beancount Cheat Sheet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../how_inventories_work.html">How Inventories Work</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../exporting_your_portfolio.html">Exporting Your Portfolio</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../tutorial_example.html">Tutorial & Example</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_history_and_credits.html">Beancount History and Credits</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../a_comparison_of_beancount_and_ledger_hledger.html">A Comparison of Beancount and Ledger Hledger</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../fetching_prices_in_beancount.html">Fetching Prices in Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../importing_external_data.html">Importing External Data</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Cookbooks & Examples</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../command_line_accounting_cookbook.html">Command Line Accounting Cookbook</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../trading_with_beancount.html">Trading with Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../stock_vesting_in_beancount.html">Stock Vesting in Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../sharing_expenses_with_beancount.html">Sharing Expenses with Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../how_we_share_expenses.html">How We Share Expenses</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../health_care_expenses.html">Health Care Expenses</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../calculating_portolio_returns.html">Calculating Portfolio Returns</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../tracking_medical_claims.html">Tracking Out-of-Network Medical Claims in Beancount</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Documentation for Developers</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_scripting_plugins.html">Beancount Scripting Plugins</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_design_doc.html">Beancount Design Doc</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ledgerhub_design_doc.html">Ledgerhub Design Doc</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../external_contributions.html">External Contributions</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Enhancement Proposals & Discussions</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../a_proposal_for_an_improvement_on_inventory_booking.html">A Proposal for an Improvement on Inventory Booking</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../settlement_dates_in_beancount.html">Settlement Dates in Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../balance_assertions_in_beancount.html">Balance Assertions in Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../fund_accounting_with_beancount.html">Fund Accounting with Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../rounding_precision_in_beancount.html">Rounding Precision in Beancount</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Beancount 3</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_v3.html">Goals & Design</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../installing_beancount_v3.html">Installing Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_v3_dependencies.html">Dependencies</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beangulp.html">Beangulp</a>
                </li>
    </ul>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">API reference</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="index.html">beancount</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.core.html">beancount.core</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.loader.html">beancount.loader</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.ops.html">beancount.ops</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.parser.html">beancount.parser</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="beancount.plugins.html">beancount.plugins</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins">beancount.plugins</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins.auto">auto</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins.auto_accounts">auto_accounts</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.auto_accounts.auto_insert_open">auto_insert_open()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins.check_average_cost">check_average_cost</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.check_average_cost.MatchBasisError">MatchBasisError</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.check_average_cost.MatchBasisError.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.check_average_cost.MatchBasisError.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.check_average_cost.MatchBasisError.__replace__">__replace__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.check_average_cost.MatchBasisError.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.check_average_cost.validate_average_cost">validate_average_cost()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins.check_closing">check_closing</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.check_closing.check_closing">check_closing()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins.check_commodity">check_commodity</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.check_commodity.CheckCommodityError">CheckCommodityError</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.check_commodity.CheckCommodityError.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.check_commodity.CheckCommodityError.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.check_commodity.CheckCommodityError.__replace__">__replace__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.check_commodity.CheckCommodityError.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.check_commodity.ConfigError">ConfigError</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.check_commodity.ConfigError.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.check_commodity.ConfigError.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.check_commodity.ConfigError.__replace__">__replace__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.check_commodity.ConfigError.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.check_commodity.get_commodity_map_ex">get_commodity_map_ex()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.check_commodity.validate_commodity_directives">validate_commodity_directives()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins.check_drained">check_drained</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.check_drained.check_drained">check_drained()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins.close_tree">close_tree</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.close_tree.close_tree">close_tree()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins.coherent_cost">coherent_cost</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.coherent_cost.CoherentCostError">CoherentCostError</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.coherent_cost.CoherentCostError.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.coherent_cost.CoherentCostError.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.coherent_cost.CoherentCostError.__replace__">__replace__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.coherent_cost.CoherentCostError.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.coherent_cost.validate_coherent_cost">validate_coherent_cost()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins.commodity_attr">commodity_attr</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.commodity_attr.CommodityError">CommodityError</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.commodity_attr.CommodityError.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.commodity_attr.CommodityError.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.commodity_attr.CommodityError.__replace__">__replace__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.commodity_attr.CommodityError.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.commodity_attr.ConfigError">ConfigError</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.commodity_attr.ConfigError.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.commodity_attr.ConfigError.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.commodity_attr.ConfigError.__replace__">__replace__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.commodity_attr.ConfigError.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.commodity_attr.validate_commodity_attr">validate_commodity_attr()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins.currency_accounts">currency_accounts</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.currency_accounts.get_neutralizing_postings">get_neutralizing_postings()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.currency_accounts.group_postings_by_weight_currency">group_postings_by_weight_currency()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.currency_accounts.insert_currency_trading_postings">insert_currency_trading_postings()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins.implicit_prices">implicit_prices</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.implicit_prices.ImplicitPriceError">ImplicitPriceError</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.implicit_prices.ImplicitPriceError.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.implicit_prices.ImplicitPriceError.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.implicit_prices.ImplicitPriceError.__replace__">__replace__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.implicit_prices.ImplicitPriceError.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.implicit_prices.add_implicit_prices">add_implicit_prices()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins.leafonly">leafonly</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.leafonly.LeafOnlyError">LeafOnlyError</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.leafonly.LeafOnlyError.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.leafonly.LeafOnlyError.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.leafonly.LeafOnlyError.__replace__">__replace__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.leafonly.LeafOnlyError.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.leafonly.validate_leaf_only">validate_leaf_only()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins.noduplicates">noduplicates</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.noduplicates.validate_no_duplicates">validate_no_duplicates()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins.nounused">nounused</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.nounused.UnusedAccountError">UnusedAccountError</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.nounused.UnusedAccountError.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.nounused.UnusedAccountError.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.nounused.UnusedAccountError.__replace__">__replace__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.nounused.UnusedAccountError.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.nounused.validate_unused_accounts">validate_unused_accounts()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins.onecommodity">onecommodity</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.onecommodity.OneCommodityError">OneCommodityError</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.onecommodity.OneCommodityError.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.onecommodity.OneCommodityError.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.onecommodity.OneCommodityError.__replace__">__replace__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.onecommodity.OneCommodityError.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.onecommodity.validate_one_commodity">validate_one_commodity()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins.pedantic">pedantic</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins.sellgains">sellgains</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.sellgains.SellGainsError">SellGainsError</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.sellgains.SellGainsError.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.sellgains.SellGainsError.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.sellgains.SellGainsError.__replace__">__replace__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.sellgains.SellGainsError.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.sellgains.validate_sell_gains">validate_sell_gains()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins.unique_prices">unique_prices</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.unique_prices.UniquePricesError">UniquePricesError</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.unique_prices.UniquePricesError.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.unique_prices.UniquePricesError.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.unique_prices.UniquePricesError.__replace__">__replace__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.unique_prices.UniquePricesError.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.unique_prices.validate_unique_prices">validate_unique_prices()</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.scripts.html">beancount.scripts</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.tools.html">beancount.tools</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.utils.html">beancount.utils</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Beancount Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
    
      
        
          <li>API reference &raquo;</li>
        
      
    
    <li>beancount.plugins</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h1 id="beancountplugins">beancount.plugins<a class="headerlink" href="#beancountplugins" title="Permanent link"></a></h1>


  <div class="doc doc-object doc-module">

<a id="beancount.plugins"></a>
    <div class="doc doc-contents first">

      <p>Example plugins for filtering transactions.</p>
<p>These are various examples of how to filter entries in various creative ways.</p>
<p>IMPORTANT: These are not meant to be complete features, rather just experiments
in problem-solving using Beancount, work-in-progress that can be selectively
installed via a --plugin option, or one-offs to answer questions on the
mailing-list.</p>



  <div class="doc doc-children">












  <div class="doc doc-object doc-module">



<h2 id="beancount.plugins.auto" class="doc doc-heading">
        <code>beancount.plugins.auto</code>



<a href="#beancount.plugins.auto" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>A plugin of plugins which triggers are all the automatic and lax plugins.</p>
<p>In a sense, this is the inverse of "pedantic." This is useful when doing some
types of quick and dirty tests. You can just import the "auto" plugin. Put that
in a macro.</p>
<p>Also see: the 'pedantic' plugin.</p>



  <div class="doc doc-children">














  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.plugins.auto_accounts" class="doc doc-heading">
        <code>beancount.plugins.auto_accounts</code>



<a href="#beancount.plugins.auto_accounts" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>This module automatically inserts Open directives for accounts not opened (at
the date of the first entry) and automatically removes open directives for
unused accounts. This can be used as a convenience for doing demos, or when
setting up your initial transactions, as an intermediate step.</p>



  <div class="doc doc-children">











  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.auto_accounts.auto_insert_open" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.auto_accounts.auto_insert_open(entries, unused_options_map)</code>


<a href="#beancount.plugins.auto_accounts.auto_insert_open" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Insert Open directives for accounts not opened.</p>
<p>Open directives are inserted at the date of the first entry. Open directives
for unused accounts are removed.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives.</p></li>
            <li><p><strong>unused_options_map</strong> – A parser options dict.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of entries, possibly with more Open entries than before, and a
list of errors.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/plugins/auto_accounts.py</code></summary>
          <pre class="highlight"><code class="language-python">def auto_insert_open(entries, unused_options_map):
    """Insert Open directives for accounts not opened.

    Open directives are inserted at the date of the first entry. Open directives
    for unused accounts are removed.

    Args:
      entries: A list of directives.
      unused_options_map: A parser options dict.
    Returns:
      A list of entries, possibly with more Open entries than before, and a
      list of errors.
    """
    opened_accounts = {entry.account
                       for entry in entries
                       if isinstance(entry, data.Open)}

    new_entries = []
    accounts_first, _ = getters.get_accounts_use_map(entries)
    for index, (account, date_first_used) in enumerate(sorted(accounts_first.items())):
        if account not in opened_accounts:
            meta = data.new_metadata('&lt;auto_accounts&gt;', index)
            new_entries.append(data.Open(meta, date_first_used, account,
                                         None, None))

    if new_entries:
        new_entries.extend(entries)
        new_entries.sort(key=data.entry_sortkey)
    else:
        new_entries = entries

    return new_entries, []
</code></pre>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.plugins.check_average_cost" class="doc doc-heading">
        <code>beancount.plugins.check_average_cost</code>



<a href="#beancount.plugins.check_average_cost" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>A plugin that ensures cost basis is preserved in unbooked transactions.</p>
<p>This is intended to be used in accounts using the "NONE" booking method, to
manually ensure that the sum total of the cost basis of reducing legs matches
the average of what's in the account inventory. This is a partial first step
toward implementing the "AVERAGE" booking method. In other words, this plugins
provides assertions that will constrain you to approximate what the "AVERAGE"
booking method will do, manually, and not to leak too much cost basis through
unmatching bookings without checks. (Note the contrived context here: Ideally
the "NONE" booking method would simply not exist.)</p>



  <div class="doc doc-children">











  <div class="doc doc-object doc-class">



<h3 id="beancount.plugins.check_average_cost.MatchBasisError" class="doc doc-heading">
        <code>
beancount.plugins.check_average_cost.MatchBasisError            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.plugins.check_average_cost.MatchBasisError" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>MatchBasisError(source, message, entry)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.check_average_cost.MatchBasisError.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.check_average_cost.MatchBasisError.__getnewargs__(self)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.check_average_cost.MatchBasisError.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/check_average_cost.py</code></summary>
          <pre class="highlight"><code class="language-python">def __getnewargs__(self):
    'Return self as a plain tuple.  Used by copy and pickle.'
    return _tuple(self)
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.check_average_cost.MatchBasisError.__new__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.check_average_cost.MatchBasisError.__new__(_cls, source, message, entry)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.plugins.check_average_cost.MatchBasisError.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of MatchBasisError(source, message, entry)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.check_average_cost.MatchBasisError.__replace__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.check_average_cost.MatchBasisError.__replace__(/, self, **kwds)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.check_average_cost.MatchBasisError.__replace__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a new MatchBasisError object replacing specified fields with new values</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/check_average_cost.py</code></summary>
          <pre class="highlight"><code class="language-python">def _replace(self, /, **kwds):
    result = self._make(_map(kwds.pop, field_names, self))
    if kwds:
        raise TypeError(f'Got unexpected field names: {list(kwds)!r}')
    return result
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.check_average_cost.MatchBasisError.__repr__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.check_average_cost.MatchBasisError.__repr__(self)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.check_average_cost.MatchBasisError.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/check_average_cost.py</code></summary>
          <pre class="highlight"><code class="language-python">def __repr__(self):
    'Return a nicely formatted representation string'
    return self.__class__.__name__ + repr_fmt % self
</code></pre>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.check_average_cost.validate_average_cost" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.check_average_cost.validate_average_cost(entries, options_map, config_str=None)</code>


<a href="#beancount.plugins.check_average_cost.validate_average_cost" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Check that reducing legs on unbooked postings are near the average cost basis.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives.</p></li>
            <li><p><strong>unused_options_map</strong> – An options map.</p></li>
            <li><p><strong>config_str</strong> – The configuration as a string version of a float.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of new errors, if any were found.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/plugins/check_average_cost.py</code></summary>
          <pre class="highlight"><code class="language-python">def validate_average_cost(entries, options_map, config_str=None):
    """Check that reducing legs on unbooked postings are near the average cost basis.

    Args:
      entries: A list of directives.
      unused_options_map: An options map.
      config_str: The configuration as a string version of a float.
    Returns:
      A list of new errors, if any were found.
    """
    # Initialize tolerance bounds.
    if config_str and config_str.strip():
        # pylint: disable=eval-used
        config_obj = eval(config_str, {}, {})
        if not isinstance(config_obj, float):
            raise RuntimeError("Invalid configuration for check_average_cost: "
                               "must be a float")
        tolerance = config_obj
    else:
        tolerance = DEFAULT_TOLERANCE
    min_tolerance = D(1 - tolerance)
    max_tolerance = D(1 + tolerance)

    errors = []
    ocmap = getters.get_account_open_close(entries)
    balances = collections.defaultdict(inventory.Inventory)
    for entry in entries:
        if isinstance(entry, Transaction):
            for posting in entry.postings:
                dopen = ocmap.get(posting.account, None)
                # Only process accounts with a NONE booking value.
                if dopen and dopen[0] and dopen[0].booking == Booking.NONE:
                    balance = balances[(posting.account,
                                        posting.units.currency,
                                        posting.cost.currency if posting.cost else None)]
                    if posting.units.number &lt; ZERO:
                        average = balance.average().get_only_position()
                        if average is not None:
                            number = average.cost.number
                            min_valid = number * min_tolerance
                            max_valid = number * max_tolerance
                            if not (min_valid &lt;= posting.cost.number &lt;= max_valid):
                                errors.append(
                                    MatchBasisError(
                                        entry.meta,
                                        ("Cost basis on reducing posting is too far from "
                                         "the average cost ({} vs. {})".format(
                                             posting.cost.number, average.cost.number)),
                                        entry))
                    balance.add_position(posting)
    return entries, errors
</code></pre>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.plugins.check_closing" class="doc doc-heading">
        <code>beancount.plugins.check_closing</code>



<a href="#beancount.plugins.check_closing" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>A plugin that automatically inserts a balance check on a tagged closing posting.</p>
<p>Some postings are known to the user to be "closing trades", which means that the
resulting position of the instrument just after the trade should be zero. For
instance, this is the case for most ordinary options trading, only one lot of a
particular instrument is held, and eventually expires or gets sold off in its
entirely. One would like to confirm that, and the way to do this in Beancount is
to insert a balance check.</p>
<p>This plugin allows you to do that more simply, by inserting metadata. For
example, this transaction:</p>
<pre><code>2018-02-16 * "SOLD -14 QQQ 100 16 FEB 18 160 CALL @5.31"
  Assets:US:Brokerage:Main:Options     -1400 QQQ180216C160 {2.70 USD} @ 5.31 USD
    closing: TRUE
  Expenses:Financial:Commissions       17.45 USD
  Expenses:Financial:Fees               0.42 USD
  Assets:US:Brokerage:Main:Cash      7416.13 USD
  Income:US:Brokerage:Main:PnL
</code></pre>
<p>Would expand into the following two directives:</p>
<pre><code>2018-02-16 * "SOLD -14 QQQ 100 16 FEB 18 160 CALL @5.31"
  Assets:US:Brokerage:Main:Options     -1400 QQQ180216C160 {2.70 USD} @ 5.31 USD
  Expenses:Financial:Commissions       17.45 USD
  Expenses:Financial:Fees               0.42 USD
  Assets:US:Brokerage:Main:Cash      7416.13 USD
  Income:US:Brokerage:Main:PnL

2018-02-17 balance Assets:US:Brokerage:Main:Options  0 QQQ180216C160
</code></pre>
<p>Insert the closing line when you know you're closing the position.</p>



  <div class="doc doc-children">











  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.check_closing.check_closing" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.check_closing.check_closing(entries, options_map)</code>


<a href="#beancount.plugins.check_closing.check_closing" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Expand 'closing' metadata to a zero balance check.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives.</p></li>
            <li><p><strong>unused_options_map</strong> – An options map.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of new errors, if any were found.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/plugins/check_closing.py</code></summary>
          <pre class="highlight"><code class="language-python">def check_closing(entries, options_map):
    """Expand 'closing' metadata to a zero balance check.

    Args:
      entries: A list of directives.
      unused_options_map: An options map.
    Returns:
      A list of new errors, if any were found.
    """
    new_entries = []
    for entry in entries:
        if isinstance(entry, data.Transaction):
            for i, posting in enumerate(entry.postings):
                if posting.meta and posting.meta.get('closing', False):
                    # Remove the metadata.
                    meta = posting.meta.copy()
                    del meta['closing']
                    posting = posting._replace(meta=meta)
                    entry.postings[i] = posting

                    # Insert a balance.
                    date = entry.date + datetime.timedelta(days=1)
                    balance = data.Balance(data.new_metadata("&lt;check_closing&gt;", 0),
                                           date, posting.account,
                                           amount.Amount(ZERO, posting.units.currency),
                                           None, None)
                    new_entries.append(balance)
        new_entries.append(entry)
    return new_entries, []
</code></pre>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.plugins.check_commodity" class="doc doc-heading">
        <code>beancount.plugins.check_commodity</code>



<a href="#beancount.plugins.check_commodity" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>A plugin that verifies that all seen commodities have a Commodity directive.</p>
<p>This is useful if you're a bit pedantic and like to make sure that you're
declared attributes for each of the commodities you use. It's useful if you use
the portfolio export, for example.</p>
<p>You can provide a mapping of (account-regexp, currency-regexp) as options, to
specify which commodities to ignore from this plugin selectively. Use this
sparingly, as it is an out from the checks that this plugin provides. However,
in an active options trading account, a ton of products get inserted and the
number of commodity directives can be overwhelming and it's not productive to
declare each of the options contracts - names with an embedded strike and
expiration date, such as 'SPX_121622P3300' - individually.</p>
<p>Note that if a symbol has been ignored in at least one account, it will
therefore be further in all Price directives and Metadata values.</p>



  <div class="doc doc-children">













  <div class="doc doc-object doc-class">



<h3 id="beancount.plugins.check_commodity.CheckCommodityError" class="doc doc-heading">
        <code>
beancount.plugins.check_commodity.CheckCommodityError            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.plugins.check_commodity.CheckCommodityError" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>CheckCommodityError(source, message, entry)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.check_commodity.CheckCommodityError.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.check_commodity.CheckCommodityError.__getnewargs__(self)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.check_commodity.CheckCommodityError.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/check_commodity.py</code></summary>
          <pre class="highlight"><code class="language-python">def __getnewargs__(self):
    'Return self as a plain tuple.  Used by copy and pickle.'
    return _tuple(self)
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.check_commodity.CheckCommodityError.__new__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.check_commodity.CheckCommodityError.__new__(_cls, source, message, entry)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.plugins.check_commodity.CheckCommodityError.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of CheckCommodityError(source, message, entry)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.check_commodity.CheckCommodityError.__replace__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.check_commodity.CheckCommodityError.__replace__(/, self, **kwds)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.check_commodity.CheckCommodityError.__replace__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a new CheckCommodityError object replacing specified fields with new values</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/check_commodity.py</code></summary>
          <pre class="highlight"><code class="language-python">def _replace(self, /, **kwds):
    result = self._make(_map(kwds.pop, field_names, self))
    if kwds:
        raise TypeError(f'Got unexpected field names: {list(kwds)!r}')
    return result
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.check_commodity.CheckCommodityError.__repr__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.check_commodity.CheckCommodityError.__repr__(self)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.check_commodity.CheckCommodityError.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/check_commodity.py</code></summary>
          <pre class="highlight"><code class="language-python">def __repr__(self):
    'Return a nicely formatted representation string'
    return self.__class__.__name__ + repr_fmt % self
</code></pre>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="beancount.plugins.check_commodity.ConfigError" class="doc doc-heading">
        <code>
beancount.plugins.check_commodity.ConfigError            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.plugins.check_commodity.ConfigError" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>ConfigError(source, message, entry)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.check_commodity.ConfigError.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.check_commodity.ConfigError.__getnewargs__(self)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.check_commodity.ConfigError.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/check_commodity.py</code></summary>
          <pre class="highlight"><code class="language-python">def __getnewargs__(self):
    'Return self as a plain tuple.  Used by copy and pickle.'
    return _tuple(self)
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.check_commodity.ConfigError.__new__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.check_commodity.ConfigError.__new__(_cls, source, message, entry)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.plugins.check_commodity.ConfigError.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of ConfigError(source, message, entry)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.check_commodity.ConfigError.__replace__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.check_commodity.ConfigError.__replace__(/, self, **kwds)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.check_commodity.ConfigError.__replace__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a new ConfigError object replacing specified fields with new values</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/check_commodity.py</code></summary>
          <pre class="highlight"><code class="language-python">def _replace(self, /, **kwds):
    result = self._make(_map(kwds.pop, field_names, self))
    if kwds:
        raise TypeError(f'Got unexpected field names: {list(kwds)!r}')
    return result
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.check_commodity.ConfigError.__repr__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.check_commodity.ConfigError.__repr__(self)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.check_commodity.ConfigError.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/check_commodity.py</code></summary>
          <pre class="highlight"><code class="language-python">def __repr__(self):
    'Return a nicely formatted representation string'
    return self.__class__.__name__ + repr_fmt % self
</code></pre>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.check_commodity.get_commodity_map_ex" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.check_commodity.get_commodity_map_ex(entries, metadata=False)</code>


<a href="#beancount.plugins.check_commodity.get_commodity_map_ex" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Find and extract commodities in the stream of directives.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/check_commodity.py</code></summary>
          <pre class="highlight"><code class="language-python">def get_commodity_map_ex(entries, metadata=False):
    """Find and extract commodities in the stream of directives."""

    # Find commodity names in metadata.
    #
    # TODO(dnicolodi) Unfortunately detecting commodities in metadata
    # values may result in false positives: common used string are
    # matched by the regular expression. Revisit this when commodities
    # will be represented with their own type.
    ignore = set(['filename', 'lineno', '__automatic__'])
    regexp = re.compile(CURRENCY_RE)
    def currencies_in_meta(entry):
        if entry.meta is not None:
            for key, value in entry.meta.items():
                if isinstance(value, str) and key not in ignore:
                    if regexp.fullmatch(value):
                        yield value

    commodities_map = {}
    occurrences = set()
    for entry in entries:
        if isinstance(entry, data.Commodity):
            commodities_map[entry.currency] = entry

        elif isinstance(entry, data.Open):
            if entry.currencies:
                for currency in entry.currencies:
                    occurrences.add((entry.account, currency))

        elif isinstance(entry, data.Transaction):
            for posting in entry.postings:

                # Main currency.
                units = posting.units
                occurrences.add((posting.account, units.currency))

                # Currency in cost.
                cost = posting.cost
                if cost:
                    occurrences.add((posting.account, cost.currency))

                # Currency in price.
                price = posting.price
                if price:
                    occurrences.add((posting.account, price.currency))

                # Currency in posting metadata.
                if metadata:
                    for currency in currencies_in_meta(posting):
                        occurrences.add((posting.account, currency))

        elif isinstance(entry, data.Balance):
            occurrences.add((entry.account, entry.amount.currency))

        elif isinstance(entry, data.Price):
            occurrences.add((PRICE_CONTEXT, entry.currency))
            occurrences.add((PRICE_CONTEXT, entry.amount.currency))

        # Entry metadata.
        if metadata:
            for currency in currencies_in_meta(entry):
                occurrences.add((METADATA_CONTEXT, currency))

    return occurrences, commodities_map
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.check_commodity.validate_commodity_directives" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.check_commodity.validate_commodity_directives(entries, options_map, config_str=None)</code>


<a href="#beancount.plugins.check_commodity.validate_commodity_directives" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Find all commodities used and ensure they have a corresponding Commodity directive.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives.</p></li>
            <li><p><strong>options_map</strong> – An options map.</p></li>
            <li><p><strong>config_str</strong> – The configuration as a string version of a float.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of new errors, if any were found.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/plugins/check_commodity.py</code></summary>
          <pre class="highlight"><code class="language-python">def validate_commodity_directives(entries, options_map, config_str=None):
    """Find all commodities used and ensure they have a corresponding Commodity directive.

    Args:
      entries: A list of directives.
      options_map: An options map.
      config_str: The configuration as a string version of a float.
    Returns:
      A list of new errors, if any were found.
    """
    errors = []

    # pylint: disable=eval-used
    if config_str:
        config_obj = eval(config_str, {}, {})
        if not isinstance(config_obj, dict):
            errors.append(ConfigError(
                data.new_metadata('&lt;commodity_attr&gt;', 0),
                "Invalid configuration for check_commodity plugin; skipping.", None))
            return entries, errors
    else:
        config_obj = {}

    # Compile the regular expressions, producing an error if invalid.
    ignore_map = {}
    for key, value in config_obj.items():
        kv = []
        for pattern in key, value:
            try:
                kv.append(re.compile(pattern).match)
            except re.error:
                meta = data.new_metadata('&lt;check_commodity&gt;', 0)
                errors.append(
                    CheckCommodityError(
                        meta, "Invalid regexp: '{}' for {}".format(value, key), None))
        if len(kv) == 2:
            ignore_map[kv[0]] = kv[1]

    # Get all the occurrences of commodities and a mapping of the directives.
    #
    # TODO(blais): Establish a distinction at the parser level for commodities
    # and strings, so that we can turn detection of them in metadata.
    occurrences, commodity_map = get_commodity_map_ex(entries, metadata=False)

    # Process all currencies with context.
    issued = set()
    ignored = set()
    anonymous = set()
    for context, currency in sorted(occurrences):
        if context in ANONYMOUS:
            anonymous.add((context, currency))
            continue
        commodity_entry = commodity_map.get(currency, None)

        # Skip if the commodity was declared, or if an error for that commodity
        # has already been issued.
        if commodity_entry is not None or currency in issued:
            continue

        # If any of the ignore patterns matches, ignore and record ignored.
        if any((context_re(context) and currency_re(currency))
                for context_re, currency_re in ignore_map.items()):
            ignored.add(currency)
            continue

        # Issue error.
        meta = data.new_metadata('&lt;check_commodity&gt;', 0)
        errors.append(
            CheckCommodityError(
                meta,
                "Missing Commodity directive for '{}' in '{}'".format(
                    currency, context),
                None))

        # Process it only once.
        issued.add(currency)

    # Process all currencies out of context, automatically ignoring those which
    # have already been issued with account context..
    for context, currency in sorted(anonymous):
        commodity_entry = commodity_map.get(currency, None)

        # Skip if (a) the commodity was declared, any of the ignore patterns
        # matches, or an error for that commodity has already been issued.
        if (commodity_entry is not None or
            currency in issued or
            currency in ignored):
            continue

        # Issue error.
        meta = data.new_metadata('&lt;check_commodity&gt;', 0)
        errors.append(
            CheckCommodityError(
                meta,
                "Missing Commodity directive for '{}' in '{}'".format(
                    currency, context),
                None))

    return entries, errors
</code></pre>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.plugins.check_drained" class="doc doc-heading">
        <code>beancount.plugins.check_drained</code>



<a href="#beancount.plugins.check_drained" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Insert a balance check for zero before balance sheets accounts are closed.</p>
<p>For balance sheet accounts with a Close directive (Assets, Liabilities &amp;
Equity), insert Balance directives just after its closing date, for all the
commodities that have appeared in that account and that are declared as legal on
it as well. This performs the equivalent of the following transformation:</p>
<pre><code>2018-02-01 open  Assets:Project:Cash      USD,CAD
...
2020-02-01 close Assets:Project:Cash
</code></pre>
<p>!!! to
    2018-02-01 open  Assets:Project:Cash      USD,CAD
    ...</p>
<pre><code>2020-02-01 close Assets:Project:Cash
2020-02-02 balance Assets:Project:Cash    0 USD
2020-02-02 balance Assets:Project:Cash    0 CAD
</code></pre>



  <div class="doc doc-children">












  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.check_drained.check_drained" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.check_drained.check_drained(entries, options_map)</code>


<a href="#beancount.plugins.check_drained.check_drained" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Check that closed accounts are empty.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives.</p></li>
            <li><p><strong>unused_options_map</strong> – An options map.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of new errors, if any were found.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/plugins/check_drained.py</code></summary>
          <pre class="highlight"><code class="language-python">def check_drained(entries, options_map):
    """Check that closed accounts are empty.

    Args:
      entries: A list of directives.
      unused_options_map: An options map.
    Returns:
      A list of new errors, if any were found.
    """
    acctypes = options.get_account_types(options_map)
    is_covered = functools.partial(
        account_types.is_balance_sheet_account, account_types=acctypes
    )

    new_entries = []
    currencies = collections.defaultdict(set)
    balances = collections.defaultdict(set)
    for entry in entries:
        if isinstance(entry, data.Transaction):
            # Accumulate all the currencies seen in each account over time.
            for posting in entry.postings:
                if is_covered(posting.account):
                    currencies[posting.account].add(posting.units.currency)

        elif isinstance(entry, data.Open):
            # Accumulate all the currencies declared in the account opening.
            if is_covered(entry.account) and entry.currencies:
                for currency in entry.currencies:
                    currencies[entry.account].add(currency)

        elif isinstance(entry, data.Balance):
            # Ignore balances where directives are present.
            if is_covered(entry.account):
                balances[entry.account].add((entry.date, entry.amount.currency))

        if isinstance(entry, data.Close):
            if is_covered(entry.account):
                for currency in currencies[entry.account]:
                    # Skip balance insertion due to the presence of an explicit one.
                    if (entry.date, currency) in balances[entry.account]:
                        continue

                    # Insert a balance directive.
                    balance_entry = data.Balance(
                        # Note: We use the close directive's meta so that
                        # balance errors direct the user to the corresponding
                        # close directive.
                        entry.meta,
                        entry.date + ONE_DAY,
                        entry.account,
                        amount.Amount(ZERO, currency),
                        None,
                        None,
                    )
                    new_entries.append(balance_entry)

        new_entries.append(entry)

    return new_entries, []
</code></pre>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.plugins.close_tree" class="doc doc-heading">
        <code>beancount.plugins.close_tree</code>



<a href="#beancount.plugins.close_tree" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>This plugin inserts close directives for all of an account's descendants when
an account is closed. Unopened parent accounts can also be closed. Any
explicitly specified close is left untouched.</p>
<p>For example, given this::</p>
<pre><code>2017-11-10 open Assets:Brokerage:AAPL
2017-11-10 open Assets:Brokerage:ORNG
2018-11-10 close Assets:Brokerage  ; this does not necessarily need to be opened
</code></pre>
<p>the plugin turns it into::</p>
<pre><code>2017-11-10 open Assets:Brokerage:AAPL
2017-11-10 open Assets:Brokerage:ORNG
2018-11-10 close Assets:Brokerage:AAPL
2018-11-10 close Assets:Brokerage:ORNG
</code></pre>
<p>Invoke this plugin <em>after</em> any plugins that generate <code>open</code> directives for account trees
that you want to auto close. An example is the <code>auto_accounts</code> plugin that ships with
Beancount::</p>
<pre><code>plugin "beancount.plugins.auto_accounts"
plugin "beancount.plugins.close_tree"
</code></pre>



  <div class="doc doc-children">









  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.close_tree.close_tree" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.close_tree.close_tree(entries, unused_options_map)</code>


<a href="#beancount.plugins.close_tree.close_tree" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Insert close entries for all subaccounts of a closed account.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives. We're interested only in the Open/Close instances.</p></li>
            <li><p><strong>unused_options_map</strong> – A parser options dict.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A tuple of entries and errors.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/plugins/close_tree.py</code></summary>
          <pre class="highlight"><code class="language-python">def close_tree(entries, unused_options_map):
    """Insert close entries for all subaccounts of a closed account.

    Args:
      entries: A list of directives. We're interested only in the Open/Close instances.
      unused_options_map: A parser options dict.
    Returns:
      A tuple of entries and errors.
    """

    new_entries = []
    errors = []

    opens = set(entry.account for entry in entries if isinstance(entry, Open))
    closes = set(entry.account for entry in entries if isinstance(entry, Close))

    for entry in entries:
        if isinstance(entry, Close):
            subaccounts = [
                account
                for account in opens
                if account.startswith(entry.account + ":") and account not in closes
            ]
            for subacc in subaccounts:
                meta = data.new_metadata("&lt;beancount.plugins.close_tree&gt;", 0)
                close_entry = data.Close(meta, entry.date, subacc)
                new_entries.append(close_entry)
                # So we don't attempt to re-close a grandchild that a child closed
                closes.add(subacc)
            if entry.account in opens:
                new_entries.append(entry)
        else:
            new_entries.append(entry)

    return new_entries, errors
</code></pre>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.plugins.coherent_cost" class="doc doc-heading">
        <code>beancount.plugins.coherent_cost</code>



<a href="#beancount.plugins.coherent_cost" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>This plugin validates that currencies held at cost aren't ever converted at
price and vice-versa. This is usually the case, and using it will prevent users
from making the mistake of selling a lot without specifying it via its cost
basis.</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-class">



<h3 id="beancount.plugins.coherent_cost.CoherentCostError" class="doc doc-heading">
        <code>
beancount.plugins.coherent_cost.CoherentCostError            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.plugins.coherent_cost.CoherentCostError" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>CoherentCostError(source, message, entry)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.coherent_cost.CoherentCostError.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.coherent_cost.CoherentCostError.__getnewargs__(self)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.coherent_cost.CoherentCostError.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/coherent_cost.py</code></summary>
          <pre class="highlight"><code class="language-python">def __getnewargs__(self):
    'Return self as a plain tuple.  Used by copy and pickle.'
    return _tuple(self)
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.coherent_cost.CoherentCostError.__new__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.coherent_cost.CoherentCostError.__new__(_cls, source, message, entry)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.plugins.coherent_cost.CoherentCostError.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of CoherentCostError(source, message, entry)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.coherent_cost.CoherentCostError.__replace__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.coherent_cost.CoherentCostError.__replace__(/, self, **kwds)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.coherent_cost.CoherentCostError.__replace__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a new CoherentCostError object replacing specified fields with new values</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/coherent_cost.py</code></summary>
          <pre class="highlight"><code class="language-python">def _replace(self, /, **kwds):
    result = self._make(_map(kwds.pop, field_names, self))
    if kwds:
        raise TypeError(f'Got unexpected field names: {list(kwds)!r}')
    return result
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.coherent_cost.CoherentCostError.__repr__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.coherent_cost.CoherentCostError.__repr__(self)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.coherent_cost.CoherentCostError.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/coherent_cost.py</code></summary>
          <pre class="highlight"><code class="language-python">def __repr__(self):
    'Return a nicely formatted representation string'
    return self.__class__.__name__ + repr_fmt % self
</code></pre>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.coherent_cost.validate_coherent_cost" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.coherent_cost.validate_coherent_cost(entries, unused_options_map)</code>


<a href="#beancount.plugins.coherent_cost.validate_coherent_cost" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Check that all currencies are either used at cost or not at all, but never both.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives.</p></li>
            <li><p><strong>unused_options_map</strong> – An options map.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of new errors, if any were found.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/plugins/coherent_cost.py</code></summary>
          <pre class="highlight"><code class="language-python">def validate_coherent_cost(entries, unused_options_map):
    """Check that all currencies are either used at cost or not at all, but never both.

    Args:
      entries: A list of directives.
      unused_options_map: An options map.
    Returns:
      A list of new errors, if any were found.
    """
    errors = []

    with_cost = {}
    without_cost = {}
    for entry in data.filter_txns(entries):
        for posting in entry.postings:
            target_set = without_cost if posting.cost is None else with_cost
            currency = posting.units.currency
            target_set.setdefault(currency, entry)

    for currency in set(with_cost) &amp; set(without_cost):
        errors.append(
            CoherentCostError(
                without_cost[currency].meta,
                "Currency '{}' is used both with and without cost".format(currency),
                with_cost[currency]))
        # Note: We really ought to include both of the first transactions here.

    return entries, errors
</code></pre>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.plugins.commodity_attr" class="doc doc-heading">
        <code>beancount.plugins.commodity_attr</code>



<a href="#beancount.plugins.commodity_attr" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>A plugin that asserts that all Commodity directives have a particular
attribute and that it is part of a set of enum values.</p>
<p>The configuration must be a mapping of attribute name to list of valid values,
like this:</p>
<pre><code>plugin "beancount.plugins.commodity_attr" "{
  'sector': ['Technology', 'Financials', 'Energy'],
  'name': None,
}"
</code></pre>
<p>The plugin issues an error if a Commodity directive is missing the attribute, or
if the attribute value is not in the valid set. If you'd like to just ensure the
attribute is set, set the list of valid values to None, as in the 'name'
attribute in the example above.</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-class">



<h3 id="beancount.plugins.commodity_attr.CommodityError" class="doc doc-heading">
        <code>
beancount.plugins.commodity_attr.CommodityError            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.plugins.commodity_attr.CommodityError" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>CommodityError(source, message, entry)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.commodity_attr.CommodityError.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.commodity_attr.CommodityError.__getnewargs__(self)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.commodity_attr.CommodityError.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/commodity_attr.py</code></summary>
          <pre class="highlight"><code class="language-python">def __getnewargs__(self):
    'Return self as a plain tuple.  Used by copy and pickle.'
    return _tuple(self)
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.commodity_attr.CommodityError.__new__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.commodity_attr.CommodityError.__new__(_cls, source, message, entry)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.plugins.commodity_attr.CommodityError.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of CommodityError(source, message, entry)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.commodity_attr.CommodityError.__replace__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.commodity_attr.CommodityError.__replace__(/, self, **kwds)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.commodity_attr.CommodityError.__replace__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a new CommodityError object replacing specified fields with new values</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/commodity_attr.py</code></summary>
          <pre class="highlight"><code class="language-python">def _replace(self, /, **kwds):
    result = self._make(_map(kwds.pop, field_names, self))
    if kwds:
        raise TypeError(f'Got unexpected field names: {list(kwds)!r}')
    return result
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.commodity_attr.CommodityError.__repr__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.commodity_attr.CommodityError.__repr__(self)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.commodity_attr.CommodityError.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/commodity_attr.py</code></summary>
          <pre class="highlight"><code class="language-python">def __repr__(self):
    'Return a nicely formatted representation string'
    return self.__class__.__name__ + repr_fmt % self
</code></pre>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="beancount.plugins.commodity_attr.ConfigError" class="doc doc-heading">
        <code>
beancount.plugins.commodity_attr.ConfigError            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.plugins.commodity_attr.ConfigError" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>ConfigError(source, message, entry)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.commodity_attr.ConfigError.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.commodity_attr.ConfigError.__getnewargs__(self)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.commodity_attr.ConfigError.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/commodity_attr.py</code></summary>
          <pre class="highlight"><code class="language-python">def __getnewargs__(self):
    'Return self as a plain tuple.  Used by copy and pickle.'
    return _tuple(self)
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.commodity_attr.ConfigError.__new__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.commodity_attr.ConfigError.__new__(_cls, source, message, entry)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.plugins.commodity_attr.ConfigError.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of ConfigError(source, message, entry)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.commodity_attr.ConfigError.__replace__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.commodity_attr.ConfigError.__replace__(/, self, **kwds)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.commodity_attr.ConfigError.__replace__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a new ConfigError object replacing specified fields with new values</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/commodity_attr.py</code></summary>
          <pre class="highlight"><code class="language-python">def _replace(self, /, **kwds):
    result = self._make(_map(kwds.pop, field_names, self))
    if kwds:
        raise TypeError(f'Got unexpected field names: {list(kwds)!r}')
    return result
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.commodity_attr.ConfigError.__repr__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.commodity_attr.ConfigError.__repr__(self)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.commodity_attr.ConfigError.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/commodity_attr.py</code></summary>
          <pre class="highlight"><code class="language-python">def __repr__(self):
    'Return a nicely formatted representation string'
    return self.__class__.__name__ + repr_fmt % self
</code></pre>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.commodity_attr.validate_commodity_attr" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.commodity_attr.validate_commodity_attr(entries, unused_options_map, config_str)</code>


<a href="#beancount.plugins.commodity_attr.validate_commodity_attr" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Check that all Commodity directives have a valid attribute.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives.</p></li>
            <li><p><strong>unused_options_map</strong> – An options map.</p></li>
            <li><p><strong>config_str</strong> – A configuration string.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of new errors, if any were found.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/plugins/commodity_attr.py</code></summary>
          <pre class="highlight"><code class="language-python">def validate_commodity_attr(entries, unused_options_map, config_str):
    """Check that all Commodity directives have a valid attribute.

    Args:
      entries: A list of directives.
      unused_options_map: An options map.
      config_str: A configuration string.
    Returns:
      A list of new errors, if any were found.
    """
    errors = []

    # pylint: disable=eval-used
    config_obj = eval(config_str, {}, {})
    if not isinstance(config_obj, dict):
        errors.append(ConfigError(
            data.new_metadata('&lt;commodity_attr&gt;', 0),
            "Invalid configuration for commodity_attr plugin; skipping.", None))
        return entries, errors

    validmap = {attr: frozenset(values) if values is not None else None
                for attr, values in config_obj.items()}
    for entry in entries:
        if not isinstance(entry, data.Commodity):
            continue
        for attr, values in validmap.items():
            value = entry.meta.get(attr, None)
            if value is None:
                errors.append(CommodityError(
                    entry.meta,
                    "Missing attribute '{}' for Commodity directive {}".format(
                        attr, entry.currency), None))
                continue
            if values and value not in values:
                errors.append(CommodityError(
                    entry.meta,
                    "Invalid value '{}' for attribute {}, Commodity".format(value, attr) +
                    " directive {}; valid options: {}".format(
                        entry.currency, ', '.join(values)), None))

    return entries, errors
</code></pre>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.plugins.currency_accounts" class="doc doc-heading">
        <code>beancount.plugins.currency_accounts</code>



<a href="#beancount.plugins.currency_accounts" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>An implementation of currency accounts.</p>
<p>This is an automatic implementation of the method described here:
https://www.mathstat.dal.ca/~selinger/accounting/tutorial.html</p>
<p>You enable it just like this:</p>
<pre><code>plugin "beancount.plugins.currency_accounts" "Equity:CurrencyAccounts"
</code></pre>
<p>Accounts will be automatically created under the given base account, with the
currency name appended to it, e.g.,</p>
<pre><code>Equity:CurrencyAccounts:CAD
Equity:CurrencyAccounts:USD
</code></pre>
<p>etc., where used. You can have a look at the account balances with a query like
this:</p>
<pre><code>bean-query $L "select account, sum(position), convert(sum(position), 'USD')
               where date &amp;gt;= 2018-01-01 and  account ~ 'CurrencyAccounts' "
</code></pre>
<p>The sum total of the converted amounts should be a number not too large:</p>
<pre><code>bean-query $L "select convert(sum(position), 'USD')
               where date &amp;gt;= 2018-01-01 and  account ~ 'CurrencyAccounts'"
</code></pre>
<p>WARNING: This is a prototype. Note the FIXMEs in the code below, which indicate
some potential problems.</p>



  <div class="doc doc-children">













  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.currency_accounts.get_neutralizing_postings" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.currency_accounts.get_neutralizing_postings(curmap, base_account, new_accounts)</code>


<a href="#beancount.plugins.currency_accounts.get_neutralizing_postings" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Process an entry.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>curmap</strong> – A dict of currency to a list of Postings of this transaction.</p></li>
            <li><p><strong>base_account</strong> – A string, the root account name to insert.</p></li>
            <li><p><strong>new_accounts</strong> – A set, a mutable accumulator of new account names.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A modified entry, with new postings inserted to rebalance currency trading
accounts.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/plugins/currency_accounts.py</code></summary>
          <pre class="highlight"><code class="language-python">def get_neutralizing_postings(curmap, base_account, new_accounts):
    """Process an entry.

    Args:
      curmap: A dict of currency to a list of Postings of this transaction.
      base_account: A string, the root account name to insert.
      new_accounts: A set, a mutable accumulator of new account names.
    Returns:
      A modified entry, with new postings inserted to rebalance currency trading
      accounts.
    """
    new_postings = []
    for currency, postings in curmap.items():
        # Compute the per-currency balance.
        inv = inventory.Inventory()
        for posting in postings:
            inv.add_amount(convert.get_cost(posting))
        if inv.is_empty():
            new_postings.extend(postings)
            continue

        # Re-insert original postings and remove price conversions.
        #
        # Note: This may cause problems if the implicit_prices plugin is
        # configured to run after this one, or if you need the price annotations
        # for some scripting or serious work.
        #
        # FIXME: We need to handle these important cases (they're not frivolous,
        # this is a prototype), probably by inserting some exceptions with
        # collaborating code in the booking (e.g. insert some metadata that
        # disables price conversions on those postings).
        #
        # FIXME(2): Ouch! Some of the residual seeps through here, where there
        # are more than a single currency block. This needs fixing too. You can
        # easily mitigate some of this to some extent, by excluding transactions
        # which don't have any price conversion in them.
        for pos in postings:
            if pos.price is not None:
                pos = pos._replace(price=None)
            new_postings.append(pos)

        # Insert the currency trading accounts postings.
        amount = inv.get_only_position().units
        acc = account.join(base_account, currency)
        new_accounts.add(acc)
        new_postings.append(
            Posting(acc, -amount, None, None, None, None))

    return new_postings
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.currency_accounts.group_postings_by_weight_currency" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.currency_accounts.group_postings_by_weight_currency(entry)</code>


<a href="#beancount.plugins.currency_accounts.group_postings_by_weight_currency" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Return where this entry might require adjustment.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/currency_accounts.py</code></summary>
          <pre class="highlight"><code class="language-python">def group_postings_by_weight_currency(entry: Transaction):
    """Return where this entry might require adjustment."""
    curmap = collections.defaultdict(list)
    has_price = False
    for posting in entry.postings:
        currency = posting.units.currency
        if posting.cost:
            currency = posting.cost.currency
            if posting.price:
                assert posting.price.currency == currency
            elif posting.price:
                has_price = True
                currency = posting.price.currency
        if posting.price:
            has_price = True
        curmap[currency].append(posting)
    return curmap, has_price
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.currency_accounts.insert_currency_trading_postings" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.currency_accounts.insert_currency_trading_postings(entries, options_map, config)</code>


<a href="#beancount.plugins.currency_accounts.insert_currency_trading_postings" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Insert currency trading postings.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives.</p></li>
            <li><p><strong>unused_options_map</strong> – An options map.</p></li>
            <li><p><strong>config</strong> – The base account name for currency trading accounts.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of new errors, if any were found.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/plugins/currency_accounts.py</code></summary>
          <pre class="highlight"><code class="language-python">def insert_currency_trading_postings(entries, options_map, config):
    """Insert currency trading postings.

    Args:
      entries: A list of directives.
      unused_options_map: An options map.
      config: The base account name for currency trading accounts.
    Returns:
      A list of new errors, if any were found.
    """
    base_account = config.strip()
    if not account.is_valid(base_account):
        base_account = DEFAULT_BASE_ACCOUNT

    errors = []
    new_entries = []
    new_accounts = set()
    for entry in entries:
        if isinstance(entry, Transaction):
            curmap, has_price = group_postings_by_weight_currency(entry)
            if has_price and len(curmap) &gt; 1:
                new_postings = get_neutralizing_postings(
                    curmap, base_account, new_accounts)
                entry = entry._replace(postings=new_postings)
                if META_PROCESSED:
                    entry.meta[META_PROCESSED] = True
        new_entries.append(entry)

    earliest_date = entries[0].date
    open_entries = [
        data.Open(data.new_metadata('&lt;currency_accounts&gt;', index),
                  earliest_date, acc, None, None)
        for index, acc in enumerate(sorted(new_accounts))]

    return open_entries + new_entries, errors
</code></pre>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.plugins.implicit_prices" class="doc doc-heading">
        <code>beancount.plugins.implicit_prices</code>



<a href="#beancount.plugins.implicit_prices" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>This plugin synthesizes Price directives for all Postings with a price or
directive or if it is an augmenting posting, has a cost directive.</p>



  <div class="doc doc-children">











  <div class="doc doc-object doc-class">



<h3 id="beancount.plugins.implicit_prices.ImplicitPriceError" class="doc doc-heading">
        <code>
beancount.plugins.implicit_prices.ImplicitPriceError            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.plugins.implicit_prices.ImplicitPriceError" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>ImplicitPriceError(source, message, entry)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.implicit_prices.ImplicitPriceError.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.implicit_prices.ImplicitPriceError.__getnewargs__(self)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.implicit_prices.ImplicitPriceError.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/implicit_prices.py</code></summary>
          <pre class="highlight"><code class="language-python">def __getnewargs__(self):
    'Return self as a plain tuple.  Used by copy and pickle.'
    return _tuple(self)
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.implicit_prices.ImplicitPriceError.__new__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.implicit_prices.ImplicitPriceError.__new__(_cls, source, message, entry)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.plugins.implicit_prices.ImplicitPriceError.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of ImplicitPriceError(source, message, entry)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.implicit_prices.ImplicitPriceError.__replace__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.implicit_prices.ImplicitPriceError.__replace__(/, self, **kwds)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.implicit_prices.ImplicitPriceError.__replace__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a new ImplicitPriceError object replacing specified fields with new values</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/implicit_prices.py</code></summary>
          <pre class="highlight"><code class="language-python">def _replace(self, /, **kwds):
    result = self._make(_map(kwds.pop, field_names, self))
    if kwds:
        raise TypeError(f'Got unexpected field names: {list(kwds)!r}')
    return result
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.implicit_prices.ImplicitPriceError.__repr__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.implicit_prices.ImplicitPriceError.__repr__(self)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.implicit_prices.ImplicitPriceError.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/implicit_prices.py</code></summary>
          <pre class="highlight"><code class="language-python">def __repr__(self):
    'Return a nicely formatted representation string'
    return self.__class__.__name__ + repr_fmt % self
</code></pre>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.implicit_prices.add_implicit_prices" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.implicit_prices.add_implicit_prices(entries, unused_options_map)</code>


<a href="#beancount.plugins.implicit_prices.add_implicit_prices" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Insert implicitly defined prices from Transactions.</p>
<p>Explicit price entries are simply maintained in the output list. Prices from
postings with costs or with prices from Transaction entries are synthesized
as new Price entries in the list of entries output.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives. We're interested only in the Transaction instances.</p></li>
            <li><p><strong>unused_options_map</strong> – A parser options dict.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of entries, possibly with more Price entries than before, and a
list of errors.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/plugins/implicit_prices.py</code></summary>
          <pre class="highlight"><code class="language-python">def add_implicit_prices(entries, unused_options_map):
    """Insert implicitly defined prices from Transactions.

    Explicit price entries are simply maintained in the output list. Prices from
    postings with costs or with prices from Transaction entries are synthesized
    as new Price entries in the list of entries output.

    Args:
      entries: A list of directives. We're interested only in the Transaction instances.
      unused_options_map: A parser options dict.
    Returns:
      A list of entries, possibly with more Price entries than before, and a
      list of errors.
    """
    new_entries = []
    errors = []

    # A dict of (date, currency, cost-currency) to price entry.
    new_price_entry_map = {}

    balances = collections.defaultdict(inventory.Inventory)
    for entry in entries:
        # Always replicate the existing entries.
        new_entries.append(entry)

        if isinstance(entry, Transaction):
            # Inspect all the postings in the transaction.
            for posting in entry.postings:
                units = posting.units
                cost = posting.cost

                # Check if the position is matching against an existing
                # position.
                _, booking = balances[posting.account].add_position(posting)

                # Add prices when they're explicitly specified on a posting. An
                # explicitly specified price may occur in a conversion, e.g.
                #      Assets:Account    100 USD @ 1.10 CAD
                # or, if a cost is also specified, as the current price of the
                # underlying instrument, e.g.
                #      Assets:Account    100 HOOL {564.20} @ {581.97} USD
                if posting.price is not None:
                    meta = data.new_metadata(entry.meta["filename"], entry.meta["lineno"])
                    meta[METADATA_FIELD] = "from_price"
                    price_entry = data.Price(meta, entry.date,
                                             units.currency,
                                             posting.price)

                # Add costs, when we're not matching against an existing
                # position. This happens when we're just specifying the cost,
                # e.g.
                #      Assets:Account    100 HOOL {564.20}
                elif (cost is not None and
                      booking != inventory.MatchResult.REDUCED):
                    # TODO(blais): What happens here if the account has no
                    # booking strategy? Do we end up inserting a price for the
                    # reducing leg?  Check.
                    meta = data.new_metadata(entry.meta["filename"], entry.meta["lineno"])
                    meta[METADATA_FIELD] = "from_cost"
                    price_entry = data.Price(meta, entry.date,
                                             units.currency,
                                             amount.Amount(cost.number, cost.currency))
                else:
                    price_entry = None

                if price_entry is not None:
                    key = (price_entry.date,
                           price_entry.currency,
                           price_entry.amount.number,  # Ideally should be removed.
                           price_entry.amount.currency)
                    try:
                        new_price_entry_map[key]

                        ## Do not fail for now. We still have many valid use
                        ## cases of duplicate prices on the same date, for
                        ## example, stock splits, or trades on two dates with
                        ## two separate reported prices. We need to figure out a
                        ## more elegant solution for this in the long term.
                        ## Keeping both for now. We should ideally not use the
                        ## number in the de-dup key above.
                        #
                        # dup_entry = new_price_entry_map[key]
                        # if price_entry.amount.number == dup_entry.amount.number:
                        #     # Skip duplicates.
                        #     continue
                        # else:
                        #     errors.append(
                        #         ImplicitPriceError(
                        #             entry.meta,
                        #             "Duplicate prices for {} on {}".format(entry,
                        #                                                    dup_entry),
                        #             entry))
                    except KeyError:
                        new_price_entry_map[key] = price_entry
                        new_entries.append(price_entry)

    return new_entries, errors
</code></pre>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.plugins.leafonly" class="doc doc-heading">
        <code>beancount.plugins.leafonly</code>



<a href="#beancount.plugins.leafonly" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>A plugin that issues errors when amounts are posted to non-leaf accounts,
that is, accounts with child accounts.</p>
<p>This is an extra constraint that you may want to apply optionally. If you
install this plugin, it will issue errors for all accounts that have
postings to non-leaf accounts. Some users may want to disallow this and
enforce that only leaf accounts may have postings on them.</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-class">



<h3 id="beancount.plugins.leafonly.LeafOnlyError" class="doc doc-heading">
        <code>
beancount.plugins.leafonly.LeafOnlyError            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.plugins.leafonly.LeafOnlyError" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>LeafOnlyError(source, message, entry)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.leafonly.LeafOnlyError.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.leafonly.LeafOnlyError.__getnewargs__(self)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.leafonly.LeafOnlyError.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/leafonly.py</code></summary>
          <pre class="highlight"><code class="language-python">def __getnewargs__(self):
    'Return self as a plain tuple.  Used by copy and pickle.'
    return _tuple(self)
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.leafonly.LeafOnlyError.__new__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.leafonly.LeafOnlyError.__new__(_cls, source, message, entry)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.plugins.leafonly.LeafOnlyError.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of LeafOnlyError(source, message, entry)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.leafonly.LeafOnlyError.__replace__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.leafonly.LeafOnlyError.__replace__(/, self, **kwds)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.leafonly.LeafOnlyError.__replace__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a new LeafOnlyError object replacing specified fields with new values</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/leafonly.py</code></summary>
          <pre class="highlight"><code class="language-python">def _replace(self, /, **kwds):
    result = self._make(_map(kwds.pop, field_names, self))
    if kwds:
        raise TypeError(f'Got unexpected field names: {list(kwds)!r}')
    return result
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.leafonly.LeafOnlyError.__repr__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.leafonly.LeafOnlyError.__repr__(self)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.leafonly.LeafOnlyError.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/leafonly.py</code></summary>
          <pre class="highlight"><code class="language-python">def __repr__(self):
    'Return a nicely formatted representation string'
    return self.__class__.__name__ + repr_fmt % self
</code></pre>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.leafonly.validate_leaf_only" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.leafonly.validate_leaf_only(entries, unused_options_map)</code>


<a href="#beancount.plugins.leafonly.validate_leaf_only" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Check for non-leaf accounts that have postings on them.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives.</p></li>
            <li><p><strong>unused_options_map</strong> – An options map.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of new errors, if any were found.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/plugins/leafonly.py</code></summary>
          <pre class="highlight"><code class="language-python">def validate_leaf_only(entries, unused_options_map):
    """Check for non-leaf accounts that have postings on them.

    Args:
      entries: A list of directives.
      unused_options_map: An options map.
    Returns:
      A list of new errors, if any were found.
    """
    real_root = realization.realize(entries, compute_balance=False)

    default_meta = data.new_metadata('&lt;leafonly&gt;', 0)
    open_close_map = None # Lazily computed.
    errors = []
    for real_account in realization.iter_children(real_root):
        if len(real_account) &gt; 0 and real_account.txn_postings:

            if open_close_map is None:
                open_close_map = getters.get_account_open_close(entries)

            try:
                open_entry = open_close_map[real_account.account][0]
            except KeyError:
                open_entry = None
            errors.append(LeafOnlyError(
                open_entry.meta if open_entry else default_meta,
                "Non-leaf account '{}' has postings on it".format(real_account.account),
                open_entry))

    return entries, errors
</code></pre>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.plugins.noduplicates" class="doc doc-heading">
        <code>beancount.plugins.noduplicates</code>



<a href="#beancount.plugins.noduplicates" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>This plugin validates that there are no duplicate transactions.</p>



  <div class="doc doc-children">











  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.noduplicates.validate_no_duplicates" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.noduplicates.validate_no_duplicates(entries, unused_options_map)</code>


<a href="#beancount.plugins.noduplicates.validate_no_duplicates" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Check that the entries are unique, by computing hashes.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives.</p></li>
            <li><p><strong>unused_options_map</strong> – An options map.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of new errors, if any were found.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/plugins/noduplicates.py</code></summary>
          <pre class="highlight"><code class="language-python">def validate_no_duplicates(entries, unused_options_map):
    """Check that the entries are unique, by computing hashes.

    Args:
      entries: A list of directives.
      unused_options_map: An options map.
    Returns:
      A list of new errors, if any were found.
    """
    unused_hashes, errors = compare.hash_entries(entries, exclude_meta=True)
    return entries, errors
</code></pre>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.plugins.nounused" class="doc doc-heading">
        <code>beancount.plugins.nounused</code>



<a href="#beancount.plugins.nounused" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>This plugin validates that there are no unused accounts.</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-class">



<h3 id="beancount.plugins.nounused.UnusedAccountError" class="doc doc-heading">
        <code>
beancount.plugins.nounused.UnusedAccountError            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.plugins.nounused.UnusedAccountError" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>UnusedAccountError(source, message, entry)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.nounused.UnusedAccountError.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.nounused.UnusedAccountError.__getnewargs__(self)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.nounused.UnusedAccountError.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/nounused.py</code></summary>
          <pre class="highlight"><code class="language-python">def __getnewargs__(self):
    'Return self as a plain tuple.  Used by copy and pickle.'
    return _tuple(self)
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.nounused.UnusedAccountError.__new__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.nounused.UnusedAccountError.__new__(_cls, source, message, entry)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.plugins.nounused.UnusedAccountError.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of UnusedAccountError(source, message, entry)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.nounused.UnusedAccountError.__replace__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.nounused.UnusedAccountError.__replace__(/, self, **kwds)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.nounused.UnusedAccountError.__replace__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a new UnusedAccountError object replacing specified fields with new values</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/nounused.py</code></summary>
          <pre class="highlight"><code class="language-python">def _replace(self, /, **kwds):
    result = self._make(_map(kwds.pop, field_names, self))
    if kwds:
        raise TypeError(f'Got unexpected field names: {list(kwds)!r}')
    return result
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.nounused.UnusedAccountError.__repr__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.nounused.UnusedAccountError.__repr__(self)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.nounused.UnusedAccountError.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/nounused.py</code></summary>
          <pre class="highlight"><code class="language-python">def __repr__(self):
    'Return a nicely formatted representation string'
    return self.__class__.__name__ + repr_fmt % self
</code></pre>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.nounused.validate_unused_accounts" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.nounused.validate_unused_accounts(entries, unused_options_map)</code>


<a href="#beancount.plugins.nounused.validate_unused_accounts" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Check that all accounts declared open are actually used.</p>
<p>We check that all of the accounts that are open are at least referred to by
another directive. These are probably unused, so issue a warning (we like to
be pedantic). Note that an account that is open and then closed is
considered used--this is a valid use case that may occur in reality. If you
have a use case for an account to be open but never used, you can quiet that
warning by initializing the account with a balance asserts or a pad
directive, or even use a note will be sufficient.</p>
<p>(This is probably a good candidate for optional inclusion as a "pedantic"
plugin.)</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives.</p></li>
            <li><p><strong>unused_options_map</strong> – An options map.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of new errors, if any were found.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/plugins/nounused.py</code></summary>
          <pre class="highlight"><code class="language-python">def validate_unused_accounts(entries, unused_options_map):
    """Check that all accounts declared open are actually used.

    We check that all of the accounts that are open are at least referred to by
    another directive. These are probably unused, so issue a warning (we like to
    be pedantic). Note that an account that is open and then closed is
    considered used--this is a valid use case that may occur in reality. If you
    have a use case for an account to be open but never used, you can quiet that
    warning by initializing the account with a balance asserts or a pad
    directive, or even use a note will be sufficient.

    (This is probably a good candidate for optional inclusion as a "pedantic"
    plugin.)

    Args:
      entries: A list of directives.
      unused_options_map: An options map.
    Returns:
      A list of new errors, if any were found.
    """
    # Find all the accounts referenced by entries which are not Open, and the
    # open directives for error reporting below.
    open_map = {}
    referenced_accounts = set()
    for entry in entries:
        if isinstance(entry, data.Open):
            open_map[entry.account] = entry
            continue
        referenced_accounts.update(getters.get_entry_accounts(entry))

    # Create a list of suitable errors, with the location of the Open directives
    # corresponding to the unused accounts.
    errors = [UnusedAccountError(open_entry.meta,
                                 "Unused account '{}'".format(account),
                                 open_entry)
              for account, open_entry in open_map.items()
              if account not in referenced_accounts]
    return entries, errors
</code></pre>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.plugins.onecommodity" class="doc doc-heading">
        <code>beancount.plugins.onecommodity</code>



<a href="#beancount.plugins.onecommodity" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>A plugin that issues errors when more than one commodity is used in an account.</p>
<p>For investments or trading accounts, it can make it easier to filter the action
around a single stock by using the name of the stock as the leaf of the account
name.</p>
<p>Notes:</p>
<ul>
<li>
<p>The plugin will automatically skip accounts that have explicitly declared
  commodities in their Open directive.</p>
</li>
<li>
<p>You can also set the metadata "onecommodity: FALSE" on an account's Open
  directive to skip the checks for that account.</p>
</li>
<li>
<p>If provided, the configuration should be a regular expression restricting the
  set of accounts to check.</p>
</li>
</ul>



  <div class="doc doc-children">










  <div class="doc doc-object doc-class">



<h3 id="beancount.plugins.onecommodity.OneCommodityError" class="doc doc-heading">
        <code>
beancount.plugins.onecommodity.OneCommodityError            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.plugins.onecommodity.OneCommodityError" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>OneCommodityError(source, message, entry)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.onecommodity.OneCommodityError.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.onecommodity.OneCommodityError.__getnewargs__(self)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.onecommodity.OneCommodityError.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/onecommodity.py</code></summary>
          <pre class="highlight"><code class="language-python">def __getnewargs__(self):
    'Return self as a plain tuple.  Used by copy and pickle.'
    return _tuple(self)
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.onecommodity.OneCommodityError.__new__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.onecommodity.OneCommodityError.__new__(_cls, source, message, entry)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.plugins.onecommodity.OneCommodityError.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of OneCommodityError(source, message, entry)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.onecommodity.OneCommodityError.__replace__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.onecommodity.OneCommodityError.__replace__(/, self, **kwds)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.onecommodity.OneCommodityError.__replace__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a new OneCommodityError object replacing specified fields with new values</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/onecommodity.py</code></summary>
          <pre class="highlight"><code class="language-python">def _replace(self, /, **kwds):
    result = self._make(_map(kwds.pop, field_names, self))
    if kwds:
        raise TypeError(f'Got unexpected field names: {list(kwds)!r}')
    return result
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.onecommodity.OneCommodityError.__repr__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.onecommodity.OneCommodityError.__repr__(self)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.onecommodity.OneCommodityError.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/onecommodity.py</code></summary>
          <pre class="highlight"><code class="language-python">def __repr__(self):
    'Return a nicely formatted representation string'
    return self.__class__.__name__ + repr_fmt % self
</code></pre>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.onecommodity.validate_one_commodity" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.onecommodity.validate_one_commodity(entries, unused_options_map, config=None)</code>


<a href="#beancount.plugins.onecommodity.validate_one_commodity" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Check that each account has units in only a single commodity.</p>
<p>This is an extra constraint that you may want to apply optionally, despite
Beancount's ability to support inventories and aggregations with more than
one commodity. I believe this also matches GnuCash's model, where each
account has a single commodity attached to it.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives.</p></li>
            <li><p><strong>unused_options_map</strong> – An options map.</p></li>
            <li><p><strong>config</strong> – The plugin configuration string, a regular expression to match
against the subset of accounts to check.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of new errors, if any were found.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/plugins/onecommodity.py</code></summary>
          <pre class="highlight"><code class="language-python">def validate_one_commodity(entries, unused_options_map, config=None):
    """Check that each account has units in only a single commodity.

    This is an extra constraint that you may want to apply optionally, despite
    Beancount's ability to support inventories and aggregations with more than
    one commodity. I believe this also matches GnuCash's model, where each
    account has a single commodity attached to it.

    Args:
      entries: A list of directives.
      unused_options_map: An options map.
      config: The plugin configuration string, a regular expression to match
        against the subset of accounts to check.
    Returns:
      A list of new errors, if any were found.
    """
    accounts_re = re.compile(config) if config else None

    # Mappings of account name to lists of currencies for each units and cost.
    units_map = collections.defaultdict(set)
    cost_map = collections.defaultdict(set)

    # Mappings to use just for getting a relevant source.
    units_source_map = {}
    cost_source_map = {}

    # Gather the set of accounts to skip from the Open directives.
    skip_accounts = set()
    for entry in entries:
        if not isinstance(entry, data.Open):
            continue
        if (not entry.meta.get("onecommodity", True) or
            (accounts_re and not accounts_re.match(entry.account)) or
            (entry.currencies and len(entry.currencies) &gt; 1)):
            skip_accounts.add(entry.account)

    # Accumulate all the commodities used.
    for entry in entries:
        if isinstance(entry, data.Transaction):
            for posting in entry.postings:
                if posting.account in skip_accounts:
                    continue

                units = posting.units
                units_map[posting.account].add(units.currency)
                if len(units_map[posting.account]) &gt; 1:
                    units_source_map[posting.account] = entry

                cost = posting.cost
                if cost:
                    cost_map[posting.account].add(cost.currency)
                    if len(cost_map[posting.account]) &gt; 1:
                        cost_source_map[posting.account] = entry

        elif isinstance(entry, data.Balance):
            if entry.account in skip_accounts:
                continue

            units_map[entry.account].add(entry.amount.currency)
            if len(units_map[entry.account]) &gt; 1:
                units_source_map[entry.account] = entry

        elif isinstance(entry, data.Open):
            if entry.currencies and len(entry.currencies) &gt; 1:
                skip_accounts.add(entry.account)

    # Check units.
    errors = []
    for account, currencies in units_map.items():
        if account in skip_accounts:
            continue
        if len(currencies) &gt; 1:
            errors.append(OneCommodityError(
                units_source_map[account].meta,
                "More than one currency in account '{}': {}".format(
                    account, ','.join(currencies)),
                None))

    # Check costs.
    for account, currencies in cost_map.items():
        if account in skip_accounts:
            continue
        if len(currencies) &gt; 1:
            errors.append(OneCommodityError(
                cost_source_map[account].meta,
                "More than one cost currency in account '{}': {}".format(
                    account, ','.join(currencies)),
                None))

    return entries, errors
</code></pre>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.plugins.pedantic" class="doc doc-heading">
        <code>beancount.plugins.pedantic</code>



<a href="#beancount.plugins.pedantic" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>A plugin of plugins which triggers all the pedantic plugins.</p>



  <div class="doc doc-children">














  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.plugins.sellgains" class="doc doc-heading">
        <code>beancount.plugins.sellgains</code>



<a href="#beancount.plugins.sellgains" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>A plugin that cross-checks declared gains against prices on lot sales.</p>
<p>When you sell stock, the gains can be automatically implied by the corresponding
cash amounts. For example, in the following transaction the 2nd and 3rd postings
should match the value of the stock sold:</p>
<pre><code>1999-07-31 * "Sell"
  Assets:US:BRS:Company:ESPP          -81 ADSK {26.3125 USD}
  Assets:US:BRS:Company:Cash      2141.36 USD
  Expenses:Financial:Fees            0.08 USD
  Income:US:Company:ESPP:PnL      -10.125 USD
</code></pre>
<p>The cost basis is checked against: 2141.36 + 008 + -10.125. That is, the balance
checks computes</p>
<p>-81 x 26.3125  = -2131.3125  +
                    2141.36    +
                       0.08    +
                     -10.125</p>
<p>and checks that the residual is below a small tolerance.</p>
<p>But... usually the income leg isn't given to you in statements. Beancount can
automatically infer it using the balance, which is convenient, like this:</p>
<pre><code>1999-07-31 * "Sell"
  Assets:US:BRS:Company:ESPP          -81 ADSK {26.3125 USD}
  Assets:US:BRS:Company:Cash      2141.36 USD
  Expenses:Financial:Fees            0.08 USD
  Income:US:Company:ESPP:PnL
</code></pre>
<p>Additionally, most often you have the sales prices given to you on your
transaction confirmation statement, so you can enter this:</p>
<pre><code>1999-07-31 * "Sell"
  Assets:US:BRS:Company:ESPP          -81 ADSK {26.3125 USD} @ 26.4375 USD
  Assets:US:BRS:Company:Cash      2141.36 USD
  Expenses:Financial:Fees            0.08 USD
  Income:US:Company:ESPP:PnL
</code></pre>
<p>So in theory, if the price is given (26.4375 USD), we could verify that the
proceeds from the sale at the given price match non-Income postings. That is,
verify that</p>
<p>-81 x 26.4375  = -2141.4375  +
                    2141.36    +
                       0.08    +</p>
<p>is below a small tolerance value. So this plugin does this.</p>
<p>In general terms, it does the following: For transactions with postings that
have a cost and a price, it verifies that the sum of the positions on all
postings to non-income accounts is below tolerance.</p>
<p>This provides yet another level of verification and allows you to elide the
income amounts, knowing that the price is there to provide an extra level of
error-checking in case you enter a typo.</p>



  <div class="doc doc-children">











  <div class="doc doc-object doc-class">



<h3 id="beancount.plugins.sellgains.SellGainsError" class="doc doc-heading">
        <code>
beancount.plugins.sellgains.SellGainsError            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.plugins.sellgains.SellGainsError" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>SellGainsError(source, message, entry)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.sellgains.SellGainsError.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.sellgains.SellGainsError.__getnewargs__(self)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.sellgains.SellGainsError.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/sellgains.py</code></summary>
          <pre class="highlight"><code class="language-python">def __getnewargs__(self):
    'Return self as a plain tuple.  Used by copy and pickle.'
    return _tuple(self)
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.sellgains.SellGainsError.__new__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.sellgains.SellGainsError.__new__(_cls, source, message, entry)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.plugins.sellgains.SellGainsError.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of SellGainsError(source, message, entry)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.sellgains.SellGainsError.__replace__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.sellgains.SellGainsError.__replace__(/, self, **kwds)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.sellgains.SellGainsError.__replace__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a new SellGainsError object replacing specified fields with new values</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/sellgains.py</code></summary>
          <pre class="highlight"><code class="language-python">def _replace(self, /, **kwds):
    result = self._make(_map(kwds.pop, field_names, self))
    if kwds:
        raise TypeError(f'Got unexpected field names: {list(kwds)!r}')
    return result
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.sellgains.SellGainsError.__repr__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.sellgains.SellGainsError.__repr__(self)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.sellgains.SellGainsError.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/sellgains.py</code></summary>
          <pre class="highlight"><code class="language-python">def __repr__(self):
    'Return a nicely formatted representation string'
    return self.__class__.__name__ + repr_fmt % self
</code></pre>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.sellgains.validate_sell_gains" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.sellgains.validate_sell_gains(entries, options_map)</code>


<a href="#beancount.plugins.sellgains.validate_sell_gains" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Check the sum of asset account totals for lots sold with a price on them.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives.</p></li>
            <li><p><strong>unused_options_map</strong> – An options map.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of new errors, if any were found.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/plugins/sellgains.py</code></summary>
          <pre class="highlight"><code class="language-python">def validate_sell_gains(entries, options_map):
    """Check the sum of asset account totals for lots sold with a price on them.

    Args:
      entries: A list of directives.
      unused_options_map: An options map.
    Returns:
      A list of new errors, if any were found.
    """
    errors = []
    acc_types = options.get_account_types(options_map)
    proceed_types = set([acc_types.assets,
                         acc_types.liabilities,
                         acc_types.equity,
                         acc_types.expenses])

    for entry in entries:
        if not isinstance(entry, data.Transaction):
            continue

        # Find transactions whose lots at cost all have a price.
        postings_at_cost = [posting
                            for posting in entry.postings
                            if posting.cost is not None]
        if not postings_at_cost or not all(posting.price is not None
                                           for posting in postings_at_cost):
            continue

        # Accumulate the total expected proceeds and the sum of the asset and
        # expenses legs.
        total_price = inventory.Inventory()
        total_proceeds = inventory.Inventory()
        for posting in entry.postings:
            # If the posting is held at cost, add the priced value to the balance.
            if posting.cost is not None:
                assert posting.price is not None
                price = posting.price
                total_price.add_amount(amount.mul(price, -posting.units.number))
            else:
                # Otherwise, use the weight and ignore postings to Income accounts.
                atype = account_types.get_account_type(posting.account)
                if atype in proceed_types:
                    total_proceeds.add_amount(convert.get_weight(posting))

        # Compare inventories, currency by currency.
        dict_price = {pos.units.currency: pos.units.number
                      for pos in total_price}
        dict_proceeds = {pos.units.currency: pos.units.number
                         for pos in total_proceeds}

        tolerances = interpolate.infer_tolerances(entry.postings, options_map)
        invalid = False
        for currency, price_number in dict_price.items():
            # Accept a looser than usual tolerance because rounding occurs
            # differently. Also, it would be difficult for the user to satisfy
            # two sets of constraints manually.
            tolerance = tolerances.get(currency) * EXTRA_TOLERANCE_MULTIPLIER

            proceeds_number = dict_proceeds.pop(currency, ZERO)
            diff = abs(price_number - proceeds_number)
            if diff &gt; tolerance:
                invalid = True
                break

        if invalid or dict_proceeds:
            errors.append(
                SellGainsError(
                    entry.meta,
                    "Invalid price vs. proceeds/gains: {} vs. {}; difference: {}".format(
                        total_price, total_proceeds, (total_price + -total_proceeds)),
                    entry))

    return entries, errors
</code></pre>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.plugins.unique_prices" class="doc doc-heading">
        <code>beancount.plugins.unique_prices</code>



<a href="#beancount.plugins.unique_prices" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>This module adds validation that there is a single price defined per
date and base/quote currencies. If multiple conflicting price values are
declared, an error is generated. Note that multiple price entries with the
same number do not generate an error.</p>
<p>This is meant to be turned on if you want to use a very strict mode for
entering prices, and may not be realistic usage. For example, if you have
(1) a transaction with an implicitly generated price during the day (from
its cost) and (2) a separate explicit price directive that declares a
different price for the day's closing price, this would generate an error.
I'm not certain this will be useful in the long run, so placing it in a
plugin.</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-class">



<h3 id="beancount.plugins.unique_prices.UniquePricesError" class="doc doc-heading">
        <code>
beancount.plugins.unique_prices.UniquePricesError            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.plugins.unique_prices.UniquePricesError" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>UniquePricesError(source, message, entry)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.unique_prices.UniquePricesError.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.unique_prices.UniquePricesError.__getnewargs__(self)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.unique_prices.UniquePricesError.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/unique_prices.py</code></summary>
          <pre class="highlight"><code class="language-python">def __getnewargs__(self):
    'Return self as a plain tuple.  Used by copy and pickle.'
    return _tuple(self)
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.unique_prices.UniquePricesError.__new__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.unique_prices.UniquePricesError.__new__(_cls, source, message, entry)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.plugins.unique_prices.UniquePricesError.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of UniquePricesError(source, message, entry)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.unique_prices.UniquePricesError.__replace__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.unique_prices.UniquePricesError.__replace__(/, self, **kwds)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.unique_prices.UniquePricesError.__replace__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a new UniquePricesError object replacing specified fields with new values</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/unique_prices.py</code></summary>
          <pre class="highlight"><code class="language-python">def _replace(self, /, **kwds):
    result = self._make(_map(kwds.pop, field_names, self))
    if kwds:
        raise TypeError(f'Got unexpected field names: {list(kwds)!r}')
    return result
</code></pre>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.unique_prices.UniquePricesError.__repr__" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.unique_prices.UniquePricesError.__repr__(self)</code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.unique_prices.UniquePricesError.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/unique_prices.py</code></summary>
          <pre class="highlight"><code class="language-python">def __repr__(self):
    'Return a nicely formatted representation string'
    return self.__class__.__name__ + repr_fmt % self
</code></pre>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.unique_prices.validate_unique_prices" class="doc doc-heading">
<code class="highlight language-python">beancount.plugins.unique_prices.validate_unique_prices(entries, unused_options_map)</code>


<a href="#beancount.plugins.unique_prices.validate_unique_prices" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Check that there is only a single price per day for a particular base/quote.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives. We're interested only in the Transaction instances.</p></li>
            <li><p><strong>unused_options_map</strong> – A parser options dict.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>The list of input entries, and a list of new UniquePricesError instances generated.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/plugins/unique_prices.py</code></summary>
          <pre class="highlight"><code class="language-python">def validate_unique_prices(entries, unused_options_map):
    """Check that there is only a single price per day for a particular base/quote.

    Args:
      entries: A list of directives. We're interested only in the Transaction instances.
      unused_options_map: A parser options dict.
    Returns:
      The list of input entries, and a list of new UniquePricesError instances generated.
    """
    new_entries = []
    errors = []

    prices = collections.defaultdict(list)
    for entry in entries:
        if not isinstance(entry, data.Price):
            continue
        key = (entry.date, entry.currency, entry.amount.currency)
        prices[key].append(entry)

    errors = []
    for price_entries in prices.values():
        if len(price_entries) &gt; 1:
            number_map = {price_entry.amount.number: price_entry
                          for price_entry in price_entries}
            if len(number_map) &gt; 1:
                # Note: This should be a list of entries for better error
                # reporting. (Later.)
                error_entry = next(iter(number_map.values()))
                errors.append(
                    UniquePricesError(error_entry.meta,
                                      "Disagreeing price entries",
                                      price_entries))

    return entries, errors
</code></pre>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>




  </div>

    </div>

  </div>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="beancount.scripts.html" class="btn btn-neutral float-right" title="beancount.scripts">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="beancount.parser.html" class="btn btn-neutral" title="beancount.parser"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="beancount.parser.html" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="beancount.scripts.html" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
