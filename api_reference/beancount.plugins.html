<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="canonical" href="https://beancount.github.io/docs/api_reference/beancount.plugins.html">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>beancount.plugins - Beancount Documentation</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link href="../assets/_mkdocstrings.css" rel="stylesheet" />
  <link href="../css/custom.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "beancount.plugins";
    var mkdocs_page_input_path = "api_reference/beancount.plugins.md";
    var mkdocs_page_url = "/docs/api_reference/beancount.plugins.html";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="icon icon-home"> Beancount Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../index.html">Index</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Outline</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="#">Documentation for Users</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../command_line_accounting_in_context.html">Command Line Accounting in Context</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../the_double_entry_counting_method.html">The Double Entry Counting Method</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../installing_beancount.html">Installing Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../running_beancount_and_generating_reports.html">Running Beancount and Generating Reports</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../getting_started_with_beancount.html">Getting Started with Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_language_syntax.html">Beancount Language Syntax</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_options_reference.html">Beancount Options Reference</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../precision_tolerances.html">Precision Tolerances</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_query_language.html">Beancount Query Language</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_cheat_sheet.html">Beancount Cheat Sheet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../how_inventories_work.html">How Inventories Work</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../exporting_your_portfolio.html">Exporting Your Portfolio</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../tutorial_example.html">Tutorial & Example</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_history_and_credits.html">Beancount History and Credits</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../a_comparison_of_beancount_and_ledger_hledger.html">A Comparison of Beancount and Ledger Hledger</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../fetching_prices_in_beancount.html">Fetching Prices in Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../importing_external_data.html">Importing External Data</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Cookbooks & Examples</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../command_line_accounting_cookbook.html">Command Line Accounting Cookbook</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../trading_with_beancount.html">Trading with Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../stock_vesting_in_beancount.html">Stock Vesting in Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../sharing_expenses_with_beancount.html">Sharing Expenses with Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../how_we_share_expenses.html">How We Share Expenses</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../health_care_expenses.html">Health Care Expenses</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../calculating_portolio_returns.html">Calculating Portfolio Returns</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../tracking_medical_claims.html">Tracking Out-of-Network Medical Claims in Beancount</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Documentation for Developers</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_scripting_plugins.html">Beancount Scripting Plugins</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_design_doc.html">Beancount Design Doc</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ledgerhub_design_doc.html">Ledgerhub Design Doc</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../external_contributions.html">External Contributions</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Enhancement Proposals & Discussions</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../a_proposal_for_an_improvement_on_inventory_booking.html">A Proposal for an Improvement on Inventory Booking</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../settlement_dates_in_beancount.html">Settlement Dates in Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../balance_assertions_in_beancount.html">Balance Assertions in Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../fund_accounting_with_beancount.html">Fund Accounting with Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../rounding_precision_in_beancount.html">Rounding Precision in Beancount</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Beancount 3</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_v3.html">Goals & Design</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../installing_beancount_v3.html">Installing Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_v3_dependencies.html">Dependencies</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beangulp.html">Beangulp</a>
                </li>
    </ul>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">API reference</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="index.html">beancount</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.core.html">beancount.core</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.loader.html">beancount.loader</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.ops.html">beancount.ops</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.parser.html">beancount.parser</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="beancount.plugins.html">beancount.plugins</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins">beancount.plugins</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins.auto">auto</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins.auto_accounts">auto_accounts</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.auto_accounts.auto_insert_open">auto_insert_open()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins.check_average_cost">check_average_cost</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.check_average_cost.MatchBasisError">MatchBasisError</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.check_average_cost.MatchBasisError.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.check_average_cost.MatchBasisError.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.check_average_cost.MatchBasisError.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.check_average_cost.validate_average_cost">validate_average_cost()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins.check_closing">check_closing</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.check_closing.check_closing">check_closing()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins.check_commodity">check_commodity</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.check_commodity.CheckCommodityError">CheckCommodityError</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.check_commodity.CheckCommodityError.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.check_commodity.CheckCommodityError.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.check_commodity.CheckCommodityError.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.check_commodity.ConfigError">ConfigError</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.check_commodity.ConfigError.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.check_commodity.ConfigError.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.check_commodity.ConfigError.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.check_commodity.get_commodity_map_ex">get_commodity_map_ex()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.check_commodity.validate_commodity_directives">validate_commodity_directives()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins.check_drained">check_drained</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.check_drained.check_drained">check_drained()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins.close_tree">close_tree</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.close_tree.close_tree">close_tree()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins.coherent_cost">coherent_cost</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.coherent_cost.CoherentCostError">CoherentCostError</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.coherent_cost.CoherentCostError.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.coherent_cost.CoherentCostError.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.coherent_cost.CoherentCostError.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.coherent_cost.validate_coherent_cost">validate_coherent_cost()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins.commodity_attr">commodity_attr</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.commodity_attr.CommodityError">CommodityError</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.commodity_attr.CommodityError.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.commodity_attr.CommodityError.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.commodity_attr.CommodityError.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.commodity_attr.ConfigError">ConfigError</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.commodity_attr.ConfigError.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.commodity_attr.ConfigError.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.commodity_attr.ConfigError.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.commodity_attr.validate_commodity_attr">validate_commodity_attr()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins.currency_accounts">currency_accounts</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.currency_accounts.get_neutralizing_postings">get_neutralizing_postings()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.currency_accounts.group_postings_by_weight_currency">group_postings_by_weight_currency()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.currency_accounts.insert_currency_trading_postings">insert_currency_trading_postings()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins.implicit_prices">implicit_prices</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.implicit_prices.ImplicitPriceError">ImplicitPriceError</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.implicit_prices.ImplicitPriceError.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.implicit_prices.ImplicitPriceError.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.implicit_prices.ImplicitPriceError.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.implicit_prices.add_implicit_prices">add_implicit_prices()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins.leafonly">leafonly</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.leafonly.LeafOnlyError">LeafOnlyError</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.leafonly.LeafOnlyError.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.leafonly.LeafOnlyError.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.leafonly.LeafOnlyError.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.leafonly.validate_leaf_only">validate_leaf_only()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins.noduplicates">noduplicates</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.noduplicates.validate_no_duplicates">validate_no_duplicates()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins.nounused">nounused</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.nounused.UnusedAccountError">UnusedAccountError</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.nounused.UnusedAccountError.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.nounused.UnusedAccountError.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.nounused.UnusedAccountError.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.nounused.validate_unused_accounts">validate_unused_accounts()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins.onecommodity">onecommodity</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.onecommodity.OneCommodityError">OneCommodityError</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.onecommodity.OneCommodityError.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.onecommodity.OneCommodityError.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.onecommodity.OneCommodityError.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.onecommodity.validate_one_commodity">validate_one_commodity()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins.pedantic">pedantic</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins.sellgains">sellgains</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.sellgains.SellGainsError">SellGainsError</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.sellgains.SellGainsError.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.sellgains.SellGainsError.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.sellgains.SellGainsError.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.sellgains.validate_sell_gains">validate_sell_gains()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.plugins.unique_prices">unique_prices</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.unique_prices.UniquePricesError">UniquePricesError</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.unique_prices.UniquePricesError.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.unique_prices.UniquePricesError.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.plugins.unique_prices.UniquePricesError.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.plugins.unique_prices.validate_unique_prices">validate_unique_prices()</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.scripts.html">beancount.scripts</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.tools.html">beancount.tools</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.utils.html">beancount.utils</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Beancount Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
    
      
        
          <li>API reference &raquo;</li>
        
      
    
    <li>beancount.plugins</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h1 id="beancountplugins">beancount.plugins<a class="headerlink" href="#beancountplugins" title="Permanent link"></a></h1>


  <div class="doc doc-object doc-module">

<a id="beancount.plugins"></a>
    <div class="doc doc-contents first">

      <p>Example plugins for filtering transactions.</p>
<p>These are various examples of how to filter entries in various creative ways.</p>
<p>IMPORTANT: These are not meant to be complete features, rather just experiments
in problem-solving using Beancount, work-in-progress that can be selectively
installed via a --plugin option, or one-offs to answer questions on the
mailing-list.</p>



  <div class="doc doc-children">












  <div class="doc doc-object doc-module">



<h2 id="beancount.plugins.auto" class="doc doc-heading">
        <code>beancount.plugins.auto</code>



<a href="#beancount.plugins.auto" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>A plugin of plugins which triggers are all the automatic and lax plugins.</p>
<p>In a sense, this is the inverse of "pedantic." This is useful when doing some
types of quick and dirty tests. You can just import the "auto" plugin. Put that
in a macro.</p>
<p>Also see: the 'pedantic' plugin.</p>



  <div class="doc doc-children">














  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.plugins.auto_accounts" class="doc doc-heading">
        <code>beancount.plugins.auto_accounts</code>



<a href="#beancount.plugins.auto_accounts" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>This module automatically inserts Open directives for accounts not opened (at
the date of the first entry) and automatically removes open directives for
unused accounts. This can be used as a convenience for doing demos, or when
setting up your initial transactions, as an intermediate step.</p>



  <div class="doc doc-children">











  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.auto_accounts.auto_insert_open" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">auto_accounts</span><span class="o">.</span><span class="n">auto_insert_open</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">unused_options_map</span><span class="p">)</span></code>


<a href="#beancount.plugins.auto_accounts.auto_insert_open" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Insert Open directives for accounts not opened.</p>
<p>Open directives are inserted at the date of the first entry. Open directives
for unused accounts are removed.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives.</p></li>
            <li><p><strong>unused_options_map</strong> – A parser options dict.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of entries, possibly with more Open entries than before, and a
list of errors.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/plugins/auto_accounts.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">auto_insert_open</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">unused_options_map</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Insert Open directives for accounts not opened.</span>

<span class="sd">    Open directives are inserted at the date of the first entry. Open directives</span>
<span class="sd">    for unused accounts are removed.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      unused_options_map: A parser options dict.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of entries, possibly with more Open entries than before, and a</span>
<span class="sd">      list of errors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">opened_accounts</span> <span class="o">=</span> <span class="p">{</span><span class="n">entry</span><span class="o">.</span><span class="n">account</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Open</span><span class="p">)}</span>

    <span class="n">new_entries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">accounts_first</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">getters</span><span class="o">.</span><span class="n">get_accounts_use_map</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">date_first_used</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">accounts_first</span><span class="o">.</span><span class="n">items</span><span class="p">())):</span>
        <span class="k">if</span> <span class="n">account</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">opened_accounts</span><span class="p">:</span>
            <span class="n">meta</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">new_metadata</span><span class="p">(</span><span class="s2">&quot;&lt;auto_accounts&gt;&quot;</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
            <span class="n">new_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">date_first_used</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">new_entries</span><span class="p">:</span>
        <span class="n">new_entries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>
        <span class="n">new_entries</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">entry_sortkey</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_entries</span> <span class="o">=</span> <span class="n">entries</span>

    <span class="k">return</span> <span class="n">new_entries</span><span class="p">,</span> <span class="p">[]</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.plugins.check_average_cost" class="doc doc-heading">
        <code>beancount.plugins.check_average_cost</code>



<a href="#beancount.plugins.check_average_cost" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>A plugin that ensures cost basis is preserved in unbooked transactions.</p>
<p>This is intended to be used in accounts using the "NONE" booking method, to
manually ensure that the sum total of the cost basis of reducing legs matches
the average of what's in the account inventory. This is a partial first step
toward implementing the "AVERAGE" booking method. In other words, this plugins
provides assertions that will constrain you to approximate what the "AVERAGE"
booking method will do, manually, and not to leak too much cost basis through
unmatching bookings without checks. (Note the contrived context here: Ideally
the "NONE" booking method would simply not exist.)</p>



  <div class="doc doc-children">











  <div class="doc doc-object doc-class">



<h3 id="beancount.plugins.check_average_cost.MatchBasisError" class="doc doc-heading">
        <code>
beancount.plugins.check_average_cost.MatchBasisError            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.plugins.check_average_cost.MatchBasisError" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>MatchBasisError(source, message, entry)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.check_average_cost.MatchBasisError.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">check_average_cost</span><span class="o">.</span><span class="n">MatchBasisError</span><span class="o">.</span><span class="n">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.check_average_cost.MatchBasisError.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/check_average_cost.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return self as a plain tuple.  Used by copy and pickle.&#39;</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.check_average_cost.MatchBasisError.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">check_average_cost</span><span class="o">.</span><span class="n">MatchBasisError</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.plugins.check_average_cost.MatchBasisError.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of MatchBasisError(source, message, entry)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.check_average_cost.MatchBasisError.__repr__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">check_average_cost</span><span class="o">.</span><span class="n">MatchBasisError</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.check_average_cost.MatchBasisError.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/check_average_cost.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return a nicely formatted representation string&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.check_average_cost.validate_average_cost" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">check_average_cost</span><span class="o">.</span><span class="n">validate_average_cost</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="n">config_str</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#beancount.plugins.check_average_cost.validate_average_cost" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Check that reducing legs on unbooked postings are near the average cost basis.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives.</p></li>
            <li><p><strong>unused_options_map</strong> – An options map.</p></li>
            <li><p><strong>config_str</strong> – The configuration as a string version of a float.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of new errors, if any were found.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/plugins/check_average_cost.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">validate_average_cost</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="n">config_str</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check that reducing legs on unbooked postings are near the average cost basis.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      unused_options_map: An options map.</span>
<span class="sd">      config_str: The configuration as a string version of a float.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of new errors, if any were found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Initialize tolerance bounds.</span>
    <span class="k">if</span> <span class="n">config_str</span> <span class="ow">and</span> <span class="n">config_str</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="n">config_obj</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">config_str</span><span class="p">,</span> <span class="p">{},</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config_obj</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Invalid configuration for check_average_cost: &quot;</span> <span class="s2">&quot;must be a float&quot;</span>
            <span class="p">)</span>
        <span class="n">tolerance</span> <span class="o">=</span> <span class="n">config_obj</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tolerance</span> <span class="o">=</span> <span class="n">DEFAULT_TOLERANCE</span>
    <span class="n">min_tolerance</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">tolerance</span><span class="p">)</span>
    <span class="n">max_tolerance</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">tolerance</span><span class="p">)</span>

    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ocmap</span> <span class="o">=</span> <span class="n">getters</span><span class="o">.</span><span class="n">get_account_open_close</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>
    <span class="n">balances</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">Transaction</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">:</span>
                <span class="n">dopen</span> <span class="o">=</span> <span class="n">ocmap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="c1"># Only process accounts with a NONE booking value.</span>
                <span class="k">if</span> <span class="n">dopen</span> <span class="ow">and</span> <span class="n">dopen</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">dopen</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">booking</span> <span class="o">==</span> <span class="n">Booking</span><span class="o">.</span><span class="n">NONE</span><span class="p">:</span>
                    <span class="n">balance</span> <span class="o">=</span> <span class="n">balances</span><span class="p">[</span>
                        <span class="p">(</span>
                            <span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">,</span>
                            <span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span>
                            <span class="n">posting</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">currency</span> <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">]</span>
                    <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="o">&lt;</span> <span class="n">ZERO</span><span class="p">:</span>
                        <span class="n">average</span> <span class="o">=</span> <span class="n">balance</span><span class="o">.</span><span class="n">average</span><span class="p">()</span><span class="o">.</span><span class="n">get_only_position</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">average</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">number</span> <span class="o">=</span> <span class="n">average</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">number</span>
                            <span class="n">min_valid</span> <span class="o">=</span> <span class="n">number</span> <span class="o">*</span> <span class="n">min_tolerance</span>
                            <span class="n">max_valid</span> <span class="o">=</span> <span class="n">number</span> <span class="o">*</span> <span class="n">max_tolerance</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">min_valid</span> <span class="o">&lt;=</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">number</span> <span class="o">&lt;=</span> <span class="n">max_valid</span><span class="p">):</span>
                                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                    <span class="n">MatchBasisError</span><span class="p">(</span>
                                        <span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
                                        <span class="p">(</span>
                                            <span class="s2">&quot;Cost basis on reducing posting is too far from &quot;</span>
                                            <span class="s2">&quot;the average cost (</span><span class="si">{}</span><span class="s2"> vs. </span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                                <span class="n">posting</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">average</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">number</span>
                                            <span class="p">)</span>
                                        <span class="p">),</span>
                                        <span class="n">entry</span><span class="p">,</span>
                                    <span class="p">)</span>
                                <span class="p">)</span>
                    <span class="n">balance</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">posting</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.plugins.check_closing" class="doc doc-heading">
        <code>beancount.plugins.check_closing</code>



<a href="#beancount.plugins.check_closing" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>A plugin that automatically inserts a balance check on a tagged closing posting.</p>
<p>Some postings are known to the user to be "closing trades", which means that the
resulting position of the instrument just after the trade should be zero. For
instance, this is the case for most ordinary options trading, only one lot of a
particular instrument is held, and eventually expires or gets sold off in its
entirely. One would like to confirm that, and the way to do this in Beancount is
to insert a balance check.</p>
<p>This plugin allows you to do that more simply, by inserting metadata. For
example, this transaction:</p>
<pre><code>2018-02-16 * "SOLD -14 QQQ 100 16 FEB 18 160 CALL @5.31"
  Assets:US:Brokerage:Main:Options     -1400 QQQ180216C160 {2.70 USD} @ 5.31 USD
    closing: TRUE
  Expenses:Financial:Commissions       17.45 USD
  Expenses:Financial:Fees               0.42 USD
  Assets:US:Brokerage:Main:Cash      7416.13 USD
  Income:US:Brokerage:Main:PnL
</code></pre>
<p>Would expand into the following two directives:</p>
<pre><code>2018-02-16 * "SOLD -14 QQQ 100 16 FEB 18 160 CALL @5.31"
  Assets:US:Brokerage:Main:Options     -1400 QQQ180216C160 {2.70 USD} @ 5.31 USD
  Expenses:Financial:Commissions       17.45 USD
  Expenses:Financial:Fees               0.42 USD
  Assets:US:Brokerage:Main:Cash      7416.13 USD
  Income:US:Brokerage:Main:PnL

2018-02-17 balance Assets:US:Brokerage:Main:Options  0 QQQ180216C160
</code></pre>
<p>Insert the closing line when you know you're closing the position.</p>



  <div class="doc doc-children">











  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.check_closing.check_closing" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">check_closing</span><span class="o">.</span><span class="n">check_closing</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">)</span></code>


<a href="#beancount.plugins.check_closing.check_closing" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Expand 'closing' metadata to a zero balance check.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives.</p></li>
            <li><p><strong>unused_options_map</strong> – An options map.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of new errors, if any were found.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/plugins/check_closing.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">check_closing</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Expand &#39;closing&#39; metadata to a zero balance check.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      unused_options_map: An options map.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of new errors, if any were found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">new_entries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Transaction</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">posting</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">meta</span> <span class="ow">and</span> <span class="n">posting</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;closing&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                    <span class="c1"># Remove the metadata.</span>
                    <span class="n">meta</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="k">del</span> <span class="n">meta</span><span class="p">[</span><span class="s2">&quot;closing&quot;</span><span class="p">]</span>
                    <span class="n">posting</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">)</span>
                    <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">posting</span>

                    <span class="c1"># Insert a balance.</span>
                    <span class="n">date</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">balance</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Balance</span><span class="p">(</span>
                        <span class="n">data</span><span class="o">.</span><span class="n">new_metadata</span><span class="p">(</span><span class="s2">&quot;&lt;check_closing&gt;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                        <span class="n">date</span><span class="p">,</span>
                        <span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">,</span>
                        <span class="n">amount</span><span class="o">.</span><span class="n">Amount</span><span class="p">(</span><span class="n">ZERO</span><span class="p">,</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span><span class="p">),</span>
                        <span class="kc">None</span><span class="p">,</span>
                        <span class="kc">None</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">new_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">balance</span><span class="p">)</span>
        <span class="n">new_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_entries</span><span class="p">,</span> <span class="p">[]</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.plugins.check_commodity" class="doc doc-heading">
        <code>beancount.plugins.check_commodity</code>



<a href="#beancount.plugins.check_commodity" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>A plugin that verifies that all seen commodities have a Commodity directive.</p>
<p>This is useful if you're a bit pedantic and like to make sure that you're
declared attributes for each of the commodities you use. It's useful if you use
the portfolio export, for example.</p>
<p>You can provide a mapping of (account-regexp, currency-regexp) as options, to
specify which commodities to ignore from this plugin selectively. Use this
sparingly, as it is an out from the checks that this plugin provides. However,
in an active options trading account, a ton of products get inserted and the
number of commodity directives can be overwhelming and it's not productive to
declare each of the options contracts - names with an embedded strike and
expiration date, such as 'SPX_121622P3300' - individually.</p>
<p>Note that if a symbol has been ignored in at least one account, it will
therefore be further in all Price directives and Metadata values.</p>



  <div class="doc doc-children">













  <div class="doc doc-object doc-class">



<h3 id="beancount.plugins.check_commodity.CheckCommodityError" class="doc doc-heading">
        <code>
beancount.plugins.check_commodity.CheckCommodityError            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.plugins.check_commodity.CheckCommodityError" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>CheckCommodityError(source, message, entry)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.check_commodity.CheckCommodityError.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">check_commodity</span><span class="o">.</span><span class="n">CheckCommodityError</span><span class="o">.</span><span class="n">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.check_commodity.CheckCommodityError.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/check_commodity.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return self as a plain tuple.  Used by copy and pickle.&#39;</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.check_commodity.CheckCommodityError.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">check_commodity</span><span class="o">.</span><span class="n">CheckCommodityError</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.plugins.check_commodity.CheckCommodityError.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of CheckCommodityError(source, message, entry)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.check_commodity.CheckCommodityError.__repr__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">check_commodity</span><span class="o">.</span><span class="n">CheckCommodityError</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.check_commodity.CheckCommodityError.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/check_commodity.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return a nicely formatted representation string&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="beancount.plugins.check_commodity.ConfigError" class="doc doc-heading">
        <code>
beancount.plugins.check_commodity.ConfigError            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.plugins.check_commodity.ConfigError" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>ConfigError(source, message, entry)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.check_commodity.ConfigError.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">check_commodity</span><span class="o">.</span><span class="n">ConfigError</span><span class="o">.</span><span class="n">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.check_commodity.ConfigError.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/check_commodity.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return self as a plain tuple.  Used by copy and pickle.&#39;</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.check_commodity.ConfigError.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">check_commodity</span><span class="o">.</span><span class="n">ConfigError</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.plugins.check_commodity.ConfigError.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of ConfigError(source, message, entry)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.check_commodity.ConfigError.__repr__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">check_commodity</span><span class="o">.</span><span class="n">ConfigError</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.check_commodity.ConfigError.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/check_commodity.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return a nicely formatted representation string&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.check_commodity.get_commodity_map_ex" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">check_commodity</span><span class="o">.</span><span class="n">get_commodity_map_ex</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#beancount.plugins.check_commodity.get_commodity_map_ex" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Find and extract commodities in the stream of directives.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/check_commodity.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_commodity_map_ex</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find and extract commodities in the stream of directives.&quot;&quot;&quot;</span>

    <span class="c1"># Find commodity names in metadata.</span>
    <span class="c1">#</span>
    <span class="c1"># TODO(dnicolodi) Unfortunately detecting commodities in metadata</span>
    <span class="c1"># values may result in false positives: common used string are</span>
    <span class="c1"># matched by the regular expression. Revisit this when commodities</span>
    <span class="c1"># will be represented with their own type.</span>
    <span class="n">ignore</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s2">&quot;filename&quot;</span><span class="p">,</span> <span class="s2">&quot;lineno&quot;</span><span class="p">,</span> <span class="s2">&quot;__automatic__&quot;</span><span class="p">])</span>
    <span class="n">regexp</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">CURRENCY_RE</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">currencies_in_meta</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">meta</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignore</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">regexp</span><span class="o">.</span><span class="n">fullmatch</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                        <span class="k">yield</span> <span class="n">value</span>

    <span class="n">commodities_map</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">occurrences</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Commodity</span><span class="p">):</span>
            <span class="n">commodities_map</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">currency</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Open</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">currencies</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">currency</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">currencies</span><span class="p">:</span>
                    <span class="n">occurrences</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">entry</span><span class="o">.</span><span class="n">account</span><span class="p">,</span> <span class="n">currency</span><span class="p">))</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Transaction</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">:</span>
                <span class="c1"># Main currency.</span>
                <span class="n">units</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span>
                <span class="n">occurrences</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">,</span> <span class="n">units</span><span class="o">.</span><span class="n">currency</span><span class="p">))</span>

                <span class="c1"># Currency in cost.</span>
                <span class="n">cost</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span>
                <span class="k">if</span> <span class="n">cost</span><span class="p">:</span>
                    <span class="n">occurrences</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">,</span> <span class="n">cost</span><span class="o">.</span><span class="n">currency</span><span class="p">))</span>

                <span class="c1"># Currency in price.</span>
                <span class="n">price</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">price</span>
                <span class="k">if</span> <span class="n">price</span><span class="p">:</span>
                    <span class="n">occurrences</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">,</span> <span class="n">price</span><span class="o">.</span><span class="n">currency</span><span class="p">))</span>

                <span class="c1"># Currency in posting metadata.</span>
                <span class="k">if</span> <span class="n">metadata</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">currency</span> <span class="ow">in</span> <span class="n">currencies_in_meta</span><span class="p">(</span><span class="n">posting</span><span class="p">):</span>
                        <span class="n">occurrences</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">,</span> <span class="n">currency</span><span class="p">))</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Balance</span><span class="p">):</span>
            <span class="n">occurrences</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">entry</span><span class="o">.</span><span class="n">account</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">amount</span><span class="o">.</span><span class="n">currency</span><span class="p">))</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Price</span><span class="p">):</span>
            <span class="n">occurrences</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">PRICE_CONTEXT</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">currency</span><span class="p">))</span>
            <span class="n">occurrences</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">PRICE_CONTEXT</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">amount</span><span class="o">.</span><span class="n">currency</span><span class="p">))</span>

        <span class="c1"># Entry metadata.</span>
        <span class="k">if</span> <span class="n">metadata</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">currency</span> <span class="ow">in</span> <span class="n">currencies_in_meta</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
                <span class="n">occurrences</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">METADATA_CONTEXT</span><span class="p">,</span> <span class="n">currency</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">occurrences</span><span class="p">,</span> <span class="n">commodities_map</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.check_commodity.validate_commodity_directives" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">check_commodity</span><span class="o">.</span><span class="n">validate_commodity_directives</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="n">config_str</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#beancount.plugins.check_commodity.validate_commodity_directives" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Find all commodities used and ensure they have a corresponding Commodity directive.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives.</p></li>
            <li><p><strong>options_map</strong> – An options map.</p></li>
            <li><p><strong>config_str</strong> – The configuration as a string version of a float.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of new errors, if any were found.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/plugins/check_commodity.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">validate_commodity_directives</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="n">config_str</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find all commodities used and ensure they have a corresponding Commodity directive.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      options_map: An options map.</span>
<span class="sd">      config_str: The configuration as a string version of a float.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of new errors, if any were found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">config_str</span><span class="p">:</span>
        <span class="n">config_obj</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">config_str</span><span class="p">,</span> <span class="p">{},</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config_obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">ConfigError</span><span class="p">(</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">new_metadata</span><span class="p">(</span><span class="s2">&quot;&lt;commodity_attr&gt;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="s2">&quot;Invalid configuration for check_commodity plugin; skipping.&quot;</span><span class="p">,</span>
                    <span class="kc">None</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">config_obj</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Compile the regular expressions, producing an error if invalid.</span>
    <span class="n">ignore_map</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">config_obj</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">kv</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">kv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span><span class="o">.</span><span class="n">match</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">re</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
                <span class="n">meta</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">new_metadata</span><span class="p">(</span><span class="s2">&quot;&lt;check_commodity&gt;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">CheckCommodityError</span><span class="p">(</span>
                        <span class="n">meta</span><span class="p">,</span> <span class="s2">&quot;Invalid regexp: &#39;</span><span class="si">{}</span><span class="s2">&#39; for </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">key</span><span class="p">),</span> <span class="kc">None</span>
                    <span class="p">)</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">ignore_map</span><span class="p">[</span><span class="n">kv</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">kv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Get all the occurrences of commodities and a mapping of the directives.</span>
    <span class="c1">#</span>
    <span class="c1"># TODO(blais): Establish a distinction at the parser level for commodities</span>
    <span class="c1"># and strings, so that we can turn detection of them in metadata.</span>
    <span class="n">occurrences</span><span class="p">,</span> <span class="n">commodity_map</span> <span class="o">=</span> <span class="n">get_commodity_map_ex</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Process all currencies with context.</span>
    <span class="n">issued</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">ignored</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">anonymous</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">context</span><span class="p">,</span> <span class="n">currency</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">occurrences</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">context</span> <span class="ow">in</span> <span class="n">ANONYMOUS</span><span class="p">:</span>
            <span class="n">anonymous</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">context</span><span class="p">,</span> <span class="n">currency</span><span class="p">))</span>
            <span class="k">continue</span>
        <span class="n">commodity_entry</span> <span class="o">=</span> <span class="n">commodity_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Skip if the commodity was declared, or if an error for that commodity</span>
        <span class="c1"># has already been issued.</span>
        <span class="k">if</span> <span class="n">commodity_entry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">currency</span> <span class="ow">in</span> <span class="n">issued</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c1"># If any of the ignore patterns matches, ignore and record ignored.</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
            <span class="p">(</span><span class="n">context_re</span><span class="p">(</span><span class="n">context</span><span class="p">)</span> <span class="ow">and</span> <span class="n">currency_re</span><span class="p">(</span><span class="n">currency</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">context_re</span><span class="p">,</span> <span class="n">currency_re</span> <span class="ow">in</span> <span class="n">ignore_map</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">ignored</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">currency</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="c1"># Issue error.</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">new_metadata</span><span class="p">(</span><span class="s2">&quot;&lt;check_commodity&gt;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">CheckCommodityError</span><span class="p">(</span>
                <span class="n">meta</span><span class="p">,</span>
                <span class="s2">&quot;Missing Commodity directive for &#39;</span><span class="si">{}</span><span class="s2">&#39; in &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="n">context</span><span class="p">),</span>
                <span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Process it only once.</span>
        <span class="n">issued</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">currency</span><span class="p">)</span>

    <span class="c1"># Process all currencies out of context, automatically ignoring those which</span>
    <span class="c1"># have already been issued with account context..</span>
    <span class="k">for</span> <span class="n">context</span><span class="p">,</span> <span class="n">currency</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">anonymous</span><span class="p">):</span>
        <span class="n">commodity_entry</span> <span class="o">=</span> <span class="n">commodity_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Skip if (a) the commodity was declared, any of the ignore patterns</span>
        <span class="c1"># matches, or an error for that commodity has already been issued.</span>
        <span class="k">if</span> <span class="n">commodity_entry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">currency</span> <span class="ow">in</span> <span class="n">issued</span> <span class="ow">or</span> <span class="n">currency</span> <span class="ow">in</span> <span class="n">ignored</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c1"># Issue error.</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">new_metadata</span><span class="p">(</span><span class="s2">&quot;&lt;check_commodity&gt;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">CheckCommodityError</span><span class="p">(</span>
                <span class="n">meta</span><span class="p">,</span>
                <span class="s2">&quot;Missing Commodity directive for &#39;</span><span class="si">{}</span><span class="s2">&#39; in &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="n">context</span><span class="p">),</span>
                <span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.plugins.check_drained" class="doc doc-heading">
        <code>beancount.plugins.check_drained</code>



<a href="#beancount.plugins.check_drained" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Insert a balance check for zero before balance sheets accounts are closed.</p>
<p>For balance sheet accounts with a Close directive (Assets, Liabilities &amp;
Equity), insert Balance directives just after its closing date, for all the
commodities that have appeared in that account and that are declared as legal on
it as well. This performs the equivalent of the following transformation:</p>
<pre><code>2018-02-01 open  Assets:Project:Cash      USD,CAD
...
2020-02-01 close Assets:Project:Cash
</code></pre>
<p>!!! to
    2018-02-01 open  Assets:Project:Cash      USD,CAD
    ...</p>
<pre><code>2020-02-01 close Assets:Project:Cash
2020-02-02 balance Assets:Project:Cash    0 USD
2020-02-02 balance Assets:Project:Cash    0 CAD
</code></pre>



  <div class="doc doc-children">












  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.check_drained.check_drained" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">check_drained</span><span class="o">.</span><span class="n">check_drained</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">)</span></code>


<a href="#beancount.plugins.check_drained.check_drained" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Check that closed accounts are empty.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives.</p></li>
            <li><p><strong>unused_options_map</strong> – An options map.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of new errors, if any were found.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/plugins/check_drained.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">check_drained</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check that closed accounts are empty.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      unused_options_map: An options map.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of new errors, if any were found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">acctypes</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get_account_types</span><span class="p">(</span><span class="n">options_map</span><span class="p">)</span>
    <span class="n">is_covered</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span>
        <span class="n">account_types</span><span class="o">.</span><span class="n">is_balance_sheet_account</span><span class="p">,</span> <span class="n">account_types</span><span class="o">=</span><span class="n">acctypes</span>
    <span class="p">)</span>

    <span class="n">new_entries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">currencies</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>
    <span class="n">balances</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Transaction</span><span class="p">):</span>
            <span class="c1"># Accumulate all the currencies seen in each account over time.</span>
            <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">is_covered</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">):</span>
                    <span class="n">currencies</span><span class="p">[</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Open</span><span class="p">):</span>
            <span class="c1"># Accumulate all the currencies declared in the account opening.</span>
            <span class="k">if</span> <span class="n">is_covered</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">account</span><span class="p">)</span> <span class="ow">and</span> <span class="n">entry</span><span class="o">.</span><span class="n">currencies</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">currency</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">currencies</span><span class="p">:</span>
                    <span class="n">currencies</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">account</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">currency</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Balance</span><span class="p">):</span>
            <span class="c1"># Ignore balances where directives are present.</span>
            <span class="k">if</span> <span class="n">is_covered</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">account</span><span class="p">):</span>
                <span class="n">balances</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">account</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">entry</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">amount</span><span class="o">.</span><span class="n">currency</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Close</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">is_covered</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">account</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">currency</span> <span class="ow">in</span> <span class="n">currencies</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">account</span><span class="p">]:</span>
                    <span class="c1"># Skip balance insertion due to the presence of an explicit one.</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span> <span class="ow">in</span> <span class="n">balances</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">account</span><span class="p">]:</span>
                        <span class="k">continue</span>

                    <span class="c1"># Insert a balance directive.</span>
                    <span class="n">balance_entry</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Balance</span><span class="p">(</span>
                        <span class="c1"># Note: We use the close directive&#39;s meta so that</span>
                        <span class="c1"># balance errors direct the user to the corresponding</span>
                        <span class="c1"># close directive.</span>
                        <span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
                        <span class="n">entry</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">ONE_DAY</span><span class="p">,</span>
                        <span class="n">entry</span><span class="o">.</span><span class="n">account</span><span class="p">,</span>
                        <span class="n">amount</span><span class="o">.</span><span class="n">Amount</span><span class="p">(</span><span class="n">ZERO</span><span class="p">,</span> <span class="n">currency</span><span class="p">),</span>
                        <span class="kc">None</span><span class="p">,</span>
                        <span class="kc">None</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">new_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">balance_entry</span><span class="p">)</span>

        <span class="n">new_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">new_entries</span><span class="p">,</span> <span class="p">[]</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.plugins.close_tree" class="doc doc-heading">
        <code>beancount.plugins.close_tree</code>



<a href="#beancount.plugins.close_tree" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>This plugin inserts close directives for all of an account's descendants when
an account is closed. Unopened parent accounts can also be closed. Any
explicitly specified close is left untouched.</p>
<p>For example, given this::</p>
<pre><code>2017-11-10 open Assets:Brokerage:AAPL
2017-11-10 open Assets:Brokerage:ORNG
2018-11-10 close Assets:Brokerage  ; this does not necessarily need to be opened
</code></pre>
<p>the plugin turns it into::</p>
<pre><code>2017-11-10 open Assets:Brokerage:AAPL
2017-11-10 open Assets:Brokerage:ORNG
2018-11-10 close Assets:Brokerage:AAPL
2018-11-10 close Assets:Brokerage:ORNG
</code></pre>
<p>Invoke this plugin <em>after</em> any plugins that generate <code>open</code> directives for account trees
that you want to auto close. An example is the <code>auto_accounts</code> plugin that ships with
Beancount::</p>
<pre><code>plugin "beancount.plugins.auto_accounts"
plugin "beancount.plugins.close_tree"
</code></pre>



  <div class="doc doc-children">









  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.close_tree.close_tree" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">close_tree</span><span class="o">.</span><span class="n">close_tree</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">unused_options_map</span><span class="p">)</span></code>


<a href="#beancount.plugins.close_tree.close_tree" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Insert close entries for all subaccounts of a closed account.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives. We're interested only in the Open/Close instances.</p></li>
            <li><p><strong>unused_options_map</strong> – A parser options dict.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A tuple of entries and errors.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/plugins/close_tree.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">close_tree</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">unused_options_map</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Insert close entries for all subaccounts of a closed account.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives. We&#39;re interested only in the Open/Close instances.</span>
<span class="sd">      unused_options_map: A parser options dict.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A tuple of entries and errors.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">new_entries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">opens</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">account</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">Open</span><span class="p">))</span>
    <span class="n">closes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">account</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">Close</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">Close</span><span class="p">):</span>
            <span class="n">subaccounts</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">account</span>
                <span class="k">for</span> <span class="n">account</span> <span class="ow">in</span> <span class="n">opens</span>
                <span class="k">if</span> <span class="n">account</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">account</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">account</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">closes</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">subacc</span> <span class="ow">in</span> <span class="n">subaccounts</span><span class="p">:</span>
                <span class="n">meta</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">new_metadata</span><span class="p">(</span><span class="s2">&quot;&lt;beancount.plugins.close_tree&gt;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">close_entry</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Close</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">subacc</span><span class="p">)</span>
                <span class="n">new_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">close_entry</span><span class="p">)</span>
                <span class="c1"># So we don&#39;t attempt to re-close a grandchild that a child closed</span>
                <span class="n">closes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">subacc</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">account</span> <span class="ow">in</span> <span class="n">opens</span><span class="p">:</span>
                <span class="n">new_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">new_entries</span><span class="p">,</span> <span class="n">errors</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.plugins.coherent_cost" class="doc doc-heading">
        <code>beancount.plugins.coherent_cost</code>



<a href="#beancount.plugins.coherent_cost" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>This plugin validates that currencies held at cost aren't ever converted at
price and vice-versa. This is usually the case, and using it will prevent users
from making the mistake of selling a lot without specifying it via its cost
basis.</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-class">



<h3 id="beancount.plugins.coherent_cost.CoherentCostError" class="doc doc-heading">
        <code>
beancount.plugins.coherent_cost.CoherentCostError            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.plugins.coherent_cost.CoherentCostError" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>CoherentCostError(source, message, entry)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.coherent_cost.CoherentCostError.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">coherent_cost</span><span class="o">.</span><span class="n">CoherentCostError</span><span class="o">.</span><span class="n">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.coherent_cost.CoherentCostError.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/coherent_cost.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return self as a plain tuple.  Used by copy and pickle.&#39;</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.coherent_cost.CoherentCostError.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">coherent_cost</span><span class="o">.</span><span class="n">CoherentCostError</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.plugins.coherent_cost.CoherentCostError.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of CoherentCostError(source, message, entry)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.coherent_cost.CoherentCostError.__repr__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">coherent_cost</span><span class="o">.</span><span class="n">CoherentCostError</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.coherent_cost.CoherentCostError.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/coherent_cost.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return a nicely formatted representation string&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.coherent_cost.validate_coherent_cost" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">coherent_cost</span><span class="o">.</span><span class="n">validate_coherent_cost</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">unused_options_map</span><span class="p">)</span></code>


<a href="#beancount.plugins.coherent_cost.validate_coherent_cost" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Check that all currencies are either used at cost or not at all, but never both.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives.</p></li>
            <li><p><strong>unused_options_map</strong> – An options map.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of new errors, if any were found.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/plugins/coherent_cost.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">validate_coherent_cost</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">unused_options_map</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check that all currencies are either used at cost or not at all, but never both.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      unused_options_map: An options map.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of new errors, if any were found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">with_cost</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">without_cost</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">filter_txns</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">:</span>
            <span class="n">target_set</span> <span class="o">=</span> <span class="n">without_cost</span> <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">with_cost</span>
            <span class="n">currency</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span>
            <span class="n">target_set</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">currency</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">with_cost</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">without_cost</span><span class="p">):</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">CoherentCostError</span><span class="p">(</span>
                <span class="n">without_cost</span><span class="p">[</span><span class="n">currency</span><span class="p">]</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
                <span class="s2">&quot;Currency &#39;</span><span class="si">{}</span><span class="s2">&#39; is used both with and without cost&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">currency</span><span class="p">),</span>
                <span class="n">with_cost</span><span class="p">[</span><span class="n">currency</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># Note: We really ought to include both of the first transactions here.</span>

    <span class="k">return</span> <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.plugins.commodity_attr" class="doc doc-heading">
        <code>beancount.plugins.commodity_attr</code>



<a href="#beancount.plugins.commodity_attr" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>A plugin that asserts that all Commodity directives have a particular
attribute and that it is part of a set of enum values.</p>
<p>The configuration must be a mapping of attribute name to list of valid values,
like this:</p>
<pre><code>plugin "beancount.plugins.commodity_attr" "{
  'sector': ['Technology', 'Financials', 'Energy'],
  'name': None,
}"
</code></pre>
<p>The plugin issues an error if a Commodity directive is missing the attribute, or
if the attribute value is not in the valid set. If you'd like to just ensure the
attribute is set, set the list of valid values to None, as in the 'name'
attribute in the example above.</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-class">



<h3 id="beancount.plugins.commodity_attr.CommodityError" class="doc doc-heading">
        <code>
beancount.plugins.commodity_attr.CommodityError            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.plugins.commodity_attr.CommodityError" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>CommodityError(source, message, entry)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.commodity_attr.CommodityError.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">commodity_attr</span><span class="o">.</span><span class="n">CommodityError</span><span class="o">.</span><span class="n">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.commodity_attr.CommodityError.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/commodity_attr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return self as a plain tuple.  Used by copy and pickle.&#39;</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.commodity_attr.CommodityError.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">commodity_attr</span><span class="o">.</span><span class="n">CommodityError</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.plugins.commodity_attr.CommodityError.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of CommodityError(source, message, entry)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.commodity_attr.CommodityError.__repr__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">commodity_attr</span><span class="o">.</span><span class="n">CommodityError</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.commodity_attr.CommodityError.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/commodity_attr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return a nicely formatted representation string&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="beancount.plugins.commodity_attr.ConfigError" class="doc doc-heading">
        <code>
beancount.plugins.commodity_attr.ConfigError            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.plugins.commodity_attr.ConfigError" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>ConfigError(source, message, entry)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.commodity_attr.ConfigError.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">commodity_attr</span><span class="o">.</span><span class="n">ConfigError</span><span class="o">.</span><span class="n">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.commodity_attr.ConfigError.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/commodity_attr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return self as a plain tuple.  Used by copy and pickle.&#39;</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.commodity_attr.ConfigError.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">commodity_attr</span><span class="o">.</span><span class="n">ConfigError</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.plugins.commodity_attr.ConfigError.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of ConfigError(source, message, entry)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.commodity_attr.ConfigError.__repr__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">commodity_attr</span><span class="o">.</span><span class="n">ConfigError</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.commodity_attr.ConfigError.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/commodity_attr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return a nicely formatted representation string&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.commodity_attr.validate_commodity_attr" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">commodity_attr</span><span class="o">.</span><span class="n">validate_commodity_attr</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">unused_options_map</span><span class="p">,</span> <span class="n">config_str</span><span class="p">)</span></code>


<a href="#beancount.plugins.commodity_attr.validate_commodity_attr" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Check that all Commodity directives have a valid attribute.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives.</p></li>
            <li><p><strong>unused_options_map</strong> – An options map.</p></li>
            <li><p><strong>config_str</strong> – A configuration string.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of new errors, if any were found.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/plugins/commodity_attr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">validate_commodity_attr</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">unused_options_map</span><span class="p">,</span> <span class="n">config_str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check that all Commodity directives have a valid attribute.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      unused_options_map: An options map.</span>
<span class="sd">      config_str: A configuration string.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of new errors, if any were found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">config_obj</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">config_str</span><span class="p">,</span> <span class="p">{},</span> <span class="p">{})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config_obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">ConfigError</span><span class="p">(</span>
                <span class="n">data</span><span class="o">.</span><span class="n">new_metadata</span><span class="p">(</span><span class="s2">&quot;&lt;commodity_attr&gt;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;Invalid configuration for commodity_attr plugin; skipping.&quot;</span><span class="p">,</span>
                <span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span>

    <span class="n">validmap</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">attr</span><span class="p">:</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="k">if</span> <span class="n">values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">config_obj</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Commodity</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">validmap</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">CommodityError</span><span class="p">(</span>
                        <span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
                        <span class="s2">&quot;Missing attribute &#39;</span><span class="si">{}</span><span class="s2">&#39; for Commodity directive </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">attr</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">currency</span>
                        <span class="p">),</span>
                        <span class="kc">None</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">CommodityError</span><span class="p">(</span>
                        <span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
                        <span class="s2">&quot;Invalid value &#39;</span><span class="si">{}</span><span class="s2">&#39; for attribute </span><span class="si">{}</span><span class="s2">, Commodity&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                        <span class="o">+</span> <span class="s2">&quot; directive </span><span class="si">{}</span><span class="s2">; valid options: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">entry</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
                        <span class="p">),</span>
                        <span class="kc">None</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

    <span class="k">return</span> <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.plugins.currency_accounts" class="doc doc-heading">
        <code>beancount.plugins.currency_accounts</code>



<a href="#beancount.plugins.currency_accounts" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>An implementation of currency accounts.</p>
<p>This is an automatic implementation of the method described here:
https://www.mathstat.dal.ca/~selinger/accounting/tutorial.html</p>
<p>You enable it just like this:</p>
<pre><code>plugin "beancount.plugins.currency_accounts" "Equity:CurrencyAccounts"
</code></pre>
<p>Accounts will be automatically created under the given base account, with the
currency name appended to it, e.g.,</p>
<pre><code>Equity:CurrencyAccounts:CAD
Equity:CurrencyAccounts:USD
</code></pre>
<p>etc., where used. You can have a look at the account balances with a query like
this:</p>
<pre><code>bean-query $L "select account, sum(position), convert(sum(position), 'USD')
               where date &amp;gt;= 2018-01-01 and  account ~ 'CurrencyAccounts' "
</code></pre>
<p>The sum total of the converted amounts should be a number not too large:</p>
<pre><code>bean-query $L "select convert(sum(position), 'USD')
               where date &amp;gt;= 2018-01-01 and  account ~ 'CurrencyAccounts'"
</code></pre>
<p>WARNING: This is a prototype. Note the FIXMEs in the code below, which indicate
some potential problems.</p>



  <div class="doc doc-children">













  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.currency_accounts.get_neutralizing_postings" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">currency_accounts</span><span class="o">.</span><span class="n">get_neutralizing_postings</span><span class="p">(</span><span class="n">curmap</span><span class="p">,</span> <span class="n">base_account</span><span class="p">,</span> <span class="n">new_accounts</span><span class="p">)</span></code>


<a href="#beancount.plugins.currency_accounts.get_neutralizing_postings" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Process an entry.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>curmap</strong> – A dict of currency to a list of Postings of this transaction.</p></li>
            <li><p><strong>base_account</strong> – A string, the root account name to insert.</p></li>
            <li><p><strong>new_accounts</strong> – A set, a mutable accumulator of new account names.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A modified entry, with new postings inserted to rebalance currency trading
accounts.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/plugins/currency_accounts.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_neutralizing_postings</span><span class="p">(</span><span class="n">curmap</span><span class="p">,</span> <span class="n">base_account</span><span class="p">,</span> <span class="n">new_accounts</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process an entry.</span>

<span class="sd">    Args:</span>
<span class="sd">      curmap: A dict of currency to a list of Postings of this transaction.</span>
<span class="sd">      base_account: A string, the root account name to insert.</span>
<span class="sd">      new_accounts: A set, a mutable accumulator of new account names.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A modified entry, with new postings inserted to rebalance currency trading</span>
<span class="sd">      accounts.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">new_postings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">currency</span><span class="p">,</span> <span class="n">postings</span> <span class="ow">in</span> <span class="n">curmap</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1"># Compute the per-currency balance.</span>
        <span class="n">inv</span> <span class="o">=</span> <span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">postings</span><span class="p">:</span>
            <span class="n">inv</span><span class="o">.</span><span class="n">add_amount</span><span class="p">(</span><span class="n">convert</span><span class="o">.</span><span class="n">get_cost</span><span class="p">(</span><span class="n">posting</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">inv</span><span class="o">.</span><span class="n">is_empty</span><span class="p">():</span>
            <span class="n">new_postings</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">postings</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="c1"># Re-insert original postings and remove price conversions.</span>
        <span class="c1">#</span>
        <span class="c1"># Note: This may cause problems if the implicit_prices plugin is</span>
        <span class="c1"># configured to run after this one, or if you need the price annotations</span>
        <span class="c1"># for some scripting or serious work.</span>
        <span class="c1">#</span>
        <span class="c1"># FIXME: We need to handle these important cases (they&#39;re not frivolous,</span>
        <span class="c1"># this is a prototype), probably by inserting some exceptions with</span>
        <span class="c1"># collaborating code in the booking (e.g. insert some metadata that</span>
        <span class="c1"># disables price conversions on those postings).</span>
        <span class="c1">#</span>
        <span class="c1"># FIXME(2): Ouch! Some of the residual seeps through here, where there</span>
        <span class="c1"># are more than a single currency block. This needs fixing too. You can</span>
        <span class="c1"># easily mitigate some of this to some extent, by excluding transactions</span>
        <span class="c1"># which don&#39;t have any price conversion in them.</span>
        <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">postings</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pos</span><span class="o">.</span><span class="n">price</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">price</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">new_postings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>

        <span class="c1"># Insert the currency trading accounts postings.</span>
        <span class="n">amount</span> <span class="o">=</span> <span class="n">inv</span><span class="o">.</span><span class="n">get_only_position</span><span class="p">()</span><span class="o">.</span><span class="n">units</span>
        <span class="n">acc</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_account</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span>
        <span class="n">new_accounts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">acc</span><span class="p">)</span>
        <span class="n">new_postings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Posting</span><span class="p">(</span><span class="n">acc</span><span class="p">,</span> <span class="o">-</span><span class="n">amount</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">new_postings</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.currency_accounts.group_postings_by_weight_currency" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">currency_accounts</span><span class="o">.</span><span class="n">group_postings_by_weight_currency</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span></code>


<a href="#beancount.plugins.currency_accounts.group_postings_by_weight_currency" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Return where this entry might require adjustment.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/currency_accounts.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">group_postings_by_weight_currency</span><span class="p">(</span><span class="n">entry</span><span class="p">:</span> <span class="n">Transaction</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return where this entry might require adjustment.&quot;&quot;&quot;</span>
    <span class="n">curmap</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">has_price</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">:</span>
        <span class="n">currency</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span>
        <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span><span class="p">:</span>
            <span class="n">currency</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">currency</span>
            <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">price</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">posting</span><span class="o">.</span><span class="n">price</span><span class="o">.</span><span class="n">currency</span> <span class="o">==</span> <span class="n">currency</span>
            <span class="k">elif</span> <span class="n">posting</span><span class="o">.</span><span class="n">price</span><span class="p">:</span>
                <span class="n">has_price</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">currency</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">price</span><span class="o">.</span><span class="n">currency</span>
        <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">price</span><span class="p">:</span>
            <span class="n">has_price</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">curmap</span><span class="p">[</span><span class="n">currency</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">posting</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">curmap</span><span class="p">,</span> <span class="n">has_price</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.currency_accounts.insert_currency_trading_postings" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">currency_accounts</span><span class="o">.</span><span class="n">insert_currency_trading_postings</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span></code>


<a href="#beancount.plugins.currency_accounts.insert_currency_trading_postings" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Insert currency trading postings.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives.</p></li>
            <li><p><strong>unused_options_map</strong> – An options map.</p></li>
            <li><p><strong>config</strong> – The base account name for currency trading accounts.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of new errors, if any were found.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/plugins/currency_accounts.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">insert_currency_trading_postings</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Insert currency trading postings.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      unused_options_map: An options map.</span>
<span class="sd">      config: The base account name for currency trading accounts.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of new errors, if any were found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">base_account</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">account</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="n">base_account</span><span class="p">):</span>
        <span class="n">base_account</span> <span class="o">=</span> <span class="n">DEFAULT_BASE_ACCOUNT</span>

    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">new_entries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">new_accounts</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">Transaction</span><span class="p">):</span>
            <span class="n">curmap</span><span class="p">,</span> <span class="n">has_price</span> <span class="o">=</span> <span class="n">group_postings_by_weight_currency</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">has_price</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">curmap</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">new_postings</span> <span class="o">=</span> <span class="n">get_neutralizing_postings</span><span class="p">(</span><span class="n">curmap</span><span class="p">,</span> <span class="n">base_account</span><span class="p">,</span> <span class="n">new_accounts</span><span class="p">)</span>
                <span class="n">entry</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">postings</span><span class="o">=</span><span class="n">new_postings</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">META_PROCESSED</span><span class="p">:</span>
                    <span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="n">META_PROCESSED</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">new_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>

    <span class="n">earliest_date</span> <span class="o">=</span> <span class="n">entries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">date</span>
    <span class="n">open_entries</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">data</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span>
            <span class="n">data</span><span class="o">.</span><span class="n">new_metadata</span><span class="p">(</span><span class="s2">&quot;&lt;currency_accounts&gt;&quot;</span><span class="p">,</span> <span class="n">index</span><span class="p">),</span> <span class="n">earliest_date</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">acc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">new_accounts</span><span class="p">))</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="n">open_entries</span> <span class="o">+</span> <span class="n">new_entries</span><span class="p">,</span> <span class="n">errors</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.plugins.implicit_prices" class="doc doc-heading">
        <code>beancount.plugins.implicit_prices</code>



<a href="#beancount.plugins.implicit_prices" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>This plugin synthesizes Price directives for all Postings with a price or
directive or if it is an augmenting posting, has a cost directive.</p>



  <div class="doc doc-children">











  <div class="doc doc-object doc-class">



<h3 id="beancount.plugins.implicit_prices.ImplicitPriceError" class="doc doc-heading">
        <code>
beancount.plugins.implicit_prices.ImplicitPriceError            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.plugins.implicit_prices.ImplicitPriceError" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>ImplicitPriceError(source, message, entry)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.implicit_prices.ImplicitPriceError.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">implicit_prices</span><span class="o">.</span><span class="n">ImplicitPriceError</span><span class="o">.</span><span class="n">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.implicit_prices.ImplicitPriceError.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/implicit_prices.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return self as a plain tuple.  Used by copy and pickle.&#39;</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.implicit_prices.ImplicitPriceError.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">implicit_prices</span><span class="o">.</span><span class="n">ImplicitPriceError</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.plugins.implicit_prices.ImplicitPriceError.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of ImplicitPriceError(source, message, entry)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.implicit_prices.ImplicitPriceError.__repr__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">implicit_prices</span><span class="o">.</span><span class="n">ImplicitPriceError</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.implicit_prices.ImplicitPriceError.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/implicit_prices.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return a nicely formatted representation string&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.implicit_prices.add_implicit_prices" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">implicit_prices</span><span class="o">.</span><span class="n">add_implicit_prices</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">unused_options_map</span><span class="p">)</span></code>


<a href="#beancount.plugins.implicit_prices.add_implicit_prices" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Insert implicitly defined prices from Transactions.</p>
<p>Explicit price entries are simply maintained in the output list. Prices from
postings with costs or with prices from Transaction entries are synthesized
as new Price entries in the list of entries output.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives. We're interested only in the Transaction instances.</p></li>
            <li><p><strong>unused_options_map</strong> – A parser options dict.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of entries, possibly with more Price entries than before, and a
list of errors.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/plugins/implicit_prices.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">add_implicit_prices</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">unused_options_map</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Insert implicitly defined prices from Transactions.</span>

<span class="sd">    Explicit price entries are simply maintained in the output list. Prices from</span>
<span class="sd">    postings with costs or with prices from Transaction entries are synthesized</span>
<span class="sd">    as new Price entries in the list of entries output.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives. We&#39;re interested only in the Transaction instances.</span>
<span class="sd">      unused_options_map: A parser options dict.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of entries, possibly with more Price entries than before, and a</span>
<span class="sd">      list of errors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">new_entries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># A dict of (date, currency, cost-currency) to price entry.</span>
    <span class="n">new_price_entry_map</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">balances</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="c1"># Always replicate the existing entries.</span>
        <span class="n">new_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">Transaction</span><span class="p">):</span>
            <span class="c1"># Inspect all the postings in the transaction.</span>
            <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">:</span>
                <span class="n">units</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span>
                <span class="n">cost</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span>

                <span class="c1"># Check if the position is matching against an existing</span>
                <span class="c1"># position.</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">booking</span> <span class="o">=</span> <span class="n">balances</span><span class="p">[</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">]</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">posting</span><span class="p">)</span>

                <span class="c1"># Add prices when they&#39;re explicitly specified on a posting. An</span>
                <span class="c1"># explicitly specified price may occur in a conversion, e.g.</span>
                <span class="c1">#      Assets:Account    100 USD @ 1.10 CAD</span>
                <span class="c1"># or, if a cost is also specified, as the current price of the</span>
                <span class="c1"># underlying instrument, e.g.</span>
                <span class="c1">#      Assets:Account    100 HOOL {564.20} @ {581.97} USD</span>
                <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">price</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">meta</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">new_metadata</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">],</span> <span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;lineno&quot;</span><span class="p">])</span>
                    <span class="n">meta</span><span class="p">[</span><span class="n">METADATA_FIELD</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;from_price&quot;</span>
                    <span class="n">price_entry</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Price</span><span class="p">(</span>
                        <span class="n">meta</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">units</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="n">posting</span><span class="o">.</span><span class="n">price</span>
                    <span class="p">)</span>

                <span class="c1"># Add costs, when we&#39;re not matching against an existing</span>
                <span class="c1"># position. This happens when we&#39;re just specifying the cost,</span>
                <span class="c1"># e.g.</span>
                <span class="c1">#      Assets:Account    100 HOOL {564.20}</span>
                <span class="k">elif</span> <span class="n">cost</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">booking</span> <span class="o">!=</span> <span class="n">inventory</span><span class="o">.</span><span class="n">MatchResult</span><span class="o">.</span><span class="n">REDUCED</span><span class="p">:</span>
                    <span class="c1"># TODO(blais): What happens here if the account has no</span>
                    <span class="c1"># booking strategy? Do we end up inserting a price for the</span>
                    <span class="c1"># reducing leg?  Check.</span>
                    <span class="n">meta</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">new_metadata</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">],</span> <span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;lineno&quot;</span><span class="p">])</span>
                    <span class="n">meta</span><span class="p">[</span><span class="n">METADATA_FIELD</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;from_cost&quot;</span>
                    <span class="n">price_entry</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Price</span><span class="p">(</span>
                        <span class="n">meta</span><span class="p">,</span>
                        <span class="n">entry</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                        <span class="n">units</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span>
                        <span class="n">amount</span><span class="o">.</span><span class="n">Amount</span><span class="p">(</span><span class="n">cost</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">cost</span><span class="o">.</span><span class="n">currency</span><span class="p">),</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">price_entry</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="n">price_entry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">price_entry</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                        <span class="n">price_entry</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span>
                        <span class="n">price_entry</span><span class="o">.</span><span class="n">amount</span><span class="o">.</span><span class="n">number</span><span class="p">,</span>  <span class="c1"># Ideally should be removed.</span>
                        <span class="n">price_entry</span><span class="o">.</span><span class="n">amount</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">new_price_entry_map</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

                        <span class="c1">## Do not fail for now. We still have many valid use</span>
                        <span class="c1">## cases of duplicate prices on the same date, for</span>
                        <span class="c1">## example, stock splits, or trades on two dates with</span>
                        <span class="c1">## two separate reported prices. We need to figure out a</span>
                        <span class="c1">## more elegant solution for this in the long term.</span>
                        <span class="c1">## Keeping both for now. We should ideally not use the</span>
                        <span class="c1">## number in the de-dup key above.</span>
                        <span class="c1">#</span>
                        <span class="c1"># dup_entry = new_price_entry_map[key]</span>
                        <span class="c1"># if price_entry.amount.number == dup_entry.amount.number:</span>
                        <span class="c1">#     # Skip duplicates.</span>
                        <span class="c1">#     continue</span>
                        <span class="c1"># else:</span>
                        <span class="c1">#     errors.append(</span>
                        <span class="c1">#         ImplicitPriceError(</span>
                        <span class="c1">#             entry.meta,</span>
                        <span class="c1">#             &quot;Duplicate prices for {} on {}&quot;.format(entry,</span>
                        <span class="c1">#                                                    dup_entry),</span>
                        <span class="c1">#             entry))</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="n">new_price_entry_map</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">price_entry</span>
                        <span class="n">new_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">price_entry</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">new_entries</span><span class="p">,</span> <span class="n">errors</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.plugins.leafonly" class="doc doc-heading">
        <code>beancount.plugins.leafonly</code>



<a href="#beancount.plugins.leafonly" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>A plugin that issues errors when amounts are posted to non-leaf accounts,
that is, accounts with child accounts.</p>
<p>This is an extra constraint that you may want to apply optionally. If you
install this plugin, it will issue errors for all accounts that have
postings to non-leaf accounts. Some users may want to disallow this and
enforce that only leaf accounts may have postings on them.</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-class">



<h3 id="beancount.plugins.leafonly.LeafOnlyError" class="doc doc-heading">
        <code>
beancount.plugins.leafonly.LeafOnlyError            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.plugins.leafonly.LeafOnlyError" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>LeafOnlyError(source, message, entry)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.leafonly.LeafOnlyError.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">leafonly</span><span class="o">.</span><span class="n">LeafOnlyError</span><span class="o">.</span><span class="n">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.leafonly.LeafOnlyError.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/leafonly.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return self as a plain tuple.  Used by copy and pickle.&#39;</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.leafonly.LeafOnlyError.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">leafonly</span><span class="o">.</span><span class="n">LeafOnlyError</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.plugins.leafonly.LeafOnlyError.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of LeafOnlyError(source, message, entry)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.leafonly.LeafOnlyError.__repr__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">leafonly</span><span class="o">.</span><span class="n">LeafOnlyError</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.leafonly.LeafOnlyError.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/leafonly.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return a nicely formatted representation string&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.leafonly.validate_leaf_only" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">leafonly</span><span class="o">.</span><span class="n">validate_leaf_only</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">unused_options_map</span><span class="p">)</span></code>


<a href="#beancount.plugins.leafonly.validate_leaf_only" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Check for non-leaf accounts that have postings on them.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives.</p></li>
            <li><p><strong>unused_options_map</strong> – An options map.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of new errors, if any were found.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/plugins/leafonly.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">validate_leaf_only</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">unused_options_map</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check for non-leaf accounts that have postings on them.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      unused_options_map: An options map.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of new errors, if any were found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">real_root</span> <span class="o">=</span> <span class="n">realization</span><span class="o">.</span><span class="n">realize</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">compute_balance</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">default_meta</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">new_metadata</span><span class="p">(</span><span class="s2">&quot;&lt;leafonly&gt;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">open_close_map</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Lazily computed.</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">real_account</span> <span class="ow">in</span> <span class="n">realization</span><span class="o">.</span><span class="n">iter_children</span><span class="p">(</span><span class="n">real_root</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">real_account</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">real_account</span><span class="o">.</span><span class="n">txn_postings</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">open_close_map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">open_close_map</span> <span class="o">=</span> <span class="n">getters</span><span class="o">.</span><span class="n">get_account_open_close</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">open_entry</span> <span class="o">=</span> <span class="n">open_close_map</span><span class="p">[</span><span class="n">real_account</span><span class="o">.</span><span class="n">account</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">open_entry</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">LeafOnlyError</span><span class="p">(</span>
                    <span class="n">open_entry</span><span class="o">.</span><span class="n">meta</span> <span class="k">if</span> <span class="n">open_entry</span> <span class="k">else</span> <span class="n">default_meta</span><span class="p">,</span>
                    <span class="s2">&quot;Non-leaf account &#39;</span><span class="si">{}</span><span class="s2">&#39; has postings on it&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">real_account</span><span class="o">.</span><span class="n">account</span><span class="p">),</span>
                    <span class="n">open_entry</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.plugins.noduplicates" class="doc doc-heading">
        <code>beancount.plugins.noduplicates</code>



<a href="#beancount.plugins.noduplicates" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>This plugin validates that there are no duplicate transactions.</p>



  <div class="doc doc-children">











  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.noduplicates.validate_no_duplicates" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">noduplicates</span><span class="o">.</span><span class="n">validate_no_duplicates</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">unused_options_map</span><span class="p">)</span></code>


<a href="#beancount.plugins.noduplicates.validate_no_duplicates" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Check that the entries are unique, by computing hashes.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives.</p></li>
            <li><p><strong>unused_options_map</strong> – An options map.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of new errors, if any were found.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/plugins/noduplicates.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">validate_no_duplicates</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">unused_options_map</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check that the entries are unique, by computing hashes.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      unused_options_map: An options map.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of new errors, if any were found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">unused_hashes</span><span class="p">,</span> <span class="n">errors</span> <span class="o">=</span> <span class="n">compare</span><span class="o">.</span><span class="n">hash_entries</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">exclude_meta</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.plugins.nounused" class="doc doc-heading">
        <code>beancount.plugins.nounused</code>



<a href="#beancount.plugins.nounused" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>This plugin validates that there are no unused accounts.</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-class">



<h3 id="beancount.plugins.nounused.UnusedAccountError" class="doc doc-heading">
        <code>
beancount.plugins.nounused.UnusedAccountError            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.plugins.nounused.UnusedAccountError" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>UnusedAccountError(source, message, entry)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.nounused.UnusedAccountError.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">nounused</span><span class="o">.</span><span class="n">UnusedAccountError</span><span class="o">.</span><span class="n">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.nounused.UnusedAccountError.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/nounused.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return self as a plain tuple.  Used by copy and pickle.&#39;</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.nounused.UnusedAccountError.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">nounused</span><span class="o">.</span><span class="n">UnusedAccountError</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.plugins.nounused.UnusedAccountError.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of UnusedAccountError(source, message, entry)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.nounused.UnusedAccountError.__repr__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">nounused</span><span class="o">.</span><span class="n">UnusedAccountError</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.nounused.UnusedAccountError.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/nounused.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return a nicely formatted representation string&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.nounused.validate_unused_accounts" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">nounused</span><span class="o">.</span><span class="n">validate_unused_accounts</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">unused_options_map</span><span class="p">)</span></code>


<a href="#beancount.plugins.nounused.validate_unused_accounts" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Check that all accounts declared open are actually used.</p>
<p>We check that all of the accounts that are open are at least referred to by
another directive. These are probably unused, so issue a warning (we like to
be pedantic). Note that an account that is open and then closed is
considered used--this is a valid use case that may occur in reality. If you
have a use case for an account to be open but never used, you can quiet that
warning by initializing the account with a balance asserts or a pad
directive, or even use a note will be sufficient.</p>
<p>(This is probably a good candidate for optional inclusion as a "pedantic"
plugin.)</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives.</p></li>
            <li><p><strong>unused_options_map</strong> – An options map.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of new errors, if any were found.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/plugins/nounused.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">validate_unused_accounts</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">unused_options_map</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check that all accounts declared open are actually used.</span>

<span class="sd">    We check that all of the accounts that are open are at least referred to by</span>
<span class="sd">    another directive. These are probably unused, so issue a warning (we like to</span>
<span class="sd">    be pedantic). Note that an account that is open and then closed is</span>
<span class="sd">    considered used--this is a valid use case that may occur in reality. If you</span>
<span class="sd">    have a use case for an account to be open but never used, you can quiet that</span>
<span class="sd">    warning by initializing the account with a balance asserts or a pad</span>
<span class="sd">    directive, or even use a note will be sufficient.</span>

<span class="sd">    (This is probably a good candidate for optional inclusion as a &quot;pedantic&quot;</span>
<span class="sd">    plugin.)</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      unused_options_map: An options map.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of new errors, if any were found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find all the accounts referenced by entries which are not Open, and the</span>
    <span class="c1"># open directives for error reporting below.</span>
    <span class="n">open_map</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">referenced_accounts</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Open</span><span class="p">):</span>
            <span class="n">open_map</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">account</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span>
            <span class="k">continue</span>
        <span class="n">referenced_accounts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">getters</span><span class="o">.</span><span class="n">get_entry_accounts</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span>

    <span class="c1"># Create a list of suitable errors, with the location of the Open directives</span>
    <span class="c1"># corresponding to the unused accounts.</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">UnusedAccountError</span><span class="p">(</span>
            <span class="n">open_entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="s2">&quot;Unused account &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">account</span><span class="p">),</span> <span class="n">open_entry</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">account</span><span class="p">,</span> <span class="n">open_entry</span> <span class="ow">in</span> <span class="n">open_map</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">account</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">referenced_accounts</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.plugins.onecommodity" class="doc doc-heading">
        <code>beancount.plugins.onecommodity</code>



<a href="#beancount.plugins.onecommodity" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>A plugin that issues errors when more than one commodity is used in an account.</p>
<p>For investments or trading accounts, it can make it easier to filter the action
around a single stock by using the name of the stock as the leaf of the account
name.</p>
<p>Notes:</p>
<ul>
<li>
<p>The plugin will automatically skip accounts that have explicitly declared
  commodities in their Open directive.</p>
</li>
<li>
<p>You can also set the metadata "onecommodity: FALSE" on an account's Open
  directive to skip the checks for that account.</p>
</li>
<li>
<p>If provided, the configuration should be a regular expression restricting the
  set of accounts to check.</p>
</li>
</ul>



  <div class="doc doc-children">










  <div class="doc doc-object doc-class">



<h3 id="beancount.plugins.onecommodity.OneCommodityError" class="doc doc-heading">
        <code>
beancount.plugins.onecommodity.OneCommodityError            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.plugins.onecommodity.OneCommodityError" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>OneCommodityError(source, message, entry)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.onecommodity.OneCommodityError.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">onecommodity</span><span class="o">.</span><span class="n">OneCommodityError</span><span class="o">.</span><span class="n">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.onecommodity.OneCommodityError.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/onecommodity.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return self as a plain tuple.  Used by copy and pickle.&#39;</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.onecommodity.OneCommodityError.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">onecommodity</span><span class="o">.</span><span class="n">OneCommodityError</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.plugins.onecommodity.OneCommodityError.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of OneCommodityError(source, message, entry)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.onecommodity.OneCommodityError.__repr__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">onecommodity</span><span class="o">.</span><span class="n">OneCommodityError</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.onecommodity.OneCommodityError.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/onecommodity.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return a nicely formatted representation string&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.onecommodity.validate_one_commodity" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">onecommodity</span><span class="o">.</span><span class="n">validate_one_commodity</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">unused_options_map</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#beancount.plugins.onecommodity.validate_one_commodity" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Check that each account has units in only a single commodity.</p>
<p>This is an extra constraint that you may want to apply optionally, despite
Beancount's ability to support inventories and aggregations with more than
one commodity. I believe this also matches GnuCash's model, where each
account has a single commodity attached to it.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives.</p></li>
            <li><p><strong>unused_options_map</strong> – An options map.</p></li>
            <li><p><strong>config</strong> – The plugin configuration string, a regular expression to match
against the subset of accounts to check.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of new errors, if any were found.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/plugins/onecommodity.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">validate_one_commodity</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">unused_options_map</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check that each account has units in only a single commodity.</span>

<span class="sd">    This is an extra constraint that you may want to apply optionally, despite</span>
<span class="sd">    Beancount&#39;s ability to support inventories and aggregations with more than</span>
<span class="sd">    one commodity. I believe this also matches GnuCash&#39;s model, where each</span>
<span class="sd">    account has a single commodity attached to it.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      unused_options_map: An options map.</span>
<span class="sd">      config: The plugin configuration string, a regular expression to match</span>
<span class="sd">        against the subset of accounts to check.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of new errors, if any were found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">accounts_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">config</span><span class="p">)</span> <span class="k">if</span> <span class="n">config</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="c1"># Mappings of account name to lists of currencies for each units and cost.</span>
    <span class="n">units_map</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>
    <span class="n">cost_map</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>

    <span class="c1"># Mappings to use just for getting a relevant source.</span>
    <span class="n">units_source_map</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">cost_source_map</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Gather the set of accounts to skip from the Open directives.</span>
    <span class="n">skip_accounts</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Open</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;onecommodity&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="ow">or</span> <span class="p">(</span><span class="n">accounts_re</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">accounts_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">account</span><span class="p">))</span>
            <span class="ow">or</span> <span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">currencies</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">currencies</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">skip_accounts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">account</span><span class="p">)</span>

    <span class="c1"># Accumulate all the commodities used.</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Transaction</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">account</span> <span class="ow">in</span> <span class="n">skip_accounts</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="n">units</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span>
                <span class="n">units_map</span><span class="p">[</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">units_map</span><span class="p">[</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">units_source_map</span><span class="p">[</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span>

                <span class="n">cost</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span>
                <span class="k">if</span> <span class="n">cost</span><span class="p">:</span>
                    <span class="n">cost_map</span><span class="p">[</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cost</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cost_map</span><span class="p">[</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">cost_source_map</span><span class="p">[</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Balance</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">account</span> <span class="ow">in</span> <span class="n">skip_accounts</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">units_map</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">account</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">amount</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">units_map</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">account</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">units_source_map</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">account</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Open</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">currencies</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">currencies</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">skip_accounts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">account</span><span class="p">)</span>

    <span class="c1"># Check units.</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">account</span><span class="p">,</span> <span class="n">currencies</span> <span class="ow">in</span> <span class="n">units_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">account</span> <span class="ow">in</span> <span class="n">skip_accounts</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">currencies</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">OneCommodityError</span><span class="p">(</span>
                    <span class="n">units_source_map</span><span class="p">[</span><span class="n">account</span><span class="p">]</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
                    <span class="s2">&quot;More than one currency in account &#39;</span><span class="si">{}</span><span class="s2">&#39;: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">account</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">currencies</span><span class="p">)</span>
                    <span class="p">),</span>
                    <span class="kc">None</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="c1"># Check costs.</span>
    <span class="k">for</span> <span class="n">account</span><span class="p">,</span> <span class="n">currencies</span> <span class="ow">in</span> <span class="n">cost_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">account</span> <span class="ow">in</span> <span class="n">skip_accounts</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">currencies</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">OneCommodityError</span><span class="p">(</span>
                    <span class="n">cost_source_map</span><span class="p">[</span><span class="n">account</span><span class="p">]</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
                    <span class="s2">&quot;More than one cost currency in account &#39;</span><span class="si">{}</span><span class="s2">&#39;: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">account</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">currencies</span><span class="p">)</span>
                    <span class="p">),</span>
                    <span class="kc">None</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.plugins.pedantic" class="doc doc-heading">
        <code>beancount.plugins.pedantic</code>



<a href="#beancount.plugins.pedantic" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>A plugin of plugins which triggers all the pedantic plugins.</p>



  <div class="doc doc-children">














  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.plugins.sellgains" class="doc doc-heading">
        <code>beancount.plugins.sellgains</code>



<a href="#beancount.plugins.sellgains" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>A plugin that cross-checks declared gains against prices on lot sales.</p>
<p>When you sell stock, the gains can be automatically implied by the corresponding
cash amounts. For example, in the following transaction the 2nd and 3rd postings
should match the value of the stock sold:</p>
<pre><code>1999-07-31 * "Sell"
  Assets:US:BRS:Company:ESPP          -81 ADSK {26.3125 USD}
  Assets:US:BRS:Company:Cash      2141.36 USD
  Expenses:Financial:Fees            0.08 USD
  Income:US:Company:ESPP:PnL      -10.125 USD
</code></pre>
<p>The cost basis is checked against: 2141.36 + 008 + -10.125. That is, the balance
checks computes</p>
<p>-81 x 26.3125  = -2131.3125  +
                    2141.36    +
                       0.08    +
                     -10.125</p>
<p>and checks that the residual is below a small tolerance.</p>
<p>But... usually the income leg isn't given to you in statements. Beancount can
automatically infer it using the balance, which is convenient, like this:</p>
<pre><code>1999-07-31 * "Sell"
  Assets:US:BRS:Company:ESPP          -81 ADSK {26.3125 USD}
  Assets:US:BRS:Company:Cash      2141.36 USD
  Expenses:Financial:Fees            0.08 USD
  Income:US:Company:ESPP:PnL
</code></pre>
<p>Additionally, most often you have the sales prices given to you on your
transaction confirmation statement, so you can enter this:</p>
<pre><code>1999-07-31 * "Sell"
  Assets:US:BRS:Company:ESPP          -81 ADSK {26.3125 USD} @ 26.4375 USD
  Assets:US:BRS:Company:Cash      2141.36 USD
  Expenses:Financial:Fees            0.08 USD
  Income:US:Company:ESPP:PnL
</code></pre>
<p>So in theory, if the price is given (26.4375 USD), we could verify that the
proceeds from the sale at the given price match non-Income postings. That is,
verify that</p>
<p>-81 x 26.4375  = -2141.4375  +
                    2141.36    +
                       0.08    +</p>
<p>is below a small tolerance value. So this plugin does this.</p>
<p>In general terms, it does the following: For transactions with postings that
have a cost and a price, it verifies that the sum of the positions on all
postings to non-income accounts is below tolerance.</p>
<p>This provides yet another level of verification and allows you to elide the
income amounts, knowing that the price is there to provide an extra level of
error-checking in case you enter a typo.</p>



  <div class="doc doc-children">











  <div class="doc doc-object doc-class">



<h3 id="beancount.plugins.sellgains.SellGainsError" class="doc doc-heading">
        <code>
beancount.plugins.sellgains.SellGainsError            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.plugins.sellgains.SellGainsError" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>SellGainsError(source, message, entry)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.sellgains.SellGainsError.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">sellgains</span><span class="o">.</span><span class="n">SellGainsError</span><span class="o">.</span><span class="n">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.sellgains.SellGainsError.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/sellgains.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return self as a plain tuple.  Used by copy and pickle.&#39;</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.sellgains.SellGainsError.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">sellgains</span><span class="o">.</span><span class="n">SellGainsError</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.plugins.sellgains.SellGainsError.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of SellGainsError(source, message, entry)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.sellgains.SellGainsError.__repr__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">sellgains</span><span class="o">.</span><span class="n">SellGainsError</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.sellgains.SellGainsError.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/sellgains.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return a nicely formatted representation string&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.sellgains.validate_sell_gains" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">sellgains</span><span class="o">.</span><span class="n">validate_sell_gains</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">)</span></code>


<a href="#beancount.plugins.sellgains.validate_sell_gains" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Check the sum of asset account totals for lots sold with a price on them.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives.</p></li>
            <li><p><strong>unused_options_map</strong> – An options map.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of new errors, if any were found.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/plugins/sellgains.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">validate_sell_gains</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check the sum of asset account totals for lots sold with a price on them.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      unused_options_map: An options map.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of new errors, if any were found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">acc_types</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get_account_types</span><span class="p">(</span><span class="n">options_map</span><span class="p">)</span>
    <span class="n">proceed_types</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
        <span class="p">[</span><span class="n">acc_types</span><span class="o">.</span><span class="n">assets</span><span class="p">,</span> <span class="n">acc_types</span><span class="o">.</span><span class="n">liabilities</span><span class="p">,</span> <span class="n">acc_types</span><span class="o">.</span><span class="n">equity</span><span class="p">,</span> <span class="n">acc_types</span><span class="o">.</span><span class="n">expenses</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Transaction</span><span class="p">):</span>
            <span class="k">continue</span>

        <span class="c1"># Find transactions whose lots at cost all have a price.</span>
        <span class="n">postings_at_cost</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">posting</span> <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span> <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">postings_at_cost</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span>
            <span class="n">posting</span><span class="o">.</span><span class="n">price</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">postings_at_cost</span>
        <span class="p">):</span>
            <span class="k">continue</span>

        <span class="c1"># Accumulate the total expected proceeds and the sum of the asset and</span>
        <span class="c1"># expenses legs.</span>
        <span class="n">total_price</span> <span class="o">=</span> <span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">()</span>
        <span class="n">total_proceeds</span> <span class="o">=</span> <span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">:</span>
            <span class="c1"># If the posting is held at cost, add the priced value to the balance.</span>
            <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">posting</span><span class="o">.</span><span class="n">price</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="n">price</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">price</span>
                <span class="n">total_price</span><span class="o">.</span><span class="n">add_amount</span><span class="p">(</span><span class="n">amount</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">price</span><span class="p">,</span> <span class="o">-</span><span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Otherwise, use the weight and ignore postings to Income accounts.</span>
                <span class="n">atype</span> <span class="o">=</span> <span class="n">account_types</span><span class="o">.</span><span class="n">get_account_type</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">atype</span> <span class="ow">in</span> <span class="n">proceed_types</span><span class="p">:</span>
                    <span class="n">total_proceeds</span><span class="o">.</span><span class="n">add_amount</span><span class="p">(</span><span class="n">convert</span><span class="o">.</span><span class="n">get_weight</span><span class="p">(</span><span class="n">posting</span><span class="p">))</span>

        <span class="c1"># Compare inventories, currency by currency.</span>
        <span class="n">dict_price</span> <span class="o">=</span> <span class="p">{</span><span class="n">pos</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span><span class="p">:</span> <span class="n">pos</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">total_price</span><span class="p">}</span>
        <span class="n">dict_proceeds</span> <span class="o">=</span> <span class="p">{</span><span class="n">pos</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span><span class="p">:</span> <span class="n">pos</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">total_proceeds</span><span class="p">}</span>

        <span class="n">tolerances</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">infer_tolerances</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">,</span> <span class="n">options_map</span><span class="p">)</span>
        <span class="n">invalid</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">currency</span><span class="p">,</span> <span class="n">price_number</span> <span class="ow">in</span> <span class="n">dict_price</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Accept a looser than usual tolerance because rounding occurs</span>
            <span class="c1"># differently. Also, it would be difficult for the user to satisfy</span>
            <span class="c1"># two sets of constraints manually.</span>
            <span class="n">tolerance</span> <span class="o">=</span> <span class="n">tolerances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">currency</span><span class="p">)</span> <span class="o">*</span> <span class="n">EXTRA_TOLERANCE_MULTIPLIER</span>

            <span class="n">proceeds_number</span> <span class="o">=</span> <span class="n">dict_proceeds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="n">ZERO</span><span class="p">)</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">price_number</span> <span class="o">-</span> <span class="n">proceeds_number</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">diff</span> <span class="o">&gt;</span> <span class="n">tolerance</span><span class="p">:</span>
                <span class="n">invalid</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="n">invalid</span> <span class="ow">or</span> <span class="n">dict_proceeds</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">SellGainsError</span><span class="p">(</span>
                    <span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
                    <span class="s2">&quot;Invalid price vs. proceeds/gains: </span><span class="si">{}</span><span class="s2"> vs. </span><span class="si">{}</span><span class="s2">; difference: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">total_price</span><span class="p">,</span> <span class="n">total_proceeds</span><span class="p">,</span> <span class="p">(</span><span class="n">total_price</span> <span class="o">+</span> <span class="o">-</span><span class="n">total_proceeds</span><span class="p">)</span>
                    <span class="p">),</span>
                    <span class="n">entry</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.plugins.unique_prices" class="doc doc-heading">
        <code>beancount.plugins.unique_prices</code>



<a href="#beancount.plugins.unique_prices" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>This module adds validation that there is a single price defined per
date and base/quote currencies. If multiple conflicting price values are
declared, an error is generated. Note that multiple price entries with the
same number do not generate an error.</p>
<p>This is meant to be turned on if you want to use a very strict mode for
entering prices, and may not be realistic usage. For example, if you have
(1) a transaction with an implicitly generated price during the day (from
its cost) and (2) a separate explicit price directive that declares a
different price for the day's closing price, this would generate an error.
I'm not certain this will be useful in the long run, so placing it in a
plugin.</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-class">



<h3 id="beancount.plugins.unique_prices.UniquePricesError" class="doc doc-heading">
        <code>
beancount.plugins.unique_prices.UniquePricesError            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.plugins.unique_prices.UniquePricesError" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>UniquePricesError(source, message, entry)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.unique_prices.UniquePricesError.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">unique_prices</span><span class="o">.</span><span class="n">UniquePricesError</span><span class="o">.</span><span class="n">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.unique_prices.UniquePricesError.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/unique_prices.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return self as a plain tuple.  Used by copy and pickle.&#39;</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.unique_prices.UniquePricesError.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">unique_prices</span><span class="o">.</span><span class="n">UniquePricesError</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.plugins.unique_prices.UniquePricesError.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of UniquePricesError(source, message, entry)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.plugins.unique_prices.UniquePricesError.__repr__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">unique_prices</span><span class="o">.</span><span class="n">UniquePricesError</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.plugins.unique_prices.UniquePricesError.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/plugins/unique_prices.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return a nicely formatted representation string&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.plugins.unique_prices.validate_unique_prices" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">unique_prices</span><span class="o">.</span><span class="n">validate_unique_prices</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">unused_options_map</span><span class="p">)</span></code>


<a href="#beancount.plugins.unique_prices.validate_unique_prices" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Check that there is only a single price per day for a particular base/quote.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives. We're interested only in the Transaction instances.</p></li>
            <li><p><strong>unused_options_map</strong> – A parser options dict.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>The list of input entries, and a list of new UniquePricesError instances generated.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/plugins/unique_prices.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">validate_unique_prices</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">unused_options_map</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check that there is only a single price per day for a particular base/quote.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives. We&#39;re interested only in the Transaction instances.</span>
<span class="sd">      unused_options_map: A parser options dict.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The list of input entries, and a list of new UniquePricesError instances generated.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">prices</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Price</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">amount</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
        <span class="n">prices</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>

    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">price_entries</span> <span class="ow">in</span> <span class="n">prices</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">price_entries</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">number_map</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">price_entry</span><span class="o">.</span><span class="n">amount</span><span class="o">.</span><span class="n">number</span><span class="p">:</span> <span class="n">price_entry</span> <span class="k">for</span> <span class="n">price_entry</span> <span class="ow">in</span> <span class="n">price_entries</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">number_map</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># Note: This should be a list of entries for better error</span>
                <span class="c1"># reporting. (Later.)</span>
                <span class="n">error_entry</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">number_map</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">UniquePricesError</span><span class="p">(</span>
                        <span class="n">error_entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="s2">&quot;Disagreeing price entries&quot;</span><span class="p">,</span> <span class="n">price_entries</span>
                    <span class="p">)</span>
                <span class="p">)</span>

    <span class="k">return</span> <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>




  </div>

    </div>

  </div>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="beancount.scripts.html" class="btn btn-neutral float-right" title="beancount.scripts">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="beancount.parser.html" class="btn btn-neutral" title="beancount.parser"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="beancount.parser.html" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="beancount.scripts.html" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
