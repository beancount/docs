<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="canonical" href="https://beancount.github.io/docs/api_reference/beancount.scripts.html">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>beancount.scripts - Beancount Documentation</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link href="../assets/_mkdocstrings.css" rel="stylesheet" />
  <link href="../css/custom.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "beancount.scripts";
    var mkdocs_page_input_path = "api_reference/beancount.scripts.md";
    var mkdocs_page_url = "/docs/api_reference/beancount.scripts.html";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="icon icon-home"> Beancount Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../index.html">Index</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Outline</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="#">Documentation for Users</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../command_line_accounting_in_context.html">Command Line Accounting in Context</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../the_double_entry_counting_method.html">The Double Entry Counting Method</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../installing_beancount.html">Installing Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../running_beancount_and_generating_reports.html">Running Beancount and Generating Reports</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../getting_started_with_beancount.html">Getting Started with Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_language_syntax.html">Beancount Language Syntax</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_options_reference.html">Beancount Options Reference</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../precision_tolerances.html">Precision Tolerances</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_query_language.html">Beancount Query Language</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_cheat_sheet.html">Beancount Cheat Sheet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../how_inventories_work.html">How Inventories Work</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../exporting_your_portfolio.html">Exporting Your Portfolio</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../tutorial_example.html">Tutorial & Example</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_history_and_credits.html">Beancount History and Credits</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../a_comparison_of_beancount_and_ledger_hledger.html">A Comparison of Beancount and Ledger Hledger</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../fetching_prices_in_beancount.html">Fetching Prices in Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../importing_external_data.html">Importing External Data</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Cookbooks & Examples</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../command_line_accounting_cookbook.html">Command Line Accounting Cookbook</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../trading_with_beancount.html">Trading with Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../stock_vesting_in_beancount.html">Stock Vesting in Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../sharing_expenses_with_beancount.html">Sharing Expenses with Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../how_we_share_expenses.html">How We Share Expenses</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../health_care_expenses.html">Health Care Expenses</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../calculating_portolio_returns.html">Calculating Portfolio Returns</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../tracking_medical_claims.html">Tracking Out-of-Network Medical Claims in Beancount</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Documentation for Developers</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_scripting_plugins.html">Beancount Scripting Plugins</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_design_doc.html">Beancount Design Doc</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ledgerhub_design_doc.html">Ledgerhub Design Doc</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../external_contributions.html">External Contributions</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Enhancement Proposals & Discussions</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../a_proposal_for_an_improvement_on_inventory_booking.html">A Proposal for an Improvement on Inventory Booking</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../settlement_dates_in_beancount.html">Settlement Dates in Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../balance_assertions_in_beancount.html">Balance Assertions in Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../fund_accounting_with_beancount.html">Fund Accounting with Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../rounding_precision_in_beancount.html">Rounding Precision in Beancount</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Beancount 3</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_v3.html">Goals & Design</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../installing_beancount_v3.html">Installing Beancount</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beancount_v3_dependencies.html">Dependencies</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beangulp.html">Beangulp</a>
                </li>
    </ul>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">API reference</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="index.html">beancount</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.core.html">beancount.core</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.loader.html">beancount.loader</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.ops.html">beancount.ops</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.parser.html">beancount.parser</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.plugins.html">beancount.plugins</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="beancount.scripts.html">beancount.scripts</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#beancount.scripts">beancount.scripts</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.scripts.deps">deps</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.deps.check_cdecimal">check_cdecimal()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.deps.check_dependencies">check_dependencies()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.deps.check_import">check_import()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.deps.check_python">check_python()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.deps.check_python_magic">check_python_magic()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.deps.is_fast_decimal">is_fast_decimal()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.deps.list_dependencies">list_dependencies()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.deps.parse_version">parse_version()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.scripts.directories">directories</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.directories.ValidateDirectoryError">ValidateDirectoryError</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.directories.validate_directories">validate_directories()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.directories.validate_directory">validate_directory()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.scripts.doctor">doctor</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.doctor.FileLocation">FileLocation</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.scripts.doctor.FileLocation.convert">convert()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.doctor.FileRegion">FileRegion</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.scripts.doctor.FileRegion.convert">convert()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.doctor.Group">Group</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.scripts.doctor.Group.command">command()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.scripts.doctor.Group.get_command">get_command()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.doctor.RenderError">RenderError</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.scripts.doctor.RenderError.__getnewargs__">__getnewargs__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.scripts.doctor.RenderError.__new__">__new__()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.scripts.doctor.RenderError.__repr__">__repr__()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.doctor.find_linked_entries">find_linked_entries()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.doctor.find_tagged_entries">find_tagged_entries()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.doctor.render_mini_balances">render_mini_balances()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.doctor.resolve_region_to_entries">resolve_region_to_entries()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.scripts.example">example</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.LiberalDate">LiberalDate</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#beancount.scripts.example.LiberalDate.convert">convert()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.check_non_negative">check_non_negative()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.compute_trip_dates">compute_trip_dates()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.contextualize_file">contextualize_file()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.date_iter">date_iter()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.date_random_seq">date_random_seq()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.delay_dates">delay_dates()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.generate_balance_checks">generate_balance_checks()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.generate_banking">generate_banking()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.generate_banking_expenses">generate_banking_expenses()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.generate_clearing_entries">generate_clearing_entries()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.generate_commodity_entries">generate_commodity_entries()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.generate_employment_income">generate_employment_income()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.generate_expense_accounts">generate_expense_accounts()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.generate_open_entries">generate_open_entries()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.generate_outgoing_transfers">generate_outgoing_transfers()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.generate_periodic_expenses">generate_periodic_expenses()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.generate_prices">generate_prices()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.generate_regular_credit_expenses">generate_regular_credit_expenses()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.generate_retirement_employer_match">generate_retirement_employer_match()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.generate_retirement_investments">generate_retirement_investments()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.generate_tax_accounts">generate_tax_accounts()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.generate_tax_preamble">generate_tax_preamble()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.generate_taxable_investment">generate_taxable_investment()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.generate_trip_entries">generate_trip_entries()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.get_minimum_balance">get_minimum_balance()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.iter_dates_with_balance">iter_dates_with_balance()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.iter_quarters">iter_quarters()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.merge_postings">merge_postings()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.parse">parse()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.postings_for">postings_for()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.price_series">price_series()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.replace">replace()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.validate_output">validate_output()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.write_example_file">write_example_file()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#beancount.scripts.format">format</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.format.align_beancount">align_beancount()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.format.compute_most_frequent">compute_most_frequent()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.format.normalize_indent_whitespace">normalize_indent_whitespace()</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.tools.html">beancount.tools</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="beancount.utils.html">beancount.utils</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Beancount Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
    
      
        
          <li>API reference &raquo;</li>
        
      
    
    <li>beancount.scripts</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h1 id="beancountscripts">beancount.scripts<a class="headerlink" href="#beancountscripts" title="Permanent link"></a></h1>


  <div class="doc doc-object doc-module">

<a id="beancount.scripts"></a>
    <div class="doc doc-contents first">

      <p>Implementation of the various scripts available from bin.</p>
<p>This is structured this way because we want all the significant codes under a
single directory, for analysis, grepping and unit testing.</p>



  <div class="doc doc-children">













  <div class="doc doc-object doc-module">



<h2 id="beancount.scripts.deps" class="doc doc-heading">
        <code>beancount.scripts.deps</code>



<a href="#beancount.scripts.deps" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Check the installation dependencies and report the version numbers of each.</p>
<p>This is meant to be used as an error diagnostic tool.</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.deps.check_cdecimal" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">deps</span><span class="o">.</span><span class="n">check_cdecimal</span><span class="p">()</span></code>


<a href="#beancount.scripts.deps.check_cdecimal" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Check that Python 3.3 or above is installed.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A triple of (package-name, version-number, sufficient) as per
check_dependencies().</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/scripts/deps.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">check_cdecimal</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check that Python 3.3 or above is installed.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A triple of (package-name, version-number, sufficient) as per</span>
<span class="sd">      check_dependencies().</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Note: this code mirrors and should be kept in-sync with that at the top of</span>
    <span class="c1"># beancount.core.number.</span>

    <span class="c1"># Try the built-in installation.</span>
    <span class="kn">import</span> <span class="nn">decimal</span>

    <span class="k">if</span> <span class="n">is_fast_decimal</span><span class="p">(</span><span class="n">decimal</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;cdecimal&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> (built-in)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">decimal</span><span class="o">.</span><span class="n">__version__</span><span class="p">),</span> <span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Try an explicitly installed version.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">cdecimal</span>

        <span class="k">if</span> <span class="n">is_fast_decimal</span><span class="p">(</span><span class="n">cdecimal</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;cdecimal&quot;</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">cdecimal</span><span class="p">,</span> <span class="s2">&quot;__version__&quot;</span><span class="p">,</span> <span class="s2">&quot;OKAY&quot;</span><span class="p">),</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="c1"># Not found.</span>
    <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;cdecimal&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.deps.check_dependencies" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">deps</span><span class="o">.</span><span class="n">check_dependencies</span><span class="p">()</span></code>


<a href="#beancount.scripts.deps.check_dependencies" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Check the runtime dependencies and report their version numbers.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of pairs of (package-name, version-number, sufficient) whereby if a
package has not been installed, its 'version-number' will be set to None.
Otherwise, it will be a string with the version number in it. 'sufficient'
will be True if the version if sufficient for this installation of
Beancount.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/scripts/deps.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">check_dependencies</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check the runtime dependencies and report their version numbers.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A list of pairs of (package-name, version-number, sufficient) whereby if a</span>
<span class="sd">      package has not been installed, its &#39;version-number&#39; will be set to None.</span>
<span class="sd">      Otherwise, it will be a string with the version number in it. &#39;sufficient&#39;</span>
<span class="sd">      will be True if the version if sufficient for this installation of</span>
<span class="sd">      Beancount.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">check_python</span><span class="p">(),</span>
        <span class="n">check_cdecimal</span><span class="p">(),</span>
        <span class="n">check_import</span><span class="p">(</span><span class="s2">&quot;dateutil&quot;</span><span class="p">),</span>
    <span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.deps.check_import" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">deps</span><span class="o">.</span><span class="n">check_import</span><span class="p">(</span><span class="n">package_name</span><span class="p">,</span> <span class="n">min_version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">module_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#beancount.scripts.deps.check_import" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Check that a particular module name is installed.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>package_name</strong> – A string, the name of the package and module to be
imported to verify this works. This should have a <strong>version</strong>
attribute on it.</p></li>
            <li><p><strong>min_version</strong> – If not None, a string, the minimum version number
we require.</p></li>
            <li><p><strong>module_name</strong> – The name of the module to import if it differs from the
package name.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A triple of (package-name, version-number, sufficient) as per
check_dependencies().</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/scripts/deps.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">check_import</span><span class="p">(</span><span class="n">package_name</span><span class="p">,</span> <span class="n">min_version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">module_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check that a particular module name is installed.</span>

<span class="sd">    Args:</span>
<span class="sd">      package_name: A string, the name of the package and module to be</span>
<span class="sd">        imported to verify this works. This should have a __version__</span>
<span class="sd">        attribute on it.</span>
<span class="sd">      min_version: If not None, a string, the minimum version number</span>
<span class="sd">        we require.</span>
<span class="sd">      module_name: The name of the module to import if it differs from the</span>
<span class="sd">        package name.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A triple of (package-name, version-number, sufficient) as per</span>
<span class="sd">      check_dependencies().</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">module_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">module_name</span> <span class="o">=</span> <span class="n">package_name</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">__import__</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">module_name</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">min_version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">version</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">__version__</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
            <span class="n">is_sufficient</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">parse_version</span><span class="p">(</span><span class="n">version</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">parse_version</span><span class="p">(</span><span class="n">min_version</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">min_version</span>
                <span class="k">else</span> <span class="kc">True</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">version</span><span class="p">,</span> <span class="n">is_sufficient</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="n">version</span><span class="p">,</span> <span class="n">is_sufficient</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">package_name</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">is_sufficient</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.deps.check_python" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">deps</span><span class="o">.</span><span class="n">check_python</span><span class="p">()</span></code>


<a href="#beancount.scripts.deps.check_python" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Check that Python 3.7 or above is installed.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A triple of (package-name, version-number, sufficient) as per
check_dependencies().</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/scripts/deps.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">check_python</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check that Python 3.7 or above is installed.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A triple of (package-name, version-number, sufficient) as per</span>
<span class="sd">      check_dependencies().</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="s2">&quot;python3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[:</span><span class="mi">3</span><span class="p">])),</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.deps.check_python_magic" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">deps</span><span class="o">.</span><span class="n">check_python_magic</span><span class="p">()</span></code>


<a href="#beancount.scripts.deps.check_python_magic" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Check that a recent-enough version of python-magic is installed.</p>
<p>python-magic is an interface to libmagic, which is used by the 'file' tool
and UNIX to identify file types. Note that there are two Python wrappers
which provide the 'magic' import: python-magic and filemagic. The former is
what we need, which appears to be more recently maintained.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A triple of (package-name, version-number, sufficient) as per
check_dependencies().</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/scripts/deps.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">check_python_magic</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check that a recent-enough version of python-magic is installed.</span>

<span class="sd">    python-magic is an interface to libmagic, which is used by the &#39;file&#39; tool</span>
<span class="sd">    and UNIX to identify file types. Note that there are two Python wrappers</span>
<span class="sd">    which provide the &#39;magic&#39; import: python-magic and filemagic. The former is</span>
<span class="sd">    what we need, which appears to be more recently maintained.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A triple of (package-name, version-number, sufficient) as per</span>
<span class="sd">      check_dependencies().</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">magic</span>

        <span class="c1"># Check that python-magic and not filemagic is installed.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">magic</span><span class="p">,</span> <span class="s2">&quot;from_file&quot;</span><span class="p">):</span>
            <span class="c1"># &#39;filemagic&#39; is installed; install python-magic.</span>
            <span class="k">raise</span> <span class="ne">ImportError</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;python-magic&quot;</span><span class="p">,</span> <span class="s2">&quot;OK&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ImportError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;python-magic&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.deps.is_fast_decimal" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">deps</span><span class="o">.</span><span class="n">is_fast_decimal</span><span class="p">(</span><span class="n">decimal_module</span><span class="p">)</span></code>


<a href="#beancount.scripts.deps.is_fast_decimal" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Return true if a fast C decimal implementation is installed.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/scripts/deps.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">is_fast_decimal</span><span class="p">(</span><span class="n">decimal_module</span><span class="p">):</span>
    <span class="s2">&quot;Return true if a fast C decimal implementation is installed.&quot;</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">decimal_module</span><span class="o">.</span><span class="n">Decimal</span><span class="p">()</span><span class="o">.</span><span class="n">sqrt</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">BuiltinFunctionType</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.deps.list_dependencies" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">deps</span><span class="o">.</span><span class="n">list_dependencies</span><span class="p">(</span><span class="n">file</span><span class="o">=&lt;</span><span class="n">_io</span><span class="o">.</span><span class="n">TextIOWrapper</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&lt;stderr&gt;&#39;</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="o">&gt;</span><span class="p">)</span></code>


<a href="#beancount.scripts.deps.list_dependencies" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Check the dependencies and produce a listing on the given file.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>file</strong> – A file object to write the output to.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/scripts/deps.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">list_dependencies</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check the dependencies and produce a listing on the given file.</span>

<span class="sd">    Args:</span>
<span class="sd">      file: A file object to write the output to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dependencies:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">package</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">sufficient</span> <span class="ow">in</span> <span class="n">check_dependencies</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;   </span><span class="si">{:16}</span><span class="s2">: </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">package</span><span class="p">,</span>
                <span class="n">version</span> <span class="ow">or</span> <span class="s2">&quot;NOT INSTALLED&quot;</span><span class="p">,</span>
                <span class="s2">&quot;(INSUFFICIENT)&quot;</span> <span class="k">if</span> <span class="n">version</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">sufficient</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.deps.parse_version" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">deps</span><span class="o">.</span><span class="n">parse_version</span><span class="p">(</span><span class="n">version_str</span><span class="p">)</span></code>


<a href="#beancount.scripts.deps.parse_version" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Parse the version string into a comparable tuple.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/scripts/deps.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">parse_version</span><span class="p">(</span><span class="n">version_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse the version string into a comparable tuple.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">version_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)]</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.scripts.directories" class="doc doc-heading">
        <code>beancount.scripts.directories</code>



<a href="#beancount.scripts.directories" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Check that document directories mirror a list of accounts correctly.</p>



  <div class="doc doc-children">









  <div class="doc doc-object doc-class">



<h3 id="beancount.scripts.directories.ValidateDirectoryError" class="doc doc-heading">
        <code>
beancount.scripts.directories.ValidateDirectoryError            (<span title="Exception">Exception</span>)
        </code>



<a href="#beancount.scripts.directories.ValidateDirectoryError" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>A directory validation error.</p>



    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.directories.validate_directories" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">directories</span><span class="o">.</span><span class="n">validate_directories</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">document_dirs</span><span class="p">)</span></code>


<a href="#beancount.scripts.directories.validate_directories" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Validate a directory hierarchy against a ledger's account names.</p>
<p>Read a ledger's list of account names and check that all the capitalized
subdirectory names under the given roots match the account names.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives.</p></li>
            <li><p><strong>document_dirs</strong> – A list of string, the directory roots to walk and validate.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/scripts/directories.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">validate_directories</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">document_dirs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate a directory hierarchy against a ledger&#39;s account names.</span>

<span class="sd">    Read a ledger&#39;s list of account names and check that all the capitalized</span>
<span class="sd">    subdirectory names under the given roots match the account names.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      document_dirs: A list of string, the directory roots to walk and validate.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Get the list of accounts declared in the ledge.</span>
    <span class="n">accounts</span> <span class="o">=</span> <span class="n">getters</span><span class="o">.</span><span class="n">get_accounts</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>

    <span class="c1"># For each of the roots, validate the hierarchy of directories.</span>
    <span class="k">for</span> <span class="n">document_dir</span> <span class="ow">in</span> <span class="n">document_dirs</span><span class="p">:</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="n">validate_directory</span><span class="p">(</span><span class="n">accounts</span><span class="p">,</span> <span class="n">document_dir</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.directories.validate_directory" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">directories</span><span class="o">.</span><span class="n">validate_directory</span><span class="p">(</span><span class="n">accounts</span><span class="p">,</span> <span class="n">document_dir</span><span class="p">)</span></code>


<a href="#beancount.scripts.directories.validate_directory" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Check a directory hierarchy against a list of valid accounts.</p>
<p>Walk the directory hierarchy, and for all directories with names matching
that of accounts (with ":" replaced with "/"), check that they refer to an
account name declared in the given list.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>account</strong> – A set or dict of account names.</p></li>
            <li><p><strong>document_dir</strong> – A string, the root directory to walk and validate.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>An errors for each invalid directory name found.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/scripts/directories.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">validate_directory</span><span class="p">(</span><span class="n">accounts</span><span class="p">,</span> <span class="n">document_dir</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check a directory hierarchy against a list of valid accounts.</span>

<span class="sd">    Walk the directory hierarchy, and for all directories with names matching</span>
<span class="sd">    that of accounts (with &quot;:&quot; replaced with &quot;/&quot;), check that they refer to an</span>
<span class="sd">    account name declared in the given list.</span>

<span class="sd">    Args:</span>
<span class="sd">      account: A set or dict of account names.</span>
<span class="sd">      document_dir: A string, the root directory to walk and validate.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An errors for each invalid directory name found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Generate all parent accounts in the account_set we&#39;re checking against, so</span>
    <span class="c1"># that parent directories with no corresponding account don&#39;t warn.</span>
    <span class="n">accounts_with_parents</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">accounts</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">account_</span> <span class="ow">in</span> <span class="n">accounts</span><span class="p">:</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="n">account_</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">parent</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">accounts_with_parents</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">accounts_with_parents</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
            <span class="n">account_</span> <span class="o">=</span> <span class="n">parent</span>

    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">directory</span><span class="p">,</span> <span class="n">account_name</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">account</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">document_dir</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">account_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">accounts_with_parents</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">ValidateDirectoryError</span><span class="p">(</span>
                    <span class="s2">&quot;Invalid directory &#39;</span><span class="si">{}</span><span class="s2">&#39;: no corresponding account &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">directory</span><span class="p">,</span> <span class="n">account_name</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">errors</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.scripts.doctor" class="doc doc-heading">
        <code>beancount.scripts.doctor</code>



<a href="#beancount.scripts.doctor" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">

      <p>Debugging tool for those finding bugs in Beancount.</p>
<p>This tool is able to dump lexer/parser state, and will provide other services in
the name of debugging.</p>



  <div class="doc doc-children">











  <div class="doc doc-object doc-class">



<h3 id="beancount.scripts.doctor.FileLocation" class="doc doc-heading">
        <code>
beancount.scripts.doctor.FileLocation            (<span title="click.types.ParamType">ParamType</span>)
        </code>



<a href="#beancount.scripts.doctor.FileLocation" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">





  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h4 id="beancount.scripts.doctor.FileLocation.convert" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">doctor</span><span class="o">.</span><span class="n">FileLocation</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span></code>


<a href="#beancount.scripts.doctor.FileLocation.convert" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Convert the value to the correct type. This is not called if
the value is <code>None</code> (the missing value).</p>
<p>This must accept string values from the command line, as well as
values that are already the correct type. It may also convert
other compatible types.</p>
<p>The <code>param</code> and <code>ctx</code> arguments may be <code>None</code> in certain
situations, such as when converting prompt input.</p>
<p>If the value cannot be converted, call :meth:<code>fail</code> with a
descriptive message.</p>
<p>:param value: The value to convert.
:param param: The parameter that is using this type to convert
    its value. May be <code>None</code>.
:param ctx: The current context that arrived at this value. May
    be <code>None</code>.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/scripts/doctor.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?:(.+):)?(\d+)$&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{!r}</span><span class="s2"> is not a valid location&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">param</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span>
    <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">filename</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">lineno</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="beancount.scripts.doctor.FileRegion" class="doc doc-heading">
        <code>
beancount.scripts.doctor.FileRegion            (<span title="click.types.ParamType">ParamType</span>)
        </code>



<a href="#beancount.scripts.doctor.FileRegion" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">





  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h4 id="beancount.scripts.doctor.FileRegion.convert" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">doctor</span><span class="o">.</span><span class="n">FileRegion</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span></code>


<a href="#beancount.scripts.doctor.FileRegion.convert" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Convert the value to the correct type. This is not called if
the value is <code>None</code> (the missing value).</p>
<p>This must accept string values from the command line, as well as
values that are already the correct type. It may also convert
other compatible types.</p>
<p>The <code>param</code> and <code>ctx</code> arguments may be <code>None</code> in certain
situations, such as when converting prompt input.</p>
<p>If the value cannot be converted, call :meth:<code>fail</code> with a
descriptive message.</p>
<p>:param value: The value to convert.
:param param: The parameter that is using this type to convert
    its value. May be <code>None</code>.
:param ctx: The current context that arrived at this value. May
    be <code>None</code>.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/scripts/doctor.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?:(.+):)?(\d+):(\d+)$&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{!r}</span><span class="s2"> is not a valid region&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">param</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span>
    <span class="n">filename</span><span class="p">,</span> <span class="n">start_lineno</span><span class="p">,</span> <span class="n">end_lineno</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">filename</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">start_lineno</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">end_lineno</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="beancount.scripts.doctor.Group" class="doc doc-heading">
        <code>
beancount.scripts.doctor.Group            (<span title="click.core.Group">Group</span>)
        </code>



<a href="#beancount.scripts.doctor.Group" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">





  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h4 id="beancount.scripts.doctor.Group.command" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">doctor</span><span class="o">.</span><span class="n">Group</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">alias</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#beancount.scripts.doctor.Group.command" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>A shortcut decorator for declaring and attaching a command to
the group. This takes the same arguments as :func:<code>command</code> and
immediately registers the created command with this group by
calling :meth:<code>add_command</code>.</p>
<p>To customize the command class used, set the
:attr:<code>command_class</code> attribute.</p>
<p>.. versionchanged:: 8.1
    This decorator can be applied without parentheses.</p>
<p>.. versionchanged:: 8.0
    Added the :attr:<code>command_class</code> attribute.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/scripts/doctor.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">alias</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">wrap</span> <span class="o">=</span> <span class="n">click</span><span class="o">.</span><span class="n">Group</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">wrap</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">alias</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span><span class="p">[</span><span class="n">alias</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">name</span>
        <span class="k">return</span> <span class="n">cmd</span>

    <span class="k">return</span> <span class="n">decorator</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.scripts.doctor.Group.get_command" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">doctor</span><span class="o">.</span><span class="n">Group</span><span class="o">.</span><span class="n">get_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">cmd_name</span><span class="p">)</span></code>


<a href="#beancount.scripts.doctor.Group.get_command" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Given a context and a command name, this returns a
:class:<code>Command</code> object if it exists or returns <code>None</code>.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/scripts/doctor.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">cmd_name</span><span class="p">):</span>
    <span class="c1"># aliases</span>
    <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cmd_name</span><span class="p">,</span> <span class="n">cmd_name</span><span class="p">)</span>
    <span class="c1"># allow to use &#39;_&#39; or &#39;-&#39; in command names.</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">click</span><span class="o">.</span><span class="n">Group</span><span class="o">.</span><span class="n">get_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="beancount.scripts.doctor.RenderError" class="doc doc-heading">
        <code>
beancount.scripts.doctor.RenderError            (<span title="tuple">tuple</span>)
        </code>



<a href="#beancount.scripts.doctor.RenderError" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>RenderError(source, message, entry)</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="beancount.scripts.doctor.RenderError.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">doctor</span><span class="o">.</span><span class="n">RenderError</span><span class="o">.</span><span class="n">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.scripts.doctor.RenderError.__getnewargs__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/scripts/doctor.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return self as a plain tuple.  Used by copy and pickle.&#39;</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.scripts.doctor.RenderError.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">doctor</span><span class="o">.</span><span class="n">RenderError</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#beancount.scripts.doctor.RenderError.__new__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Create new instance of RenderError(source, message, entry)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="beancount.scripts.doctor.RenderError.__repr__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">doctor</span><span class="o">.</span><span class="n">RenderError</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#beancount.scripts.doctor.RenderError.__repr__" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>beancount/scripts/doctor.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return a nicely formatted representation string&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.doctor.find_linked_entries" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">doctor</span><span class="o">.</span><span class="n">find_linked_entries</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">links</span><span class="p">,</span> <span class="n">follow_links</span><span class="p">)</span></code>


<a href="#beancount.scripts.doctor.find_linked_entries" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Find all linked entries.</p>
<p>Note that there is an option here: You can either just look at the links
on the closest entry, or you can include the links of the linked
transactions as well. Whichever one you want depends on how you use your
links. Best would be to query the user (in Emacs) when there are many
links present.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/scripts/doctor.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">find_linked_entries</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">links</span><span class="p">,</span> <span class="n">follow_links</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find all linked entries.</span>

<span class="sd">    Note that there is an option here: You can either just look at the links</span>
<span class="sd">    on the closest entry, or you can include the links of the linked</span>
<span class="sd">    transactions as well. Whichever one you want depends on how you use your</span>
<span class="sd">    links. Best would be to query the user (in Emacs) when there are many</span>
<span class="sd">    links present.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">linked_entries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">follow_links</span><span class="p">:</span>
        <span class="n">linked_entries</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">entry</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Transaction</span><span class="p">)</span> <span class="ow">and</span> <span class="n">entry</span><span class="o">.</span><span class="n">links</span> <span class="ow">and</span> <span class="n">entry</span><span class="o">.</span><span class="n">links</span> <span class="o">&amp;</span> <span class="n">links</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">links</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">links</span><span class="p">)</span>
        <span class="n">linked_entries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">num_linked</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">linked_entries</span><span class="p">)</span>
            <span class="n">linked_entries</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">entry</span>
                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Transaction</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="n">entry</span><span class="o">.</span><span class="n">links</span>
                    <span class="ow">and</span> <span class="n">entry</span><span class="o">.</span><span class="n">links</span> <span class="o">&amp;</span> <span class="n">links</span>
                <span class="p">)</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">linked_entries</span><span class="p">)</span> <span class="o">==</span> <span class="n">num_linked</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">linked_entries</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">links</span><span class="p">:</span>
                    <span class="n">links</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">links</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">linked_entries</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.doctor.find_tagged_entries" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">doctor</span><span class="o">.</span><span class="n">find_tagged_entries</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span></code>


<a href="#beancount.scripts.doctor.find_tagged_entries" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Find all entries with the given tag.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/scripts/doctor.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">find_tagged_entries</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find all entries with the given tag.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">entry</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Transaction</span><span class="p">)</span> <span class="ow">and</span> <span class="n">entry</span><span class="o">.</span><span class="n">tags</span> <span class="ow">and</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">tags</span><span class="p">)</span>
    <span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.doctor.render_mini_balances" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">doctor</span><span class="o">.</span><span class="n">render_mini_balances</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="n">conversion</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">price_map</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#beancount.scripts.doctor.render_mini_balances" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Render a treeified list of the balances for the given transactions.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of selected transactions to render.</p></li>
            <li><p><strong>options_map</strong> – The parsed options.</p></li>
            <li><p><strong>conversion</strong> – Conversion method string, None, 'value' or 'cost'.</p></li>
            <li><p><strong>price_map</strong> – A price map from the original entries. If this isn't provided,
the inventories are rendered directly. If it is, their contents are
converted to market value.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/scripts/doctor.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">render_mini_balances</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="n">conversion</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">price_map</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Render a treeified list of the balances for the given transactions.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of selected transactions to render.</span>
<span class="sd">      options_map: The parsed options.</span>
<span class="sd">      conversion: Conversion method string, None, &#39;value&#39; or &#39;cost&#39;.</span>
<span class="sd">      price_map: A price map from the original entries. If this isn&#39;t provided,</span>
<span class="sd">        the inventories are rendered directly. If it is, their contents are</span>
<span class="sd">        converted to market value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Render linked entries (in date order) as errors (for Emacs).</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[</span><span class="n">RenderError</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">]</span>
    <span class="n">printer</span><span class="o">.</span><span class="n">print_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>

    <span class="c1"># Print out balances.</span>
    <span class="n">real_root</span> <span class="o">=</span> <span class="n">realization</span><span class="o">.</span><span class="n">realize</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>
    <span class="n">dformat</span> <span class="o">=</span> <span class="n">options_map</span><span class="p">[</span><span class="s2">&quot;dcontext&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">alignment</span><span class="o">=</span><span class="n">Align</span><span class="o">.</span><span class="n">DOT</span><span class="p">,</span> <span class="n">reserved</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># TODO(blais): I always want to be able to convert at cost. We need</span>
    <span class="c1"># arguments capability.</span>
    <span class="c1">#</span>
    <span class="c1"># TODO(blais): Ideally this conversion inserts a new transactions to</span>
    <span class="c1"># &#39;Unrealized&#39; to account for the difference between cost and market value.</span>
    <span class="c1"># Insert one and update the realization. Add an update() method to the</span>
    <span class="c1"># realization, given a transaction.</span>
    <span class="n">acctypes</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get_account_types</span><span class="p">(</span><span class="n">options_map</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">conversion</span> <span class="o">==</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">price_map</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="c1"># Warning: Mutate the inventories in-place, converting them to market</span>
        <span class="c1"># value.</span>
        <span class="n">balance_diff</span> <span class="o">=</span> <span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">real_account</span> <span class="ow">in</span> <span class="n">realization</span><span class="o">.</span><span class="n">iter_children</span><span class="p">(</span><span class="n">real_root</span><span class="p">):</span>
            <span class="n">balance_cost</span> <span class="o">=</span> <span class="n">real_account</span><span class="o">.</span><span class="n">balance</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">convert</span><span class="o">.</span><span class="n">get_cost</span><span class="p">)</span>
            <span class="n">balance_value</span> <span class="o">=</span> <span class="n">real_account</span><span class="o">.</span><span class="n">balance</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">convert</span><span class="o">.</span><span class="n">get_value</span><span class="p">,</span> <span class="n">price_map</span><span class="p">)</span>
            <span class="n">real_account</span><span class="o">.</span><span class="n">balance</span> <span class="o">=</span> <span class="n">balance_value</span>
            <span class="n">balance_diff</span><span class="o">.</span><span class="n">add_inventory</span><span class="p">(</span><span class="n">balance_cost</span><span class="p">)</span>
            <span class="n">balance_diff</span><span class="o">.</span><span class="n">add_inventory</span><span class="p">(</span><span class="o">-</span><span class="n">balance_value</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">balance_diff</span><span class="o">.</span><span class="n">is_empty</span><span class="p">():</span>
            <span class="n">account_unrealized</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">acctypes</span><span class="o">.</span><span class="n">income</span><span class="p">,</span> <span class="n">options_map</span><span class="p">[</span><span class="s2">&quot;account_unrealized_gains&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">unrealized</span> <span class="o">=</span> <span class="n">realization</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">real_root</span><span class="p">,</span> <span class="n">account_unrealized</span><span class="p">)</span>
            <span class="n">unrealized</span><span class="o">.</span><span class="n">balance</span><span class="o">.</span><span class="n">add_inventory</span><span class="p">(</span><span class="n">balance_diff</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">conversion</span> <span class="o">==</span> <span class="s2">&quot;cost&quot;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">real_account</span> <span class="ow">in</span> <span class="n">realization</span><span class="o">.</span><span class="n">iter_children</span><span class="p">(</span><span class="n">real_root</span><span class="p">):</span>
            <span class="n">real_account</span><span class="o">.</span><span class="n">balance</span> <span class="o">=</span> <span class="n">real_account</span><span class="o">.</span><span class="n">balance</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">convert</span><span class="o">.</span><span class="n">get_cost</span><span class="p">)</span>

    <span class="n">realization</span><span class="o">.</span><span class="n">dump_balances</span><span class="p">(</span><span class="n">real_root</span><span class="p">,</span> <span class="n">dformat</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>

    <span class="c1"># Print out net income change.</span>
    <span class="n">net_income</span> <span class="o">=</span> <span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">real_node</span> <span class="ow">in</span> <span class="n">realization</span><span class="o">.</span><span class="n">iter_children</span><span class="p">(</span><span class="n">real_root</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">account_types</span><span class="o">.</span><span class="n">is_income_statement_account</span><span class="p">(</span><span class="n">real_node</span><span class="o">.</span><span class="n">account</span><span class="p">,</span> <span class="n">acctypes</span><span class="p">):</span>
            <span class="n">net_income</span><span class="o">.</span><span class="n">add_inventory</span><span class="p">(</span><span class="n">real_node</span><span class="o">.</span><span class="n">balance</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Net Income: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">-</span><span class="n">net_income</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.doctor.resolve_region_to_entries" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">doctor</span><span class="o">.</span><span class="n">resolve_region_to_entries</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span></code>


<a href="#beancount.scripts.doctor.resolve_region_to_entries" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Resolve a filename and region to a list of entries.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/scripts/doctor.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">resolve_region_to_entries</span><span class="p">(</span>
    <span class="n">entries</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">Entries</span><span class="p">],</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">region</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">Entries</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Resolve a filename and region to a list of entries.&quot;&quot;&quot;</span>

    <span class="n">search_filename</span><span class="p">,</span> <span class="n">first_lineno</span><span class="p">,</span> <span class="n">last_lineno</span> <span class="o">=</span> <span class="n">region</span>
    <span class="k">if</span> <span class="n">search_filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">search_filename</span> <span class="o">=</span> <span class="n">filename</span>

    <span class="c1"># Find all the entries in the region. (To be clear, this isn&#39;t like the</span>
    <span class="c1"># &#39;linked&#39; command, none of the links are followed.)</span>
    <span class="n">region_entries</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">entry</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">filter_txns</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">search_filename</span>
            <span class="ow">and</span> <span class="n">first_lineno</span> <span class="o">&lt;=</span> <span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;lineno&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">last_lineno</span>
        <span class="p">)</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="n">region_entries</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.scripts.example" class="doc doc-heading">
        <code>beancount.scripts.example</code>



<a href="#beancount.scripts.example" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">




  <div class="doc doc-children">






















  <div class="doc doc-object doc-class">



<h3 id="beancount.scripts.example.LiberalDate" class="doc doc-heading">
        <code>
beancount.scripts.example.LiberalDate            (<span title="click.types.ParamType">ParamType</span>)
        </code>



<a href="#beancount.scripts.example.LiberalDate" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">





  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h4 id="beancount.scripts.example.LiberalDate.convert" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">LiberalDate</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span></code>


<a href="#beancount.scripts.example.LiberalDate.convert" class="headerlink" title="Permanent link"></a></h4>

    <div class="doc doc-contents ">

      <p>Convert the value to the correct type. This is not called if
the value is <code>None</code> (the missing value).</p>
<p>This must accept string values from the command line, as well as
values that are already the correct type. It may also convert
other compatible types.</p>
<p>The <code>param</code> and <code>ctx</code> arguments may be <code>None</code> in certain
situations, such as when converting prompt input.</p>
<p>If the value cannot be converted, call :meth:<code>fail</code> with a
descriptive message.</p>
<p>:param value: The value to convert.
:param param: The parameter that is using this type to convert
    its value. May be <code>None</code>.
:param ctx: The current context that arrived at this value. May
    be <code>None</code>.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/scripts/example.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">date_utils</span><span class="o">.</span><span class="n">parse_date_liberally</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{!r}</span><span class="s2"> is not a valid date&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">param</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.example.check_non_negative" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">check_non_negative</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span></code>


<a href="#beancount.scripts.example.check_non_negative" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Check that the balance of the given account never goes negative.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives.</p></li>
            <li><p><strong>account</strong> – An account string, the account to check the balance for.</p></li>
            <li><p><strong>currency</strong> – A string, the currency to check minimums for.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>AssertionError</code> – if the balance goes negative.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/scripts/example.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">check_non_negative</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check that the balance of the given account never goes negative.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      account: An account string, the account to check the balance for.</span>
<span class="sd">      currency: A string, the currency to check minimums for.</span>
<span class="sd">    Raises:</span>
<span class="sd">      AssertionError: if the balance goes negative.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">previous_date</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">txn_posting</span><span class="p">,</span> <span class="n">balances</span> <span class="ow">in</span> <span class="n">postings_for</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span><span class="n">entries</span><span class="p">),</span> <span class="p">[</span><span class="n">account</span><span class="p">],</span> <span class="n">before</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">balance</span> <span class="o">=</span> <span class="n">balances</span><span class="p">[</span><span class="n">account</span><span class="p">]</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">txn_posting</span><span class="o">.</span><span class="n">txn</span><span class="o">.</span><span class="n">date</span>
        <span class="k">if</span> <span class="n">date</span> <span class="o">!=</span> <span class="n">previous_date</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
                <span class="n">pos</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="o">&gt;=</span> <span class="n">ZERO</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">balance</span><span class="o">.</span><span class="n">get_positions</span><span class="p">()</span>
            <span class="p">),</span> <span class="s2">&quot;Negative balance: </span><span class="si">{}</span><span class="s2"> at: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">balance</span><span class="p">,</span> <span class="n">txn_posting</span><span class="o">.</span><span class="n">txn</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
        <span class="n">previous_date</span> <span class="o">=</span> <span class="n">date</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.example.compute_trip_dates" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">compute_trip_dates</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">)</span></code>


<a href="#beancount.scripts.example.compute_trip_dates" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Generate dates at reasonable intervals for trips during the given time period.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>date_begin</strong> – The start date.</p></li>
            <li><p><strong>date_end</strong> – The end date.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  Pairs of dates for the trips within the period.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/scripts/example.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">compute_trip_dates</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate dates at reasonable intervals for trips during the given time period.</span>

<span class="sd">    Args:</span>
<span class="sd">      date_begin: The start date.</span>
<span class="sd">      date_end: The end date.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Pairs of dates for the trips within the period.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Min and max number of days remaining at home.</span>
    <span class="n">days_at_home</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">13</span> <span class="o">*</span> <span class="mi">30</span><span class="p">)</span>

    <span class="c1"># Length of trip.</span>
    <span class="n">days_trip</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">22</span><span class="p">)</span>

    <span class="c1"># Number of days to ensure no trip at the beginning and the end.</span>
    <span class="n">days_buffer</span> <span class="o">=</span> <span class="mi">21</span>

    <span class="n">date_begin</span> <span class="o">+=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days_buffer</span><span class="p">)</span>
    <span class="n">date_end</span> <span class="o">-=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days_buffer</span><span class="p">)</span>

    <span class="n">date</span> <span class="o">=</span> <span class="n">date_begin</span>
    <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">duration_at_home</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">*</span><span class="n">days_at_home</span><span class="p">))</span>
        <span class="n">duration_trip</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">*</span><span class="n">days_trip</span><span class="p">))</span>
        <span class="n">date_trip_begin</span> <span class="o">=</span> <span class="n">date</span> <span class="o">+</span> <span class="n">duration_at_home</span>
        <span class="n">date_trip_end</span> <span class="o">=</span> <span class="n">date_trip_begin</span> <span class="o">+</span> <span class="n">duration_trip</span>
        <span class="k">if</span> <span class="n">date_trip_end</span> <span class="o">&gt;=</span> <span class="n">date_end</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">yield</span> <span class="p">(</span><span class="n">date_trip_begin</span><span class="p">,</span> <span class="n">date_trip_end</span><span class="p">)</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">date_trip_end</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.example.contextualize_file" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">contextualize_file</span><span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="n">employer</span><span class="p">)</span></code>


<a href="#beancount.scripts.example.contextualize_file" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Replace generic strings in the generated file with realistic strings.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>contents</strong> – A string, the generic file contents.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A string, the contextualized version.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/scripts/example.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">contextualize_file</span><span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="n">employer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Replace generic strings in the generated file with realistic strings.</span>

<span class="sd">    Args:</span>
<span class="sd">      contents: A string, the generic file contents.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, the contextualized version.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">replacements</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;CC&quot;</span><span class="p">:</span> <span class="s2">&quot;US&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Bank1&quot;</span><span class="p">:</span> <span class="s2">&quot;BofA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Bank1_Institution&quot;</span><span class="p">:</span> <span class="s2">&quot;Bank of America&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Bank1_Address&quot;</span><span class="p">:</span> <span class="s2">&quot;123 America Street, LargeTown, USA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Bank1_Phone&quot;</span><span class="p">:</span> <span class="s2">&quot;+1.012.345.6789&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CreditCard1&quot;</span><span class="p">:</span> <span class="s2">&quot;Chase:Slate&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CreditCard2&quot;</span><span class="p">:</span> <span class="s2">&quot;Amex:BlueCash&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Employer1&quot;</span><span class="p">:</span> <span class="n">employer</span><span class="p">,</span>
        <span class="s2">&quot;Retirement&quot;</span><span class="p">:</span> <span class="s2">&quot;Vanguard&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Retirement_Institution&quot;</span><span class="p">:</span> <span class="s2">&quot;Vanguard Group&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Retirement_Address&quot;</span><span class="p">:</span> <span class="s2">&quot;P.O. Box 1110, Valley Forge, PA 19482-1110&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Retirement_Phone&quot;</span><span class="p">:</span> <span class="s2">&quot;+1.800.523.1188&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Investment&quot;</span><span class="p">:</span> <span class="s2">&quot;ETrade&quot;</span><span class="p">,</span>
        <span class="c1"># Commodities</span>
        <span class="s2">&quot;CCY&quot;</span><span class="p">:</span> <span class="s2">&quot;USD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;VACHR&quot;</span><span class="p">:</span> <span class="s2">&quot;VACHR&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DEFCCY&quot;</span><span class="p">:</span> <span class="s2">&quot;IRAUSD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;MFUND1&quot;</span><span class="p">:</span> <span class="s2">&quot;VBMPX&quot;</span><span class="p">,</span>
        <span class="s2">&quot;MFUND2&quot;</span><span class="p">:</span> <span class="s2">&quot;RGAGX&quot;</span><span class="p">,</span>
        <span class="s2">&quot;STK1&quot;</span><span class="p">:</span> <span class="s2">&quot;ITOT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;STK2&quot;</span><span class="p">:</span> <span class="s2">&quot;VEA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;STK3&quot;</span><span class="p">:</span> <span class="s2">&quot;VHT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;STK4&quot;</span><span class="p">:</span> <span class="s2">&quot;GLD&quot;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">new_contents</span> <span class="o">=</span> <span class="n">replace</span><span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="n">replacements</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_contents</span><span class="p">,</span> <span class="n">replacements</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.example.date_iter" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">date_iter</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">)</span></code>


<a href="#beancount.scripts.example.date_iter" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Generate a sequence of dates.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>date_begin</strong> – The start date.</p></li>
            <li><p><strong>date_end</strong> – The end date.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  Instances of datetime.date.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/scripts/example.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">date_iter</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a sequence of dates.</span>

<span class="sd">    Args:</span>
<span class="sd">      date_begin: The start date.</span>
<span class="sd">      date_end: The end date.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Instances of datetime.date.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">date_begin</span> <span class="o">&lt;=</span> <span class="n">date_end</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">date_begin</span>
    <span class="n">one_day</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">date</span> <span class="o">&lt;</span> <span class="n">date_end</span><span class="p">:</span>
        <span class="n">date</span> <span class="o">+=</span> <span class="n">one_day</span>
        <span class="k">yield</span> <span class="n">date</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.example.date_random_seq" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">date_random_seq</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">days_min</span><span class="p">,</span> <span class="n">days_max</span><span class="p">)</span></code>


<a href="#beancount.scripts.example.date_random_seq" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Generate a sequence of dates with some random increase in days.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>date_begin</strong> – The start date.</p></li>
            <li><p><strong>date_end</strong> – The end date.</p></li>
            <li><p><strong>days_min</strong> – The minimum number of days to advance on each iteration.</p></li>
            <li><p><strong>days_max</strong> – The maximum number of days to advance on each iteration.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  Instances of datetime.date.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/scripts/example.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">date_random_seq</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">days_min</span><span class="p">,</span> <span class="n">days_max</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a sequence of dates with some random increase in days.</span>

<span class="sd">    Args:</span>
<span class="sd">      date_begin: The start date.</span>
<span class="sd">      date_end: The end date.</span>
<span class="sd">      days_min: The minimum number of days to advance on each iteration.</span>
<span class="sd">      days_max: The maximum number of days to advance on each iteration.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Instances of datetime.date.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">days_min</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="n">days_min</span> <span class="o">&lt;=</span> <span class="n">days_max</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">date_begin</span>
    <span class="k">while</span> <span class="n">date</span> <span class="o">&lt;</span> <span class="n">date_end</span><span class="p">:</span>
        <span class="n">nb_days_forward</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">days_min</span><span class="p">,</span> <span class="n">days_max</span><span class="p">)</span>
        <span class="n">date</span> <span class="o">+=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">nb_days_forward</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">date</span> <span class="o">&gt;=</span> <span class="n">date_end</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">yield</span> <span class="n">date</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.example.delay_dates" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">delay_dates</span><span class="p">(</span><span class="n">date_iter</span><span class="p">,</span> <span class="n">delay_days_min</span><span class="p">,</span> <span class="n">delay_days_max</span><span class="p">)</span></code>


<a href="#beancount.scripts.example.delay_dates" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Delay the dates from the given iterator by some uniformly drawn number of days.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>date_iter</strong> – An iterator of datetime.date instances.</p></li>
            <li><p><strong>delay_days_min</strong> – The minimum amount of advance days for the transaction.</p></li>
            <li><p><strong>delay_days_max</strong> – The maximum amount of advance days for the transaction.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  datetime.date instances.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/scripts/example.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">delay_dates</span><span class="p">(</span><span class="n">date_iter</span><span class="p">,</span> <span class="n">delay_days_min</span><span class="p">,</span> <span class="n">delay_days_max</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delay the dates from the given iterator by some uniformly drawn number of days.</span>

<span class="sd">    Args:</span>
<span class="sd">      date_iter: An iterator of datetime.date instances.</span>
<span class="sd">      delay_days_min: The minimum amount of advance days for the transaction.</span>
<span class="sd">      delay_days_max: The maximum amount of advance days for the transaction.</span>
<span class="sd">    Yields:</span>
<span class="sd">      datetime.date instances.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">date_iter</span><span class="p">)</span>
    <span class="n">last_date</span> <span class="o">=</span> <span class="n">dates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">last_date</span> <span class="o">=</span> <span class="n">last_date</span><span class="o">.</span><span class="n">date</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">last_date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span> <span class="k">else</span> <span class="n">last_date</span>
    <span class="k">for</span> <span class="n">dtime</span> <span class="ow">in</span> <span class="n">dates</span><span class="p">:</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">dtime</span><span class="o">.</span><span class="n">date</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtime</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span> <span class="k">else</span> <span class="n">dtime</span>
        <span class="n">date</span> <span class="o">+=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">delay_days_min</span><span class="p">,</span> <span class="n">delay_days_max</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">date</span> <span class="o">&gt;=</span> <span class="n">last_date</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">yield</span> <span class="n">date</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.example.generate_balance_checks" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">generate_balance_checks</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">date_iter</span><span class="p">)</span></code>


<a href="#beancount.scripts.example.generate_balance_checks" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Generate balance check entries to the given frequency.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives that contain all the transactions for the
accounts.</p></li>
            <li><p><strong>account</strong> – The name of the account for which to generate.</p></li>
            <li><p><strong>date_iter</strong> – Iterator of dates. We generate balance checks at these dates.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of balance check entries.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/scripts/example.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">generate_balance_checks</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">date_iter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate balance check entries to the given frequency.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives that contain all the transactions for the</span>
<span class="sd">        accounts.</span>
<span class="sd">      account: The name of the account for which to generate.</span>
<span class="sd">      date_iter: Iterator of dates. We generate balance checks at these dates.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of balance check entries.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">balance_checks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">date_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">date_iter</span><span class="p">)</span>
    <span class="n">next_date</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">date_iter</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">misc_utils</span><span class="o">.</span><span class="n">swallow</span><span class="p">(</span><span class="ne">StopIteration</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">txn_posting</span><span class="p">,</span> <span class="n">balance</span> <span class="ow">in</span> <span class="n">postings_for</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="p">[</span><span class="n">account</span><span class="p">],</span> <span class="n">before</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">while</span> <span class="n">txn_posting</span><span class="o">.</span><span class="n">txn</span><span class="o">.</span><span class="n">date</span> <span class="o">&gt;=</span> <span class="n">next_date</span><span class="p">:</span>
                <span class="n">amount</span> <span class="o">=</span> <span class="n">balance</span><span class="p">[</span><span class="n">account</span><span class="p">]</span><span class="o">.</span><span class="n">get_currency_units</span><span class="p">(</span><span class="s2">&quot;CCY&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">number</span>
                <span class="n">balance_checks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="n">parse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                  </span><span class="si">{</span><span class="n">next_date</span><span class="si">}</span><span class="s2"> balance </span><span class="si">{</span><span class="n">account</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">next_date</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">date_iter</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">balance_checks</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.example.generate_banking" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">generate_banking</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">amount_initial</span><span class="p">)</span></code>


<a href="#beancount.scripts.example.generate_banking" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Generate a checking account opening.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of entries which affect this account.</p></li>
            <li><p><strong>date_begin</strong> – A date instance, the beginning date.</p></li>
            <li><p><strong>date_end</strong> – A date instance, the end date.</p></li>
            <li><p><strong>amount_initial</strong> – A Decimal instance, the amount to initialize the checking
account with.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of directives.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/scripts/example.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">generate_banking</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">amount_initial</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a checking account opening.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of entries which affect this account.</span>
<span class="sd">      date_begin: A date instance, the beginning date.</span>
<span class="sd">      date_end: A date instance, the end date.</span>
<span class="sd">      amount_initial: A Decimal instance, the amount to initialize the checking</span>
<span class="sd">        account with.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of directives.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">amount_initial_neg</span> <span class="o">=</span> <span class="o">-</span><span class="n">amount_initial</span>
    <span class="n">new_entries</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2">      </span><span class="si">{</span><span class="n">date_begin</span><span class="si">}</span><span class="s2"> open Assets:CC:Bank1</span>
<span class="s2">        institution: &quot;Bank1_Institution&quot;</span>
<span class="s2">        address: &quot;Bank1_Address&quot;</span>
<span class="s2">        phone: &quot;Bank1_Phone&quot;</span>

<span class="s2">      </span><span class="si">{</span><span class="n">date_begin</span><span class="si">}</span><span class="s2"> open Assets:CC:Bank1:Checking    CCY</span>
<span class="s2">        account: &quot;00234-48574897&quot;</span>

<span class="s2">      ;; </span><span class="si">{</span><span class="n">date_begin</span><span class="si">}</span><span class="s2"> open Assets:CC:Bank1:Savings    CCY</span>

<span class="s2">      </span><span class="si">{</span><span class="n">date_begin</span><span class="si">}</span><span class="s2"> * &quot;Opening Balance for checking account&quot;</span>
<span class="s2">        Assets:CC:Bank1:Checking   </span><span class="si">{</span><span class="n">amount_initial</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">        Equity:Opening-Balances    </span><span class="si">{</span><span class="n">amount_initial_neg</span><span class="si">}</span><span class="s2"> CCY</span>

<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">date_balance</span> <span class="o">=</span> <span class="n">date_begin</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">account</span> <span class="o">=</span> <span class="s2">&quot;Assets:CC:Bank1:Checking&quot;</span>
    <span class="k">for</span> <span class="n">txn_posting</span><span class="p">,</span> <span class="n">balances</span> <span class="ow">in</span> <span class="n">postings_for</span><span class="p">(</span>
        <span class="n">data</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span><span class="n">entries</span> <span class="o">+</span> <span class="n">new_entries</span><span class="p">),</span> <span class="p">[</span><span class="n">account</span><span class="p">],</span> <span class="n">before</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">txn_posting</span><span class="o">.</span><span class="n">txn</span><span class="o">.</span><span class="n">date</span> <span class="o">&gt;=</span> <span class="n">date_balance</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="n">amount_balance</span> <span class="o">=</span> <span class="n">balances</span><span class="p">[</span><span class="n">account</span><span class="p">]</span><span class="o">.</span><span class="n">get_currency_units</span><span class="p">(</span><span class="s2">&quot;CCY&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">number</span>
    <span class="n">bal_entries</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2">      </span><span class="si">{</span><span class="n">date_balance</span><span class="si">}</span><span class="s2"> balance Assets:CC:Bank1:Checking   </span><span class="si">{</span><span class="n">amount_balance</span><span class="si">}</span><span class="s2"> CCY</span>

<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">new_entries</span> <span class="o">+</span> <span class="n">bal_entries</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.example.generate_banking_expenses" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">generate_banking_expenses</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">rent_amount</span><span class="p">)</span></code>


<a href="#beancount.scripts.example.generate_banking_expenses" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Generate expenses paid out of a checking account, typically living expenses.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>date_begin</strong> – The start date.</p></li>
            <li><p><strong>date_end</strong> – The end date.</p></li>
            <li><p><strong>account</strong> – The checking account to generate expenses to.</p></li>
            <li><p><strong>rent_amount</strong> – The amount of rent.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of directives.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/scripts/example.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">generate_banking_expenses</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">rent_amount</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate expenses paid out of a checking account, typically living expenses.</span>

<span class="sd">    Args:</span>
<span class="sd">      date_begin: The start date.</span>
<span class="sd">      date_end: The end date.</span>
<span class="sd">      account: The checking account to generate expenses to.</span>
<span class="sd">      rent_amount: The amount of rent.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of directives.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fee_expenses</span> <span class="o">=</span> <span class="n">generate_periodic_expenses</span><span class="p">(</span>
        <span class="n">rrule</span><span class="o">.</span><span class="n">rrule</span><span class="p">(</span><span class="n">rrule</span><span class="o">.</span><span class="n">MONTHLY</span><span class="p">,</span> <span class="n">bymonthday</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">dtstart</span><span class="o">=</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">until</span><span class="o">=</span><span class="n">date_end</span><span class="p">),</span>
        <span class="s2">&quot;BANK FEES&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Monthly bank fee&quot;</span><span class="p">,</span>
        <span class="n">account</span><span class="p">,</span>
        <span class="s2">&quot;Expenses:Financial:Fees&quot;</span><span class="p">,</span>
        <span class="k">lambda</span><span class="p">:</span> <span class="n">D</span><span class="p">(</span><span class="s2">&quot;4.00&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">rent_expenses</span> <span class="o">=</span> <span class="n">generate_periodic_expenses</span><span class="p">(</span>
        <span class="n">delay_dates</span><span class="p">(</span><span class="n">rrule</span><span class="o">.</span><span class="n">rrule</span><span class="p">(</span><span class="n">rrule</span><span class="o">.</span><span class="n">MONTHLY</span><span class="p">,</span> <span class="n">dtstart</span><span class="o">=</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">until</span><span class="o">=</span><span class="n">date_end</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
        <span class="s2">&quot;RiverBank Properties&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Paying the rent&quot;</span><span class="p">,</span>
        <span class="n">account</span><span class="p">,</span>
        <span class="s2">&quot;Expenses:Home:Rent&quot;</span><span class="p">,</span>
        <span class="k">lambda</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">normalvariate</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rent_amount</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">electricity_expenses</span> <span class="o">=</span> <span class="n">generate_periodic_expenses</span><span class="p">(</span>
        <span class="n">delay_dates</span><span class="p">(</span><span class="n">rrule</span><span class="o">.</span><span class="n">rrule</span><span class="p">(</span><span class="n">rrule</span><span class="o">.</span><span class="n">MONTHLY</span><span class="p">,</span> <span class="n">dtstart</span><span class="o">=</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">until</span><span class="o">=</span><span class="n">date_end</span><span class="p">),</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
        <span class="s2">&quot;EDISON POWER&quot;</span><span class="p">,</span>
        <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">account</span><span class="p">,</span>
        <span class="s2">&quot;Expenses:Home:Electricity&quot;</span><span class="p">,</span>
        <span class="k">lambda</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">normalvariate</span><span class="p">(</span><span class="mi">65</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">internet_expenses</span> <span class="o">=</span> <span class="n">generate_periodic_expenses</span><span class="p">(</span>
        <span class="n">delay_dates</span><span class="p">(</span><span class="n">rrule</span><span class="o">.</span><span class="n">rrule</span><span class="p">(</span><span class="n">rrule</span><span class="o">.</span><span class="n">MONTHLY</span><span class="p">,</span> <span class="n">dtstart</span><span class="o">=</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">until</span><span class="o">=</span><span class="n">date_end</span><span class="p">),</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">22</span><span class="p">),</span>
        <span class="s2">&quot;Wine-Tarner Cable&quot;</span><span class="p">,</span>
        <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">account</span><span class="p">,</span>
        <span class="s2">&quot;Expenses:Home:Internet&quot;</span><span class="p">,</span>
        <span class="k">lambda</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">normalvariate</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">phone_expenses</span> <span class="o">=</span> <span class="n">generate_periodic_expenses</span><span class="p">(</span>
        <span class="n">delay_dates</span><span class="p">(</span><span class="n">rrule</span><span class="o">.</span><span class="n">rrule</span><span class="p">(</span><span class="n">rrule</span><span class="o">.</span><span class="n">MONTHLY</span><span class="p">,</span> <span class="n">dtstart</span><span class="o">=</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">until</span><span class="o">=</span><span class="n">date_end</span><span class="p">),</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">19</span><span class="p">),</span>
        <span class="s2">&quot;Verizon Wireless&quot;</span><span class="p">,</span>
        <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">account</span><span class="p">,</span>
        <span class="s2">&quot;Expenses:Home:Phone&quot;</span><span class="p">,</span>
        <span class="k">lambda</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">normalvariate</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span>
        <span class="n">fee_expenses</span>
        <span class="o">+</span> <span class="n">rent_expenses</span>
        <span class="o">+</span> <span class="n">electricity_expenses</span>
        <span class="o">+</span> <span class="n">internet_expenses</span>
        <span class="o">+</span> <span class="n">phone_expenses</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.example.generate_clearing_entries" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">generate_clearing_entries</span><span class="p">(</span><span class="n">date_iter</span><span class="p">,</span> <span class="n">payee</span><span class="p">,</span> <span class="n">narration</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="n">account_clear</span><span class="p">,</span> <span class="n">account_from</span><span class="p">)</span></code>


<a href="#beancount.scripts.example.generate_clearing_entries" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Generate entries to clear the value of an account.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>date_iter</strong> – An iterator of datetime.date instances.</p></li>
            <li><p><strong>payee</strong> – A string, the payee name to use on the transactions.</p></li>
            <li><p><strong>narration</strong> – A string, the narration to use on the transactions.</p></li>
            <li><p><strong>entries</strong> – A list of entries.</p></li>
            <li><p><strong>account_clear</strong> – The account to clear.</p></li>
            <li><p><strong>account_from</strong> – The source account to clear 'account_clear' from.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of directives.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/scripts/example.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">generate_clearing_entries</span><span class="p">(</span>
    <span class="n">date_iter</span><span class="p">,</span> <span class="n">payee</span><span class="p">,</span> <span class="n">narration</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="n">account_clear</span><span class="p">,</span> <span class="n">account_from</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate entries to clear the value of an account.</span>

<span class="sd">    Args:</span>
<span class="sd">      date_iter: An iterator of datetime.date instances.</span>
<span class="sd">      payee: A string, the payee name to use on the transactions.</span>
<span class="sd">      narration: A string, the narration to use on the transactions.</span>
<span class="sd">      entries: A list of entries.</span>
<span class="sd">      account_clear: The account to clear.</span>
<span class="sd">      account_from: The source account to clear &#39;account_clear&#39; from.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of directives.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">new_entries</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># The next date we&#39;re looking for.</span>
    <span class="n">date_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">date_iter</span><span class="p">)</span>
    <span class="n">next_date</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">date_iter</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">next_date</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">new_entries</span>

    <span class="c1"># Iterate over all the postings of the account to clear.</span>
    <span class="k">for</span> <span class="n">txn_posting</span><span class="p">,</span> <span class="n">balances</span> <span class="ow">in</span> <span class="n">postings_for</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="p">[</span><span class="n">account_clear</span><span class="p">]):</span>
        <span class="n">balance_clear</span> <span class="o">=</span> <span class="n">balances</span><span class="p">[</span><span class="n">account_clear</span><span class="p">]</span>

        <span class="c1"># Check if we need to clear.</span>
        <span class="k">if</span> <span class="n">next_date</span> <span class="o">&lt;=</span> <span class="n">txn_posting</span><span class="o">.</span><span class="n">txn</span><span class="o">.</span><span class="n">date</span><span class="p">:</span>
            <span class="n">pos_amount</span> <span class="o">=</span> <span class="n">balance_clear</span><span class="o">.</span><span class="n">get_currency_units</span><span class="p">(</span><span class="s2">&quot;CCY&quot;</span><span class="p">)</span>
            <span class="n">neg_amount</span> <span class="o">=</span> <span class="o">-</span><span class="n">pos_amount</span>
            <span class="n">new_entries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="n">parse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">              </span><span class="si">{</span><span class="n">next_date</span><span class="si">}</span><span class="s2"> * &quot;</span><span class="si">{</span><span class="n">payee</span><span class="si">}</span><span class="s2">&quot; &quot;</span><span class="si">{</span><span class="n">narration</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="s2">                </span><span class="si">{</span><span class="n">account_clear</span><span class="si">}</span><span class="s2">     </span><span class="si">{</span><span class="n">neg_amount</span><span class="o">.</span><span class="n">number</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">                </span><span class="si">{</span><span class="n">account_from</span><span class="si">}</span><span class="s2">      </span><span class="si">{</span><span class="n">pos_amount</span><span class="o">.</span><span class="n">number</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">balance_clear</span><span class="o">.</span><span class="n">add_amount</span><span class="p">(</span><span class="n">neg_amount</span><span class="p">)</span>

            <span class="c1"># Advance to the next date we&#39;re looking for.</span>
            <span class="n">next_date</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">date_iter</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">next_date</span><span class="p">:</span>
                <span class="k">break</span>

    <span class="k">return</span> <span class="n">new_entries</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.example.generate_commodity_entries" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">generate_commodity_entries</span><span class="p">(</span><span class="n">date_birth</span><span class="p">)</span></code>


<a href="#beancount.scripts.example.generate_commodity_entries" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Create a list of Commodity entries for all the currencies we're using.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>date_birth</strong> – A datetime.date instance, the date of birth of the user.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of Commodity entries for all the commodities in use.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/scripts/example.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">generate_commodity_entries</span><span class="p">(</span><span class="n">date_birth</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a list of Commodity entries for all the currencies we&#39;re using.</span>

<span class="sd">    Args:</span>
<span class="sd">      date_birth: A datetime.date instance, the date of birth of the user.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of Commodity entries for all the commodities in use.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">parse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2">        1792-01-01 commodity USD</span>
<span class="s2">          name: &quot;US Dollar&quot;</span>
<span class="s2">          export: &quot;CASH&quot;</span>

<span class="s2">        </span><span class="si">{</span><span class="n">date_birth</span><span class="si">}</span><span class="s2"> commodity VACHR</span>
<span class="s2">          name: &quot;Employer Vacation Hours&quot;</span>
<span class="s2">          export: &quot;IGNORE&quot;</span>

<span class="s2">        </span><span class="si">{</span><span class="n">date_birth</span><span class="si">}</span><span class="s2"> commodity IRAUSD</span>
<span class="s2">          name: &quot;US 401k and IRA Contributions&quot;</span>
<span class="s2">          export: &quot;IGNORE&quot;</span>

<span class="s2">        2009-05-01 commodity RGAGX</span>
<span class="s2">          name: &quot;American Funds The Growth Fund of America Class R-6&quot;</span>
<span class="s2">          export: &quot;MUTF:RGAGX&quot;</span>
<span class="s2">          price: &quot;USD:google/MUTF:RGAGX&quot;</span>

<span class="s2">        1995-09-18 commodity VBMPX</span>
<span class="s2">          name: &quot;Vanguard Total Bond Market Index Fund Institutional Plus Shares&quot;</span>
<span class="s2">          export: &quot;MUTF:VBMPX&quot;</span>
<span class="s2">          price: &quot;USD:google/MUTF:VBMPX&quot;</span>

<span class="s2">        2004-01-20 commodity ITOT</span>
<span class="s2">          name: &quot;iShares Core S&amp;P Total U.S. Stock Market ETF&quot;</span>
<span class="s2">          export: &quot;NYSEARCA:ITOT&quot;</span>
<span class="s2">          price: &quot;USD:google/NYSEARCA:ITOT&quot;</span>

<span class="s2">        2007-07-20 commodity VEA</span>
<span class="s2">          name: &quot;Vanguard FTSE Developed Markets ETF&quot;</span>
<span class="s2">          export: &quot;NYSEARCA:VEA&quot;</span>
<span class="s2">          price: &quot;USD:google/NYSEARCA:VEA&quot;</span>

<span class="s2">        2004-01-26 commodity VHT</span>
<span class="s2">          name: &quot;Vanguard Health Care ETF&quot;</span>
<span class="s2">          export: &quot;NYSEARCA:VHT&quot;</span>
<span class="s2">          price: &quot;USD:google/NYSEARCA:VHT&quot;</span>

<span class="s2">        2004-11-01 commodity GLD</span>
<span class="s2">          name: &quot;SPDR Gold Trust (ETF)&quot;</span>
<span class="s2">          export: &quot;NYSEARCA:GLD&quot;</span>
<span class="s2">          price: &quot;USD:google/NYSEARCA:GLD&quot;</span>

<span class="s2">        1900-01-01 commodity VMMXX</span>
<span class="s2">          export: &quot;MUTF:VMMXX (MONEY:USD)&quot;</span>

<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.example.generate_employment_income" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">generate_employment_income</span><span class="p">(</span><span class="n">employer_name</span><span class="p">,</span> <span class="n">employer_address</span><span class="p">,</span> <span class="n">annual_salary</span><span class="p">,</span> <span class="n">account_deposit</span><span class="p">,</span> <span class="n">account_retirement</span><span class="p">,</span> <span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">)</span></code>


<a href="#beancount.scripts.example.generate_employment_income" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Generate bi-weekly entries for payroll salary income.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>employer_name</strong> – A string, the human-readable name of the employer.</p></li>
            <li><p><strong>employer_address</strong> – A string, the address of the employer.</p></li>
            <li><p><strong>annual_salary</strong> – A Decimal, the annual salary of the employee.</p></li>
            <li><p><strong>account_deposit</strong> – An account string, the account to deposit the salary to.</p></li>
            <li><p><strong>account_retirement</strong> – An account string, the account to deposit retirement
contributions to.</p></li>
            <li><p><strong>date_begin</strong> – The start date.</p></li>
            <li><p><strong>date_end</strong> – The end date.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of directives, including open directives for the account.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/scripts/example.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">generate_employment_income</span><span class="p">(</span>
    <span class="n">employer_name</span><span class="p">,</span>
    <span class="n">employer_address</span><span class="p">,</span>
    <span class="n">annual_salary</span><span class="p">,</span>
    <span class="n">account_deposit</span><span class="p">,</span>
    <span class="n">account_retirement</span><span class="p">,</span>
    <span class="n">date_begin</span><span class="p">,</span>
    <span class="n">date_end</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate bi-weekly entries for payroll salary income.</span>

<span class="sd">    Args:</span>
<span class="sd">      employer_name: A string, the human-readable name of the employer.</span>
<span class="sd">      employer_address: A string, the address of the employer.</span>
<span class="sd">      annual_salary: A Decimal, the annual salary of the employee.</span>
<span class="sd">      account_deposit: An account string, the account to deposit the salary to.</span>
<span class="sd">      account_retirement: An account string, the account to deposit retirement</span>
<span class="sd">        contributions to.</span>
<span class="sd">      date_begin: The start date.</span>
<span class="sd">      date_end: The end date.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of directives, including open directives for the account.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">preamble</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2">        </span><span class="si">{</span><span class="n">date_begin</span><span class="si">}</span><span class="s2"> event &quot;employer&quot; &quot;</span><span class="si">{</span><span class="n">employer_name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">employer_address</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="s2">        </span><span class="si">{</span><span class="n">date_begin</span><span class="si">}</span><span class="s2"> open Income:CC:Employer1:Salary           CCY</span>
<span class="s2">        ;</span><span class="si">{</span><span class="n">date_begin</span><span class="si">}</span><span class="s2"> open Income:CC:Employer1:AnnualBonus     CCY</span>
<span class="s2">        </span><span class="si">{</span><span class="n">date_begin</span><span class="si">}</span><span class="s2"> open Income:CC:Employer1:GroupTermLife    CCY</span>

<span class="s2">        </span><span class="si">{</span><span class="n">date_begin</span><span class="si">}</span><span class="s2"> open Income:CC:Employer1:Vacation         VACHR</span>
<span class="s2">        </span><span class="si">{</span><span class="n">date_begin</span><span class="si">}</span><span class="s2"> open Assets:CC:Employer1:Vacation         VACHR</span>
<span class="s2">        </span><span class="si">{</span><span class="n">date_begin</span><span class="si">}</span><span class="s2"> open Expenses:Vacation                    VACHR</span>

<span class="s2">        </span><span class="si">{</span><span class="n">date_begin</span><span class="si">}</span><span class="s2"> open Expenses:Health:Life:GroupTermLife</span>
<span class="s2">        </span><span class="si">{</span><span class="n">date_begin</span><span class="si">}</span><span class="s2"> open Expenses:Health:Medical:Insurance</span>
<span class="s2">        </span><span class="si">{</span><span class="n">date_begin</span><span class="si">}</span><span class="s2"> open Expenses:Health:Dental:Insurance</span>
<span class="s2">        </span><span class="si">{</span><span class="n">date_begin</span><span class="si">}</span><span class="s2"> open Expenses:Health:Vision:Insurance</span>

<span class="s2">        ;</span><span class="si">{</span><span class="n">date_begin</span><span class="si">}</span><span class="s2"> open Expenses:Vacation:Employer</span>

<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">date_prev</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">contrib_retirement</span> <span class="o">=</span> <span class="n">ZERO</span>
    <span class="n">contrib_socsec</span> <span class="o">=</span> <span class="n">ZERO</span>

    <span class="n">biweekly_pay</span> <span class="o">=</span> <span class="n">annual_salary</span> <span class="o">/</span> <span class="mi">26</span>
    <span class="n">gross</span> <span class="o">=</span> <span class="n">biweekly_pay</span>

    <span class="n">medicare</span> <span class="o">=</span> <span class="n">gross</span> <span class="o">*</span> <span class="n">D</span><span class="p">(</span><span class="s2">&quot;0.0231&quot;</span><span class="p">)</span>
    <span class="n">federal</span> <span class="o">=</span> <span class="n">gross</span> <span class="o">*</span> <span class="n">D</span><span class="p">(</span><span class="s2">&quot;0.2303&quot;</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">gross</span> <span class="o">*</span> <span class="n">D</span><span class="p">(</span><span class="s2">&quot;0.0791&quot;</span><span class="p">)</span>
    <span class="n">city</span> <span class="o">=</span> <span class="n">gross</span> <span class="o">*</span> <span class="n">D</span><span class="p">(</span><span class="s2">&quot;0.0379&quot;</span><span class="p">)</span>
    <span class="n">sdi</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="s2">&quot;1.12&quot;</span><span class="p">)</span>

    <span class="n">lifeinsurance</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="s2">&quot;24.32&quot;</span><span class="p">)</span>
    <span class="n">dental</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="s2">&quot;2.90&quot;</span><span class="p">)</span>
    <span class="n">medical</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="s2">&quot;27.38&quot;</span><span class="p">)</span>
    <span class="n">vision</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="s2">&quot;42.30&quot;</span><span class="p">)</span>

    <span class="n">fixed</span> <span class="o">=</span> <span class="n">medicare</span> <span class="o">+</span> <span class="n">federal</span> <span class="o">+</span> <span class="n">state</span> <span class="o">+</span> <span class="n">city</span> <span class="o">+</span> <span class="n">sdi</span> <span class="o">+</span> <span class="n">dental</span> <span class="o">+</span> <span class="n">medical</span> <span class="o">+</span> <span class="n">vision</span>

    <span class="c1"># Calculate vacation hours per-pay.</span>
    <span class="k">with</span> <span class="n">decimal</span><span class="o">.</span><span class="n">localcontext</span><span class="p">()</span> <span class="k">as</span> <span class="n">ctx</span><span class="p">:</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">prec</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">vacation_hrs</span> <span class="o">=</span> <span class="p">(</span><span class="n">ANNUAL_VACATION_DAYS</span> <span class="o">*</span> <span class="n">D</span><span class="p">(</span><span class="s2">&quot;8&quot;</span><span class="p">))</span> <span class="o">/</span> <span class="n">D</span><span class="p">(</span><span class="s2">&quot;26&quot;</span><span class="p">)</span>

    <span class="n">transactions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">dtime</span> <span class="ow">in</span> <span class="n">misc_utils</span><span class="o">.</span><span class="n">skipiter</span><span class="p">(</span>
        <span class="n">rrule</span><span class="o">.</span><span class="n">rrule</span><span class="p">(</span><span class="n">rrule</span><span class="o">.</span><span class="n">WEEKLY</span><span class="p">,</span> <span class="n">byweekday</span><span class="o">=</span><span class="n">rrule</span><span class="o">.</span><span class="n">TH</span><span class="p">,</span> <span class="n">dtstart</span><span class="o">=</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">until</span><span class="o">=</span><span class="n">date_end</span><span class="p">),</span> <span class="mi">2</span>
    <span class="p">):</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">dtime</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
        <span class="n">year</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">year</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">date_prev</span> <span class="ow">or</span> <span class="n">date_prev</span><span class="o">.</span><span class="n">year</span> <span class="o">!=</span> <span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="p">:</span>
            <span class="n">contrib_retirement</span> <span class="o">=</span> <span class="n">RETIREMENT_LIMITS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">RETIREMENT_LIMITS</span><span class="p">[</span><span class="kc">None</span><span class="p">])</span>
            <span class="n">contrib_socsec</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="s2">&quot;7000&quot;</span><span class="p">)</span>
        <span class="n">date_prev</span> <span class="o">=</span> <span class="n">date</span>

        <span class="n">retirement_uncapped</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">gross</span> <span class="o">*</span> <span class="n">D</span><span class="p">(</span><span class="s2">&quot;0.25&quot;</span><span class="p">))</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="n">retirement</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">contrib_retirement</span><span class="p">,</span> <span class="n">retirement_uncapped</span><span class="p">)</span>
        <span class="n">contrib_retirement</span> <span class="o">-=</span> <span class="n">retirement</span>

        <span class="n">socsec_uncapped</span> <span class="o">=</span> <span class="n">gross</span> <span class="o">*</span> <span class="n">D</span><span class="p">(</span><span class="s2">&quot;0.0610&quot;</span><span class="p">)</span>
        <span class="n">socsec</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">contrib_socsec</span><span class="p">,</span> <span class="n">socsec_uncapped</span><span class="p">)</span>
        <span class="n">contrib_socsec</span> <span class="o">-=</span> <span class="n">socsec</span>

        <span class="k">with</span> <span class="n">decimal</span><span class="o">.</span><span class="n">localcontext</span><span class="p">()</span> <span class="k">as</span> <span class="n">ctx</span><span class="p">:</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">prec</span> <span class="o">=</span> <span class="mi">6</span>
            <span class="n">deposit</span> <span class="o">=</span> <span class="n">gross</span> <span class="o">-</span> <span class="n">retirement</span> <span class="o">-</span> <span class="n">fixed</span> <span class="o">-</span> <span class="n">socsec</span>

        <span class="n">retirement_neg</span> <span class="o">=</span> <span class="o">-</span><span class="n">retirement</span>
        <span class="n">gross_neg</span> <span class="o">=</span> <span class="o">-</span><span class="n">gross</span>
        <span class="n">lifeinsurance_neg</span> <span class="o">=</span> <span class="o">-</span><span class="n">lifeinsurance</span>
        <span class="n">vacation_hrs_neg</span> <span class="o">=</span> <span class="o">-</span><span class="n">vacation_hrs</span>

        <span class="n">transactions</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="n">parse</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            </span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s2"> * &quot;</span><span class="si">{</span><span class="n">employer_name</span><span class="si">}</span><span class="s2">&quot; &quot;Payroll&quot;</span>
<span class="s2">              </span><span class="si">{</span><span class="n">account_deposit</span><span class="si">}</span><span class="s2">                                 </span><span class="si">{</span><span class="n">deposit</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">              &quot;&quot;&quot;</span>
                <span class="o">+</span> <span class="p">(</span>
                    <span class="s2">&quot;&quot;</span>
                    <span class="k">if</span> <span class="n">retirement</span> <span class="o">==</span> <span class="n">ZERO</span>
                    <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">              </span><span class="si">{</span><span class="n">account_retirement</span><span class="si">}</span><span class="s2">                              </span><span class="si">{</span><span class="n">retirement</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">              Assets:CC:Federal:PreTax401k                      </span><span class="si">{</span><span class="n">retirement_neg</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> DEFCCY</span>
<span class="s2">              Expenses:Taxes:Y</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">:CC:Federal:PreTax401k      </span><span class="si">{</span><span class="n">retirement</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> DEFCCY</span>
<span class="s2">              &quot;&quot;&quot;</span>
                <span class="p">)</span>
                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">              Income:CC:Employer1:Salary                        </span><span class="si">{</span><span class="n">gross_neg</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">              Income:CC:Employer1:GroupTermLife                 </span><span class="si">{</span><span class="n">lifeinsurance_neg</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">              Expenses:Health:Life:GroupTermLife                </span><span class="si">{</span><span class="n">lifeinsurance</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">              Expenses:Health:Dental:Insurance                  </span><span class="si">{</span><span class="n">dental</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">              Expenses:Health:Medical:Insurance                 </span><span class="si">{</span><span class="n">medical</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">              Expenses:Health:Vision:Insurance                  </span><span class="si">{</span><span class="n">vision</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">              Expenses:Taxes:Y</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">:CC:Medicare                </span><span class="si">{</span><span class="n">medicare</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">              Expenses:Taxes:Y</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">:CC:Federal                 </span><span class="si">{</span><span class="n">federal</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">              Expenses:Taxes:Y</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">:CC:State                   </span><span class="si">{</span><span class="n">state</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">              Expenses:Taxes:Y</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">:CC:CityNYC                 </span><span class="si">{</span><span class="n">city</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">              Expenses:Taxes:Y</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">:CC:SDI                     </span><span class="si">{</span><span class="n">sdi</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">              Expenses:Taxes:Y</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">:CC:SocSec                  </span><span class="si">{</span><span class="n">socsec</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">              Assets:CC:Employer1:Vacation                      </span><span class="si">{</span><span class="n">vacation_hrs</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> VACHR</span>
<span class="s2">              Income:CC:Employer1:Vacation                      </span><span class="si">{</span><span class="n">vacation_hrs_neg</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> VACHR</span>
<span class="s2">        &quot;&quot;&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">preamble</span> <span class="o">+</span> <span class="n">transactions</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.example.generate_expense_accounts" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">generate_expense_accounts</span><span class="p">(</span><span class="n">date_birth</span><span class="p">)</span></code>


<a href="#beancount.scripts.example.generate_expense_accounts" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Generate directives for expense accounts.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>date_birth</strong> – Birth date of the character.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of directives.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/scripts/example.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">generate_expense_accounts</span><span class="p">(</span><span class="n">date_birth</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate directives for expense accounts.</span>

<span class="sd">    Args:</span>
<span class="sd">      date_birth: Birth date of the character.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of directives.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">parse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2">      </span><span class="si">{</span><span class="n">date_birth</span><span class="si">}</span><span class="s2"> open Expenses:Food:Groceries</span>
<span class="s2">      </span><span class="si">{</span><span class="n">date_birth</span><span class="si">}</span><span class="s2"> open Expenses:Food:Restaurant</span>
<span class="s2">      </span><span class="si">{</span><span class="n">date_birth</span><span class="si">}</span><span class="s2"> open Expenses:Food:Coffee</span>
<span class="s2">      </span><span class="si">{</span><span class="n">date_birth</span><span class="si">}</span><span class="s2"> open Expenses:Food:Alcohol</span>

<span class="s2">      </span><span class="si">{</span><span class="n">date_birth</span><span class="si">}</span><span class="s2"> open Expenses:Transport:Tram</span>

<span class="s2">      </span><span class="si">{</span><span class="n">date_birth</span><span class="si">}</span><span class="s2"> open Expenses:Home:Rent</span>
<span class="s2">      </span><span class="si">{</span><span class="n">date_birth</span><span class="si">}</span><span class="s2"> open Expenses:Home:Electricity</span>
<span class="s2">      </span><span class="si">{</span><span class="n">date_birth</span><span class="si">}</span><span class="s2"> open Expenses:Home:Internet</span>
<span class="s2">      </span><span class="si">{</span><span class="n">date_birth</span><span class="si">}</span><span class="s2"> open Expenses:Home:Phone</span>

<span class="s2">      </span><span class="si">{</span><span class="n">date_birth</span><span class="si">}</span><span class="s2"> open Expenses:Financial:Fees</span>
<span class="s2">      </span><span class="si">{</span><span class="n">date_birth</span><span class="si">}</span><span class="s2"> open Expenses:Financial:Commissions</span>

<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.example.generate_open_entries" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">generate_open_entries</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">accounts</span><span class="p">,</span> <span class="n">currency</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#beancount.scripts.example.generate_open_entries" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Generate a list of Open entries for the given accounts:</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>date</strong> – A datetime.date instance for the open entries.</p></li>
            <li><p><strong>accounts</strong> – A list of account strings.</p></li>
            <li><p><strong>currency</strong> – An optional currency constraint.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of Open directives.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/scripts/example.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">generate_open_entries</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">accounts</span><span class="p">,</span> <span class="n">currency</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a list of Open entries for the given accounts:</span>

<span class="sd">    Args:</span>
<span class="sd">      date: A datetime.date instance for the open entries.</span>
<span class="sd">      accounts: A list of account strings.</span>
<span class="sd">      currency: An optional currency constraint.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of Open directives.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">accounts</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">parse</span><span class="p">(</span>
        <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{date}</span><span class="s2"> open </span><span class="si">{account}</span><span class="s2"> </span><span class="si">{currency}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="o">=</span><span class="n">account</span><span class="p">,</span> <span class="n">currency</span><span class="o">=</span><span class="n">currency</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">account</span> <span class="ow">in</span> <span class="n">accounts</span>
        <span class="p">)</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.example.generate_outgoing_transfers" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">generate_outgoing_transfers</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">account_out</span><span class="p">,</span> <span class="n">transfer_minimum</span><span class="p">,</span> <span class="n">transfer_threshold</span><span class="p">,</span> <span class="n">transfer_increment</span><span class="p">)</span></code>


<a href="#beancount.scripts.example.generate_outgoing_transfers" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Generate transfers of accumulated funds out of an account.</p>
<p>This monitors the balance of an account and when it is beyond a threshold,
generate out transfers form that account to another account.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of existing entries that affect this account so far.
The generated entries will also affect this account.</p></li>
            <li><p><strong>account</strong> – An account string, the account to monitor.</p></li>
            <li><p><strong>account_out</strong> – An account string, the savings account to make transfers to.</p></li>
            <li><p><strong>transfer_minimum</strong> – The minimum amount of funds to always leave in this account
after a transfer.</p></li>
            <li><p><strong>transfer_threshold</strong> – The minimum amount of funds to be able to transfer out without
breaking the minimum.</p></li>
            <li><p><strong>transfer_increment</strong> – A Decimal, the increment to round transfers to.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of new directives, the transfers to add to the given account.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/scripts/example.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">generate_outgoing_transfers</span><span class="p">(</span>
    <span class="n">entries</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">account_out</span><span class="p">,</span> <span class="n">transfer_minimum</span><span class="p">,</span> <span class="n">transfer_threshold</span><span class="p">,</span> <span class="n">transfer_increment</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate transfers of accumulated funds out of an account.</span>

<span class="sd">    This monitors the balance of an account and when it is beyond a threshold,</span>
<span class="sd">    generate out transfers form that account to another account.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of existing entries that affect this account so far.</span>
<span class="sd">        The generated entries will also affect this account.</span>
<span class="sd">      account: An account string, the account to monitor.</span>
<span class="sd">      account_out: An account string, the savings account to make transfers to.</span>
<span class="sd">      transfer_minimum: The minimum amount of funds to always leave in this account</span>
<span class="sd">        after a transfer.</span>
<span class="sd">      transfer_threshold: The minimum amount of funds to be able to transfer out without</span>
<span class="sd">        breaking the minimum.</span>
<span class="sd">      transfer_increment: A Decimal, the increment to round transfers to.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of new directives, the transfers to add to the given account.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">last_date</span> <span class="o">=</span> <span class="n">entries</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">date</span>

    <span class="c1"># Reverse the balance amounts taking into account the minimum balance for</span>
    <span class="c1"># all time in the future.</span>
    <span class="n">amounts</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">balances</span><span class="p">[</span><span class="n">account</span><span class="p">]</span><span class="o">.</span><span class="n">get_currency_units</span><span class="p">(</span><span class="s2">&quot;CCY&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">txn_posting</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">txn_posting</span><span class="p">,</span> <span class="n">balances</span> <span class="ow">in</span> <span class="n">postings_for</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="p">[</span><span class="n">account</span><span class="p">])</span>
    <span class="p">]</span>
    <span class="n">reversed_amounts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">last_amount</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">amounts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">current_amount</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">amounts</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">current_amount</span> <span class="o">&lt;</span> <span class="n">last_amount</span><span class="p">:</span>
            <span class="n">reversed_amounts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_amount</span><span class="p">)</span>
            <span class="n">last_amount</span> <span class="o">=</span> <span class="n">current_amount</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">reversed_amounts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">last_amount</span><span class="p">)</span>
    <span class="n">capped_amounts</span> <span class="o">=</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">reversed_amounts</span><span class="p">)</span>

    <span class="c1"># Create transfers outward where the future allows it.</span>
    <span class="n">new_entries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">offset_amount</span> <span class="o">=</span> <span class="n">ZERO</span>
    <span class="k">for</span> <span class="n">current_amount</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">txn_posting</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">capped_amounts</span><span class="p">,</span> <span class="n">amounts</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">txn_posting</span><span class="o">.</span><span class="n">txn</span><span class="o">.</span><span class="n">date</span> <span class="o">&gt;=</span> <span class="n">last_date</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="n">adjusted_amount</span> <span class="o">=</span> <span class="n">current_amount</span> <span class="o">-</span> <span class="n">offset_amount</span>
        <span class="k">if</span> <span class="n">adjusted_amount</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">transfer_minimum</span> <span class="o">+</span> <span class="n">transfer_threshold</span><span class="p">):</span>
            <span class="n">amount_transfer</span> <span class="o">=</span> <span class="n">round_to</span><span class="p">(</span>
                <span class="n">adjusted_amount</span> <span class="o">-</span> <span class="n">transfer_minimum</span><span class="p">,</span> <span class="n">transfer_increment</span>
            <span class="p">)</span>

            <span class="n">date</span> <span class="o">=</span> <span class="n">txn_posting</span><span class="o">.</span><span class="n">txn</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">amount_transfer_neg</span> <span class="o">=</span> <span class="o">-</span><span class="n">amount_transfer</span>
            <span class="n">new_entries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="n">parse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">              </span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s2"> * &quot;Transfering accumulated savings to other account&quot;</span>
<span class="s2">                </span><span class="si">{</span><span class="n">account</span><span class="si">}</span><span class="s2">          </span><span class="si">{</span><span class="n">amount_transfer_neg</span><span class="si">:</span><span class="s2">2f</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">                </span><span class="si">{</span><span class="n">account_out</span><span class="si">}</span><span class="s2">      </span><span class="si">{</span><span class="n">amount_transfer</span><span class="si">:</span><span class="s2">2f</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">offset_amount</span> <span class="o">+=</span> <span class="n">amount_transfer</span>

    <span class="k">return</span> <span class="n">new_entries</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.example.generate_periodic_expenses" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">generate_periodic_expenses</span><span class="p">(</span><span class="n">date_iter</span><span class="p">,</span> <span class="n">payee</span><span class="p">,</span> <span class="n">narration</span><span class="p">,</span> <span class="n">account_from</span><span class="p">,</span> <span class="n">account_to</span><span class="p">,</span> <span class="n">amount_generator</span><span class="p">)</span></code>


<a href="#beancount.scripts.example.generate_periodic_expenses" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Generate periodic expense transactions.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>date_iter</strong> – An iterator for dates or datetimes.</p></li>
            <li><p><strong>payee</strong> – A string, the payee name to use on the transactions, or a set of such strings
to randomly choose from</p></li>
            <li><p><strong>narration</strong> – A string, the narration to use on the transactions.</p></li>
            <li><p><strong>account_from</strong> – An account string the debited account.</p></li>
            <li><p><strong>account_to</strong> – An account string the credited account.</p></li>
            <li><p><strong>amount_generator</strong> – A callable object to generate variates.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of directives.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/scripts/example.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">generate_periodic_expenses</span><span class="p">(</span>
    <span class="n">date_iter</span><span class="p">,</span> <span class="n">payee</span><span class="p">,</span> <span class="n">narration</span><span class="p">,</span> <span class="n">account_from</span><span class="p">,</span> <span class="n">account_to</span><span class="p">,</span> <span class="n">amount_generator</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate periodic expense transactions.</span>

<span class="sd">    Args:</span>
<span class="sd">      date_iter: An iterator for dates or datetimes.</span>
<span class="sd">      payee: A string, the payee name to use on the transactions, or a set of such strings</span>
<span class="sd">        to randomly choose from</span>
<span class="sd">      narration: A string, the narration to use on the transactions.</span>
<span class="sd">      account_from: An account string the debited account.</span>
<span class="sd">      account_to: An account string the credited account.</span>
<span class="sd">      amount_generator: A callable object to generate variates.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of directives.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">new_entries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">dtime</span> <span class="ow">in</span> <span class="n">date_iter</span><span class="p">:</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">dtime</span><span class="o">.</span><span class="n">date</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtime</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span> <span class="k">else</span> <span class="n">dtime</span>
        <span class="n">amount</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="n">amount_generator</span><span class="p">())</span>
        <span class="n">txn_payee</span> <span class="o">=</span> <span class="n">payee</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">payee</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">payee</span><span class="p">)</span>
        <span class="n">txn_narration</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">narration</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">narration</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">narration</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">amount_neg</span> <span class="o">=</span> <span class="o">-</span><span class="n">amount</span>
        <span class="n">new_entries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="n">parse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">          </span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s2"> * &quot;</span><span class="si">{</span><span class="n">txn_payee</span><span class="si">}</span><span class="s2">&quot; &quot;</span><span class="si">{</span><span class="n">txn_narration</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="s2">            </span><span class="si">{</span><span class="n">account_from</span><span class="si">}</span><span class="s2">    </span><span class="si">{</span><span class="n">amount_neg</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">            </span><span class="si">{</span><span class="n">account_to</span><span class="si">}</span><span class="s2">      </span><span class="si">{</span><span class="n">amount</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">new_entries</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.example.generate_prices" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">generate_prices</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">currencies</span><span class="p">,</span> <span class="n">cost_currency</span><span class="p">)</span></code>


<a href="#beancount.scripts.example.generate_prices" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Generate weekly or monthly price entries for the given currencies.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>date_begin</strong> – The start date.</p></li>
            <li><p><strong>date_end</strong> – The end date.</p></li>
            <li><p><strong>currencies</strong> – A list of currency strings to generate prices for.</p></li>
            <li><p><strong>cost_currency</strong> – A string, the cost currency.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of Price directives.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/scripts/example.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">generate_prices</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">currencies</span><span class="p">,</span> <span class="n">cost_currency</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate weekly or monthly price entries for the given currencies.</span>

<span class="sd">    Args:</span>
<span class="sd">      date_begin: The start date.</span>
<span class="sd">      date_end: The end date.</span>
<span class="sd">      currencies: A list of currency strings to generate prices for.</span>
<span class="sd">      cost_currency: A string, the cost currency.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of Price directives.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">digits</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="s2">&quot;0.01&quot;</span><span class="p">)</span>
    <span class="n">entries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">currency</span> <span class="ow">in</span> <span class="n">currencies</span><span class="p">:</span>
        <span class="n">start_price</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">growth</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.13</span><span class="p">)</span>  <span class="c1"># %/year</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">growth</span> <span class="o">*</span> <span class="p">(</span><span class="mi">7</span> <span class="o">/</span> <span class="mi">365</span><span class="p">)</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">)</span>  <span class="c1"># Vol</span>

        <span class="k">for</span> <span class="n">dtime</span><span class="p">,</span> <span class="n">price_float</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
            <span class="n">rrule</span><span class="o">.</span><span class="n">rrule</span><span class="p">(</span>
                <span class="n">rrule</span><span class="o">.</span><span class="n">WEEKLY</span><span class="p">,</span> <span class="n">byweekday</span><span class="o">=</span><span class="n">rrule</span><span class="o">.</span><span class="n">FR</span><span class="p">,</span> <span class="n">dtstart</span><span class="o">=</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">until</span><span class="o">=</span><span class="n">date_end</span>
            <span class="p">),</span>
            <span class="n">price_series</span><span class="p">(</span><span class="n">start_price</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="n">price</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="n">price_float</span><span class="p">)</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">digits</span><span class="p">)</span>
            <span class="n">meta</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">new_metadata</span><span class="p">(</span><span class="n">generate_prices</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="nb">next</span><span class="p">(</span><span class="n">counter</span><span class="p">))</span>
            <span class="n">entry</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Price</span><span class="p">(</span>
                <span class="n">meta</span><span class="p">,</span> <span class="n">dtime</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span> <span class="n">currency</span><span class="p">,</span> <span class="n">amount</span><span class="o">.</span><span class="n">Amount</span><span class="p">(</span><span class="n">price</span><span class="p">,</span> <span class="n">cost_currency</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">entries</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.example.generate_regular_credit_expenses" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">generate_regular_credit_expenses</span><span class="p">(</span><span class="n">date_birth</span><span class="p">,</span> <span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">account_credit</span><span class="p">,</span> <span class="n">account_checking</span><span class="p">)</span></code>


<a href="#beancount.scripts.example.generate_regular_credit_expenses" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Generate expenses paid out of a credit card account, including payments to the
credit card.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>date_birth</strong> – The user's birth date.</p></li>
            <li><p><strong>date_begin</strong> – The start date.</p></li>
            <li><p><strong>date_end</strong> – The end date.</p></li>
            <li><p><strong>account_credit</strong> – The credit card account to generate expenses against.</p></li>
            <li><p><strong>account_checking</strong> – The checking account to generate payments from.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of directives.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/scripts/example.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">generate_regular_credit_expenses</span><span class="p">(</span>
    <span class="n">date_birth</span><span class="p">,</span> <span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">account_credit</span><span class="p">,</span> <span class="n">account_checking</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate expenses paid out of a credit card account, including payments to the</span>
<span class="sd">    credit card.</span>

<span class="sd">    Args:</span>
<span class="sd">      date_birth: The user&#39;s birth date.</span>
<span class="sd">      date_begin: The start date.</span>
<span class="sd">      date_end: The end date.</span>
<span class="sd">      account_credit: The credit card account to generate expenses against.</span>
<span class="sd">      account_checking: The checking account to generate payments from.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of directives.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">restaurant_expenses</span> <span class="o">=</span> <span class="n">generate_periodic_expenses</span><span class="p">(</span>
        <span class="n">date_random_seq</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
        <span class="n">RESTAURANT_NAMES</span><span class="p">,</span>
        <span class="n">RESTAURANT_NARRATIONS</span><span class="p">,</span>
        <span class="n">account_credit</span><span class="p">,</span>
        <span class="s2">&quot;Expenses:Food:Restaurant&quot;</span><span class="p">,</span>
        <span class="k">lambda</span><span class="p">:</span> <span class="nb">min</span><span class="p">(</span>
            <span class="n">random</span><span class="o">.</span><span class="n">lognormvariate</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)),</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">220</span><span class="p">)</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="n">groceries_expenses</span> <span class="o">=</span> <span class="n">generate_periodic_expenses</span><span class="p">(</span>
        <span class="n">date_random_seq</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
        <span class="n">GROCERIES_NAMES</span><span class="p">,</span>
        <span class="s2">&quot;Buying groceries&quot;</span><span class="p">,</span>
        <span class="n">account_credit</span><span class="p">,</span>
        <span class="s2">&quot;Expenses:Food:Groceries&quot;</span><span class="p">,</span>
        <span class="k">lambda</span><span class="p">:</span> <span class="nb">min</span><span class="p">(</span>
            <span class="n">random</span><span class="o">.</span><span class="n">lognormvariate</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">80</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">1.3</span><span class="p">)),</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="n">subway_expenses</span> <span class="o">=</span> <span class="n">generate_periodic_expenses</span><span class="p">(</span>
        <span class="n">date_random_seq</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">33</span><span class="p">),</span>
        <span class="s2">&quot;Metro Transport Authority&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Tram tickets&quot;</span><span class="p">,</span>
        <span class="n">account_credit</span><span class="p">,</span>
        <span class="s2">&quot;Expenses:Transport:Tram&quot;</span><span class="p">,</span>
        <span class="k">lambda</span><span class="p">:</span> <span class="n">D</span><span class="p">(</span><span class="s2">&quot;120.00&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">credit_expenses</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span>
        <span class="n">restaurant_expenses</span> <span class="o">+</span> <span class="n">groceries_expenses</span> <span class="o">+</span> <span class="n">subway_expenses</span>
    <span class="p">)</span>

    <span class="c1"># Entries to open accounts.</span>
    <span class="n">credit_preamble</span> <span class="o">=</span> <span class="n">generate_open_entries</span><span class="p">(</span><span class="n">date_birth</span><span class="p">,</span> <span class="p">[</span><span class="n">account_credit</span><span class="p">],</span> <span class="s2">&quot;CCY&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span><span class="n">credit_preamble</span> <span class="o">+</span> <span class="n">credit_expenses</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.example.generate_retirement_employer_match" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">generate_retirement_employer_match</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">account_invest</span><span class="p">,</span> <span class="n">account_income</span><span class="p">)</span></code>


<a href="#beancount.scripts.example.generate_retirement_employer_match" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Generate employer matching contributions into a retirement account.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives that cover the retirement account.</p></li>
            <li><p><strong>account_invest</strong> – The name of the retirement cash account.</p></li>
            <li><p><strong>account_income</strong> – The name of the income account.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of new entries generated for employer contributions.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/scripts/example.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">generate_retirement_employer_match</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">account_invest</span><span class="p">,</span> <span class="n">account_income</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate employer matching contributions into a retirement account.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives that cover the retirement account.</span>
<span class="sd">      account_invest: The name of the retirement cash account.</span>
<span class="sd">      account_income: The name of the income account.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of new entries generated for employer contributions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">match_frac</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="s2">&quot;0.50&quot;</span><span class="p">)</span>

    <span class="n">new_entries</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2">      </span><span class="si">{</span><span class="n">entries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s2"> open </span><span class="si">{</span><span class="n">account_income</span><span class="si">}</span><span class="s2">   CCY</span>

<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">txn_posting</span><span class="p">,</span> <span class="n">balances</span> <span class="ow">in</span> <span class="n">postings_for</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="p">[</span><span class="n">account_invest</span><span class="p">]):</span>
        <span class="n">amount</span> <span class="o">=</span> <span class="n">txn_posting</span><span class="o">.</span><span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="o">*</span> <span class="n">match_frac</span>
        <span class="n">amount_neg</span> <span class="o">=</span> <span class="o">-</span><span class="n">amount</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">txn_posting</span><span class="o">.</span><span class="n">txn</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">ONE_DAY</span>
        <span class="n">new_entries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="n">parse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2">          </span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s2"> * &quot;Employer match for contribution&quot;</span>
<span class="s2">            </span><span class="si">{</span><span class="n">account_invest</span><span class="si">}</span><span class="s2">         </span><span class="si">{</span><span class="n">amount</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">            </span><span class="si">{</span><span class="n">account_income</span><span class="si">}</span><span class="s2">         </span><span class="si">{</span><span class="n">amount_neg</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> CCY</span>

<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">new_entries</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.example.generate_retirement_investments" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">generate_retirement_investments</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">commodities_items</span><span class="p">,</span> <span class="n">price_map</span><span class="p">)</span></code>


<a href="#beancount.scripts.example.generate_retirement_investments" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Invest money deposited to the given retirement account.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives</p></li>
            <li><p><strong>account</strong> – The root account for all retirement investment sub-accounts.</p></li>
            <li><p><strong>commodities_items</strong> – A list of (commodity, fraction to be invested in) items.</p></li>
            <li><p><strong>price_map</strong> – A dict of prices, as per beancount.core.prices.build_price_map().</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of new directives for the given investments. This also generates account
opening directives for the desired investment commodities.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/scripts/example.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">generate_retirement_investments</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">commodities_items</span><span class="p">,</span> <span class="n">price_map</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Invest money deposited to the given retirement account.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives</span>
<span class="sd">      account: The root account for all retirement investment sub-accounts.</span>
<span class="sd">      commodities_items: A list of (commodity, fraction to be invested in) items.</span>
<span class="sd">      price_map: A dict of prices, as per beancount.core.prices.build_price_map().</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of new directives for the given investments. This also generates account</span>
<span class="sd">      opening directives for the desired investment commodities.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">open_entries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">account_cash</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="s2">&quot;Cash&quot;</span><span class="p">)</span>
    <span class="n">date_origin</span> <span class="o">=</span> <span class="n">entries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">date</span>
    <span class="n">open_entries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
        <span class="n">parse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2">      </span><span class="si">{</span><span class="n">date_origin</span><span class="si">}</span><span class="s2"> open </span><span class="si">{</span><span class="n">account</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">        institution: &quot;Retirement_Institution&quot;</span>
<span class="s2">        address: &quot;Retirement_Address&quot;</span>
<span class="s2">        phone: &quot;Retirement_Phone&quot;</span>

<span class="s2">      </span><span class="si">{</span><span class="n">date_origin</span><span class="si">}</span><span class="s2"> open </span><span class="si">{</span><span class="n">account_cash</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">        number: &quot;882882&quot;</span>

<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">currency</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">commodities_items</span><span class="p">:</span>
        <span class="n">open_entries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="n">parse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">          </span><span class="si">{</span><span class="n">date_origin</span><span class="si">}</span><span class="s2"> open </span><span class="si">{</span><span class="n">account</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">currency</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">currency</span><span class="si">}</span>
<span class="s2">            number: &quot;882882&quot;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="n">new_entries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">txn_posting</span><span class="p">,</span> <span class="n">balances</span> <span class="ow">in</span> <span class="n">postings_for</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="p">[</span><span class="n">account_cash</span><span class="p">]):</span>
        <span class="n">balance</span> <span class="o">=</span> <span class="n">balances</span><span class="p">[</span><span class="n">account_cash</span><span class="p">]</span>
        <span class="n">amount_to_invest</span> <span class="o">=</span> <span class="n">balance</span><span class="o">.</span><span class="n">get_currency_units</span><span class="p">(</span><span class="s2">&quot;CCY&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">number</span>

        <span class="c1"># Find the date the following Monday, the date to invest.</span>
        <span class="n">txn_date</span> <span class="o">=</span> <span class="n">txn_posting</span><span class="o">.</span><span class="n">txn</span><span class="o">.</span><span class="n">date</span>
        <span class="k">while</span> <span class="n">txn_date</span><span class="o">.</span><span class="n">weekday</span><span class="p">()</span> <span class="o">!=</span> <span class="n">calendar</span><span class="o">.</span><span class="n">MONDAY</span><span class="p">:</span>
            <span class="n">txn_date</span> <span class="o">+=</span> <span class="n">ONE_DAY</span>

        <span class="k">for</span> <span class="n">commodity</span><span class="p">,</span> <span class="n">fraction</span> <span class="ow">in</span> <span class="n">commodities_items</span><span class="p">:</span>
            <span class="n">amount_fraction</span> <span class="o">=</span> <span class="n">amount_to_invest</span> <span class="o">*</span> <span class="n">D</span><span class="p">(</span><span class="n">fraction</span><span class="p">)</span>

            <span class="c1"># Find the price at that date.</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">price</span> <span class="o">=</span> <span class="n">prices</span><span class="o">.</span><span class="n">get_price</span><span class="p">(</span><span class="n">price_map</span><span class="p">,</span> <span class="p">(</span><span class="n">commodity</span><span class="p">,</span> <span class="s2">&quot;CCY&quot;</span><span class="p">),</span> <span class="n">txn_date</span><span class="p">)</span>
            <span class="n">units</span> <span class="o">=</span> <span class="p">(</span><span class="n">amount_fraction</span> <span class="o">/</span> <span class="n">price</span><span class="p">)</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">D</span><span class="p">(</span><span class="s2">&quot;0.001&quot;</span><span class="p">))</span>
            <span class="n">amount_cash</span> <span class="o">=</span> <span class="p">(</span><span class="n">units</span> <span class="o">*</span> <span class="n">price</span><span class="p">)</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">D</span><span class="p">(</span><span class="s2">&quot;0.01&quot;</span><span class="p">))</span>
            <span class="n">amount_cash_neg</span> <span class="o">=</span> <span class="o">-</span><span class="n">amount_cash</span>
            <span class="n">new_entries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="n">parse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2">              </span><span class="si">{</span><span class="n">txn_date</span><span class="si">}</span><span class="s2"> * &quot;Investing </span><span class="si">{</span><span class="n">fraction</span><span class="si">:</span><span class="s2">.0%</span><span class="si">}</span><span class="s2"> of cash in </span><span class="si">{</span><span class="n">commodity</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="s2">                </span><span class="si">{</span><span class="n">account</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">commodity</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">units</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">commodity</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="si">{</span><span class="n">price</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> CCY</span><span class="se">}}</span>
<span class="s2">                </span><span class="si">{</span><span class="n">account</span><span class="si">}</span><span class="s2">:Cash         </span><span class="si">{</span><span class="n">amount_cash_neg</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> CCY</span>

<span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">balance</span><span class="o">.</span><span class="n">add_amount</span><span class="p">(</span><span class="n">amount</span><span class="o">.</span><span class="n">Amount</span><span class="p">(</span><span class="o">-</span><span class="n">amount_cash</span><span class="p">,</span> <span class="s2">&quot;CCY&quot;</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span><span class="n">open_entries</span> <span class="o">+</span> <span class="n">new_entries</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.example.generate_tax_accounts" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">generate_tax_accounts</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">date_max</span><span class="p">)</span></code>


<a href="#beancount.scripts.example.generate_tax_accounts" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Generate accounts and contribution directives for a particular tax year.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>year</strong> – An integer, the year we're to generate this for.</p></li>
            <li><p><strong>date_max</strong> – The maximum date to produce an entry for.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of directives.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/scripts/example.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">generate_tax_accounts</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">date_max</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate accounts and contribution directives for a particular tax year.</span>

<span class="sd">    Args:</span>
<span class="sd">      year: An integer, the year we&#39;re to generate this for.</span>
<span class="sd">      date_max: The maximum date to produce an entry for.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of directives.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">date_year</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">date_filing</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">year</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span>
        <span class="n">days</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">date_federal</span> <span class="o">=</span> <span class="n">date_filing</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">date_state</span> <span class="o">=</span> <span class="n">date_filing</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

    <span class="n">quantum</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="s2">&quot;0.01&quot;</span><span class="p">)</span>
    <span class="n">amount_federal</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">normalvariate</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">120</span><span class="p">),</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">quantum</span><span class="p">)</span>
    <span class="n">amount_federal_neg</span> <span class="o">=</span> <span class="o">-</span><span class="n">amount_federal</span>
    <span class="n">amount_state</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">normalvariate</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">10</span><span class="p">))</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">quantum</span><span class="p">)</span>
    <span class="n">amount_state_neg</span> <span class="o">=</span> <span class="o">-</span><span class="n">amount_state</span>
    <span class="n">amount_payable</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">amount_federal</span> <span class="o">+</span> <span class="n">amount_state</span><span class="p">)</span>

    <span class="n">amount_limit</span> <span class="o">=</span> <span class="n">RETIREMENT_LIMITS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">RETIREMENT_LIMITS</span><span class="p">[</span><span class="kc">None</span><span class="p">])</span>
    <span class="n">amount_limit_neg</span> <span class="o">=</span> <span class="o">-</span><span class="n">amount_limit</span>

    <span class="n">entries</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2">      ;; Open tax accounts for that year.</span>
<span class="s2">      </span><span class="si">{</span><span class="n">date_year</span><span class="si">}</span><span class="s2"> open Expenses:Taxes:Y</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">:CC:Federal:PreTax401k   DEFCCY</span>
<span class="s2">      </span><span class="si">{</span><span class="n">date_year</span><span class="si">}</span><span class="s2"> open Expenses:Taxes:Y</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">:CC:Medicare             CCY</span>
<span class="s2">      </span><span class="si">{</span><span class="n">date_year</span><span class="si">}</span><span class="s2"> open Expenses:Taxes:Y</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">:CC:Federal              CCY</span>
<span class="s2">      </span><span class="si">{</span><span class="n">date_year</span><span class="si">}</span><span class="s2"> open Expenses:Taxes:Y</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">:CC:CityNYC              CCY</span>
<span class="s2">      </span><span class="si">{</span><span class="n">date_year</span><span class="si">}</span><span class="s2"> open Expenses:Taxes:Y</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">:CC:SDI                  CCY</span>
<span class="s2">      </span><span class="si">{</span><span class="n">date_year</span><span class="si">}</span><span class="s2"> open Expenses:Taxes:Y</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">:CC:State                CCY</span>
<span class="s2">      </span><span class="si">{</span><span class="n">date_year</span><span class="si">}</span><span class="s2"> open Expenses:Taxes:Y</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">:CC:SocSec               CCY</span>

<span class="s2">      ;; Check that the tax amounts have been fully used.</span>
<span class="s2">      </span><span class="si">{</span><span class="n">date_year</span><span class="si">}</span><span class="s2"> balance Assets:CC:Federal:PreTax401k  0 DEFCCY</span>

<span class="s2">      </span><span class="si">{</span><span class="n">date_year</span><span class="si">}</span><span class="s2"> * &quot;Allowed contributions for one year&quot;</span>
<span class="s2">        Income:CC:Federal:PreTax401k     </span><span class="si">{</span><span class="n">amount_limit_neg</span><span class="si">}</span><span class="s2"> DEFCCY</span>
<span class="s2">        Assets:CC:Federal:PreTax401k     </span><span class="si">{</span><span class="n">amount_limit</span><span class="si">}</span><span class="s2"> DEFCCY</span>

<span class="s2">      </span><span class="si">{</span><span class="n">date_filing</span><span class="si">}</span><span class="s2"> * &quot;Filing taxes for </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="s2">        Expenses:Taxes:Y</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">:CC:Federal      </span><span class="si">{</span><span class="n">amount_federal</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">        Expenses:Taxes:Y</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">:CC:State        </span><span class="si">{</span><span class="n">amount_state</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">        Liabilities:AccountsPayable            </span><span class="si">{</span><span class="n">amount_payable</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> CCY</span>

<span class="s2">      </span><span class="si">{</span><span class="n">date_federal</span><span class="si">}</span><span class="s2"> * &quot;FEDERAL TAXPYMT&quot;</span>
<span class="s2">        Assets:CC:Bank1:Checking       </span><span class="si">{</span><span class="n">amount_federal_neg</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">        Liabilities:AccountsPayable    </span><span class="si">{</span><span class="n">amount_federal</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> CCY</span>

<span class="s2">      </span><span class="si">{</span><span class="n">date_state</span><span class="si">}</span><span class="s2"> * &quot;STATE TAX &amp; FINANC PYMT&quot;</span>
<span class="s2">        Assets:CC:Bank1:Checking       </span><span class="si">{</span><span class="n">amount_state_neg</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">        Liabilities:AccountsPayable    </span><span class="si">{</span><span class="n">amount_state</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> CCY</span>

<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">entry</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span> <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">date</span> <span class="o">&lt;</span> <span class="n">date_max</span><span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.example.generate_tax_preamble" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">generate_tax_preamble</span><span class="p">(</span><span class="n">date_birth</span><span class="p">)</span></code>


<a href="#beancount.scripts.example.generate_tax_preamble" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Generate tax declarations not specific to any particular year.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>date_birth</strong> – A date instance, the birth date of the character.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of directives.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/scripts/example.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">generate_tax_preamble</span><span class="p">(</span><span class="n">date_birth</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate tax declarations not specific to any particular year.</span>

<span class="sd">    Args:</span>
<span class="sd">      date_birth: A date instance, the birth date of the character.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of directives.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">parse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">      ;; Tax accounts not specific to a year.</span>
<span class="s2">      </span><span class="si">{</span><span class="n">date_birth</span><span class="si">}</span><span class="s2"> open Income:CC:Federal:PreTax401k     DEFCCY</span>
<span class="s2">      </span><span class="si">{</span><span class="n">date_birth</span><span class="si">}</span><span class="s2"> open Assets:CC:Federal:PreTax401k     DEFCCY</span>

<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.example.generate_taxable_investment" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">generate_taxable_investment</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="n">price_map</span><span class="p">,</span> <span class="n">stocks</span><span class="p">)</span></code>


<a href="#beancount.scripts.example.generate_taxable_investment" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Generate opening directives and transactions for an investment account.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>date_begin</strong> – A date instance, the beginning date.</p></li>
            <li><p><strong>date_end</strong> – A date instance, the end date.</p></li>
            <li><p><strong>entries</strong> – A list of entries that contains at least the transfers to the investment
account's cash account.</p></li>
            <li><p><strong>price_map</strong> – A dict of prices, as per beancount.core.prices.build_price_map().</p></li>
            <li><p><strong>stocks</strong> – A list of strings, the list of commodities to invest in.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of directives.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/scripts/example.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">generate_taxable_investment</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="n">price_map</span><span class="p">,</span> <span class="n">stocks</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate opening directives and transactions for an investment account.</span>

<span class="sd">    Args:</span>
<span class="sd">      date_begin: A date instance, the beginning date.</span>
<span class="sd">      date_end: A date instance, the end date.</span>
<span class="sd">      entries: A list of entries that contains at least the transfers to the investment</span>
<span class="sd">        account&#39;s cash account.</span>
<span class="sd">      price_map: A dict of prices, as per beancount.core.prices.build_price_map().</span>
<span class="sd">      stocks: A list of strings, the list of commodities to invest in.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of directives.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">account</span> <span class="o">=</span> <span class="s2">&quot;Assets:CC:Investment&quot;</span>
    <span class="n">income</span> <span class="o">=</span> <span class="s2">&quot;Income:CC:Investment&quot;</span>
    <span class="n">account_cash</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="s2">&quot;Cash&quot;</span><span class="p">)</span>
    <span class="n">account_gains</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{income}</span><span class="s2">:PnL&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">income</span><span class="o">=</span><span class="n">income</span><span class="p">)</span>
    <span class="n">dividends</span> <span class="o">=</span> <span class="s2">&quot;Dividend&quot;</span>
    <span class="n">accounts_stocks</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Assets:CC:Investment:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">commodity</span><span class="p">)</span> <span class="k">for</span> <span class="n">commodity</span> <span class="ow">in</span> <span class="n">stocks</span><span class="p">]</span>

    <span class="n">open_entries</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">      </span><span class="si">{</span><span class="n">date_begin</span><span class="si">}</span><span class="s2"> open </span><span class="si">{</span><span class="n">account</span><span class="si">}</span><span class="s2">:Cash    CCY</span>
<span class="s2">      </span><span class="si">{</span><span class="n">date_begin</span><span class="si">}</span><span class="s2"> open </span><span class="si">{</span><span class="n">account_gains</span><span class="si">}</span><span class="s2">    CCY</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">stock</span> <span class="ow">in</span> <span class="n">stocks</span><span class="p">:</span>
        <span class="n">open_entries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="n">parse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">          </span><span class="si">{</span><span class="n">date_begin</span><span class="si">}</span><span class="s2"> open </span><span class="si">{</span><span class="n">account</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">stock</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">stock</span><span class="si">}</span>
<span class="s2">          </span><span class="si">{</span><span class="n">date_begin</span><span class="si">}</span><span class="s2"> open </span><span class="si">{</span><span class="n">income</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">stock</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">dividends</span><span class="si">}</span><span class="s2">    CCY</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># Figure out dates at which dividends should be distributed, near the end of</span>
    <span class="c1"># each quarter.</span>
    <span class="n">days_to</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">3</span> <span class="o">*</span> <span class="mi">90</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">dividend_dates</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">quarter_begin</span> <span class="ow">in</span> <span class="n">iter_quarters</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">):</span>
        <span class="n">end_of_quarter</span> <span class="o">=</span> <span class="n">quarter_begin</span> <span class="o">+</span> <span class="n">days_to</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">date_begin</span> <span class="o">&lt;</span> <span class="n">end_of_quarter</span> <span class="o">&lt;</span> <span class="n">date_end</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">dividend_dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">end_of_quarter</span><span class="p">)</span>

    <span class="c1"># Iterate over all the dates, but merging in the postings for the cash</span>
    <span class="c1"># account.</span>
    <span class="n">min_amount</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="s2">&quot;1000.00&quot;</span><span class="p">)</span>
    <span class="n">round_amount</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="s2">&quot;100.00&quot;</span><span class="p">)</span>
    <span class="n">commission</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="s2">&quot;8.95&quot;</span><span class="p">)</span>
    <span class="n">round_units</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">)</span>
    <span class="n">frac_invest</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="s2">&quot;1.00&quot;</span><span class="p">)</span>
    <span class="n">frac_dividend</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="s2">&quot;0.004&quot;</span><span class="p">)</span>
    <span class="n">p_daily_buy</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mi">15</span>  <span class="c1"># days</span>
    <span class="n">p_daily_sell</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mi">90</span>  <span class="c1"># days</span>

    <span class="n">stocks_inventory</span> <span class="o">=</span> <span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">()</span>
    <span class="n">new_entries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dividend_date_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">dividend_dates</span><span class="p">)</span>
    <span class="n">next_dividend_date</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">dividend_date_iter</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">date</span><span class="p">,</span> <span class="n">balances</span> <span class="ow">in</span> <span class="n">iter_dates_with_balance</span><span class="p">(</span>
        <span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="p">[</span><span class="n">account_cash</span><span class="p">]</span>
    <span class="p">):</span>
        <span class="c1"># Check if we should insert a dividend. Note that we could not factor</span>
        <span class="c1"># this out because we want to explicitly reinvest the cash dividends and</span>
        <span class="c1"># we also want the dividends to be proportional to the amount of</span>
        <span class="c1"># invested stock, so one feeds on the other and vice-versa.</span>
        <span class="k">if</span> <span class="n">next_dividend_date</span> <span class="ow">and</span> <span class="n">date</span> <span class="o">&gt;</span> <span class="n">next_dividend_date</span><span class="p">:</span>
            <span class="c1"># Compute the total balances for the stock accounts in order to</span>
            <span class="c1"># create a realistic dividend.</span>
            <span class="n">total</span> <span class="o">=</span> <span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">account_stock</span> <span class="ow">in</span> <span class="n">accounts_stocks</span><span class="p">:</span>
                <span class="n">total</span><span class="o">.</span><span class="n">add_inventory</span><span class="p">(</span><span class="n">balances</span><span class="p">[</span><span class="n">account_stock</span><span class="p">])</span>

            <span class="c1"># Create an entry offering dividends of 1% of the portfolio.</span>
            <span class="n">portfolio_cost</span> <span class="o">=</span> <span class="n">total</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">convert</span><span class="o">.</span><span class="n">get_cost</span><span class="p">)</span><span class="o">.</span><span class="n">get_currency_units</span><span class="p">(</span><span class="s2">&quot;CCY&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">number</span>
            <span class="n">amount_cash</span> <span class="o">=</span> <span class="p">(</span><span class="n">frac_dividend</span> <span class="o">*</span> <span class="n">portfolio_cost</span><span class="p">)</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">D</span><span class="p">(</span><span class="s2">&quot;0.01&quot;</span><span class="p">))</span>
            <span class="n">amount_cash_neg</span> <span class="o">=</span> <span class="o">-</span><span class="n">amount_cash</span>
            <span class="n">stock</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">stocks</span><span class="p">)</span>
            <span class="n">cash_dividend</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">              </span><span class="si">{</span><span class="n">next_dividend_date</span><span class="si">}</span><span class="s2"> * &quot;Dividends on portfolio&quot;</span>
<span class="s2">                </span><span class="si">{</span><span class="n">account</span><span class="si">}</span><span class="s2">:Cash        </span><span class="si">{</span><span class="n">amount_cash</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">                </span><span class="si">{</span><span class="n">income</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">stock</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">dividends</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">amount_cash_neg</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">new_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cash_dividend</span><span class="p">)</span>

            <span class="c1"># Advance the next dividend date.</span>
            <span class="n">next_dividend_date</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">dividend_date_iter</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># If the balance is high, buy with high probability.</span>
        <span class="n">balance</span> <span class="o">=</span> <span class="n">balances</span><span class="p">[</span><span class="n">account_cash</span><span class="p">]</span>
        <span class="n">total_cash</span> <span class="o">=</span> <span class="n">balance</span><span class="o">.</span><span class="n">get_currency_units</span><span class="p">(</span><span class="s2">&quot;CCY&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">number</span>
        <span class="k">assert</span> <span class="n">total_cash</span> <span class="o">&gt;=</span> <span class="n">ZERO</span><span class="p">,</span> <span class="s2">&quot;Cash balance is negative: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">total_cash</span><span class="p">)</span>
        <span class="n">invest_cash</span> <span class="o">=</span> <span class="n">total_cash</span> <span class="o">*</span> <span class="n">frac_invest</span> <span class="o">-</span> <span class="n">commission</span>
        <span class="k">if</span> <span class="n">invest_cash</span> <span class="o">&gt;</span> <span class="n">min_amount</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">p_daily_buy</span><span class="p">:</span>
                <span class="n">commodities</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">stocks</span><span class="p">,</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">stocks</span><span class="p">)))</span>
                <span class="n">lot_amount</span> <span class="o">=</span> <span class="n">round_to</span><span class="p">(</span><span class="n">invest_cash</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">commodities</span><span class="p">),</span> <span class="n">round_amount</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">stock</span> <span class="ow">in</span> <span class="n">commodities</span><span class="p">:</span>
                    <span class="c1"># Find the price at that date.</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">price</span> <span class="o">=</span> <span class="n">prices</span><span class="o">.</span><span class="n">get_price</span><span class="p">(</span><span class="n">price_map</span><span class="p">,</span> <span class="p">(</span><span class="n">stock</span><span class="p">,</span> <span class="s2">&quot;CCY&quot;</span><span class="p">),</span> <span class="n">date</span><span class="p">)</span>

                    <span class="n">units</span> <span class="o">=</span> <span class="n">round_to</span><span class="p">((</span><span class="n">lot_amount</span> <span class="o">/</span> <span class="n">price</span><span class="p">),</span> <span class="n">round_units</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">units</span> <span class="o">&lt;=</span> <span class="n">ZERO</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">amount_cash</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">units</span> <span class="o">*</span> <span class="n">price</span> <span class="o">+</span> <span class="n">commission</span><span class="p">)</span>
                    <span class="c1"># logging.info(&#39;Buying %s %s @ %s CCY = %s CCY&#39;,</span>
                    <span class="c1">#              units, stock, price, units * price)</span>

                    <span class="n">buy</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                      </span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s2"> * &quot;Buy shares of </span><span class="si">{</span><span class="n">stock</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="s2">                        </span><span class="si">{</span><span class="n">account</span><span class="si">}</span><span class="s2">:Cash                  </span><span class="si">{</span><span class="n">amount_cash</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">                        </span><span class="si">{</span><span class="n">account</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">stock</span><span class="si">}</span><span class="s2">               </span><span class="si">{</span><span class="n">units</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">stock</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="si">{</span><span class="n">price</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> CCY</span><span class="se">}}</span>
<span class="s2">                        Expenses:Financial:Commissions  </span><span class="si">{</span><span class="n">commission</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">                    &quot;&quot;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">new_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">buy</span><span class="p">)</span>

                    <span class="n">account_stock</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">account</span><span class="p">,</span> <span class="n">stock</span><span class="p">])</span>
                    <span class="n">balances</span><span class="p">[</span><span class="n">account_cash</span><span class="p">]</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">buy</span><span class="o">.</span><span class="n">postings</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">balances</span><span class="p">[</span><span class="n">account_stock</span><span class="p">]</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">buy</span><span class="o">.</span><span class="n">postings</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">stocks_inventory</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">buy</span><span class="o">.</span><span class="n">postings</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

                <span class="c1"># Don&#39;t sell on days you buy.</span>
                <span class="k">continue</span>

        <span class="c1"># Otherwise, sell with low probability.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">stocks_inventory</span><span class="o">.</span><span class="n">is_empty</span><span class="p">()</span> <span class="ow">and</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">p_daily_sell</span><span class="p">:</span>
            <span class="c1"># Choose the lot with the highest gain or highest loss.</span>
            <span class="n">gains</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="n">stocks_inventory</span><span class="o">.</span><span class="n">get_positions</span><span class="p">():</span>
                <span class="n">base_quote</span> <span class="o">=</span> <span class="p">(</span><span class="n">position</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="n">position</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">price</span> <span class="o">=</span> <span class="n">prices</span><span class="o">.</span><span class="n">get_price</span><span class="p">(</span><span class="n">price_map</span><span class="p">,</span> <span class="n">base_quote</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">price</span> <span class="o">==</span> <span class="n">position</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">number</span><span class="p">:</span>
                    <span class="k">continue</span>  <span class="c1"># Skip lots without movement.</span>
                <span class="n">market_value</span> <span class="o">=</span> <span class="n">position</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="o">*</span> <span class="n">price</span>
                <span class="n">book_value</span> <span class="o">=</span> <span class="n">convert</span><span class="o">.</span><span class="n">get_cost</span><span class="p">(</span><span class="n">position</span><span class="p">)</span><span class="o">.</span><span class="n">number</span>
                <span class="n">gain</span> <span class="o">=</span> <span class="n">market_value</span> <span class="o">-</span> <span class="n">book_value</span>
                <span class="n">gains</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">gain</span><span class="p">,</span> <span class="n">market_value</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">position</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gains</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Sell either biggest winner or biggest loser.</span>
            <span class="n">biggest</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="n">lot_tuple</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">gains</span><span class="p">)[</span><span class="mi">0</span> <span class="k">if</span> <span class="n">biggest</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">gain</span><span class="p">,</span> <span class="n">market_value</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">sell_position</span> <span class="o">=</span> <span class="n">lot_tuple</span>
            <span class="c1"># logging.info(&#39;Selling {} for {}&#39;.format(sell_position, market_value))</span>

            <span class="n">sell_position</span> <span class="o">=</span> <span class="o">-</span><span class="n">sell_position</span>
            <span class="n">stock</span> <span class="o">=</span> <span class="n">sell_position</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span>
            <span class="n">amount_cash</span> <span class="o">=</span> <span class="n">market_value</span> <span class="o">-</span> <span class="n">commission</span>
            <span class="n">amount_gain</span> <span class="o">=</span> <span class="o">-</span><span class="n">gain</span>
            <span class="n">sell</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">              </span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s2"> * &quot;Sell shares of </span><span class="si">{</span><span class="n">stock</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="s2">                </span><span class="si">{</span><span class="n">account</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">stock</span><span class="si">}</span><span class="s2">               </span><span class="si">{</span><span class="n">sell_position</span><span class="si">}</span><span class="s2"> @ </span><span class="si">{</span><span class="n">price</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">                </span><span class="si">{</span><span class="n">account</span><span class="si">}</span><span class="s2">:Cash                  </span><span class="si">{</span><span class="n">amount_cash</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">                Expenses:Financial:Commissions  </span><span class="si">{</span><span class="n">commission</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">                </span><span class="si">{</span><span class="n">account_gains</span><span class="si">}</span><span class="s2">                 </span><span class="si">{</span><span class="n">amount_gain</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">new_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sell</span><span class="p">)</span>

            <span class="n">balances</span><span class="p">[</span><span class="n">account_cash</span><span class="p">]</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">sell</span><span class="o">.</span><span class="n">postings</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">stocks_inventory</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">sell</span><span class="o">.</span><span class="n">postings</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">continue</span>

    <span class="k">return</span> <span class="n">open_entries</span> <span class="o">+</span> <span class="n">new_entries</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.example.generate_trip_entries" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">generate_trip_entries</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">trip_city</span><span class="p">,</span> <span class="n">home_city</span><span class="p">,</span> <span class="n">account_credit</span><span class="p">)</span></code>


<a href="#beancount.scripts.example.generate_trip_entries" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Generate more dense expenses for a trip.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>date_begin</strong> – A datetime.date instance, the beginning of the trip.</p></li>
            <li><p><strong>date_end</strong> – A datetime.date instance, the end of the trip.</p></li>
            <li><p><strong>tag</strong> – A string, the name of the tag.</p></li>
            <li><p><strong>config</strong> – A list of (payee name, account name, (mu, 3sigma)), where
mu is the mean of the prices to generate and 3sigma is 3 times
the standard deviation.</p></li>
            <li><p><strong>trip_city</strong> – A string, the capitalized name of the destination city.</p></li>
            <li><p><strong>home_city</strong> – A string, the name of the home city.</p></li>
            <li><p><strong>account_credit</strong> – A string, the name of the credit card account to pay
the expenses from.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of entries for the trip, all tagged with the given tag.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/scripts/example.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">generate_trip_entries</span><span class="p">(</span>
    <span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">trip_city</span><span class="p">,</span> <span class="n">home_city</span><span class="p">,</span> <span class="n">account_credit</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate more dense expenses for a trip.</span>

<span class="sd">    Args:</span>
<span class="sd">      date_begin: A datetime.date instance, the beginning of the trip.</span>
<span class="sd">      date_end: A datetime.date instance, the end of the trip.</span>
<span class="sd">      tag: A string, the name of the tag.</span>
<span class="sd">      config: A list of (payee name, account name, (mu, 3sigma)), where</span>
<span class="sd">        mu is the mean of the prices to generate and 3sigma is 3 times</span>
<span class="sd">        the standard deviation.</span>
<span class="sd">      trip_city: A string, the capitalized name of the destination city.</span>
<span class="sd">      home_city: A string, the name of the home city.</span>
<span class="sd">      account_credit: A string, the name of the credit card account to pay</span>
<span class="sd">        the expenses from.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of entries for the trip, all tagged with the given tag.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p_day_generate</span> <span class="o">=</span> <span class="mf">0.3</span>

    <span class="n">new_entries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">date_iter</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">payee</span><span class="p">,</span> <span class="n">account_expense</span><span class="p">,</span> <span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma3</span><span class="p">)</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">p_day_generate</span><span class="p">:</span>
                <span class="n">amount</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">normalvariate</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma3</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span>
                <span class="n">amount_neg</span> <span class="o">=</span> <span class="o">-</span><span class="n">amount</span>
                <span class="n">new_entries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="n">parse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                  </span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s2"> * &quot;</span><span class="si">{</span><span class="n">payee</span><span class="si">}</span><span class="s2">&quot; &quot;&quot; #</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span>
<span class="s2">                    </span><span class="si">{</span><span class="n">account_credit</span><span class="si">}</span><span class="s2">     </span><span class="si">{</span><span class="n">amount_neg</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">                    </span><span class="si">{</span><span class="n">account_expense</span><span class="si">}</span><span class="s2">    </span><span class="si">{</span><span class="n">amount</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> CCY</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span>
                <span class="p">)</span>

    <span class="c1"># Consume the vacation days.</span>
    <span class="n">vacation_hrs</span> <span class="o">=</span> <span class="p">(</span><span class="n">date_end</span> <span class="o">-</span> <span class="n">date_begin</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">*</span> <span class="mi">8</span>  <span class="c1"># hrs/day</span>
    <span class="n">new_entries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
        <span class="n">parse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">      </span><span class="si">{</span><span class="n">date_end</span><span class="si">}</span><span class="s2"> * &quot;Consume vacation days&quot;</span>
<span class="s2">        Assets:CC:Employer1:Vacation -</span><span class="si">{</span><span class="n">vacation_hrs</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> VACHR</span>
<span class="s2">        Expenses:Vacation             </span><span class="si">{</span><span class="n">vacation_hrs</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> VACHR</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Generate events for the trip.</span>
    <span class="n">new_entries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
        <span class="n">parse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">      </span><span class="si">{</span><span class="n">date_begin</span><span class="si">}</span><span class="s2"> event &quot;location&quot; &quot;</span><span class="si">{</span><span class="n">trip_city</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="s2">      </span><span class="si">{</span><span class="n">date_end</span><span class="si">}</span><span class="s2">   event &quot;location&quot; &quot;</span><span class="si">{</span><span class="n">home_city</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">new_entries</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.example.get_minimum_balance" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">get_minimum_balance</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span></code>


<a href="#beancount.scripts.example.get_minimum_balance" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Compute the minimum balance of the given account according to the entries history.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives.</p></li>
            <li><p><strong>account</strong> – An account string.</p></li>
            <li><p><strong>currency</strong> – A currency string, for which we want to compute the minimum.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A Decimal number, the minimum amount throughout the history of this account.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/scripts/example.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_minimum_balance</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the minimum balance of the given account according to the entries history.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      account: An account string.</span>
<span class="sd">      currency: A currency string, for which we want to compute the minimum.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A Decimal number, the minimum amount throughout the history of this account.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">min_amount</span> <span class="o">=</span> <span class="n">ZERO</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">balances</span> <span class="ow">in</span> <span class="n">postings_for</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="p">[</span><span class="n">account</span><span class="p">]):</span>
        <span class="n">balance</span> <span class="o">=</span> <span class="n">balances</span><span class="p">[</span><span class="n">account</span><span class="p">]</span>
        <span class="n">current</span> <span class="o">=</span> <span class="n">balance</span><span class="o">.</span><span class="n">get_currency_units</span><span class="p">(</span><span class="n">currency</span><span class="p">)</span><span class="o">.</span><span class="n">number</span>
        <span class="k">if</span> <span class="n">current</span> <span class="o">&lt;</span> <span class="n">min_amount</span><span class="p">:</span>
            <span class="n">min_amount</span> <span class="o">=</span> <span class="n">current</span>
    <span class="k">return</span> <span class="n">min_amount</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.example.iter_dates_with_balance" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">iter_dates_with_balance</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="n">accounts</span><span class="p">)</span></code>


<a href="#beancount.scripts.example.iter_dates_with_balance" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Iterate over dates, including the balances of the postings iterator.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>postings_iter</strong> – An iterator of postings as per postings_for().</p></li>
            <li><p><strong>date_begin</strong> – The start date.</p></li>
            <li><p><strong>date_end</strong> – The end date.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  Pairs of (data, balances) objects, with
    date: A datetime.date instance
    balances: An Inventory object, representing the current balance.
      You can modify the inventory object to feed back changes in the
      balance.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/scripts/example.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">iter_dates_with_balance</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="n">accounts</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Iterate over dates, including the balances of the postings iterator.</span>

<span class="sd">    Args:</span>
<span class="sd">      postings_iter: An iterator of postings as per postings_for().</span>
<span class="sd">      date_begin: The start date.</span>
<span class="sd">      date_end: The end date.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Pairs of (data, balances) objects, with</span>
<span class="sd">        date: A datetime.date instance</span>
<span class="sd">        balances: An Inventory object, representing the current balance.</span>
<span class="sd">          You can modify the inventory object to feed back changes in the</span>
<span class="sd">          balance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">balances</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">)</span>
    <span class="n">merged_txn_postings</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">merge_postings</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">accounts</span><span class="p">))</span>
    <span class="n">txn_posting</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">merged_txn_postings</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">date_iter</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">):</span>
        <span class="k">while</span> <span class="n">txn_posting</span> <span class="ow">and</span> <span class="n">txn_posting</span><span class="o">.</span><span class="n">txn</span><span class="o">.</span><span class="n">date</span> <span class="o">==</span> <span class="n">date</span><span class="p">:</span>
            <span class="n">posting</span> <span class="o">=</span> <span class="n">txn_posting</span><span class="o">.</span><span class="n">posting</span>
            <span class="n">balances</span><span class="p">[</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">]</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">posting</span><span class="p">)</span>
            <span class="n">txn_posting</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">merged_txn_postings</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">date</span><span class="p">,</span> <span class="n">balances</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.example.iter_quarters" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">iter_quarters</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">)</span></code>


<a href="#beancount.scripts.example.iter_quarters" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Iterate over all quarters between begin and end dates.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>date_begin</strong> – The start date.</p></li>
            <li><p><strong>date_end</strong> – The end date.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  Instances of datetime.date at the beginning of the quarters. This will
  include the quarter of the beginning date and of the end date.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/scripts/example.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">iter_quarters</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Iterate over all quarters between begin and end dates.</span>

<span class="sd">    Args:</span>
<span class="sd">      date_begin: The start date.</span>
<span class="sd">      date_end: The end date.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Instances of datetime.date at the beginning of the quarters. This will</span>
<span class="sd">      include the quarter of the beginning date and of the end date.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">quarter</span> <span class="o">=</span> <span class="p">(</span><span class="n">date_begin</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="p">(</span><span class="n">date_begin</span><span class="o">.</span><span class="n">month</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">quarter_last</span> <span class="o">=</span> <span class="p">(</span><span class="n">date_end</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="p">(</span><span class="n">date_end</span><span class="o">.</span><span class="n">month</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">quarter</span> <span class="o">&lt;=</span> <span class="n">quarter_last</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">year</span><span class="p">,</span> <span class="n">trimester</span> <span class="o">=</span> <span class="n">quarter</span>
        <span class="k">yield</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">trimester</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">quarter</span> <span class="o">==</span> <span class="n">quarter_last</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">trimester</span> <span class="o">=</span> <span class="p">(</span><span class="n">trimester</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span>
        <span class="k">if</span> <span class="n">trimester</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">year</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">quarter</span> <span class="o">=</span> <span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">trimester</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.example.merge_postings" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">merge_postings</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">accounts</span><span class="p">)</span></code>


<a href="#beancount.scripts.example.merge_postings" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Merge all the postings from the given account names.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives.</p></li>
            <li><p><strong>accounts</strong> – A list of account strings to get the balances for.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  A list of TxnPosting's for all the accounts, in sorted order.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/scripts/example.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">merge_postings</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">accounts</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Merge all the postings from the given account names.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      accounts: A list of account strings to get the balances for.</span>
<span class="sd">    Yields:</span>
<span class="sd">      A list of TxnPosting&#39;s for all the accounts, in sorted order.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">real_root</span> <span class="o">=</span> <span class="n">realization</span><span class="o">.</span><span class="n">realize</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>
    <span class="n">merged_postings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">account</span> <span class="ow">in</span> <span class="n">accounts</span><span class="p">:</span>
        <span class="n">real_account</span> <span class="o">=</span> <span class="n">realization</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">real_root</span><span class="p">,</span> <span class="n">account</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">real_account</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">merged_postings</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="n">txn_posting</span>
            <span class="k">for</span> <span class="n">txn_posting</span> <span class="ow">in</span> <span class="n">real_account</span><span class="o">.</span><span class="n">txn_postings</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">txn_posting</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">TxnPosting</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="n">merged_postings</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">txn_posting</span><span class="p">:</span> <span class="n">txn_posting</span><span class="o">.</span><span class="n">txn</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">merged_postings</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.example.parse" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">input_string</span><span class="p">)</span></code>


<a href="#beancount.scripts.example.parse" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Parse some input string and assert no errors.</p>
<p>This parse function does not just create the object, it also triggers local
interpolation to fill in the missing amounts.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>input_string</strong> – Beancount input text.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A list of directive objects.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/scripts/example.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">input_string</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse some input string and assert no errors.</span>

<span class="sd">    This parse function does not just create the object, it also triggers local</span>
<span class="sd">    interpolation to fill in the missing amounts.</span>

<span class="sd">    Args:</span>
<span class="sd">      input_string: Beancount input text.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of directive objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">options_map</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_string</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">input_string</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
        <span class="n">printer</span><span class="o">.</span><span class="n">print_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Parsed text has errors&quot;</span><span class="p">)</span>

    <span class="c1"># Interpolation.</span>
    <span class="n">entries</span><span class="p">,</span> <span class="n">unused_balance_errors</span> <span class="o">=</span> <span class="n">booking</span><span class="o">.</span><span class="n">book</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.example.postings_for" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">postings_for</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">accounts</span><span class="p">,</span> <span class="n">before</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#beancount.scripts.example.postings_for" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Realize the entries and get the list of postings for the given accounts.</p>
<p>All the non-Posting directives are already filtered out.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>entries</strong> – A list of directives.</p></li>
            <li><p><strong>accounts</strong> – A list of account strings to get the balances for.</p></li>
            <li><p><strong>before</strong> – A boolean, if true, yield the balance before the position is applied.
The default is to yield the balance after applying the position.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  Tuples of:
    posting: An instance of TxnPosting
    balances: A dict of Inventory balances for the given accounts <em>after</em>
      applying the posting. These inventory objects can be mutated to adjust
      the balance due to generated transactions to be applied later.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/scripts/example.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">postings_for</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">accounts</span><span class="p">,</span> <span class="n">before</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Realize the entries and get the list of postings for the given accounts.</span>

<span class="sd">    All the non-Posting directives are already filtered out.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      accounts: A list of account strings to get the balances for.</span>
<span class="sd">      before: A boolean, if true, yield the balance before the position is applied.</span>
<span class="sd">        The default is to yield the balance after applying the position.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Tuples of:</span>
<span class="sd">        posting: An instance of TxnPosting</span>
<span class="sd">        balances: A dict of Inventory balances for the given accounts _after_</span>
<span class="sd">          applying the posting. These inventory objects can be mutated to adjust</span>
<span class="sd">          the balance due to generated transactions to be applied later.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">accounts</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
    <span class="n">merged_txn_postings</span> <span class="o">=</span> <span class="n">merge_postings</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">accounts</span><span class="p">)</span>
    <span class="n">balances</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">txn_posting</span> <span class="ow">in</span> <span class="n">merged_txn_postings</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">before</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">txn_posting</span><span class="p">,</span> <span class="n">balances</span>
        <span class="n">posting</span> <span class="o">=</span> <span class="n">txn_posting</span><span class="o">.</span><span class="n">posting</span>
        <span class="n">balances</span><span class="p">[</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">]</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">posting</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">before</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">txn_posting</span><span class="p">,</span> <span class="n">balances</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.example.price_series" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">price_series</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span></code>


<a href="#beancount.scripts.example.price_series" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Generate a price series based on a simple stochastic model.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>start</strong> – The beginning value.</p></li>
            <li><p><strong>mu</strong> – The per-step drift, in units of value.</p></li>
            <li><p><strong>sigma</strong> – Volatility of the changes.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Yields:
  Floats, at each step.</p>

        <details class="quote">
          <summary>Source code in <code>beancount/scripts/example.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">price_series</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a price series based on a simple stochastic model.</span>

<span class="sd">    Args:</span>
<span class="sd">      start: The beginning value.</span>
<span class="sd">      mu: The per-step drift, in units of value.</span>
<span class="sd">      sigma: Volatility of the changes.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Floats, at each step.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">start</span>
    <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">value</span>
        <span class="n">value</span> <span class="o">+=</span> <span class="n">random</span><span class="o">.</span><span class="n">normalvariate</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">*</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.example.replace" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">replacements</span><span class="p">,</span> <span class="n">strip</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#beancount.scripts.example.replace" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Apply word-boundaried regular expression replacements to an indented string.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>string</strong> – Some input template string.</p></li>
            <li><p><strong>replacements</strong> – A dict of regexp to replacement value.</p></li>
            <li><p><strong>strip</strong> – A boolean, true if we should strip the input.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>The input string with the replacements applied to it, with the indentation removed.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/scripts/example.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">replace</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">replacements</span><span class="p">,</span> <span class="n">strip</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply word-boundaried regular expression replacements to an indented string.</span>

<span class="sd">    Args:</span>
<span class="sd">      string: Some input template string.</span>
<span class="sd">      replacements: A dict of regexp to replacement value.</span>
<span class="sd">      strip: A boolean, true if we should strip the input.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The input string with the replacements applied to it, with the indentation removed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">from_</span><span class="p">,</span> <span class="n">to_</span> <span class="ow">in</span> <span class="n">replacements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to_</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">to_</span><span class="p">):</span>
            <span class="n">to_</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">to_</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\b</span><span class="si">{}</span><span class="s2">\b&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">from_</span><span class="p">),</span> <span class="n">to_</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">output</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.example.validate_output" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">validate_output</span><span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="n">positive_accounts</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span></code>


<a href="#beancount.scripts.example.validate_output" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Check that the output file validates.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>contents</strong> – A string, the output file.</p></li>
            <li><p><strong>positive_accounts</strong> – A list of strings, account names to check for
non-negative balances.</p></li>
            <li><p><strong>currency</strong> – A string, the currency to check minimums for.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>AssertionError</code> – If the output does not validate.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/scripts/example.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">validate_output</span><span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="n">positive_accounts</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check that the output file validates.</span>

<span class="sd">    Args:</span>
<span class="sd">      contents: A string, the output file.</span>
<span class="sd">      positive_accounts: A list of strings, account names to check for</span>
<span class="sd">        non-negative balances.</span>
<span class="sd">      currency: A string, the currency to check minimums for.</span>
<span class="sd">    Raises:</span>
<span class="sd">      AssertionError: If the output does not validate.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">loaded_entries</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">load_string</span><span class="p">(</span>
        <span class="n">contents</span><span class="p">,</span> <span class="n">log_errors</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">extra_validations</span><span class="o">=</span><span class="n">validation</span><span class="o">.</span><span class="n">HARDCORE_VALIDATIONS</span>
    <span class="p">)</span>

    <span class="c1"># Sanity checks: Check that the checking balance never goes below zero.</span>
    <span class="k">for</span> <span class="n">account</span> <span class="ow">in</span> <span class="n">positive_accounts</span><span class="p">:</span>
        <span class="n">check_non_negative</span><span class="p">(</span><span class="n">loaded_entries</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.example.write_example_file" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">write_example_file</span><span class="p">(</span><span class="n">date_birth</span><span class="p">,</span> <span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">reformat</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span></code>


<a href="#beancount.scripts.example.write_example_file" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Generate the example file.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>date_birth</strong> – A datetime.date instance, the birth date of our character.</p></li>
            <li><p><strong>date_begin</strong> – A datetime.date instance, the beginning date at which to generate
transactions.</p></li>
            <li><p><strong>date_end</strong> – A datetime.date instance, the end date at which to generate
transactions.</p></li>
            <li><p><strong>reformat</strong> – A boolean, true if we should apply global reformatting to this file.</p></li>
            <li><p><strong>file</strong> – A file object, where to write out the output.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/scripts/example.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">write_example_file</span><span class="p">(</span><span class="n">date_birth</span><span class="p">,</span> <span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">reformat</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate the example file.</span>

<span class="sd">    Args:</span>
<span class="sd">      date_birth: A datetime.date instance, the birth date of our character.</span>
<span class="sd">      date_begin: A datetime.date instance, the beginning date at which to generate</span>
<span class="sd">        transactions.</span>
<span class="sd">      date_end: A datetime.date instance, the end date at which to generate</span>
<span class="sd">        transactions.</span>
<span class="sd">      reformat: A boolean, true if we should apply global reformatting to this file.</span>
<span class="sd">      file: A file object, where to write out the output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># The following code entirely writes out the output to generic names, such</span>
    <span class="c1"># as &quot;Employer1&quot;, &quot;Bank1&quot;, and &quot;CCY&quot; (for principal currency). Those names</span>
    <span class="c1"># are purposely chosen to be unique, and only near the very end do we make</span>
    <span class="c1"># renamings to more specific and realistic names.</span>

    <span class="c1"># Name of the checking account.</span>
    <span class="n">account_opening</span> <span class="o">=</span> <span class="s2">&quot;Equity:Opening-Balances&quot;</span>
    <span class="n">account_payable</span> <span class="o">=</span> <span class="s2">&quot;Liabilities:AccountsPayable&quot;</span>
    <span class="n">account_checking</span> <span class="o">=</span> <span class="s2">&quot;Assets:CC:Bank1:Checking&quot;</span>
    <span class="n">account_credit</span> <span class="o">=</span> <span class="s2">&quot;Liabilities:CC:CreditCard1&quot;</span>
    <span class="n">account_retirement</span> <span class="o">=</span> <span class="s2">&quot;Assets:CC:Retirement&quot;</span>
    <span class="n">account_investing</span> <span class="o">=</span> <span class="s2">&quot;Assets:CC:Investment:Cash&quot;</span>

    <span class="c1"># Commodities.</span>
    <span class="n">commodity_entries</span> <span class="o">=</span> <span class="n">generate_commodity_entries</span><span class="p">(</span><span class="n">date_birth</span><span class="p">)</span>

    <span class="c1"># Estimate the rent.</span>
    <span class="n">rent_amount</span> <span class="o">=</span> <span class="n">round_to</span><span class="p">(</span><span class="n">ANNUAL_SALARY</span> <span class="o">/</span> <span class="n">RENT_DIVISOR</span><span class="p">,</span> <span class="n">RENT_INCREMENT</span><span class="p">)</span>

    <span class="c1"># Get a random employer.</span>
    <span class="n">employer_name</span><span class="p">,</span> <span class="n">employer_address</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">EMPLOYERS</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating Salary Employment Income&quot;</span><span class="p">)</span>
    <span class="n">income_entries</span> <span class="o">=</span> <span class="n">generate_employment_income</span><span class="p">(</span>
        <span class="n">employer_name</span><span class="p">,</span>
        <span class="n">employer_address</span><span class="p">,</span>
        <span class="n">ANNUAL_SALARY</span><span class="p">,</span>
        <span class="n">account_checking</span><span class="p">,</span>
        <span class="n">join</span><span class="p">(</span><span class="n">account_retirement</span><span class="p">,</span> <span class="s2">&quot;Cash&quot;</span><span class="p">),</span>
        <span class="n">date_begin</span><span class="p">,</span>
        <span class="n">date_end</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating Expenses from Banking Accounts&quot;</span><span class="p">)</span>
    <span class="n">banking_expenses</span> <span class="o">=</span> <span class="n">generate_banking_expenses</span><span class="p">(</span>
        <span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">account_checking</span><span class="p">,</span> <span class="n">rent_amount</span>
    <span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating Regular Expenses via Credit Card&quot;</span><span class="p">)</span>
    <span class="n">credit_regular_entries</span> <span class="o">=</span> <span class="n">generate_regular_credit_expenses</span><span class="p">(</span>
        <span class="n">date_birth</span><span class="p">,</span> <span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">account_credit</span><span class="p">,</span> <span class="n">account_checking</span>
    <span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating Credit Card Expenses for Trips&quot;</span><span class="p">)</span>
    <span class="n">trip_entries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">destinations</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">TRIP_DESTINATIONS</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="n">destinations</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">destinations</span><span class="p">)</span>
    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">destinations</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">date_trip_begin</span><span class="p">,</span> <span class="n">date_trip_end</span><span class="p">),</span> <span class="p">(</span><span class="n">destination_name</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
        <span class="n">compute_trip_dates</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">),</span> <span class="n">destinations</span>
    <span class="p">):</span>
        <span class="c1"># Compute a suitable tag.</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;trip-</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">destination_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">),</span> <span class="n">date_trip_begin</span><span class="o">.</span><span class="n">year</span>
        <span class="p">)</span>
        <span class="c1"># logging.info(&quot;%s -- %s %s&quot;, tag, date_trip_begin, date_trip_end)</span>

        <span class="c1"># Remove regular entries during this trip.</span>
        <span class="n">credit_regular_entries</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">entry</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">credit_regular_entries</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">date_trip_begin</span> <span class="o">&lt;=</span> <span class="n">entry</span><span class="o">.</span><span class="n">date</span> <span class="o">&lt;</span> <span class="n">date_trip_end</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="c1"># Generate entries for the trip.</span>
        <span class="n">this_trip_entries</span> <span class="o">=</span> <span class="n">generate_trip_entries</span><span class="p">(</span>
            <span class="n">date_trip_begin</span><span class="p">,</span>
            <span class="n">date_trip_end</span><span class="p">,</span>
            <span class="n">tag</span><span class="p">,</span>
            <span class="n">config</span><span class="p">,</span>
            <span class="n">destination_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span>
            <span class="n">HOME_NAME</span><span class="p">,</span>
            <span class="n">account_credit</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">trip_entries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">this_trip_entries</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating Credit Card Payment Entries&quot;</span><span class="p">)</span>
    <span class="n">credit_payments</span> <span class="o">=</span> <span class="n">generate_clearing_entries</span><span class="p">(</span>
        <span class="n">delay_dates</span><span class="p">(</span>
            <span class="n">rrule</span><span class="o">.</span><span class="n">rrule</span><span class="p">(</span><span class="n">rrule</span><span class="o">.</span><span class="n">MONTHLY</span><span class="p">,</span> <span class="n">dtstart</span><span class="o">=</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">until</span><span class="o">=</span><span class="n">date_end</span><span class="p">,</span> <span class="n">bymonthday</span><span class="o">=</span><span class="mi">7</span><span class="p">),</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="mi">4</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="s2">&quot;CreditCard1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Paying off credit card&quot;</span><span class="p">,</span>
        <span class="n">credit_regular_entries</span><span class="p">,</span>
        <span class="n">account_credit</span><span class="p">,</span>
        <span class="n">account_checking</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">credit_entries</span> <span class="o">=</span> <span class="n">credit_regular_entries</span> <span class="o">+</span> <span class="n">trip_entries</span> <span class="o">+</span> <span class="n">credit_payments</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating Tax Filings and Payments&quot;</span><span class="p">)</span>
    <span class="n">tax_preamble</span> <span class="o">=</span> <span class="n">generate_tax_preamble</span><span class="p">(</span><span class="n">date_birth</span><span class="p">)</span>

    <span class="c1"># Figure out all the years we need tax accounts for.</span>
    <span class="n">years</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">account_name</span> <span class="ow">in</span> <span class="n">getters</span><span class="o">.</span><span class="n">get_accounts</span><span class="p">(</span><span class="n">income_entries</span><span class="p">):</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Expenses:Taxes:Y(\d\d\d\d)&quot;</span><span class="p">,</span> <span class="n">account_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">years</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>

    <span class="n">taxes</span> <span class="o">=</span> <span class="p">[(</span><span class="n">year</span><span class="p">,</span> <span class="n">generate_tax_accounts</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">date_end</span><span class="p">))</span> <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">years</span><span class="p">)]</span>
    <span class="n">tax_entries</span> <span class="o">=</span> <span class="n">tax_preamble</span> <span class="o">+</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span>
        <span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="p">(</span><span class="n">entries</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">entries</span> <span class="ow">in</span> <span class="n">taxes</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating Opening of Banking Accounts&quot;</span><span class="p">)</span>
    <span class="c1"># Open banking accounts and gift the checking account with a balance that</span>
    <span class="c1"># will offset all the amounts to ensure a positive balance throughout its</span>
    <span class="c1"># lifetime.</span>
    <span class="n">entries_for_banking</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span>
        <span class="n">income_entries</span> <span class="o">+</span> <span class="n">banking_expenses</span> <span class="o">+</span> <span class="n">credit_entries</span> <span class="o">+</span> <span class="n">tax_entries</span>
    <span class="p">)</span>
    <span class="n">minimum</span> <span class="o">=</span> <span class="n">get_minimum_balance</span><span class="p">(</span><span class="n">entries_for_banking</span><span class="p">,</span> <span class="n">account_checking</span><span class="p">,</span> <span class="s2">&quot;CCY&quot;</span><span class="p">)</span>
    <span class="n">banking_entries</span> <span class="o">=</span> <span class="n">generate_banking</span><span class="p">(</span>
        <span class="n">entries_for_banking</span><span class="p">,</span> <span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="n">minimum</span><span class="p">,</span> <span class="n">ZERO</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating Transfers to Investment Account&quot;</span><span class="p">)</span>
    <span class="n">banking_transfers</span> <span class="o">=</span> <span class="n">generate_outgoing_transfers</span><span class="p">(</span>
        <span class="n">data</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span>
            <span class="n">income_entries</span>
            <span class="o">+</span> <span class="n">banking_entries</span>
            <span class="o">+</span> <span class="n">banking_expenses</span>
            <span class="o">+</span> <span class="n">credit_entries</span>
            <span class="o">+</span> <span class="n">tax_entries</span>
        <span class="p">),</span>
        <span class="n">account_checking</span><span class="p">,</span>
        <span class="n">account_investing</span><span class="p">,</span>
        <span class="n">transfer_minimum</span><span class="o">=</span><span class="n">D</span><span class="p">(</span><span class="s2">&quot;200&quot;</span><span class="p">),</span>
        <span class="n">transfer_threshold</span><span class="o">=</span><span class="n">D</span><span class="p">(</span><span class="s2">&quot;3000&quot;</span><span class="p">),</span>
        <span class="n">transfer_increment</span><span class="o">=</span><span class="n">D</span><span class="p">(</span><span class="s2">&quot;500&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating Prices&quot;</span><span class="p">)</span>
    <span class="c1"># Generate price entries for investment currencies and create a price map to</span>
    <span class="c1"># use for later for generating investment transactions.</span>
    <span class="n">funds_allocation</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;MFUND1&quot;</span><span class="p">:</span> <span class="mf">0.40</span><span class="p">,</span> <span class="s2">&quot;MFUND2&quot;</span><span class="p">:</span> <span class="mf">0.60</span><span class="p">}</span>
    <span class="n">stocks</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;STK1&quot;</span><span class="p">,</span> <span class="s2">&quot;STK2&quot;</span><span class="p">,</span> <span class="s2">&quot;STK3&quot;</span><span class="p">,</span> <span class="s2">&quot;STK4&quot;</span><span class="p">]</span>
    <span class="n">price_entries</span> <span class="o">=</span> <span class="n">generate_prices</span><span class="p">(</span>
        <span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">funds_allocation</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="n">stocks</span><span class="p">,</span> <span class="s2">&quot;CCY&quot;</span>
    <span class="p">)</span>
    <span class="n">price_map</span> <span class="o">=</span> <span class="n">prices</span><span class="o">.</span><span class="n">build_price_map</span><span class="p">(</span><span class="n">price_entries</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating Employer Match Contribution&quot;</span><span class="p">)</span>
    <span class="n">account_match</span> <span class="o">=</span> <span class="s2">&quot;Income:US:Employer1:Match401k&quot;</span>
    <span class="n">retirement_match</span> <span class="o">=</span> <span class="n">generate_retirement_employer_match</span><span class="p">(</span>
        <span class="n">income_entries</span><span class="p">,</span> <span class="n">join</span><span class="p">(</span><span class="n">account_retirement</span><span class="p">,</span> <span class="s2">&quot;Cash&quot;</span><span class="p">),</span> <span class="n">account_match</span>
    <span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating Retirement Investments&quot;</span><span class="p">)</span>
    <span class="n">retirement_entries</span> <span class="o">=</span> <span class="n">generate_retirement_investments</span><span class="p">(</span>
        <span class="n">income_entries</span> <span class="o">+</span> <span class="n">retirement_match</span><span class="p">,</span>
        <span class="n">account_retirement</span><span class="p">,</span>
        <span class="nb">sorted</span><span class="p">(</span><span class="n">funds_allocation</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span>
        <span class="n">price_map</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating Taxes Investments&quot;</span><span class="p">)</span>
    <span class="n">investment_entries</span> <span class="o">=</span> <span class="n">generate_taxable_investment</span><span class="p">(</span>
        <span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">banking_transfers</span><span class="p">,</span> <span class="n">price_map</span><span class="p">,</span> <span class="n">stocks</span>
    <span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating Expense Accounts&quot;</span><span class="p">)</span>
    <span class="n">expense_accounts_entries</span> <span class="o">=</span> <span class="n">generate_expense_accounts</span><span class="p">(</span><span class="n">date_birth</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating Equity Accounts&quot;</span><span class="p">)</span>
    <span class="n">equity_entries</span> <span class="o">=</span> <span class="n">generate_open_entries</span><span class="p">(</span><span class="n">date_birth</span><span class="p">,</span> <span class="p">[</span><span class="n">account_opening</span><span class="p">,</span> <span class="n">account_payable</span><span class="p">])</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating Balance Checks&quot;</span><span class="p">)</span>
    <span class="n">credit_checks</span> <span class="o">=</span> <span class="n">generate_balance_checks</span><span class="p">(</span>
        <span class="n">credit_entries</span><span class="p">,</span> <span class="n">account_credit</span><span class="p">,</span> <span class="n">date_random_seq</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">banking_checks</span> <span class="o">=</span> <span class="n">generate_balance_checks</span><span class="p">(</span>
        <span class="n">data</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span>
            <span class="n">income_entries</span>
            <span class="o">+</span> <span class="n">banking_entries</span>
            <span class="o">+</span> <span class="n">banking_expenses</span>
            <span class="o">+</span> <span class="n">banking_transfers</span>
            <span class="o">+</span> <span class="n">credit_entries</span>
            <span class="o">+</span> <span class="n">tax_entries</span>
        <span class="p">),</span>
        <span class="n">account_checking</span><span class="p">,</span>
        <span class="n">date_random_seq</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Outputting and Formatting Entries&quot;</span><span class="p">)</span>
    <span class="n">dcontext</span> <span class="o">=</span> <span class="n">display_context</span><span class="o">.</span><span class="n">DisplayContext</span><span class="p">()</span>
    <span class="n">default_int_digits</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="k">for</span> <span class="n">currency</span><span class="p">,</span> <span class="n">precision</span> <span class="ow">in</span> <span class="p">{</span>
        <span class="s2">&quot;USD&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;CAD&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;VACHR&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;IRAUSD&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;VBMPX&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;RGAGX&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;ITOT&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;VEA&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;VHT&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;GLD&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">}</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">int_digits</span> <span class="o">=</span> <span class="n">default_int_digits</span>
        <span class="k">if</span> <span class="n">precision</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">int_digits</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">precision</span>
        <span class="n">dcontext</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">D</span><span class="p">(</span><span class="s2">&quot;{{:0</span><span class="si">{}</span><span class="s2">.</span><span class="si">{}</span><span class="s2">f}}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">int_digits</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span> <span class="n">currency</span><span class="p">)</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">output_section</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">entries</span><span class="p">):</span>
        <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n\n</span><span class="si">{}</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">title</span><span class="p">))</span>
        <span class="n">printer</span><span class="o">.</span><span class="n">print_entries</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span><span class="n">entries</span><span class="p">),</span> <span class="n">dcontext</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

    <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">FILE_PREAMBLE</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>
    <span class="n">output_section</span><span class="p">(</span><span class="s2">&quot;* Commodities&quot;</span><span class="p">,</span> <span class="n">commodity_entries</span><span class="p">)</span>
    <span class="n">output_section</span><span class="p">(</span><span class="s2">&quot;* Equity Accounts&quot;</span><span class="p">,</span> <span class="n">equity_entries</span><span class="p">)</span>
    <span class="n">output_section</span><span class="p">(</span>
        <span class="s2">&quot;* Banking&quot;</span><span class="p">,</span>
        <span class="n">data</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span>
            <span class="n">banking_entries</span> <span class="o">+</span> <span class="n">banking_expenses</span> <span class="o">+</span> <span class="n">banking_transfers</span> <span class="o">+</span> <span class="n">banking_checks</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">output_section</span><span class="p">(</span><span class="s2">&quot;* Credit-Cards&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span><span class="n">credit_entries</span> <span class="o">+</span> <span class="n">credit_checks</span><span class="p">))</span>
    <span class="n">output_section</span><span class="p">(</span><span class="s2">&quot;* Taxable Investments&quot;</span><span class="p">,</span> <span class="n">investment_entries</span><span class="p">)</span>
    <span class="n">output_section</span><span class="p">(</span>
        <span class="s2">&quot;* Retirement Investments&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span><span class="n">retirement_entries</span> <span class="o">+</span> <span class="n">retirement_match</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">output_section</span><span class="p">(</span><span class="s2">&quot;* Sources of Income&quot;</span><span class="p">,</span> <span class="n">income_entries</span><span class="p">)</span>
    <span class="n">output_section</span><span class="p">(</span><span class="s2">&quot;* Taxes&quot;</span><span class="p">,</span> <span class="n">tax_preamble</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">year</span><span class="p">,</span> <span class="n">entries</span> <span class="ow">in</span> <span class="n">taxes</span><span class="p">:</span>
        <span class="n">output_section</span><span class="p">(</span><span class="s2">&quot;** Tax Year </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">year</span><span class="p">),</span> <span class="n">entries</span><span class="p">)</span>
    <span class="n">output_section</span><span class="p">(</span><span class="s2">&quot;* Expenses&quot;</span><span class="p">,</span> <span class="n">expense_accounts_entries</span><span class="p">)</span>
    <span class="n">output_section</span><span class="p">(</span><span class="s2">&quot;* Prices&quot;</span><span class="p">,</span> <span class="n">price_entries</span><span class="p">)</span>
    <span class="n">output_section</span><span class="p">(</span><span class="s2">&quot;* Cash&quot;</span><span class="p">,</span> <span class="p">[])</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Contextualizing to Realistic Names&quot;</span><span class="p">)</span>
    <span class="n">contents</span><span class="p">,</span> <span class="n">replacements</span> <span class="o">=</span> <span class="n">contextualize_file</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="n">employer_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">reformat</span><span class="p">:</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="nb">format</span><span class="o">.</span><span class="n">align_beancount</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Writing contents&quot;</span><span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Validating Results&quot;</span><span class="p">)</span>
    <span class="n">validate_output</span><span class="p">(</span>
        <span class="n">contents</span><span class="p">,</span>
        <span class="p">[</span><span class="n">replace</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">replacements</span><span class="p">)</span> <span class="k">for</span> <span class="n">account</span> <span class="ow">in</span> <span class="p">[</span><span class="n">account_checking</span><span class="p">]],</span>
        <span class="n">replace</span><span class="p">(</span><span class="s2">&quot;CCY&quot;</span><span class="p">,</span> <span class="n">replacements</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="beancount.scripts.format" class="doc doc-heading">
        <code>beancount.scripts.format</code>



<a href="#beancount.scripts.format" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents ">




  <div class="doc doc-children">












  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.format.align_beancount" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">align_beancount</span><span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="n">prefix_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">currency_column</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#beancount.scripts.format.align_beancount" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Reformat Beancount input to align all the numbers at the same column.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>contents</strong> – A string, Beancount input syntax to reformat.</p></li>
            <li><p><strong>prefix_width</strong> – An integer, the width in characters to render the account
name to. If this is not specified, a good value is selected
automatically from the contents of the file.</p></li>
            <li><p><strong>num_width</strong> – An integer, the width to render each number. If this is not
specified, a good value is selected automatically from the contents of
the file.</p></li>
            <li><p><strong>currency_column</strong> – An integer, the column at which to align the currencies.
If given, this overrides the other options.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>A string, reformatted Beancount input with all the number aligned.
No other changes than whitespace changes should be present between that
return value and the input contents.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/scripts/format.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">align_beancount</span><span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="n">prefix_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">currency_column</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reformat Beancount input to align all the numbers at the same column.</span>

<span class="sd">    Args:</span>
<span class="sd">      contents: A string, Beancount input syntax to reformat.</span>
<span class="sd">      prefix_width: An integer, the width in characters to render the account</span>
<span class="sd">        name to. If this is not specified, a good value is selected</span>
<span class="sd">        automatically from the contents of the file.</span>
<span class="sd">      num_width: An integer, the width to render each number. If this is not</span>
<span class="sd">        specified, a good value is selected automatically from the contents of</span>
<span class="sd">        the file.</span>
<span class="sd">      currency_column: An integer, the column at which to align the currencies.</span>
<span class="sd">        If given, this overrides the other options.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, reformatted Beancount input with all the number aligned.</span>
<span class="sd">      No other changes than whitespace changes should be present between that</span>
<span class="sd">      return value and the input contents.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find all lines that have a number in them and calculate the maximum length</span>
    <span class="c1"># of the stripped prefix and the number.</span>
    <span class="n">match_pairs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">contents</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">regex</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
            <span class="sa">rf</span><span class="s1">&#39;(^\d[^&quot;;]*?|\s+</span><span class="si">{</span><span class="n">account</span><span class="o">.</span><span class="n">ACCOUNT_RE</span><span class="si">}</span><span class="s1">)\s+&#39;</span>
            <span class="sa">rf</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">PARENTHESIZED_BINARY_OP_RE</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="n">NUMBER_RE</span><span class="si">}</span><span class="s2">)\s+&quot;</span>
            <span class="sa">rf</span><span class="s2">&quot;((?:</span><span class="si">{</span><span class="n">amount</span><span class="o">.</span><span class="n">CURRENCY_RE</span><span class="si">}</span><span class="s2">)\b.*)&quot;</span><span class="p">,</span>
            <span class="n">line</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">prefix</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
            <span class="n">match_pairs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">prefix</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">rest</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">match_pairs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">line</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

    <span class="c1"># Normalize whitespace before lines that has some indent and an account</span>
    <span class="c1"># name.</span>
    <span class="n">norm_match_pairs</span> <span class="o">=</span> <span class="n">normalize_indent_whitespace</span><span class="p">(</span><span class="n">match_pairs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">currency_column</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">rest</span> <span class="ow">in</span> <span class="n">norm_match_pairs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">number</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">num_of_spaces</span> <span class="o">=</span> <span class="n">currency_column</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="o">-</span> <span class="mi">4</span>
                <span class="n">spaces</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">num_of_spaces</span>
                <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">spaces</span> <span class="o">+</span> <span class="s2">&quot;  &quot;</span> <span class="o">+</span> <span class="n">number</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">rest</span><span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

    <span class="c1"># Compute the maximum widths.</span>
    <span class="n">filtered_pairs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">number</span><span class="p">)</span> <span class="k">for</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">match_pairs</span> <span class="k">if</span> <span class="n">number</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="p">]</span>

    <span class="k">if</span> <span class="n">filtered_pairs</span><span class="p">:</span>
        <span class="n">max_prefix_width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="k">for</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">filtered_pairs</span><span class="p">)</span>
        <span class="n">max_num_width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">number</span> <span class="ow">in</span> <span class="n">filtered_pairs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">max_prefix_width</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_num_width</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Use user-supplied overrides, if available</span>
    <span class="k">if</span> <span class="n">prefix_width</span><span class="p">:</span>
        <span class="n">max_prefix_width</span> <span class="o">=</span> <span class="n">prefix_width</span>
    <span class="k">if</span> <span class="n">num_width</span><span class="p">:</span>
        <span class="n">max_num_width</span> <span class="o">=</span> <span class="n">num_width</span>

    <span class="c1"># Create a format that will admit the maximum width of all prefixes equally.</span>
    <span class="n">line_format</span> <span class="o">=</span> <span class="s2">&quot;{{:&lt;</span><span class="si">{prefix_width}</span><span class="s2">}}  {{:&gt;</span><span class="si">{num_width}</span><span class="s2">}} {{}}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">prefix_width</span><span class="o">=</span><span class="n">max_prefix_width</span><span class="p">,</span> <span class="n">num_width</span><span class="o">=</span><span class="n">max_num_width</span>
    <span class="p">)</span>

    <span class="c1"># Process each line to an output buffer.</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">rest</span> <span class="ow">in</span> <span class="n">norm_match_pairs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">number</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prefix</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(),</span> <span class="n">number</span><span class="p">,</span> <span class="n">rest</span><span class="p">))</span>
        <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">formatted_contents</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

    <span class="c1"># Ensure that the file before and after have only whitespace differences.</span>
    <span class="c1"># This is a sanity check, to make really sure we never change anything but whitespace,</span>
    <span class="c1"># so it&#39;s safe.</span>
    <span class="c1"># open(&#39;/tmp/before&#39;, &#39;w&#39;).write(regex.sub(r&#39;[ \t]+&#39;, &#39; &#39;, contents))</span>
    <span class="c1"># open(&#39;/tmp/after&#39;, &#39;w&#39;).write(regex.sub(r&#39;[ \t]+&#39;, &#39; &#39;, formatted_contents))</span>
    <span class="n">old_stripped</span> <span class="o">=</span> <span class="n">regex</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[ \t\n]+&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">contents</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
    <span class="n">new_stripped</span> <span class="o">=</span> <span class="n">regex</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[ \t\n]+&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">formatted_contents</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
    <span class="k">assert</span> <span class="n">old_stripped</span> <span class="o">==</span> <span class="n">new_stripped</span><span class="p">,</span> <span class="p">(</span><span class="n">old_stripped</span><span class="p">,</span> <span class="n">new_stripped</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">formatted_contents</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.format.compute_most_frequent" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">compute_most_frequent</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span></code>


<a href="#beancount.scripts.format.compute_most_frequent" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Compute the frequencies of the given elements and return the most frequent.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>iterable</strong> – A collection of hashable elements.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>The most frequent element. If there are no elements in the iterable,
return None.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/scripts/format.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">compute_most_frequent</span><span class="p">(</span><span class="n">iterable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the frequencies of the given elements and return the most frequent.</span>

<span class="sd">    Args:</span>
<span class="sd">      iterable: A collection of hashable elements.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The most frequent element. If there are no elements in the iterable,</span>
<span class="sd">      return None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">frequencies</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">frequencies</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">((</span><span class="n">count</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span> <span class="k">for</span> <span class="n">element</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">frequencies</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="c1"># Note: In case of a tie, this chooses the longest width.</span>
    <span class="c1"># We could eventually make this an option.</span>
    <span class="k">return</span> <span class="n">counts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="beancount.scripts.format.normalize_indent_whitespace" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beancount</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">normalize_indent_whitespace</span><span class="p">(</span><span class="n">match_pairs</span><span class="p">)</span></code>


<a href="#beancount.scripts.format.normalize_indent_whitespace" class="headerlink" title="Permanent link"></a></h3>

    <div class="doc doc-contents ">

      <p>Normalize whitespace before lines that has some indent and an account name.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>match_pairs</strong> – A list of (prefix, number, rest) tuples.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>Another list of (prefix, number, rest) tuples, where prefix may have been
adjusted with a different whitespace prefix.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>beancount/scripts/format.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">normalize_indent_whitespace</span><span class="p">(</span><span class="n">match_pairs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Normalize whitespace before lines that has some indent and an account name.</span>

<span class="sd">    Args:</span>
<span class="sd">      match_pairs: A list of (prefix, number, rest) tuples.</span>
<span class="sd">    Returns:</span>
<span class="sd">      Another list of (prefix, number, rest) tuples, where prefix may have been</span>
<span class="sd">      adjusted with a different whitespace prefix.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Compute most frequent account name prefix.</span>
    <span class="n">match_posting</span> <span class="o">=</span> <span class="n">regex</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;([ \t]+)(</span><span class="si">{}</span><span class="s2">.*)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">account</span><span class="o">.</span><span class="n">ACCOUNT_RE</span><span class="p">))</span><span class="o">.</span><span class="n">match</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">compute_most_frequent</span><span class="p">(</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="p">(</span><span class="n">match_posting</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="k">for</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">match_pairs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="p">)</span>
    <span class="n">norm_format</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">width</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span>

    <span class="c1"># Make the necessary adjustments.</span>
    <span class="n">adjusted_pairs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">match_pairs</span><span class="p">:</span>
        <span class="n">prefix</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">tup</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">match_posting</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tup</span> <span class="o">=</span> <span class="p">(</span><span class="n">norm_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="n">number</span><span class="p">,</span> <span class="n">rest</span><span class="p">)</span>
        <span class="n">adjusted_pairs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tup</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">adjusted_pairs</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>




  </div>

    </div>

  </div>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="beancount.tools.html" class="btn btn-neutral float-right" title="beancount.tools">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="beancount.plugins.html" class="btn btn-neutral" title="beancount.plugins"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="beancount.plugins.html" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="beancount.tools.html" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
